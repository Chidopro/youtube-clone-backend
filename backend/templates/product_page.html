<!DOCTYPE html>
<html>
<head>
  <title>🎯 UPDATED v2.0 - Customize Your Product</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎯</text></svg>">
     <style>
     body { 
       font-family: Arial, sans-serif; 
       background: #f9f9f9; 
       text-align: center; 
       padding: 0; 
       margin: 0; 
       overflow-x: hidden;
       width: 100%;
       box-sizing: border-box;
     }
     h1 { color: #3f51b5; }
    
         /* Ensure main container is always visible */
     .main-container {
       display: flex;
       width: 100%;
       padding: 20px;
       gap: 20px;
       min-height: 400px;
       overflow-x: hidden;
       box-sizing: border-box;
     }
    
         /* Simple Logo Header */
     .simple-header {
       background: white;
       padding: 5px 2%;
       position: relative;
       z-index: 10;
       border-bottom: 1px solid #eee;
     }

    .simple-header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: flex-start;
      align-items: center;
    }

    .simple-logo {
      display: flex;
      align-items: center;
    }

    .simple-logo .logo-img {
      width: 40px;
      height: 40px;
      display: block;
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .menu-icon {
      width: 24px;
      height: 24px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .menu-icon span {
      width: 100%;
      height: 3px;
      background: #333;
      border-radius: 2px;
    }

    .header-logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-img {
      width: 32px;
      height: 32px;
      display: block;
    }

    .logo-text {
      font-size: 1.2rem;
      font-weight: bold;
      color: #333;
    }

    .search-container {
      flex: 1;
      max-width: 500px;
      margin: 0 20px;
      position: relative;
    }

    .search-input {
      width: 500px;
      padding: 12px 18px;
      border: 1px solid #ccc;
      border-radius: 30px;
      font-size: 16px;
      background: transparent;
      outline: 0;
      transition: border-color 0.2s ease;
    }

    .search-input:focus {
      border-color: #065fd4;
    }

    .search-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      color: #666;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .subscribe-btn {
      background: #cc0000;
      color: white;
      border: 1px solid #cc0000;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.2s ease;
    }

    .subscribe-btn:hover {
      background: #a00000;
      transform: translateY(-1px);
    }

    .signin-btn {
      background: #065fd4;
      color: white;
      border: 1px solid #065fd4;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .signin-btn:hover {
      background: #0448a0;
      transform: translateY(-1px);
    }
    
         /* User Flow Section Styles */
     .user-flow-section {
       background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
       margin: 0;
       padding: 40px 20px;
       color: white;
       text-align: center;
       display: flex;
       justify-content: space-between;
       align-items: center;
       position: relative;
       width: 100%;
       box-sizing: border-box;
       min-height: 120px;
     }

    .flow-steps {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: nowrap;
      gap: 12px;
      max-width: 800px;
      margin: 0 auto;
    }

    .flow-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      min-width: 130px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .flow-step:hover {
      transform: translateY(-2px);
    }

                   .step-number {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        font-weight: bold;
        margin-bottom: 6px;
        transition: all 0.3s ease;
      }

    .flow-step:hover .step-number {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }

                   .step-content h3 {
        margin: 0 0 3px 0;
        font-size: 0.9rem;
        font-weight: 600;
        color: white;
      }

      .step-content p {
        margin: 0;
        font-size: 0.7rem;
        opacity: 0.9;
        line-height: 1.1;
      }

    .flow-arrow {
      font-size: 1.3rem;
      color: rgba(255, 255, 255, 0.7);
      font-weight: bold;
      margin: 0 6px;
    }

         /* Shipping Information */
     .shipping-info {
       display: flex;
       gap: 20px;
       align-items: center;
       margin-top: 0;
       position: absolute;
       top: 10px;
       right: 20px;
       z-index: 5;
     }

    .shipping-item {
      display: flex;
      align-items: center;
      gap: 5px;
      color: white;
      font-size: 0.8rem;
    }

    .shipping-icon {
      font-size: 1rem;
    }

    .shipping-text {
      font-weight: 500;
    }
    
    /* Responsive adjustments */
    @media (max-width: 1200px) {
      .top-section-content {
        flex-direction: column;
        gap: 15px;
      }
      
      .products-selected {
        width: auto;
        margin-bottom: 20px;
      }
      
      .products-section {
        margin-right: 0;
      }
      
      .main-container {
        flex-direction: column;
      }
    }
    
    @media (max-width: 768px) {
      .top-section {
        padding: 15px;
        margin: 15px auto;
      }
      
      .top-section-content {
        gap: 12px;
        flex-direction: column;
      }
      
       /* Hide desktop cart button on mobile */
       .desktop-cart-button {
         display: none !important;
       }
       
       /* Show mobile action buttons on mobile */
        .mobile-action-buttons {
          display: flex !important;
          gap: 10px;
          margin: 15px 0;
          justify-content: center;
          width: 100%;
        }
        
       /* Hide mobile buttons when category selection is shown */
        .category-selection-landing ~ .mobile-action-buttons,
        .category-selection-landing + .mobile-action-buttons,
        .mobile-action-buttons[data-category-page="true"] {
          display: none !important;
        }
        

      
      .screenshots-section h3 {
        font-size: 16px;
        margin-bottom: 12px;
        text-align: center;
      }
      
      /* Mobile orientation - center screenshots title */
      @media (max-width: 768px) {
        #screenshotsTitle {
          text-align: center;
          font-weight: bold;
          color: #333;
          font-size: 18px;
          margin-bottom: 15px;
        }
      }
      
      /* Fix screenshot layout on mobile */
      .screenshot-preview-row {
        flex-wrap: wrap;
        overflow-x: visible;
        justify-content: center;
        gap: 8px;
        padding: 0 5px;
      }
      
      .screenshot-thumbnails {
        flex-wrap: wrap;
        overflow-x: visible;
        justify-content: center;
        gap: 8px;
        margin-left: 0;
      }
      
      .video-thumbnail,
      .screenshot-thumbnail {
        width: 80px;
        height: 60px;
        flex-shrink: 0;
      }
      
      /* Prevent horizontal scrolling on mobile */
      body {
        overflow-x: hidden;
      }
      
      .main-container {
        overflow-x: hidden;
        width: 100%;
        max-width: 100%;
      }
      
      .top-section {
        overflow-x: hidden;
        width: 100%;
        max-width: 100%;
      }
    }

         /* Top Section - Thumbnails and Screenshots with Products Selected Sidebar */
        .top-section {
          background: #fff;
          border-radius: 12px;
          padding: 20px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          margin: 20px 0;
          width: 100%;
          box-sizing: border-box;
          overflow-x: hidden;
        }
      
             .top-section-content {
         display: flex;
         gap: 20px;
         align-items: flex-start;
         margin-top: -20px;
       }
      
      .screenshots-section {
        flex: 1;
        min-width: 0; /* Allow flex item to shrink */
        position: relative; /* For absolute positioning of counter */
      }
    
    .top-section h3 {
      margin-top: 0;
      margin-bottom: 15px;
      color: #333;
    }

         /* Main Layout Container */
     .main-container {
       display: flex;
       max-width: 1200px; /* Reduced max-width to center better */
       margin: 0 auto;
       padding: 0 20px 20px 20px;
       gap: 20px;
       min-height: 100vh;
     }

         /* Products Selected Sidebar */
     .products-selected {
       width: 300px;
       background: #fff;
       border-radius: 12px;
       padding: 20px;
       box-shadow: 0 2px 10px rgba(0,0,0,0.1);
       min-height: 200px;
       flex-shrink: 0; /* Prevent sidebar from shrinking */
     }
     
     /* When on category selection page, make screenshots section take full width */
     .top-section.category-selection-mode .screenshots-section {
       flex: 1;
       width: 100%;
     }
    
    .products-selected h3 {
      margin-top: 0;
      margin-bottom: 15px;
      color: #333;
      font-size: 16px;
    }

         /* Right Column - Available Products */
      .products-section {
        flex: 1;
        min-width: 400px;
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        box-sizing: border-box;
        overflow-x: hidden;
      }

         /* Category Navigation Icons */
      .category-navigation {
        margin-bottom: 20px;
        border-bottom: 1px solid #eee;
        padding-bottom: 15px;
        text-align: center;
      }

      .category-nav-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 15px;
        text-align: center;
      }

      .category-icons {
        display: flex;
        flex-wrap: nowrap;
        gap: 12px;
        justify-content: center;
        align-items: center;
        max-width: 100%;
        overflow-x: auto;
        padding: 5px 0;
      }

      .category-icon {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 12px 8px;
        border-radius: 12px;
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 70px;
        text-decoration: none;
        flex-shrink: 0;
      }

      .category-icon:hover {
        background: #e3f2fd;
        border-color: #2196f3;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(33, 150, 243, 0.2);
      }

      .category-icon .icon {
        font-size: 28px;
        margin-bottom: 4px;
      }

      .category-icon .label {
        font-size: 11px;
        font-weight: 600;
        color: #333;
        text-align: center;
        line-height: 1.2;
      }

      .category-icon:hover .label {
        color: #2196f3;
      }

    .preview-image {
      max-width: 100%;
      width: 100%;
      height: auto;
      margin-bottom: 10px;
      border-radius: 10px;
      cursor: pointer;
      box-sizing: border-box;
      display: block;
    }
         .screenshot-preview-row { 
          display: flex; 
          flex-direction: row;
          gap: 10px;
          margin: 6px 0 10px 0;
          min-height: 90px;
          align-items: center;
          justify-content: flex-start;
          flex-wrap: nowrap;
          overflow-x: auto;
          width: 100%;
          padding: 0 10px;
        }
      
         /* Video thumbnail styling */
         .video-thumbnail {
           width: 120px;
           height: 90px;
           object-fit: cover;
           border-radius: 8px;
           border: 2px solid #4CAF50;
           cursor: pointer;
           flex-shrink: 0;
         }
    
         /* Screenshot thumbnails container */
        .screenshot-thumbnails {
          display: flex;
          flex-direction: row;
          gap: 10px;
          flex: 1;
          margin-left: 8px;
          overflow-x: auto;
          scrollbar-width: thin;
          justify-content: center;
          width: 100%;
        }
    
         /* Individual screenshot styling */
        .screenshot-thumbnail {
          width: 120px;
          height: 90px;
          object-fit: cover;
          border-radius: 8px;
          cursor: pointer;
          border: 1px solid #ddd;
          transition: border-color 0.2s;
          flex-shrink: 0;
        }
    
    .screenshot-thumbnail:hover {
      border-color: #4CAF50;
    }
    .screenshot-preview-row img {
      border-radius: 4px;
      border: 2px solid #ccc;
      object-fit: cover;
      cursor: pointer;
      box-sizing: border-box;
    }
    .selected-image {
      border: 4px solid #4CAF50 !important;
      box-shadow: 0 0 8px #4CAF50;
      box-sizing: border-box;
    }
    .product-row { 
      display: grid; 
      grid-template-columns: repeat(3, 1fr); 
      gap: 15px; 
      margin-top: 20px; 
      justify-items: center;
    }
    .product-card { background: #fff; padding: 15px; border-radius: 8px; width: 100%; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #eee; }
    .product-card img { width: 100%; height: auto; border-radius: 6px; margin-bottom: 10px; object-fit: contain; }
    .product-title { font-weight: bold; margin: 10px 0 5px; font-size: 14px; }
    .product-price { color: #444; margin-bottom: 10px; font-size: 12px; }
    .note-input { width: 100%; padding: 6px; margin-bottom: 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px; }
    .variant-selector { margin-bottom: 12px; background: #f0f4ff; border: 1px solid #bfcfff; border-radius: 6px; padding: 10px; }
    .variant-selector label { display: block; text-align: left; margin-bottom: 4px; color: #3f51b5; font-weight: bold; font-size: 12px; }
    .variant-selector select { width: 100%; padding: 6px; border: 1.5px solid #3f51b5; border-radius: 4px; background: #fff; font-size: 12px; }
    .btn { background: #3f51b5; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; }
    .btn:hover { background: #2c3cb5; }
    
    /* Remove the old cart sidebar */
    #cart-sidebar { 
      display: none;
    }
    
         /* Mobile Responsive */
     @media (max-width: 768px) {
       /* Prevent all horizontal scrolling */
       body {
         overflow-x: hidden !important;
         width: 100% !important;
         max-width: 100% !important;
         box-sizing: border-box !important;
       }
       
       .main-container {
         flex-direction: column;
         padding: 10px;
         gap: 15px;
         overflow-x: hidden;
         width: 100%;
         max-width: 100%;
         box-sizing: border-box;
       }
       
       .left-column {
         min-width: auto;
         max-width: 100%;
         overflow-x: hidden;
       }
       
       .right-column {
         min-width: auto;
         overflow-x: hidden;
       }
       
       .screenshots-selected,
       .products-selected,
       .products-section {
         padding: 15px;
         margin-bottom: 15px;
         overflow-x: hidden;
         width: 100%;
         box-sizing: border-box;
       }
       
       .screenshot-preview-row {
         min-height: 100px;
         margin: 8px 0 10px 0;
         flex-wrap: wrap;
         overflow-x: hidden;
         justify-content: center;
         gap: 8px;
         width: 100%;
         box-sizing: border-box;
       }
       
       .video-thumbnail {
         height: 30px;
         margin-bottom: 3px;
         max-width: 100% !important;
       }
       
       .screenshot-thumbnails {
         display: flex;
         flex-wrap: wrap;
         overflow-x: hidden;
         justify-content: center;
         gap: 8px;
         margin-top: 8px;
         margin-left: 0;
         width: 100%;
         box-sizing: border-box;
       }
       
       .screenshot-thumbnail {
         width: 80px;
         height: 60px;
         flex-shrink: 0;
         max-width: 100%;
       }
       
       .product-row {
         grid-template-columns: 1fr;
         gap: 12px;
         margin-top: 15px;
         overflow-x: hidden;
       }
       
       .product-card {
         padding: 12px;
         overflow-x: hidden;
         width: 100%;
         box-sizing: border-box;
       }
       
       .product-card img {
         height: 120px;
         max-width: 100% !important;
       }
       
       .variant-selector {
         padding: 8px;
         margin-bottom: 10px;
         overflow-x: hidden;
       }
       
       .variant-selector label {
         font-size: 11px;
       }
       
       .variant-selector select {
         padding: 5px;
         font-size: 11px;
         max-width: 100% !important;
       }
       
       .note-input {
         padding: 5px;
         font-size: 11px;
         margin-bottom: 10px;
         max-width: 100%;
         box-sizing: border-box;
       }
       
       /* Additional mobile stabilization */
       .category-grid {
          display: grid;
          grid-template-columns: repeat(5, 1fr);
          gap: 20px;
          max-width: 800px;
          margin: 0 auto;
        }
        
       @media (max-width: 768px) {
         .category-grid {
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 100%;
            overflow-x: hidden;
          }
        }
       
       .category-card {
          cursor: pointer;
          padding: 20px;
          background: #f8f9fa;
          border-radius: 12px;
          transition: all 0.3s;
          border: 2px solid transparent;
          max-width: 100%;
          box-sizing: border-box;
          overflow-x: hidden;
          min-height: 80px;
        }
        
       @media (max-width: 768px) {
         .category-card {
            padding: 15px 10px;
            min-height: 80px;
          }
        }
        
        .category-icon {
          font-size: 2.5rem;
          display: block;
          margin-bottom: 8px;
        }
        
        .category-label {
          font-weight: 600;
          color: #333;
        }
        
        @media (max-width: 768px) {
          .category-icon {
            font-size: 1.8rem;
            margin-bottom: 5px;
          }
          
          .category-label {
            font-size: 0.7rem;
            line-height: 1.2;
          }
        }
       
       .category-selection-landing {
         text-align: center;
         padding: 40px 20px;
         box-sizing: border-box;
         overflow-x: hidden;
         width: 100%;
         max-width: 100%;
       }
       
       /* Prevent any horizontal scrolling on all elements */
       * {
         max-width: 100%;
         box-sizing: border-box;
       }
       
       .btn {
         padding: 10px 16px;
         font-size: 14px;
         width: 100%;
       }
       
       .user-flow-section {
          padding: 15px 12px;
          min-height: 80px;
          max-height: 100px;
          margin: -10px 0 20px 0;
          border-radius: 0;
          width: 100vw;
          position: relative;
          left: 50%;
          transform: translateX(-50%);
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          flex-direction: column;
          gap: 15px;
          justify-content: center;
        }
       
       .user-flow-section .flow-steps {
         flex-direction: row;
         gap: 8px;
         justify-content: space-evenly;
         flex-wrap: nowrap;
         width: 100%;
         padding: 0 10px;
         position: static;
         transform: none;
         left: auto;
         margin: 0 auto;
       }
       
       .user-flow-section .flow-arrow {
         display: none;
       }
       
       .user-flow-section .flow-step {
          min-width: auto;
          flex-direction: column;
          gap: 2px;
          flex: 1;
          max-width: none;
          align-items: center;
          padding-top: 8px;
        }
       
       .user-flow-section .step-number {
         width: 32px;
         height: 32px;
         font-size: 1rem;
         margin-bottom: 6px;
         padding: 2px;
       }
       
       .user-flow-section .step-content h3 {
         font-size: 0.8rem;
         margin: 0;
         line-height: 1.2;
         text-align: center;
       }
       
       .user-flow-section .step-content p {
         display: block;
         font-size: 0.6rem;
         margin: 0;
         line-height: 1.1;
         text-align: center;
       }
       
       /* Make content extend to full width like purple bar */
       .top-section {
         padding-left: 0 !important;
         padding-right: 0 !important;
         margin: 0 !important;
         width: 100vw !important;
         position: relative !important;
         left: 50% !important;
         transform: translateX(-50%) !important;
       }
       
       /* Ensure content extends to edges */
       .screenshots-section, .products-selected {
         margin-left: 0 !important;
         margin-right: 0 !important;
         width: 100% !important;
         max-width: 100% !important;
       }
       
       .shipping-info {
         position: static !important;
         top: auto !important;
         right: auto !important;
         justify-content: center;
         flex-wrap: wrap;
         gap: 10px;
         margin-top: 10px;
       }
       
       .shipping-item {
         font-size: 0.7rem;
         gap: 3px;
       }
       
       .shipping-icon {
         font-size: 0.9rem;
       }
       
       .step-number {
         width: 28px;
         height: 28px;
         font-size: 0.9rem;
       }
       
       .step-content h3 {
         font-size: 0.8rem;
       }
       
       .step-content p {
         font-size: 0.6rem;
       }
       
       /* Touch-friendly interactions */
       .screenshot-thumbnail,
       .video-thumbnail,
       .btn,
       .variant-selector select {
         min-height: 44px;
         touch-action: manipulation;
       }
       
       .screenshot-thumbnail:hover,
       .video-thumbnail:hover {
         transform: scale(1.05);
       }
       
       /* Better spacing for mobile */
       h3 {
         font-size: 1.1rem;
         margin-bottom: 10px;
       }
       
       .selected-products {
         min-height: 60px;
         display: flex;
         align-items: center;
         justify-content: center;
       }
     }
     
     /* Extra small mobile devices */
     @media (max-width: 480px) {
       .main-container {
         padding: 8px;
         gap: 12px;
       }
       
       .screenshots-selected,
       .products-selected,
       .products-section {
         padding: 12px;
       }
       
       .screenshot-thumbnails {
         grid-template-columns: repeat(2, 1fr);
         gap: 4px;
       }
       
       .product-card img {
         height: 120px;
       }
       
       .user-flow-section .flow-steps {
         gap: 4px;
         padding: 0 8px;
       }
       
       .user-flow-section .step-number {
         width: 28px;
         height: 28px;
         font-size: 0.9rem;
         padding: 2px;
         margin-bottom: 4px;
       }
       
       .user-flow-section .step-content h3 {
         font-size: 0.7rem;
         margin-bottom: 2px;
       }
       
       .user-flow-section .step-content p {
         font-size: 0.5rem;
       }
       
       .user-flow-section {
          padding: 12px 10px;
          min-height: 75px;
          max-height: 95px;
       }
       
       /* Make content extend to full width like purple bar */
       .top-section {
         padding-left: 0;
         padding-right: 0;
         margin: 0;
         width: 100vw;
         position: relative;
         left: 50%;
         transform: translateX(-50%);
       }
       
       /* Ensure content extends to edges */
       .screenshots-section, .products-selected {
         margin-left: 0;
         margin-right: 0;
         width: 100%;
         max-width: 100%;
       }
       
       .shipping-info {
         gap: 8px;
       }
       
       .shipping-item {
         font-size: 0.6rem;
       }
     }
  </style>
</head>
<body>
  
   

     <!-- User Flow Section - Only Step 3 since we're already at merchandise page -->
   <div class="user-flow-section">
     <div class="flow-steps">
       <div class="flow-step">
         <div class="step-number">3</div>
         <div class="step-content">
           <h3>Make Merchandise</h3>
           <p>Create custom products with your screenshot</p>
         </div>
       </div>
     </div>
   </div>

     <!-- Page Wrapper for consistent width -->
   <div style="max-width: 1200px; margin: 0 auto; padding: 0 20px; box-sizing: border-box;">
   
   <!-- Top Section - Thumbnails and Screenshots with Products Selected Sidebar -->
   <div class="top-section{% if show_category_selection %} category-selection-mode{% endif %}">
    <div class="top-section-content">
      <div class="screenshots-section">
        <h3 id="screenshotsTitle">Screenshots Selected</h3>
        <div id="screenshotCounter" style="
          position: absolute;
          top: 10px;
          right: 10px;
          background: #fff;
          border: 2px solid #ddd;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          font-size: 16px;
          color: #333;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          z-index: 100;
        "></div>
        <div class="screenshot-preview-row" id="screenshotPreviewRow">
          <!-- Video thumbnail will be auto-inserted here -->
        </div>
      </div>
       
               <!-- Mobile Action Buttons - Hidden on desktop, shown on mobile -->
        <div class="mobile-action-buttons" id="mobileActionButtons" style="display: none;" data-category-page="{{ 'true' if show_category_selection else 'false' }}">
         <button class="mobile-cart-btn" onclick="viewCart()" style="
           background: #007bff; 
           color: white; 
           border: none; 
           padding: 15px 20px; 
           border-radius: 8px; 
           cursor: pointer; 
           font-weight: bold; 
           font-size: 16px; 
           width: 48%; 
           display: flex; 
           align-items: center; 
           justify-content: center; 
           gap: 8px;
           box-shadow: 0 2px 8px rgba(0,0,0,0.1);
         ">
           🛒 View Cart
         </button>
         <button class="mobile-checkout-btn" onclick="goToCheckout()" style="
           background: #6c757d; 
           color: white; 
           border: none; 
           padding: 15px 20px; 
           border-radius: 8px; 
           cursor: pointer; 
           font-weight: bold; 
           font-size: 16px; 
           width: 48%; 
           display: flex; 
           align-items: center; 
           justify-content: center; 
           gap: 8px;
           box-shadow: 0 2px 8px rgba(0,0,0,0.1);
         ">
           🛍️ Checkout
         </button>
       </div>
    </div>
  </div>

     </div> <!-- Close page wrapper -->
   
   <!-- Main Layout -->
   <div class="main-container">

    <!-- Products Section -->
    <div class="products-section" id="productsSection">
      {% if show_category_selection %}
      <!-- Category Selection Landing -->
             <div class="category-selection-landing">
        <h2 style="color: #333; margin-bottom: 10px;">Choose a Product Category</h2>
        <p style="color: #666; margin-bottom: 30px;">Select a category to browse products for your custom merchandise</p>
        
                 <div class="category-grid" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; max-width: 800px; margin: 0 auto;">
           <div class="category-card" onclick="switchCategory('womens')">
             <span class="category-icon">👩</span>
             <span class="category-label">Women's</span>
           </div>
           <div class="category-card" onclick="switchCategory('mens')">
             <span class="category-icon">👨</span>
             <span class="category-label">Men's</span>
           </div>
           <div class="category-card" onclick="switchCategory('kids')">
             <span class="category-icon">👶</span>
             <span class="category-label">Kids</span>
           </div>
           <div class="category-card" onclick="switchCategory('mugs')">
             <span class="category-icon">☕</span>
             <span class="category-label">Mugs</span>
           </div>
           <div class="category-card" onclick="switchCategory('hats')">
             <span class="category-icon">🧢</span>
             <span class="category-label">Hats</span>
           </div>
           <div class="category-card" onclick="switchCategory('bags')">
             <span class="category-icon">👜</span>
             <span class="category-label">Bags</span>
           </div>
           <div class="category-card" onclick="switchCategory('pets')">
             <span class="category-icon">🐕</span>
             <span class="category-label">Pets</span>
           </div>
           <div class="category-card" onclick="switchCategory('stickers')">
             <span class="category-icon">🌟</span>
             <span class="category-label">Stickers & Magnets</span>
           </div>
           <div class="category-card" onclick="switchCategory('thumbnails')">
             <span class="category-icon">🖼️</span>
             <span class="category-label">Thumbnails</span>
           </div>
           <div class="category-card" onclick="switchCategory('misc')">
             <span class="category-icon">📦</span>
             <span class="category-label">Miscellaneous</span>
           </div>
           
         </div>
      </div>
      
      <style>
        .category-card:hover {
          transform: translateY(-4px);
          box-shadow: 0 8px 25px rgba(0,0,0,0.15);
          border-color: #4CAF50 !important;
          background: #fff !important;
        }
      </style>
      {% else %}
      <!-- Category Navigation Icons -->
      <div class="category-navigation">
        <div class="category-nav-title">Shop Other Categories:</div>
        <div class="category-icons">
          <div class="category-icon" onclick="switchCategory('womens')" title="Women's">
            <span class="icon">👩</span>
            <span class="label">Women's</span>
          </div>
          <div class="category-icon" onclick="switchCategory('mens')" title="Men's">
            <span class="icon">👨</span>
            <span class="label">Men's</span>
          </div>
          <div class="category-icon" onclick="switchCategory('kids')" title="Kids">
            <span class="icon">👶</span>
            <span class="label">Kids</span>
          </div>
          <div class="category-icon" onclick="switchCategory('mugs')" title="Mugs">
            <span class="icon">☕</span>
            <span class="label">Mugs</span>
          </div>
          <div class="category-icon" onclick="switchCategory('hats')" title="Hats">
            <span class="icon">🧢</span>
            <span class="label">Hats</span>
          </div>
          <div class="category-icon" onclick="switchCategory('bags')" title="Bags">
            <span class="icon">👜</span>
            <span class="label">Bags</span>
          </div>
          <div class="category-icon" onclick="switchCategory('pets')" title="Pets">
            <span class="icon">🐕</span>
            <span class="label">Pets</span>
          </div>
          <div class="category-icon" onclick="switchCategory('stickers')" title="Stickers">
            <span class="icon">🌟</span>
            <span class="label">Stickers</span>
          </div>
          <div class="category-icon" onclick="switchCategory('misc')" title="Misc">
            <span class="icon">📦</span>
            <span class="label">Misc</span>
          </div>
          <div class="category-icon" onclick="switchCategory('thumbnails')" title="Thumbnails">
            <span class="icon">🖼️</span>
            <span class="label">Thumbnails</span>
          </div>
        </div>
      </div>
      
      <!-- Desktop Cart Button - Shown on desktop, hidden on mobile -->
      {% if not show_category_selection %}
      <div class="desktop-cart-button" id="desktopCartButton" style="
        display: flex;
        gap: 10px;
        margin: 20px 0;
        justify-content: center;
        width: 100%;
      ">
        <button class="desktop-cart-btn" onclick="viewCart()" style="
          background: #007bff; 
          color: white; 
          border: none; 
          padding: 12px 24px; 
          border-radius: 8px; 
          cursor: pointer; 
          font-weight: bold; 
          font-size: 14px; 
          display: flex; 
          align-items: center; 
          justify-content: center; 
          gap: 8px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          transition: all 0.2s ease;
        ">
          🛒 View Cart
        </button>
        <button class="desktop-checkout-btn" onclick="goToCheckout()" style="
          background: #28a745; 
          color: white; 
          border: none; 
          padding: 12px 24px; 
          border-radius: 8px; 
          cursor: pointer; 
          font-weight: bold; 
          font-size: 14px; 
          display: flex; 
          align-items: center; 
          justify-content: center; 
          gap: 8px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          transition: all 0.2s ease;
        ">
          🛍️ Checkout
        </button>
      </div>
      {% endif %}
      
      <!-- Products Grid - Only show when not in category selection mode -->
      {% if not show_category_selection %}
      <div id="productRow" class="product-grid" style="
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 25px;
        margin: 30px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      ">
        <!-- Products will be dynamically inserted here by JavaScript -->
      </div>
      {% endif %}
      
      {% endif %}
    </div>
  </div>

     <script>
     // Merchandise page script loaded - Cache: {{ cache_buster if cache_buster is defined else 'no-cache' }}
     
     // Clear any existing screenshot capture intervals
     if (window.screenshotInterval) {
       clearInterval(window.screenshotInterval);
     }
     
             // Simple initialization
        document.addEventListener('DOMContentLoaded', function() {
          // DOM loaded successfully
          
          // Show/hide mobile buttons based on screen size and category selection
          function toggleMobileButtons() {
            const mobileButtons = document.getElementById('mobileActionButtons');
            const desktopCartButton = document.getElementById('desktopCartButton');
            
            // Toggle mobile buttons based on screen size
            
            if (window.innerWidth <= 768) {
              // Mobile view
              if (mobileButtons) {
                // Check if we're on the category selection page using data attribute
                const isCategorySelection = mobileButtons.getAttribute('data-category-page') === 'true';
                // Check category page attribute
                
                // Hide mobile buttons on category selection page
                const shouldShow = !isCategorySelection;
                mobileButtons.style.display = shouldShow ? 'flex' : 'none';
                // Set mobile buttons display
              }
              if (desktopCartButton) desktopCartButton.style.display = 'none';
            } else {
              // Desktop view
              if (mobileButtons) mobileButtons.style.display = 'none';
              if (desktopCartButton) desktopCartButton.style.display = 'flex';
            }
          }
          
          // Initial setup
          toggleMobileButtons();
          
          // Listen for window resize
          window.addEventListener('resize', toggleMobileButtons);
          
          // Update screenshot counter
          function updateScreenshotCounter() {
            const counter = document.getElementById('screenshotCounter');
            if (counter) {
              const screenshotElements = document.querySelectorAll('.screenshot-thumbnail, .video-thumbnail');
              const currentCount = screenshotElements.length;
              
              if (window.innerWidth <= 768) {
                // Show counter on mobile - just the number
                counter.textContent = currentCount;
                counter.style.display = 'flex';
                
                // Turn red when reaching 5 or more
                if (currentCount >= 5) {
                  counter.style.background = '#ff4444';
                  counter.style.color = '#fff';
                  counter.style.borderColor = '#ff4444';
                } else {
                  counter.style.background = '#fff';
                  counter.style.color = '#333';
                  counter.style.borderColor = '#ddd';
                }
              } else {
                // Hide counter on desktop
                counter.style.display = 'none';
              }
            }
          }
          
          // Mobile orientation detection and text updates
          function updateMobileText() {
            const screenshotsTitle = document.getElementById('screenshotsTitle');
            
            if (window.innerWidth <= 768) {
              const isPortrait = window.innerHeight > window.innerWidth;
              
              if (isPortrait) {
                // Mobile portrait: show "Selected Screenshots Below"
                if (screenshotsTitle) {
                  screenshotsTitle.textContent = 'Selected Screenshots Below';
                }
              } else {
                // Mobile landscape: show "Selected Screenshots"
                if (screenshotsTitle) {
                  screenshotsTitle.textContent = 'Selected Screenshots';
                }
              }
            }
            
            // Update counter after text update
            updateScreenshotCounter();
          }
          
          // Initial text setup
          updateMobileText();
          
          // Listen for window resize and orientation change
          window.addEventListener('resize', function() {
            updateMobileText();
            updateScreenshotCounter();
          });
          window.addEventListener('orientationchange', function() {
            // Small delay to ensure orientation change is complete
            setTimeout(function() {
              updateMobileText();
              updateScreenshotCounter();
            }, 100);
          });
          
          // Ensure mobile text is set after DOM is ready
          setTimeout(updateMobileText, 100);
       
       // Get data from backend
       const videoThumbnail = '{{ img_url }}';
       const screenshots = [];
       {% if screenshots %}
         {% for screenshot in screenshots %}
           screenshots.push('{{ screenshot }}');
         {% endfor %}
       {% endif %}
       
       // Video thumbnail and screenshots loaded
       
       // Display screenshots
       const row = document.getElementById("screenshotPreviewRow");
       if (row) {
         row.innerHTML = '';
         
                                     // Video thumbnail removed to prevent duplicates
         // The thumbnail is already included in the screenshots array
         
                   // Add screenshots
          const thumbnailsContainer = document.createElement("div");
          thumbnailsContainer.className = "screenshot-thumbnails";
          
          // Processing screenshots
          
          // Video thumbnail is automatically included in screenshots array from frontend
          // No need to add it separately here to avoid duplication
          
          // Add screenshots
          let screenshotsToShow = screenshots;
          screenshotsToShow.forEach((src, index) => {
            // Processing screenshot
            if (src && src !== 'None' && src !== '') {
              const img = document.createElement("img");
              img.src = src;
              img.className = "screenshot-thumbnail";
              img.alt = `Screenshot ${index + 1}`;
              img.addEventListener('click', function() {
                selectScreenshot(img, src);
              });
              thumbnailsContainer.appendChild(img);
              // Added screenshot
            } else {
              // Skipping invalid screenshot
            }
          });
          
          row.appendChild(thumbnailsContainer);
          // Added screenshots to container
          
          // Update counter after screenshots are displayed
          setTimeout(updateScreenshotCounter, 200);
       }
       
               // Display products
        const productRow = document.getElementById("productRow");
        if (productRow) {
          // Get products from backend
          window.products = []; // Make products global
          {% if products %}
            {% for product in products %}
              window.products.push({
                name: '{{ product.name }}',
                price: {{ product.price }},
                main_image: '{{ product.main_image }}',
                filename: '{{ product.filename }}',
                preview_image: '{{ product.preview_image }}',
                options: {{ product.options | tojson }},
                size_pricing: {{ (product.size_pricing | tojson) if (product.size_pricing is defined) else 'null' }},
                size_color_availability: {{ (product.size_color_availability | tojson) if (product.size_color_availability is defined) else 'null' }}
              });
            {% endfor %}
          {% endif %}
          
          {% if product %}
            // Also add the individual product data to ensure it's available
            window.products.push({
              name: '{{ product.name }}',
              price: {{ product.price }},
              main_image: '{{ product.main_image }}',
              filename: '{{ product.filename }}',
              preview_image: '{{ product.preview_image }}',
              options: {{ product.options | tojson }},
              size_pricing: {{ (product.size_pricing | tojson) if (product.size_pricing is defined) else 'null' }},
              size_color_availability: {{ (product.size_color_availability | tojson) if (product.size_color_availability is defined) else 'null' }}
            });
          {% endif %}
          
          // Products loaded for display
          
          if (window.products.length > 0) {
             productRow.innerHTML = ''; // Clear existing content
             
             // Filter out only "Unknown Product" entries and only show first 30 products
             const validProducts = window.products.filter(product => product.name !== 'Unknown Product');
             const productsToShow = validProducts.slice(0, 30);
             
             productsToShow.forEach((product, index) => {
              try {
                const productCard = document.createElement("div");
                productCard.className = "product-card";
                productCard.style.cssText = `
                  background: white;
                  border-radius: 12px;
                  padding: 15px;
                  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                  transition: all 0.3s ease;
                  border: 1px solid #e9ecef;
                  cursor: pointer;
                `;
                
                // Add hover effect
                productCard.addEventListener('mouseenter', function() {
                  this.style.transform = 'translateY(-5px)';
                  this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
                });
                
                productCard.addEventListener('mouseleave', function() {
                  this.style.transform = 'translateY(0)';
                  this.style.boxShadow = '0 4px 15px rgba(0,0,0,0.1)';
                });
                productCard.innerHTML = `
                 <img src="/static/images/${product.filename}" alt="${product.name} - Blank" style="width:100%;height:120px;object-fit:contain;border-radius:6px;margin-bottom:8px;">
                 
                 <img src="/static/images/${product.preview_image || product.filename}" alt="${product.name} - Preview" style="width:100%;height:120px;object-fit:contain;border-radius:6px;">
                 
                 <div class="product-title" style="font-weight:600;font-size:14px;color:#333;margin:12px 0 8px 0;line-height:1.3;">${product.name}</div>
                 <div class="product-price" id="price-${index}" style="font-size:18px;font-weight:bold;color:#28a745;margin-bottom:12px;">$${product.price.toFixed(2)}</div>
                 ${product.options && product.options.color && product.options.color.length > 0 ? `
                   <div class="variant-selector" style="margin-bottom:10px;">
                     <label style="display:block;font-size:12px;font-weight:500;color:#666;margin-bottom:4px;">Color:</label>
                     <select class="variant-select color-select" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;font-size:12px;">
                       ${product.options.color.map(color => `<option value="${color}">${color}</option>`).join('')}
                     </select>
                   </div>
                 ` : ''}
                 ${product.options && product.options.size && product.options.size.length > 0 ? `
                   <div class="variant-selector" style="margin-bottom:15px;">
                     <label style="display:block;font-size:12px;font-weight:500;color:#666;margin-bottom:4px;">Size:</label>
                     <select class="variant-select size-select" data-product-index="${index}" data-product-name="${product.name}" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;font-size:12px;">
                       ${product.options.size.map(size => `<option value="${size}">${size}</option>`).join('')}
                     </select>
                   </div>
                 ` : ''}
                 <button class="btn add-to-cart-btn" data-product-name="${product.name}" data-product-price="${product.price}" style="
                   width:100%;
                   background:#007bff;
                   color:white;
                   border:none;
                   padding:10px;
                   border-radius:6px;
                   font-weight:600;
                   font-size:13px;
                   cursor:pointer;
                   transition:all 0.2s ease;
                 ">Add to Cart</button>
               `;
                productRow.appendChild(productCard);
              } catch (error) {
                // Error creating product card
                // Create a fallback product card
                const fallbackCard = document.createElement("div");
                fallbackCard.className = "product-card";
                fallbackCard.innerHTML = `
                  <div class="product-title">${product.name}</div>
                  <div class="product-price">$${product.price.toFixed(2)}</div>
                  <button class="btn add-to-cart-btn" data-product-name="${product.name}" data-product-price="${product.price}">Add ${product.name} to Cart</button>
                `;
                productRow.appendChild(fallbackCard);
              }
             });
             
             // Added product cards
             
             // Add event listeners to all Add to Cart buttons
             setTimeout(() => {
               const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');
               // Found Add to Cart buttons
               addToCartButtons.forEach((button) => {
                 button.addEventListener('click', function() {
                   const productName = this.getAttribute('data-product-name');
                   const productPrice = parseFloat(this.getAttribute('data-product-price'));
                   addToCart(productName, productPrice, this);
                 });
               });
             }, 100);
             
             
        // Size-based color filtering function
        function filterColorsBySize(selectedSize, productIndex) {
            // Filtering colors for size
            
            const product = window.products[productIndex];
            if (!product) {
                // Product not found at index
                return;
            }
            if (!product.size_color_availability) {
                // No size_color_availability data found
                return;
            }
            
            const availableColors = product.size_color_availability[selectedSize];
            if (!availableColors) {
                // No colors available for size
                return;
            }
            
            // Find the color dropdown for this product
            const productCard = document.querySelector(`[data-product-index="${productIndex}"]`)?.closest('.product-card');
            if (!productCard) {
                // Product card not found
                return;
            }
            
            const colorSelect = productCard.querySelector('.color-select');
            if (!colorSelect) {
                // Color select not found
                return;
            }
            
            // Store current selection
            const currentColor = colorSelect.value;
            
            // Clear existing options
            colorSelect.innerHTML = '';
            
            // Add available colors
            availableColors.forEach(color => {
                const option = document.createElement('option');
                option.value = color;
                option.textContent = color;
                colorSelect.appendChild(option);
            });
            
            // Restore selection if it's still available, otherwise select first option
            if (availableColors.includes(currentColor)) {
                colorSelect.value = currentColor;
            } else {
                colorSelect.value = availableColors[0];
            }
            
            // Updated color options for size
        }
        
        // Enhanced size dropdown change handler
        function handleSizeChange(productIndex, productName, selectedSize) {
            // Size changed for product
            
            // Update price
            updatePrice(productIndex, productName, selectedSize);
            
            // Filter colors based on size
            filterColorsBySize(selectedSize, productIndex);
        }
        // Add event listeners to all size dropdowns
             setTimeout(() => {
               const sizeDropdowns = document.querySelectorAll('.size-select');
               // Found size dropdowns
               sizeDropdowns.forEach((dropdown) => {
                 dropdown.addEventListener('change', function() {
                   const productIndex = parseInt(this.getAttribute('data-product-index'));
                   const productName = this.getAttribute('data-product-name');
                   // Dropdown changed for product
                   handleSizeChange(productIndex, productName, this.value);
                 });
               });
             }, 100);
          } else {
            productRow.innerHTML = ''; // Show nothing when no products
            // No products to display
          }
        }
       
        // Merchandise page initialized
        
        // Set default screenshot selection after DOM is ready
        setTimeout(setDefaultScreenshot, 500);
         
       });
      
             // Screenshot selection functionality
       let selectedScreenshotUrl = null;
       
       function selectScreenshot(imgElement, screenshotUrl) {
         // Remove selection from all screenshots
         document.querySelectorAll('.screenshot-thumbnail, .video-thumbnail').forEach(img => {
           img.classList.remove('selected-image');
         });
         
         // Add selection to clicked image
         imgElement.classList.add('selected-image');
         selectedScreenshotUrl = screenshotUrl;
         
         // Selected screenshot
         
         // Update all product cards to show selected image
         updateProductImages(screenshotUrl);
       }
       
       // Set default selected screenshot if available
       function setDefaultScreenshot() {
         // Attempting to set default screenshot
         
         // Try multiple times with different selectors
         const selectors = [
           '.screenshot-thumbnail',
           '.video-thumbnail', 
           '.thumbnail-image',
           'img[src*="screenshot"]',
           'img[src*="thumbnail"]'
         ];
         
         let firstScreenshot = null;
         for (const selector of selectors) {
           firstScreenshot = document.querySelector(selector);
           if (firstScreenshot) {
             // Found screenshot with selector
             break;
           }
         }
         
         if (firstScreenshot && !selectedScreenshotUrl) {
           const screenshotUrl = firstScreenshot.src;
           selectScreenshot(firstScreenshot, screenshotUrl);
           // Auto-selected first screenshot
         } else if (!selectedScreenshotUrl) {
           // No screenshots found, setting fallback default
           // Set a fallback default image if no screenshots are available
           selectedScreenshotUrl = '/static/images/default-thumbnail.png';
           // Set fallback default image
         }
       }
       

        // Simplified category switching function - just reload with new category filter
        function switchCategory(category) {
          // Switching to category
          
          // Show loading feedback
          const categoryIcons = document.querySelectorAll('.category-icon');
          categoryIcons.forEach(icon => {
            icon.style.pointerEvents = 'none';
            icon.style.opacity = '0.6';
          });
          
          // Simple approach: reload current page with category parameter
          const currentUrl = new URL(window.location.href);
          currentUrl.searchParams.set('category', category);
          
          // Redirect to same page with category filter
          window.location.href = currentUrl.toString();
        }
       
               // Dynamic pricing function
        function updatePrice(productIndex, productName, selectedSize) {
          // updatePrice called
          
          const priceElement = document.getElementById(`price-${productIndex}`);
          if (!priceElement) {
            // Price element not found for index
            return;
          }
          
          // Default size pricing adjustments (fallback)
          const defaultSizeAdjustments = { "XS": 0, "S": 0, "M": 0, "L": 0, "XL": 2, "XXL": 3, "XXXL": 4, "XXXXL": 5, "XXXXXL": 8 };
          
          // Finding product for price calculation
          
          // Find base price from products array
          const product = window.products.find(p => {
            // Normalize both names for comparison (handle HTML entities and case)
            const normalizedProductName = p.name.replace(/&#39;/g, "'").replace(/&amp;/g, "&").toLowerCase().trim();
            const normalizedSearchName = productName.replace(/&#39;/g, "'").replace(/&amp;/g, "&").toLowerCase().trim();
            return normalizedProductName === normalizedSearchName;
          });
          if (!product) {
            // Product not found
            return;
          }
          
          const basePrice = product.price;
          const sizeAdjustments = product.size_pricing || defaultSizeAdjustments;
          const adjustment = sizeAdjustments[selectedSize] || 0;
          const newPrice = basePrice + adjustment;
          
          // Price calculation completed
          
          priceElement.textContent = `$${newPrice.toFixed(2)}`;
          
          // Update the button price for cart
          const card = priceElement.closest('.product-card');
          const addButton = card.querySelector('.add-to-cart-btn');
          if (addButton) {
            addButton.setAttribute('data-price', newPrice);
            // Updated button data-price
          }
          
          // Price updated successfully
        }
       

       

       
       // Add to cart functionality
              function addToCart(productName, price, button) {
                // Get the current price from the button's data attribute or use the passed price
         const currentPrice = parseFloat(button.getAttribute('data-price')) || price;
         const card = button.closest('.product-card');
         const colorSelect = card.querySelector('.color-select');
         const sizeSelect = card.querySelector('.size-select');
         const noteInput = card.querySelector('.note-input');
         
         const selectedColor = colorSelect ? colorSelect.value : 'Default';
         const selectedSize = sizeSelect ? sizeSelect.value : 'Default';
         const note = noteInput ? noteInput.value : '';
         
         // Check if user has selected a screenshot
         if (!selectedScreenshotUrl) {
           setDefaultScreenshot();
           if (!selectedScreenshotUrl) {
             alert('Please choose Thumbnail or Screenshot');
             return;
           }
         }
         
         // Get screenshot timestamp from localStorage
         const screenshotTimestamps = JSON.parse(localStorage.getItem('screenshot_timestamps') || '[]');
         const screenshotTimestamp = screenshotTimestamps.length > 0 ? screenshotTimestamps[0] : 0;
         
         // Create cart item object
         const cartItem = {
           screenshot: selectedScreenshotUrl,
           name: productName,
           details: `Color: ${selectedColor} | Size: ${selectedSize} | $${currentPrice.toFixed(2)}${note ? ' | Note: ' + note : ''}`,
           price: currentPrice,
           variants: {
             color: selectedColor,
             size: selectedSize
           },
           timestamp: screenshotTimestamp
         };
         
         // Get existing cart from localStorage
         const savedCart = localStorage.getItem('persistent_cart');
         let cartItems = [];
         if (savedCart) {
           try {
             cartItems = JSON.parse(savedCart);
           } catch (error) {
             // Error parsing cart data - using fallback
           }
         }
         
         // Add new item to cart
         cartItems.push(cartItem);
         
         // Save updated cart to localStorage
         localStorage.setItem('persistent_cart', JSON.stringify(cartItems));
         
         // Change button text temporarily
         button.textContent = 'Added to Cart';
         button.style.background = '#28a745';
         
         // Reset button after 2 seconds
         setTimeout(() => {
           button.textContent = `Add ${productName} to Cart`;
           button.style.background = '#4CAF50';
         }, 2000);
         
         // Show success notification
         const notification = document.createElement('div');
         notification.style.cssText = `
           position: fixed;
           top: 20px;
           right: 20px;
           background: #28a745;
           color: white;
           padding: 12px 20px;
           border-radius: 8px;
           box-shadow: 0 4px 12px rgba(0,0,0,0.15);
           z-index: 10000;
           animation: slideIn 0.3s ease-out;
           max-width: 300px;
           font-size: 14px;
           font-weight: 500;
         `;
         notification.textContent = `${productName} added to cart!`;
         document.body.appendChild(notification);
         setTimeout(() => document.body.removeChild(notification), 3000);
       }
      

      
                   function goToCheckout() {
        // Clear old cart items before proceeding to checkout
        localStorage.removeItem('cart');
        localStorage.removeItem('cart_items');
        localStorage.removeItem('screenshots');
        localStorage.removeItem('screenshot_timestamps');
        localStorage.removeItem('pending_merch_data');
        
        // Get cart data from localStorage
        const savedCart = localStorage.getItem('persistent_cart');
        let cartItems = [];
        if (savedCart) {
          try {
            cartItems = JSON.parse(savedCart);
          } catch (error) {
            // Error parsing cart data - using fallback
          }
        }
        
        if (cartItems.length === 0) {
          // Show a more user-friendly message instead of alert
          const notification = document.createElement('div');
          notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff6b6b;
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
            max-width: 350px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
          `;
          notification.innerHTML = `
            <span style="font-size: 20px;">🛒</span>
            <div>
              <div style="font-weight: 600; margin-bottom: 4px;">Cart is Empty</div>
              <div style="font-size: 12px; opacity: 0.9;">Add some products to continue</div>
            </div>
          `;
          document.body.appendChild(notification);
          setTimeout(() => document.body.removeChild(notification), 4000);
          return;
        }
        
        // Convert cart items to checkout format
        const products = cartItems.map(item => ({
          name: item.name,
          details: item.details,
          image: item.screenshot,
          price: item.price,
          variants: item.variants,
          video_title: '{{ video_title }}',
          creator_name: '{{ creator_name }}',
          video_url: '{{ video_url }}'
        }));
        
        // Redirect to checkout page with product data
        const productId = '{{ product_id }}';
        
        // Get authentication state from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const isAuthenticated = urlParams.get('authenticated') || localStorage.getItem('user_authenticated');
        const userEmail = urlParams.get('email') || localStorage.getItem('user_email');
        
        // Build checkout URL with authentication parameters
        let checkoutUrl = `/checkout/${productId}`;
        if (isAuthenticated && userEmail) {
          checkoutUrl += `?authenticated=true&email=${encodeURIComponent(userEmail)}`;
        }
        
        // Store cart data in sessionStorage for checkout page
        sessionStorage.setItem('cartData', JSON.stringify(products));
        
        // Redirect to checkout
        window.location.href = checkoutUrl;
       }
       
       // Cart view function for both mobile and desktop
       function viewCart() {
         // Clear old cart items before viewing cart
         localStorage.removeItem('cart');
         localStorage.removeItem('cart_items');
         localStorage.removeItem('screenshots');
         localStorage.removeItem('screenshot_timestamps');
         localStorage.removeItem('pending_merch_data');
         
         // Get cart data from localStorage
         const savedCart = localStorage.getItem('persistent_cart');
         let cartItems = [];
         if (savedCart) {
           try {
             cartItems = JSON.parse(savedCart);
           } catch (error) {
             // Error parsing cart data - using fallback
           }
         }
         
         // Create cart modal
         const cartModal = document.createElement('div');
         cartModal.id = 'cartModal';
         cartModal.style.cssText = `
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: rgba(0,0,0,0.5);
           z-index: 1000;
           display: flex;
           align-items: center;
           justify-content: center;
         `;
         
         const cartContent = document.createElement('div');
         cartContent.style.cssText = `
           background: white;
           border-radius: 12px;
           padding: 20px;
           max-width: 90vw;
           max-height: 80vh;
           overflow: auto;
           box-shadow: 0 4px 20px rgba(0,0,0,0.3);
           position: relative;
         `;
         
         // Add close button
         const closeBtn = document.createElement('button');
         closeBtn.innerHTML = '✕';
         closeBtn.style.cssText = 'position:absolute;top:10px;right:10px;background:#dc3545;color:white;border:none;padding:5px 10px;border-radius:50%;cursor:pointer;font-size:16px;';
         closeBtn.onclick = function() {
           document.body.removeChild(cartModal);
         };
         cartContent.appendChild(closeBtn);
         
         // Add title
         const title = document.createElement('h3');
         title.textContent = 'Shopping Cart';
         title.style.cssText = 'margin: 0 0 20px 0; color: #333;';
         cartContent.appendChild(title);
         
         if (cartItems.length === 0) {
           // Create a more engaging empty cart experience
           const emptyCartContainer = document.createElement('div');
           emptyCartContainer.style.cssText = 'text-align: center; padding: 40px 20px;';
           
           // Add empty cart icon
           const emptyIcon = document.createElement('div');
           emptyIcon.innerHTML = '🛒';
           emptyIcon.style.cssText = 'font-size: 48px; margin-bottom: 16px; opacity: 0.6;';
           emptyCartContainer.appendChild(emptyIcon);
           
           // Add main message
           const emptyMessage = document.createElement('h4');
           emptyMessage.textContent = 'Your cart is empty';
           emptyMessage.style.cssText = 'color: #666; margin: 0 0 8px 0; font-size: 18px; font-weight: 500;';
           emptyCartContainer.appendChild(emptyMessage);
           
           // Add helpful subtext
           const subMessage = document.createElement('p');
           subMessage.textContent = 'Add some products to get started!';
           subMessage.style.cssText = 'color: #999; margin: 0 0 20px 0; font-size: 14px;';
           emptyCartContainer.appendChild(subMessage);
           
           // Add a "Start Shopping" button
           const startShoppingBtn = document.createElement('button');
           startShoppingBtn.textContent = 'Start Shopping';
           startShoppingBtn.style.cssText = `
             background: linear-gradient(135deg, #667eea, #764ba2);
             color: white;
             border: none;
             padding: 12px 24px;
             border-radius: 25px;
             cursor: pointer;
             font-weight: 600;
             font-size: 14px;
             transition: all 0.3s ease;
             box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
           `;
           startShoppingBtn.onmouseover = function() {
             this.style.transform = 'translateY(-2px)';
             this.style.boxShadow = '0 6px 20px rgba(102, 126, 234, 0.4)';
           };
           startShoppingBtn.onmouseout = function() {
             this.style.transform = 'translateY(0)';
             this.style.boxShadow = '0 4px 15px rgba(102, 126, 234, 0.3)';
           };
           startShoppingBtn.onclick = function() {
             document.body.removeChild(cartModal);
           };
           emptyCartContainer.appendChild(startShoppingBtn);
           
           cartContent.appendChild(emptyCartContainer);
         } else {
           // Add cart items
           cartItems.forEach((item, index) => {
             const cartItem = document.createElement('div');
             cartItem.style.cssText = `
               background: #f8f9fa;
               padding: 10px;
               margin: 5px 0;
               border-radius: 6px;
               border-left: 4px solid #3f51b5;
               display: flex;
               gap: 10px;
               align-items: center;
             `;
             cartItem.innerHTML = `
               <img src="${item.screenshot}" alt="Selected Image" style="width:60px; height:60px; object-fit:cover; border-radius:4px; border:2px solid #4CAF50;">
               <div style="flex:1;">
                 <div style="font-weight:bold; color:#333;">${item.name}</div>
                 <div style="color:#666; font-size:12px;">${item.details}</div>
               </div>
               <button class="remove-cart-item-btn" data-index="${index}" style="background:#dc3545; color:white; border:none; padding:2px 8px; border-radius:3px; font-size:10px;">Remove</button>
             `;
             cartContent.appendChild(cartItem);
             
             // Add event listener for remove button
             const removeBtn = cartItem.querySelector('.remove-cart-item-btn');
             if (removeBtn) {
               removeBtn.addEventListener('click', function() {
                 removeFromCartModal(index);
               });
             }
           });
           
           // Add checkout button
           const checkoutBtn = document.createElement('button');
           checkoutBtn.textContent = '🛍️ Proceed to Checkout';
           checkoutBtn.style.cssText = `
             background: #28a745;
             color: white;
             border: none;
             padding: 12px 24px;
             border-radius: 8px;
             cursor: pointer;
             font-weight: bold;
             font-size: 14px;
             margin-top: 15px;
             width: 100%;
           `;
           checkoutBtn.onclick = function() {
             document.body.removeChild(cartModal);
             goToCheckout();
           };
           cartContent.appendChild(checkoutBtn);
         }
         
         cartModal.appendChild(cartContent);
         document.body.appendChild(cartModal);
         
         // Close modal when clicking outside
         cartModal.onclick = function(e) {
           if (e.target === cartModal) {
             document.body.removeChild(cartModal);
           }
         };
       }
       
       // Remove item from cart modal
       function removeFromCartModal(index) {
         const savedCart = localStorage.getItem('persistent_cart');
         if (savedCart) {
           try {
             let cartItems = JSON.parse(savedCart);
             cartItems.splice(index, 1);
             localStorage.setItem('persistent_cart', JSON.stringify(cartItems));
             
             // Refresh the cart modal
             const cartModal = document.getElementById('cartModal');
             if (cartModal) {
               document.body.removeChild(cartModal);
               viewCart();
             }
           } catch (error) {
             // Error removing item from cart
           }
         }
       }
    </script>
</body>
</html>
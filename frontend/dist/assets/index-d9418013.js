import{r as c,a as Wi,L as mt,u as ct,b as hs,d as Cs,N as Yi,e as Et,R as Hi,f as et,h as Xi,B as Gi}from"./vendor-f0e62c7a.js";import{c as Vi,_ as qi}from"./supabase-cd66909d.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();var Ta={exports:{}},er={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ji=c,Ki=Symbol.for("react.element"),Zi=Symbol.for("react.fragment"),Qi=Object.prototype.hasOwnProperty,eo=Ji.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,to={key:!0,ref:!0,__self:!0,__source:!0};function Ua(t,s,r){var a,i={},o=null,n=null;r!==void 0&&(o=""+r),s.key!==void 0&&(o=""+s.key),s.ref!==void 0&&(n=s.ref);for(a in s)Qi.call(s,a)&&!to.hasOwnProperty(a)&&(i[a]=s[a]);if(t&&t.defaultProps)for(a in s=t.defaultProps,s)i[a]===void 0&&(i[a]=s[a]);return{$$typeof:Ki,type:t,key:o,ref:n,props:i,_owner:eo.current}}er.Fragment=Zi;er.jsx=Ua;er.jsxs=Ua;Ta.exports=er;var e=Ta.exports,Ar={},va=Wi;Ar.createRoot=va.createRoot,Ar.hydrateRoot=va.hydrateRoot;const so="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAhCAYAAABN2CLhAAAAAXNSR0IArs4c6QAAARhJREFUWAntWNENgjAQpYYBdAM3EDZgA9lAnMC4ARs4AnWDuoEbqBt0BNjA9z5M+kNaI8WS3CWXUO64vr42uUdV0zRVlmUXeAFP2SzAGa31WQH0A4PUAbtkliuMNu6bBTwXBG0WANSFaBRHOCI8HrUbSfDZAhPPdJ8gNoEkDAgDwoAwsHQGKJi2WMQJzq74L+uVUqbrumsIAII2SNyHJM+QU6JNP33zUDBVvqQZ43XIXKmpPO6613JktHBuSdAqkRfDLIpSwRGHmDAgDAgDwoAwMD8Dn3sPdsPdBNP3qHFDZ7MT1BotkUPlaUQPoxnfB1p8EvWqjYJpas2xBhEV6kYzgr5HqB5V+BB0C+cfwwD/1V4ocIx93/YG6YM08g0WFTYAAAAASUVORK5CYII=",tr="/assets/screenmerch_logo.png-13fa081f.png",ro="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAYCAYAAAARfGZ1AAAAAXNSR0IArs4c6QAAAh5JREFUSA2tlDFP60AMx0m6doCJkZGxfRIDEwoDAxNlKSuv6ohE+QCIdGOEiaGVyjcARrYgsTd8kac3MLf8fLWPS0hRW9WSY5/v778dXy7RxhwZjUYtthpogjZRkRzNptNp3ul0Xlzkl0dU3oNUiEaoEZYhtpZCfxGxlRKHUYhT1mO0SXcf2D56iG6pit/XPSk+JucGWym+cyU24D0d9SozCILdxKToJSpyBf5u5n4/HTlg14WGTwE+f0Pme+S12H1SxJ/yiNxYeM1HBUjHCxELXrH3mivnVJBYqkdR1JA5Au4VdhdbpHYG+iY+SzpvyooCC3fss3Fo6H+Q67hsP6ZqoovMgitYlxtwOQrfOat8BVJLcbkyXguILXzn4cYqPp37T9vIrePCvJYkt1zjcukxr5IpUaJ2FeNyAy7HIWOxaid8SpvLMmvOieYZ14xcLoJ9p0RSBS1jJMf9i/RS+Vx3oLzOuUYuyxfBIyscxbr/S8Dhkf50AaZE7cd1h9+XC+KRgaOjEGxPw1dgJacgnlyipQI5IRlZRlfy+93Ab+AnuC20iYrcEt+bTCZn3W733yw0exbIJUQBmd8jJIULESaJD+ZDR/HAcp/1uF6vH7Tb7U/D/iC3DYq47khKiFmXOYQZ69wObzgc7sRx/EZ8B+w7BY6twFxyCBYWLfBKgd2wwFrIpYvBYLBdq9XkDVwB7NHayCsKXK+VPChwwezTL5f411qp3J6CAAAAAElFTkSuQmCC",ao="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAAXNSR0IArs4c6QAAAidJREFUaAXtmN1NwzAQx++SSuWNVPAOGxBASOWJbAAjdISyAWzABu0mLU8UISAjtO9IgQFic1fJUWi+HLBaB9kPdXK+2P79a+cuBnDFKeAUcAo4BZwCToH/owAqlCQMg7TvTxBkBIiBsm+zlgBzP01vBy9x3HZcTz1AEFNEuNkVBM+DVI2E581YVDWvqpp9kmF4rNozEIK4Vsad1rwa9iCsmwNDiL4/I59j5ZeBKIPtdQaBP2E7BVIFweL3TPwDB4vX7KWh+vsYns0R8Erd/7Wug+C+O/GPNEF0AkQHwnoQXQirQdpAMIiRzc4dmSyp8APsw4wiZG08yY9pJQiinLTNMDRB5IryoGVegaZrlBBL+ikrZA5ooidlbWvbL3I9TRCYHi7e7ioHLmk4eH4bl5jXJsqRIgE+pxjGSifiiA6tA9FRaZs+unvkKLk8rcybBk/vj5uTTi7CEHq4v2nneyG8E/74MFk0QXAkJI5qBi5MK/W9B5QVSWPBu6ZnzSY794iUtyDhS5Nh7WYliIci9kQatYGxEoQl5gOINjDWgrSFsRqkDYz1ILowmq9f7q66fAzPC3kTSmk0VvCeodhE517+nGJQIT4ZAaGwEBUw6aDMdKmD6cTSygtS9TbLgchV/oEdXy/rxs9gUvhUftnSkgLHtBqmZetPOW+nlveDRbxsGoth8j4/FjJ/8Dedu+YfNn5NCm9O0PgYrkOngFPAKeAUcAr8ZwW+ASU7qyTOpG88AAAAAElFTkSuQmCC";const _t=typeof import.meta<"u"&&{VITE_API_BASE_URL:"https://api.screenmerch.com",VITE_SUPABASE_URL:"https://sojxbydpcdcdzfdtbypd.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}?{VITE_API_BASE_URL:"https://api.screenmerch.com",VITE_SUPABASE_URL:"https://sojxbydpcdcdzfdtbypd.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}:{},br="https://screenmerch.fly.dev",ba="https://sojxbydpcdcdzfdtbypd.supabase.co",wa="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no",io={development:{API_BASE_URL:(_t.VITE_BACKEND_URL||_t.VITE_API_BASE_URL||"http://127.0.0.1:5000").replace(/\/$/,""),EMAIL_API_URL:"http://localhost:3001",SUBSCRIPTION_API_URL:"http://localhost:3002",SUPABASE_URL:(_t.VITE_SUPABASE_URL||ba).replace(/\/$/,""),SUPABASE_ANON_KEY:_t.VITE_SUPABASE_ANON_KEY||wa},production:{API_BASE_URL:(_t.VITE_BACKEND_URL||_t.VITE_API_BASE_URL||br).replace(/\/$/,""),EMAIL_API_URL:(_t.VITE_BACKEND_URL||_t.VITE_API_BASE_URL||br).replace(/\/$/,""),SUBSCRIPTION_API_URL:(_t.VITE_BACKEND_URL||_t.VITE_API_BASE_URL||br).replace(/\/$/,""),SUPABASE_URL:(_t.VITE_SUPABASE_URL||ba).replace(/\/$/,""),SUPABASE_ANON_KEY:_t.VITE_SUPABASE_ANON_KEY||wa}};let st=io.production;st.API_BASE_URL&&st.API_BASE_URL.startsWith("http://")&&(st={...st,API_BASE_URL:st.API_BASE_URL.replace(/^http:\/\//i,"https://")},st.EMAIL_API_URL=st.API_BASE_URL,st.SUBSCRIPTION_API_URL=st.API_BASE_URL),console.log("üîß USING PRODUCTION API BASE URL:",st.API_BASE_URL),console.log("üîß Backend URL:",st.API_BASE_URL);const ze={BASE_URL:st.API_BASE_URL,EMAIL_API_URL:st.EMAIL_API_URL,SUBSCRIPTION_API_URL:st.SUBSCRIPTION_API_URL,SUPABASE_URL:st.SUPABASE_URL,SUPABASE_ANON_KEY:st.SUPABASE_ANON_KEY,ENDPOINTS:{CREATE_PRODUCT:`${st.API_BASE_URL}/api/create-product`,CALCULATE_SHIPPING:`${st.API_BASE_URL}/api/calculate-shipping`,PLACE_ORDER:`${st.API_BASE_URL}/api/place-order`,CREATE_CHECKOUT_SESSION:`${st.API_BASE_URL}/api/create-checkout-session`,SEND_SUBSCRIPTION_EMAIL:`${st.EMAIL_API_URL}/api/send-subscription-email`,VERIFY_SUBSCRIPTION:`${st.SUBSCRIPTION_API_URL}/api/verify-subscription`,USER_SUBSCRIPTION:`${st.SUBSCRIPTION_API_URL}/api/users`,CAPTURE_SCREENSHOT:`${st.API_BASE_URL}/api/capture-screenshot`,CAPTURE_PRINT_QUALITY:`${st.API_BASE_URL}/api/capture-print-quality`,CAPTURE_MULTIPLE_SCREENSHOTS:`${st.API_BASE_URL}/api/capture-multiple-screenshots`,VIDEO_INFO:`${st.API_BASE_URL}/api/video-info`}};function Jt(){return ze.BASE_URL}const oo=({isOpen:t,onClose:s})=>{const[r,a]=c.useState(""),[i,o]=c.useState(!1),[n,u]=c.useState(""),[m,f]=c.useState(""),k=async M=>{if(M.preventDefault(),!r){u("Please enter a valid email address"),f("error");return}o(!0),u("");try{const h=await fetch(ze.ENDPOINTS.SEND_SUBSCRIPTION_EMAIL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r})}),v=await h.json();if(h.ok)u(`Subscription email sent to ${r}! Please check your inbox for approval link.`),f("success"),a(""),setTimeout(()=>{s(),u("")},3e3);else throw new Error(v.error||"Failed to send email")}catch(h){console.error("Error:",h),h.message.includes("fetch")?u("Backend server is not running. Please start the backend server first."):u(`Failed to send email: ${h.message}`),f("error")}finally{o(!1)}};return t?e.jsx("div",{className:"modal-overlay",onClick:s,children:e.jsxs("div",{className:"modal-content",onClick:M=>M.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Subscribe to ScreenMerch"}),e.jsx("button",{className:"close-btn",onClick:s,children:"√ó"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("p",{children:"Enter your email to receive a subscription approval link:"}),e.jsxs("form",{onSubmit:k,children:[e.jsx("div",{className:"email-input-group",children:e.jsx("input",{type:"email",value:r,onChange:M=>a(M.target.value),placeholder:"Enter your email address",required:!0,disabled:i})}),n&&e.jsx("div",{className:`message ${m}`,children:n}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:s,disabled:i,children:"Cancel"}),e.jsx("button",{type:"submit",className:"subscribe-modal-btn",disabled:i,children:i?"Sending...":"Send Approval Link"})]})]})]})]})}):null};const Ra=({isOpen:t,onClose:s,onSignup:r,apiBase:a=""})=>{const[i,o]=c.useState(""),[n,u]=c.useState(""),[m,f]=c.useState(!1),[k,M]=c.useState(!1),[h,v]=c.useState(""),[_,b]=c.useState("google"),[x,T]=c.useState(!1);if(!t)return null;const S=async E=>{if(E.preventDefault(),v(""),!i.trim()){v("Please enter your email address.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.trim())){v("Please enter a valid email address.");return}if(_==="google"&&!n.trim()){v("Please enter your location.");return}if(!m){v("You must agree to the Terms of Service to continue.");return}M(!0);try{if(_==="email"){const V=`${a}/api/auth/signup/creator-email-only`,X=await fetch(V,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i.trim().toLowerCase()})}),Y=await X.json().catch(()=>({}));if(!X.ok){const $=(Y==null?void 0:Y.error)||`Signup failed (${X.status})`;throw new Error($)}T(!0)}else await r(i.trim(),n.trim()),s()}catch(V){v(V.message||"An error occurred. Please try again.")}finally{M(!1)}},A=E=>{E.target===E.currentTarget&&s()};return e.jsx("div",{className:"creator-signup-modal-overlay",onClick:A,children:e.jsxs("div",{className:"creator-signup-modal",children:[e.jsx("button",{className:"creator-signup-modal-close",onClick:s,"aria-label":"Close",children:"√ó"}),e.jsxs("div",{className:"creator-signup-modal-content",children:[e.jsx("h2",{className:"creator-signup-modal-title",children:"Creator Signup"}),e.jsx("p",{className:"creator-signup-modal-subtitle",children:"Join ScreenMerch as a creator and start selling merchandise from your content"}),x?e.jsxs("div",{className:"creator-signup-success",children:[e.jsx("h3",{className:"creator-signup-success-title",children:"Account created"}),e.jsx("p",{className:"creator-signup-success-text",children:"Your application is pending approval. You'll receive an acceptance email with a link to set your password once approved."}),e.jsx(mt,{to:"/login",className:"creator-signup-success-link",children:"Go to Log in"}),e.jsx("button",{type:"button",className:"creator-signup-submit-btn",onClick:s,style:{marginTop:12},children:"Close"})]}):e.jsxs("form",{onSubmit:S,className:"creator-signup-form",children:[e.jsxs("div",{className:"creator-signup-method-toggle",children:[e.jsx("button",{type:"button",className:`creator-signup-method-btn ${_==="google"?"active":""}`,onClick:()=>b("google"),children:"Continue with Google"}),e.jsx("button",{type:"button",className:`creator-signup-method-btn ${_==="email"?"active":""}`,onClick:()=>b("email"),children:"Sign up with email"})]}),e.jsxs("div",{className:"creator-signup-field",children:[e.jsxs("label",{htmlFor:"creator-email",className:"creator-signup-label",children:["Email Address ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{id:"creator-email",type:"email",className:"creator-signup-input",placeholder:"your.email@example.com",value:i,onChange:E=>o(E.target.value),disabled:k,required:!0,autoComplete:"email"})]}),_==="google"&&e.jsxs("div",{className:"creator-signup-field",children:[e.jsxs("label",{htmlFor:"creator-location",className:"creator-signup-label",children:["Location ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{id:"creator-location",type:"text",className:"creator-signup-input",placeholder:"State, Country",value:n,onChange:E=>u(E.target.value),disabled:k,required:!0,autoComplete:"country-name"})]}),h&&e.jsx("div",{className:"creator-signup-error",children:h}),e.jsxs("div",{className:"creator-signup-terms",children:[e.jsx("h3",{className:"terms-title",children:"Terms of Service"}),e.jsxs("div",{className:"terms-content",children:[e.jsx("p",{children:"By signing up as a creator on ScreenMerch, you agree to the following terms:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Content Ownership:"})," You confirm that any content you upload to ScreenMerch is either owned by you or you have the legal rights and permissions to use it for commercial purposes."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"No Reverse Engineering:"})," You agree not to reverse engineer, decompile, or disassemble any part of the ScreenMerch platform, software, or services."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Limitation of Liability:"})," ScreenMerch is not responsible for any damages, losses, or liabilities arising from your use of the platform, including but not limited to product sales, customer disputes, or intellectual property claims."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"User Responsibility:"})," You assume all responsibility and liability for the content you upload, the products you create, and any interactions with customers through the ScreenMerch platform."]})]})]}),e.jsxs("label",{className:"terms-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:E=>f(E.target.checked),disabled:k,required:!0}),e.jsxs("span",{children:["I have read and agree to the Terms of Service and understand that my application requires admin approval. ",e.jsx("span",{className:"required",children:"*"})]})]})]}),e.jsx("button",{type:"submit",className:"creator-signup-submit-btn",disabled:k||!m,children:k?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner-small"}),"Processing..."]}):_==="email"?"Create account":"Continue with Google Sign In"})]})]})]})})},no=ze.SUPABASE_URL,lo=ze.SUPABASE_ANON_KEY,R=Vi(no,lo,{auth:{redirectTo:window.location.origin}});typeof window<"u"&&(window.supabase=R,window.__SUPABASE__=R);console.log("VITE ENV:",{VITE_API_BASE_URL:"https://api.screenmerch.com",VITE_SUPABASE_URL:"https://sojxbydpcdcdzfdtbypd.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1});const co=Object.freeze(Object.defineProperty({__proto__:null,supabase:R},Symbol.toStringTag,{value:"Module"}));function uo(){if(typeof window>"u")return!1;const t=(window.location.hostname||"").toLowerCase();return t.endsWith(".screenmerch.com")&&t!=="screenmerch.com"&&t!=="www.screenmerch.com"}async function _s(t){var s;if(!t)return null;try{const r={"X-User-Id":t},a=typeof localStorage<"u"&&localStorage.getItem("auth_token");a&&(r["X-Session-Token"]=a);const i=await fetch(`${Jt()}/api/users/me`,{method:"GET",credentials:"include",headers:r});if(i.status===401&&uo()){const o=typeof window<"u"&&window.location.pathname||"",n=localStorage.getItem("user"),u=o==="/creator-thank-you";let m=null;if(n)try{m=(s=JSON.parse(n))==null?void 0:s.role}catch{}console.warn("[THANKYOU] 401 on subdomain",{path:o,isOnThankYou:u,hasUser:!!n,userRole:m});try{if(u&&n)try{const f=JSON.parse(n);if((f==null?void 0:f.role)==="creator"){console.log("[THANKYOU] Redirecting to main domain WITH thank-you + user (preserve page)");const k=encodeURIComponent(n);return window.location.replace(`https://screenmerch.com/creator-thank-you?login=success&user=${k}`),null}}catch{}console.log("[THANKYOU] Redirecting to main domain HOME (no thank-you user)"),localStorage.removeItem("user"),localStorage.removeItem("auth_token")}catch{}return window.location.replace("https://screenmerch.com"),null}return i.ok?await i.json():null}catch(r){return console.error("Error fetching profile from backend:",r),null}}class sr{static async getCurrentUserProfile(){var s;try{const r=typeof localStorage<"u"&&localStorage.getItem("user"),a=r?(s=JSON.parse(r))==null?void 0:s.id:null;if(a){const u=await _s(a);if(u)return u}const{data:{user:i}}=await R.auth.getUser();if(!i)return null;const{data:o,error:n}=await R.from("users").select("*").eq("id",i.id).maybeSingle();return n?(console.error("Error fetching user profile:",n),null):o}catch(r){return console.error("Error in getCurrentUserProfile:",r),null}}static async upsertUserProfile(s){try{const{data:{user:r}}=await R.auth.getUser();if(!r)throw new Error("No authenticated user");console.log("[UPSERT] running for user:",r.id,r.email);const a={id:r.id,email:r.email,role:"creator",...s,updated_at:new Date().toISOString()},{data:i,error:o}=await R.from("users").upsert(a,{onConflict:"id",ignoreDuplicates:!1}).select().maybeSingle();return console.log("[UPSERT] result:",{data:i,error:o}),o?(console.error("Error upserting user profile:",o),null):i}catch(r){return console.error("Error in upsertUserProfile:",r),null}}static async updateUserProfile(s){try{const{data:{user:r}}=await R.auth.getUser();if(!r)throw new Error("No authenticated user");const{data:a,error:i}=await R.from("users").update(s).eq("id",r.id).select().single();return i?(console.error("Error updating user profile:",i),null):a}catch(r){return console.error("Error in updateUserProfile:",r),null}}static async getUserProfileById(s){try{const{data:r,error:a}=await R.from("users").select("id, display_name, profile_image_url, cover_image_url, bio, created_at").eq("id",s).maybeSingle();return a?(console.error("Error fetching user profile by ID:",a),null):r}catch(r){return console.error("Error in getUserProfileById:",r),null}}static async uploadProfileImage(s,r="profile-images"){try{const{data:{user:a}}=await R.auth.getUser();if(!a)throw new Error("No authenticated user");const i=s.name.split(".").pop(),o=`${a.id}-${Date.now()}.${i}`,n=`${r}/${o}`,{data:u,error:m}=await R.storage.from("profile-images").upload(n,s);if(m)return console.error("Error uploading profile image:",m),null;const{data:{publicUrl:f}}=R.storage.from("profile-images").getPublicUrl(n);return f}catch(a){return console.error("Error in uploadProfileImage:",a),null}}static async deleteProfileImage(s){try{const r=s.split("/"),i=`profile-images/${r[r.length-1]}`,{error:o}=await R.storage.from("profile-images").remove([i]);return o?(console.error("Error deleting profile image:",o),!1):!0}catch(r){return console.error("Error in deleteProfileImage:",r),!1}}static async deleteUserAccount(){try{const{data:{user:s}}=await R.auth.getUser();if(!s)return{success:!1,error:"No authenticated user found"};const r=await fetch(`${Jt()}/api/users/${s.id}/delete-account`,{method:"DELETE",headers:{"Content-Type":"application/json"}});return r.ok?await r.json():{success:!1,error:(await r.json()).error||"Failed to delete account"}}catch(s){return console.error("Error in deleteUserAccount:",s),{success:!1,error:s.message}}}static async isCreator(){try{const s=localStorage.getItem("isAuthenticated"),r=localStorage.getItem("user");if(s==="true"&&r)try{const n=JSON.parse(r);if((n==null?void 0:n.role)==="creator")return!0;if((n==null?void 0:n.role)==="customer")return!1}catch{}let a=null;try{if(r){const n=JSON.parse(r);a=n==null?void 0:n.id}}catch{}if(!a){const{data:{user:n}}=await R.auth.getUser();if(!n)return!1;a=n.id}const{data:i,error:o}=await R.from("users").select("role").eq("id",a).maybeSingle();return o?(console.error("Error checking creator status:",o),!1):(i==null?void 0:i.role)==="creator"}catch(s){return console.error("Error in isCreator:",s),!1}}}const{getCurrentUserProfile:mu,upsertUserProfile:ho,updateUserProfile:pu,getUserProfileById:gu,uploadProfileImage:fu,deleteProfileImage:yu,deleteUserAccount:mo,isCreator:xu}=sr;let xs=null,wr=0;const po=6e4;function rs(){var t;if(typeof window<"u"){const s=(((t=window.location)==null?void 0:t.origin)||"").toLowerCase();if(s==="https://screenmerch.com"||s==="https://www.screenmerch.com")return""}return ze.BASE_URL||"https://screenmerch.fly.dev"}class Be{static async getCurrentUser(){var i,o,n,u,m;let s=null,r=null,a=null;try{const{data:{user:f},error:k}=await R.auth.getUser();f&&!k&&(s=f,r=(i=f.email)==null?void 0:i.toLowerCase().trim(),a=f.id)}catch{}if(!s){const f=localStorage.getItem("isAuthenticated"),k=localStorage.getItem("user");if(f==="true"&&k)try{s=JSON.parse(k),r=(u=s.email||((o=s.user_metadata)==null?void 0:o.email)||((n=s.user)==null?void 0:n.email))==null?void 0:u.toLowerCase().trim(),a=s.id||((m=s.user)==null?void 0:m.id)}catch(M){console.error("üîê AdminService: Error parsing localStorage user:",M)}}return!s||!r&&!a?null:{user:s,userId:a,userEmail:r}}static async checkAdminStatus(){const s=Date.now();if(xs&&s-wr<po)return console.log("üîê AdminService: Using cached admin status"),xs;const r=await this.getCurrentUser();if(!r)return console.log("üîê AdminService: No authenticated user found"),{isAdmin:!1,isFullAdmin:!1,isMasterAdmin:!1,isOrderProcessingAdmin:!1,adminRole:null};const{userId:a,userEmail:i}=r;console.log("üîê AdminService: Checking admin status via backend for:",{userId:a,userEmail:i});try{const o=rs(),n=await fetch(`${o}/api/auth/check-admin`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({user_id:a,email:i})});if(!n.ok)return console.error("üîê AdminService: Backend check failed with status:",n.status),{isAdmin:!1,isFullAdmin:!1,isMasterAdmin:!1,isOrderProcessingAdmin:!1,adminRole:null};const u=await n.json();return console.log("üîê AdminService: Backend admin check result:",u),u.success?(xs={isAdmin:u.isAdmin||!1,isFullAdmin:u.isFullAdmin||!1,isMasterAdmin:u.isMasterAdmin||!1,isOrderProcessingAdmin:u.isOrderProcessingAdmin||!1,adminRole:u.adminRole||null},wr=s,xs):{isAdmin:!1,isFullAdmin:!1,isMasterAdmin:!1,isOrderProcessingAdmin:!1,adminRole:null}}catch(o){return console.error("üîê AdminService: Error calling backend:",o),{isAdmin:!1,isFullAdmin:!1,isMasterAdmin:!1,isOrderProcessingAdmin:!1,adminRole:null}}}static clearCache(){xs=null,wr=0,console.log("üîê AdminService: Cache cleared")}static async isAdmin(){return(await this.checkAdminStatus()).isAdmin}static async isMasterAdmin(){return(await this.checkAdminStatus()).isMasterAdmin}static async isFullAdmin(){return(await this.checkAdminStatus()).isFullAdmin}static async isOrderProcessingAdmin(){return(await this.checkAdminStatus()).isOrderProcessingAdmin}static async getDashboardStats(){var s,r,a;try{const i=localStorage.getItem("isAuthenticated"),o=localStorage.getItem("user");let n=null;if(i==="true"&&o)n=JSON.parse(o);else{const{data:{user:v}}=await R.auth.getUser();n=v}if(!n)throw new Error("No authenticated user");const u=n.id||((s=n.user)==null?void 0:s.id),m=(n.email||((r=n.user_metadata)==null?void 0:r.email)||((a=n.user)==null?void 0:a.email)||"").trim().toLowerCase(),f=rs(),k=new URLSearchParams;u&&k.set("user_id",u);const M=await fetch(`${f}/api/admin/dashboard-stats?${k.toString()}`,{method:"GET",headers:{"Content-Type":"application/json",...m?{"X-User-Email":m}:{}},credentials:"include"});if(!M.ok)throw new Error(`HTTP ${M.status}: ${M.statusText}`);const h=await M.json();return console.log("üìä Admin dashboard stats from backend:",h),h}catch(i){return console.error("Error fetching dashboard stats:",i),{total_users:0,active_users:0,suspended_users:0,pending_users:0,total_videos:0,pending_videos:0,approved_videos:0,total_subscriptions:0,active_subscriptions:0,premium_subscriptions:0,creator_network_subscriptions:0}}}static async getUsers(s=0,r=20,a="",i="all",o="all"){try{const n=await this.getCurrentUser(),u=ze.BASE_URL||"https://screenmerch.fly.dev";if(n!=null&&n.userEmail){const h=new URLSearchParams({page:String(s),limit:String(r),status:i,role:o});a&&h.set("search",a);const v=await fetch(`${u}/api/admin/users?${h}`,{method:"GET",headers:{"X-User-Email":n.userEmail},credentials:"include"});if(v.ok){const _=await v.json();if(_.success&&Array.isArray(_.users))return console.log("üë• Fetching users from database..."),console.log("üë• Users fetched:",_.users.length,"users"),console.log("üë• Total count:",_.total??_.users.length),{users:_.users,total:_.total??0,page:_.page??s,limit:_.limit??r,totalPages:_.totalPages??1}}}console.log("üë• Fetching users from database...");let m=R.from("users").select("*",{count:"exact"});a&&(m=m.or(`display_name.ilike.%${a}%,email.ilike.%${a}%`)),i!=="all"&&(m=m.eq("status",i)),o!=="all"&&(m=m.eq("role",o));const{data:f,error:k,count:M}=await m.order("created_at",{ascending:!1}).range(s*r,(s+1)*r-1);if(k)throw console.error("üë• Error fetching users:",k),k;return console.log("üë• Users fetched:",(f==null?void 0:f.length)||0,"users"),console.log("üë• Total count:",M),{users:f||[],total:M||0,page:s,limit:r,totalPages:Math.ceil((M||0)/r)}}catch(n){return console.error("Error fetching users:",n),{users:[],total:0,page:s,limit:r,totalPages:0}}}static async getVideos(s=0,r=20,a="",i="all"){try{let o=R.from("videos2").select("*, users(display_name, email)",{count:"exact"});a&&(o=o.or(`title.ilike.%${a}%,description.ilike.%${a}%`)),i!=="all"&&(o=o.eq("verification_status",i));const{data:n,error:u,count:m}=await o.order("created_at",{ascending:!1}).range(s*r,(s+1)*r-1);if(u)throw u;return{videos:n||[],total:m||0,page:s,limit:r,totalPages:Math.ceil((m||0)/r)}}catch(o){return console.error("Error fetching videos:",o),{videos:[],total:0,page:s,limit:r,totalPages:0}}}static async getSubscriptions(s="active"){try{let r=R.from("user_subscriptions").select("*, users(display_name, email)").order("created_at",{ascending:!1});s==="all"||(r=r.eq("status",s));const{data:a,error:i}=await r;if(i)throw i;return a||[]}catch(r){return console.error("Error fetching subscriptions:",r),[]}}static async deleteSubscription(s){try{const{data:r,error:a}=await R.from("user_subscriptions").update({status:"canceled",updated_at:new Date().toISOString()}).eq("id",s).select().single();if(a)throw a;return await this.logAdminAction("delete_subscription","subscription",s,{target_subscription_id:s}),{success:!0,data:r}}catch(r){return console.error("Error deleting subscription:",r),{success:!1,error:r.message}}}static async reactivateSubscription(s){try{const{data:r,error:a}=await R.from("user_subscriptions").update({status:"active",updated_at:new Date().toISOString()}).eq("id",s).select().single();if(a)throw a;return await this.logAdminAction("reactivate_subscription","subscription",s,{target_subscription_id:s}),{success:!0,data:r}}catch(r){return console.error("Error reactivating subscription:",r),{success:!1,error:r.message}}}static async updateUserStatus(s,r){try{console.log(`Updating user ${s} status to ${r}`);const{data:{user:a}}=await R.auth.getUser();if(!a)return{success:!1,error:"Not authenticated"};const{data:i,error:o}=await R.from("users").update({status:r}).eq("id",s).select().single();if(o)throw console.error("Database update error:",o),o;return console.log("Database update successful:",i),await this.logAdminAction("update_user_status","user",s,{new_status:r,target_user_id:s}),{success:!0,data:i}}catch(a){return console.error("Error updating user status:",a),{success:!1,error:a.message}}}static async approveUser(s){return this.updateUserStatus(s,"active")}static async deleteUser(s){try{console.log("üóëÔ∏è Deleting user:",s),console.log("üóëÔ∏è API URL:",`${ze.SUBSCRIPTION_API_URL}/api/users/${s}/delete-account`);const r=await fetch(`${ze.SUBSCRIPTION_API_URL}/api/users/${s}/delete-account`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("üóëÔ∏è Delete response status:",r.status),console.log("üóëÔ∏è Delete response ok:",r.ok),!r.ok){const i=await r.json();return console.error("üóëÔ∏è Delete error response:",i),{success:!1,error:i.error||"Failed to delete user"}}const a=await r.json();return console.log("üóëÔ∏è Delete success response:",a),await this.logAdminAction("delete_user","user",s,{target_user_id:s}),{success:!0}}catch(r){return console.error("Error deleting user:",r),{success:!1,error:r.message}}}static async updateVideoStatus(s,r){try{const{data:a,error:i}=await R.from("videos2").update({verification_status:r}).eq("id",s).select().single();if(i)throw i;return await this.logAdminAction("update_video_status","video",s,{new_status:r,target_video_id:s}),{success:!0,data:a}}catch(a){return console.error("Error updating video status:",a),{success:!1,error:a.message}}}static async updateVideo(s,r){try{const a=localStorage.getItem("isAuthenticated"),i=localStorage.getItem("user");let o=null;if(a==="true"&&i)o=JSON.parse(i);else{const{data:{user:M}}=await R.auth.getUser();o=M}if(!o)return{success:!1,error:"Not authenticated"};const{data:n,error:u}=await R.from("videos2").select("user_id").eq("id",s).single();if(u)throw u;if(n.user_id!==o.id)return{success:!1,error:"You can only edit your own videos"};const m={};r.title!==void 0&&(m.title=r.title),r.thumbnail!==void 0&&(m.thumbnail=r.thumbnail),r.video_url!==void 0&&(m.video_url=r.video_url);const{data:f,error:k}=await R.from("videos2").update(m).eq("id",s).select().single();if(k)throw k;return await this.logAdminAction("update_video","video",s,{updates:m,target_video_id:s}),{success:!0,data:f}}catch(a){return console.error("Error updating video:",a),{success:!1,error:a.message}}}static async deleteVideo(s){try{const{data:r,error:a}=await R.from("videos2").select("*").eq("id",s).single();if(a)throw a;const{error:i}=await R.from("videos2").delete().eq("id",s);if(i)throw i;if(r&&r.video_url&&!r.video_url.includes("youtube.com"))try{const o=r.video_url.split("/storage/v1/object/public/")[1];o&&await R.storage.from("videos2").remove([o])}catch(o){console.warn("Could not delete video file from storage:",o)}if(r&&r.thumbnail&&!r.thumbnail.includes("ytimg.com"))try{const o=r.thumbnail.split("/storage/v1/object/public/")[1];o&&await R.storage.from("thumbnails").remove([o])}catch(o){console.warn("Could not delete thumbnail from storage:",o)}return await this.logAdminAction("delete_video","video",s,{target_video_id:s}),{success:!0}}catch(r){return console.error("Error deleting video:",r),{success:!1,error:r.message}}}static async getAdminSettings(){try{const{data:s,error:r}=await R.from("admin_settings").select("*").order("setting_key");if(r)throw r;const a={};return s.forEach(i=>{a[i.setting_key]=i.setting_value}),a}catch(s){return console.error("Error fetching admin settings:",s),{}}}static async updateAdminSetting(s,r){try{const{data:{user:a}}=await R.auth.getUser();if(!a)return{success:!1,error:"Not authenticated"};const{data:i,error:o}=await R.rpc("update_admin_setting",{p_setting_key:s,p_setting_value:r,p_admin_user_id:a.id});if(o)throw o;return{success:!0,data:i}}catch(a){return console.error("Error updating admin setting:",a),{success:!1,error:a.message}}}static async getAdminLogs(s=0,r=50){try{const{data:a,error:i,count:o}=await R.from("admin_logs").select("*, admin_user:users(display_name, email)",{count:"exact"}).order("created_at",{ascending:!1}).range(s*r,(s+1)*r-1);if(i)throw i;return{logs:a||[],total:o||0,page:s,limit:r,totalPages:Math.ceil((o||0)/r)}}catch(a){return console.error("Error fetching admin logs:",a),{logs:[],total:0,page:s,limit:r,totalPages:0}}}static async logAdminAction(s,r,a=null,i=null){try{const{data:{user:o}}=await R.auth.getUser();if(!o)return;await R.rpc("log_admin_action",{p_admin_user_id:o.id,p_action_type:s,p_target_type:r,p_target_id:a,p_details:i})}catch(o){console.error("Error logging admin action:",o)}}static async getRecentActivity(s=10){try{const{data:r,error:a}=await R.from("admin_logs").select("*, admin_user:users(display_name, email)").order("created_at",{ascending:!1}).limit(s);if(a)throw a;return r||[]}catch(r){return console.error("Error fetching recent activity:",r),[]}}static async getPendingPayouts(){try{const{data:s,error:r}=await R.from("creator_earnings").select(`
          *,
          user:users!inner(
            id,
            display_name,
            email,
            paypal_email,
            profile_image_url
          )
        `).eq("status","pending").order("created_at",{ascending:!0});if(r)throw r;const a=new Map;return s.forEach(o=>{const n=o.user_id;a.has(n)||a.set(n,{user_id:n,display_name:o.user.display_name||o.user.email,email:o.user.email,paypal_email:o.user.paypal_email,profile_image_url:o.user.profile_image_url,pending_amount:0,earnings_count:0,earnings:[]});const u=a.get(n);u.pending_amount+=parseFloat(o.creator_share||0),u.earnings_count+=1,u.earnings.push(o)}),Array.from(a.values()).filter(o=>o.pending_amount>=50).sort((o,n)=>n.pending_amount-o.pending_amount)}catch(s){return console.error("Error fetching pending payouts:",s),[]}}static async getPendingCreators(){try{const s=await this.getCurrentUser();if(!(s!=null&&s.userEmail))throw new Error("Not authenticated");const r=rs(),a=await fetch(`${r}/api/admin/pending-creators`,{method:"GET",headers:{"X-User-Email":s.userEmail},credentials:"include"});if(!a.ok)throw new Error(await a.text());return(await a.json()).pending_creators||[]}catch(s){return console.error("Error fetching pending creators:",s),[]}}static async approveCreator(s){try{const r=await this.getCurrentUser();if(!(r!=null&&r.userEmail))throw new Error("Not authenticated");const a=rs(),i=await fetch(`${a}/api/admin/approve-creator/${s}`,{method:"POST",headers:{"Content-Type":"application/json","X-User-Email":r.userEmail},credentials:"include",body:JSON.stringify({})}),o=await i.json();return i.ok?{success:!0}:{success:!1,error:o.error||i.statusText}}catch(r){return console.error("Error approving creator:",r),{success:!1,error:r.message}}}static async disapproveCreator(s){try{const r=await this.getCurrentUser();if(!(r!=null&&r.userEmail))throw new Error("Not authenticated");const a=rs(),i=await fetch(`${a}/api/admin/disapprove-creator/${s}`,{method:"POST",headers:{"Content-Type":"application/json","X-User-Email":r.userEmail},credentials:"include",body:JSON.stringify({})}),o=await i.json();return i.ok?{success:!0}:{success:!1,error:o.error||i.statusText}}catch(r){return console.error("Error disapproving creator:",r),{success:!1,error:r.message}}}static async setCreatorPending(s){try{const r=await this.getCurrentUser();if(!(r!=null&&r.userEmail))throw new Error("Not authenticated");const a=rs(),i=await fetch(`${a}/api/admin/set-creator-pending`,{method:"POST",headers:{"Content-Type":"application/json","X-User-Email":r.userEmail},credentials:"include",body:JSON.stringify({email:(s||"").trim().toLowerCase()})}),o=await i.json();return i.ok?{success:!0,message:o.message}:{success:!1,error:o.error||i.statusText}}catch(r){return console.error("Error setting creator to pending:",r),{success:!1,error:r.message}}}static async getPayoutHistory(){try{const{data:s,error:r}=await R.from("payouts").select(`
          *,
          user:users!inner(
            id,
            display_name,
            email
          )
        `).order("payout_date",{ascending:!1}).limit(100);if(r)throw r;return s||[]}catch(s){return console.error("Error fetching payout history:",s),[]}}static async processPayout(s,r,a){try{const{data:i,error:o}=await R.from("payouts").insert({user_id:s,amount:r,payment_method:"paypal",status:"completed",processed_date:new Date().toISOString()}).select().single();if(o)throw o;const{error:n}=await R.from("creator_earnings").update({status:"paid",payout_id:i.id}).in("id",a);if(n)throw n;return{success:!0,payout:i}}catch(i){return console.error("Error processing payout:",i),{success:!1,error:i.message}}}static async getCurrentUserEmail(){var s,r,a;try{const{data:{user:i}}=await R.auth.getUser();if(i!=null&&i.email)return i.email.toLowerCase().trim();const o=localStorage.getItem("isAuthenticated"),n=localStorage.getItem("user");if(o==="true"&&n){const u=JSON.parse(n);return((a=u.email||((s=u.user_metadata)==null?void 0:s.email)||((r=u.user)==null?void 0:r.email))==null?void 0:a.toLowerCase().trim())||null}return null}catch(i){return console.error("Error getting user email:",i),null}}static async getProcessingQueue(s="all"){try{const r=await this.getCurrentUserEmail(),a={}.REACT_APP_API_URL||"https://screenmerch.fly.dev",i={"Content-Type":"application/json"};r&&(i["X-User-Email"]=r);const o=await fetch(`${a}/api/admin/processing-queue?status=${s}`,{method:"GET",credentials:"include",headers:i});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);const n=await o.json();if(n.success)return n.data||[];throw new Error(n.error||"Failed to fetch processing queue")}catch(r){return console.error("Error fetching processing queue:",r),[]}}static async assignOrderToWorker(s,r){try{const{data:a,error:i}=await R.from("order_processing_queue").update({status:"assigned",assigned_to:r,assigned_at:new Date().toISOString()}).eq("id",s).select().single();if(i)throw i;return await this.logAdminAction("assign_order","order_processing_queue",s,{worker_id:r,queue_id:s}),{success:!0,data:a}}catch(a){return console.error("Error assigning order:",a),{success:!1,error:a.message}}}static async getProcessingHistory(s=50){try{const r=await this.getCurrentUserEmail(),a={}.REACT_APP_API_URL||"https://screenmerch.fly.dev",i={"Content-Type":"application/json"};r&&(i["X-User-Email"]=r);const o=await fetch(`${a}/api/admin/processing-history?limit=${s}`,{method:"GET",credentials:"include",headers:i});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);const n=await o.json();if(n.success)return n.data||[];throw new Error(n.error||"Failed to fetch processing history")}catch(r){return console.error("Error fetching processing history:",r),[]}}static async getWorkers(){try{const s=await this.getCurrentUserEmail(),r={}.REACT_APP_API_URL||"https://screenmerch.fly.dev",a={"Content-Type":"application/json"};s&&(a["X-User-Email"]=s);const i=await fetch(`${r}/api/admin/workers`,{method:"GET",credentials:"include",headers:a});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const o=await i.json();if(o.success)return o.data||[];throw new Error(o.error||"Failed to fetch workers")}catch(s){return console.error("Error fetching workers:",s),[]}}static async grantProcessorPermissions(s,r=50){try{const{data:a,error:i}=await R.from("processor_permissions").upsert({user_id:s,role:"processor",is_active:!0,max_orders_per_day:r}).select().single();if(i)throw i;return await this.logAdminAction("grant_processor_permissions","user",s,{max_orders_per_day:r}),{success:!0,data:a}}catch(a){return console.error("Error granting processor permissions:",a),{success:!1,error:a.message}}}static async revokeProcessorPermissions(s){try{const{data:r,error:a}=await R.from("processor_permissions").update({is_active:!1}).eq("user_id",s).select().single();if(a)throw a;return await this.logAdminAction("revoke_processor_permissions","user",s),{success:!0,data:r}}catch(r){return console.error("Error revoking processor permissions:",r),{success:!1,error:r.message}}}static async submitAdminSignupRequest(s){try{const{data:r,error:a}=await R.from("admin_signup_requests").insert({email:s.toLowerCase().trim(),status:"pending"}).select().single();if(a)throw a;return{success:!0,data:r}}catch(r){return console.error("Error submitting admin signup request:",r),{success:!1,error:r.message}}}static async getAdminSignupRequests(){try{const s=await this.getCurrentUser(),r=ze.BASE_URL||"https://screenmerch.fly.dev";if(s!=null&&s.userEmail){const o=await fetch(`${r}/api/admin/signup-requests`,{method:"GET",headers:{"X-User-Email":s.userEmail},credentials:"include"});if(o.ok){const n=await o.json();if(n.success&&Array.isArray(n.requests))return n.requests}}const{data:a,error:i}=await R.from("admin_signup_requests").select("*").order("requested_at",{ascending:!1});if(i)throw i;return a||[]}catch(s){return(s==null?void 0:s.code)==="42P01"?(console.warn("Admin signup requests table does not exist yet; returning empty list."),[]):(console.error("Error fetching admin signup requests:",s),[])}}static async approveAdminSignupRequest(s,r="order_processing_admin"){try{const{data:a,error:i}=await R.from("admin_signup_requests").select("*").eq("id",s).single();if(i)throw i;const{data:{user:o}}=await R.auth.getUser();if(!o)return{success:!1,error:"Not authenticated"};const{error:n}=await R.from("admin_signup_requests").update({status:"approved",approved_by:o.id,approved_at:new Date().toISOString()}).eq("id",s);if(n)throw n;const{data:u}=await R.from("users").select("*").ilike("email",a.email).single();if(u){const{error:m}=await R.from("users").update({is_admin:!0,admin_role:r}).eq("id",u.id);if(m)throw m}else{const{error:m}=await R.from("users").insert({email:a.email,is_admin:!0,admin_role:r,role:"customer",status:"active"});if(m)throw m}return await this.logAdminAction("approve_admin_signup","admin_signup_request",s,{approved_email:a.email,admin_role:r}),{success:!0}}catch(a){return console.error("Error approving admin signup request:",a),{success:!1,error:a.message}}}static async rejectAdminSignupRequest(s,r=""){try{const{data:{user:a}}=await R.auth.getUser();if(!a)return{success:!1,error:"Not authenticated"};const{error:i}=await R.from("admin_signup_requests").update({status:"rejected",approved_by:a.id,approved_at:new Date().toISOString(),notes:r}).eq("id",s);if(i)throw i;return await this.logAdminAction("reject_admin_signup","admin_signup_request",s,{notes:r}),{success:!0}}catch(a){return console.error("Error rejecting admin signup request:",a),{success:!1,error:a.message}}}static async getAllAdmins(){try{const{data:s,error:r}=await R.from("users").select("id, email, display_name, admin_role, is_admin, created_at").eq("is_admin",!0).order("created_at",{ascending:!1});if(r)throw r;return s||[]}catch(s){return console.error("Error fetching admins:",s),[]}}static async updateAdminRole(s,r){try{const{data:a,error:i}=await R.from("users").update({admin_role:r}).eq("id",s).select().single();if(i)throw i;return await this.logAdminAction("update_admin_role","user",s,{new_role:r}),{success:!0,data:a}}catch(a){return console.error("Error updating admin role:",a),{success:!1,error:a.message}}}static async removeAdminAccess(s){try{const{data:r,error:a}=await R.from("users").update({is_admin:!1,admin_role:null}).eq("id",s).select().single();if(a)throw a;return await this.logAdminAction("remove_admin_access","user",s),{success:!0,data:r}}catch(r){return console.error("Error removing admin access:",r),{success:!1,error:r.message}}}static async getSubdomains(){try{const s=await this.getCurrentUserEmail();if(!s)return[];const r=ze.BASE_URL||"https://screenmerch.fly.dev",a=await fetch(`${r}/api/admin/subdomains`,{method:"GET",headers:{"Content-Type":"application/json","X-User-Email":s},credentials:"include"});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const i=await a.json();if(i.success)return i.subdomains||[];throw new Error(i.error||"Failed to fetch subdomains")}catch(s){return console.error("Error fetching subdomains:",s),[]}}static async updateSubdomain(s,r){try{const a=await this.getCurrentUserEmail();if(!a)return{success:!1,error:"Not authenticated"};const i=ze.BASE_URL||"https://screenmerch.fly.dev",o=await fetch(`${i}/api/admin/subdomains/${s}`,{method:"PUT",headers:{"Content-Type":"application/json","X-User-Email":a},credentials:"include",body:JSON.stringify({subdomain:r.trim().toLowerCase(),admin_email:a})});if(!o.ok){const u=await o.json();throw new Error(u.error||`HTTP ${o.status}: ${o.statusText}`)}return await o.json()}catch(a){return console.error("Error updating subdomain:",a),{success:!1,error:a.message}}}static async validateSubdomain(s){try{const r=ze.BASE_URL||"https://screenmerch.fly.dev",a=await fetch(`${r}/api/admin/subdomains/validate`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({subdomain:s.trim().toLowerCase()})});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);return await a.json()}catch(r){return console.error("Error validating subdomain:",r),{success:!1,is_accessible:!1,error:r.message}}}static async deleteOrder(s){try{const r=await this.getCurrentUserEmail(),a={}.REACT_APP_API_URL||"https://screenmerch.fly.dev",i={"Content-Type":"application/json"};r&&(i["X-User-Email"]=r);const o=await fetch(`${a}/api/admin/delete-order/${s}`,{method:"DELETE",credentials:"include",headers:i});if(!o.ok){const u=await o.json();throw new Error(u.error||`HTTP ${o.status}: ${o.statusText}`)}const n=await o.json();return await this.logAdminAction("delete_order","order_processing_queue",s),n}catch(r){return console.error("Error deleting order:",r),{success:!1,error:r.message}}}static async resetSales(s){try{const r=await this.getCurrentUserEmail();if(!r)return{success:!1,error:"Not authenticated"};const a=ze.BASE_URL||"https://screenmerch.fly.dev",i={"Content-Type":"application/json","X-User-Email":r},o=await fetch(`${a}/api/admin/reset-sales`,{method:"POST",credentials:"include",headers:i,body:JSON.stringify({user_id:s})});if(!o.ok){const u=await o.json();throw new Error(u.error||`HTTP ${o.status}: ${o.statusText}`)}const n=await o.json();return await this.logAdminAction("reset_sales","user",s,{target_user_id:s}),n}catch(r){return console.error("Error resetting sales:",r),{success:!1,error:r.message}}}static async getPlatformRevenue(s=null,r=null,a=null){try{const i=await this.getCurrentUserEmail();if(!i)return{success:!1,error:"Not authenticated"};const o=new URLSearchParams;s&&o.append("start_date",s),r&&o.append("end_date",r),a&&o.append("creator_id",a);const n=ze.BASE_URL||"https://screenmerch.fly.dev",u={"Content-Type":"application/json","X-User-Email":i},m=o.toString(),f=`${n}/api/admin/platform-revenue${m?"?"+m:""}`,k=await fetch(f,{method:"GET",credentials:"include",headers:u});if(!k.ok){const h=await k.json();throw new Error(h.error||`HTTP ${k.status}: ${k.statusText}`)}return await k.json()}catch(i){return console.error("Error fetching platform revenue:",i),{success:!1,error:i.message}}}}const go=({setSidebar:t,resetCategory:s})=>{var N,D,w;const[r,a]=c.useState(!1),[i,o]=c.useState(!1),[n,u]=c.useState(null),[m,f]=c.useState(null),[k,M]=c.useState(null),[h,v]=c.useState(!0),[_,b]=c.useState(!1),[x,T]=c.useState(!1),[S,A]=c.useState(""),[E,z]=c.useState(!1),[V,X]=c.useState(!1),Y=ct(),$=hs(),se=$.pathname==="/success";c.useEffect(()=>{let p=!0;const ee=Le=>{var Ye,I,J,Se,oe,ve;if(console.log("üì° Navbar received oauthSuccess event:",Le.detail),console.log("üì° OAuth user picture:",(Ye=Le.detail)==null?void 0:Ye.picture),console.log("üì° OAuth user metadata picture:",(J=(I=Le.detail)==null?void 0:I.user_metadata)==null?void 0:J.picture),console.log("üì° OAuth user profile_image_url:",(Se=Le.detail)==null?void 0:Se.profile_image_url),p){const le=Le.detail;if(u(le),v(!1),T(!1),console.log("üîÑ Navbar state updated from OAuth event"),le.profile_image_url||le.picture||(oe=le.user_metadata)!=null&&oe.picture){const ne=le.profile_image_url||le.picture||((ve=le.user_metadata)==null?void 0:ve.picture);console.log("üñºÔ∏è Setting userProfile with image URL:",ne),f({profile_image_url:ne,cover_image_url:le.cover_image_url||"",display_name:le.display_name,...le})}else f({profile_image_url:"",cover_image_url:le.cover_image_url||"",display_name:le.display_name,...le});setTimeout(()=>{p&&(console.log("üîÑ Forcing Navbar re-render after OAuth (1st attempt)"),u(ne=>({...ne,...le})),(le.profile_image_url||le.picture)&&f(ne=>({...ne,profile_image_url:le.profile_image_url||le.picture||(ne==null?void 0:ne.profile_image_url)})))},50),setTimeout(()=>{var ne;p&&(console.log("üîÑ Forcing Navbar re-render after OAuth (2nd attempt)"),u(le),(le.profile_image_url||le.picture)&&f({profile_image_url:le.profile_image_url||le.picture||((ne=le.user_metadata)==null?void 0:ne.picture),cover_image_url:le.cover_image_url||"",display_name:le.display_name,...le}))},200)}};window.addEventListener("oauthSuccess",ee);const ie=async()=>{p&&(await R.auth.signOut(),u(null),f(null),M(null),v(!1))};window.addEventListener("creatorThankYouSignOut",ie);const we=async Le=>{var Ye,I,J,Se;if(console.log("üì° Navbar received userLoggedIn event:",Le.detail),p&&((Ye=Le.detail)!=null&&Ye.user)){const oe=Le.detail.user;console.log("üîê [NAVBAR] Received user from login event:",oe),console.log("üîê [NAVBAR] Initial user role:",oe.role,"status:",oe.status);const ve=oe.id,le=oe.email;if(ve||le)try{let ne=null,De=null;if(ve?(console.log("üîê [NAVBAR] Fetching profile from backend for user ID:",ve),ne=await _s(ve),De=ne?null:new Error("No profile returned")):le&&(console.log("üîê [NAVBAR] No ID found, using login data"),ne=null,De=null),De&&console.error("‚ùå [NAVBAR] Error fetching profile:",De),ne&&p){console.log("üîê [NAVBAR] ‚úÖ Found user profile from database:",ne),console.log("üîê [NAVBAR] Database profile role:",ne.role,"status:",ne.status),console.log("üîê [NAVBAR] Backend response role:",oe.role,"status:",oe.status);const K={...oe,...ne,id:ne.id||oe.id,role:ne.role!==null&&ne.role!==void 0?ne.role:oe.role||"customer",status:ne.status!==null&&ne.status!==void 0?ne.status:oe.status||"active",profile_image_url:ne.profile_image_url||oe.profile_image_url||oe.picture||((I=oe.user_metadata)==null?void 0:I.picture),cover_image_url:ne.cover_image_url||oe.cover_image_url||"",display_name:ne.display_name||oe.display_name};f(K),u(K),localStorage.setItem("user",JSON.stringify(K)),console.log("üîê [NAVBAR] ‚úÖ Final merged profile role:",K.role,"status:",K.status,"profile_image_url:",K.profile_image_url);const re=(K.role==="creator"||K.role==="admin")&&(K.status==="active"||K.status===void 0);console.log("üîê [NAVBAR] ‚úÖ Will show profile image?",re),v(!1)}else{console.warn("‚ö†Ô∏è [NAVBAR] No profile found in database, using login data");const K={profile_image_url:oe.profile_image_url||oe.picture||((J=oe.user_metadata)==null?void 0:J.picture),cover_image_url:oe.cover_image_url||"",display_name:oe.display_name,...oe};f(K),u(K),v(!1)}}catch(ne){console.error("‚ùå [NAVBAR] Error fetching user profile:",ne);const De={profile_image_url:oe.profile_image_url||oe.picture||((Se=oe.user_metadata)==null?void 0:Se.picture),cover_image_url:oe.cover_image_url||"",display_name:oe.display_name,...oe};f(De),u(De),v(!1)}else console.warn("‚ö†Ô∏è [NAVBAR] No user ID or email, cannot fetch profile"),u(oe),v(!1)}};window.addEventListener("userLoggedIn",we);const Ce=async()=>{var Le,Ye,I,J,Se,oe;try{let ve=localStorage.getItem("oauth_confirmation_pending");if(ve==="true"){console.log("üîê OAuth confirmation pending, waiting..."),T(!0);let re=0;for(;ve==="true"&&re<50;)await new Promise(Ae=>setTimeout(Ae,100)),ve=localStorage.getItem("oauth_confirmation_pending"),re++;console.log("üîê OAuth processing completed or timeout reached"),T(!1)}await new Promise(re=>setTimeout(re,200));const le=localStorage.getItem("isAuthenticated"),ne=localStorage.getItem("user");if(le==="true"&&ne)try{const re=JSON.parse(ne);if(console.log("üîê [FETCHUSER] Found authenticated user:",re),console.log("üîê [FETCHUSER] Initial role from localStorage:",re==null?void 0:re.role,"status:",re==null?void 0:re.status),p)if(re.id){console.log("üîê [FETCHUSER] Fetching latest user profile from backend for user:",re.id);const Ae=await _s(re.id),q=Ae?null:new Error("No profile returned");if(q&&console.error("‚ùå [FETCHUSER] Error fetching profile:",q),Ae&&p){console.log("üîê [FETCHUSER] ‚úÖ Found user profile from database:",Ae),console.log("üîê [FETCHUSER] Database role:",Ae.role,"status:",Ae.status),console.log("üîê [FETCHUSER] Database profile_image_url:",Ae.profile_image_url);const Z={...re,...Ae,role:Ae.role!==null&&Ae.role!==void 0?Ae.role:re.role||"customer",status:Ae.status!==null&&Ae.status!==void 0?Ae.status:re.status||"active",profile_image_url:Ae.profile_image_url||re.profile_image_url||re.picture||((Le=re.user_metadata)==null?void 0:Le.picture),cover_image_url:Ae.cover_image_url||re.cover_image_url||"",display_name:Ae.display_name||re.display_name};f(Z);const he={...re,role:Z.role,status:Z.status,profile_image_url:Z.profile_image_url,cover_image_url:Z.cover_image_url,display_name:Z.display_name};localStorage.setItem("user",JSON.stringify(he)),u(he),console.log("üîê [FETCHUSER] ‚úÖ Final merged profile role:",Z.role,"Status:",Z.status,"profile_image_url:",Z.profile_image_url);const F=(Z.role==="creator"||Z.role==="admin")&&(Z.status==="active"||Z.status===void 0);console.log("üîê [FETCHUSER] ‚úÖ Will show profile image?",F)}else{console.warn("‚ö†Ô∏è [FETCHUSER] No user profile found in database, using stored data:",q);const Z={profile_image_url:re.profile_image_url||re.picture||((Ye=re.user_metadata)==null?void 0:Ye.picture),cover_image_url:re.cover_image_url||"",display_name:re.display_name,...re};f(Z),u(Z)}}else{console.warn("‚ö†Ô∏è [FETCHUSER] User has no ID, using stored data as-is");const Ae={profile_image_url:re.profile_image_url||re.picture||((I=re.user_metadata)==null?void 0:I.picture),cover_image_url:re.cover_image_url||"",display_name:re.display_name,...re};f(Ae),u(Ae)}}catch(re){console.error("Error parsing user data:",re)}else console.log("üîê No authenticated user found. isAuthenticated:",le,"userData:",ne);const De=localStorage.getItem("customer_authenticated"),K=localStorage.getItem("customer_user");if(De==="true"&&K)try{const re=JSON.parse(K);console.log("üõí Found customer user:",re),p&&M(re)}catch(re){console.error("Error parsing customer user data:",re)}if(p&&v(!1),!le||!ne){console.log("üîê No Google OAuth user found, checking Supabase auth...");const re=R.auth.getUser(),Ae=new Promise((Z,he)=>setTimeout(()=>he(new Error("Auth timeout")),5e3)),{data:{user:q}}=await Promise.race([re,Ae]);if(p&&(console.log("üîê Supabase auth result:",q),u(q),v(!1),q)){const Z={id:q.id,username:((Se=(J=q.user_metadata)==null?void 0:J.name)==null?void 0:Se.replace(/\s+/g,"").toLowerCase())||q.email,display_name:((oe=q.user_metadata)==null?void 0:oe.name)||q.email,email:q.email};console.log("Upserting user profile with:",Z),ho(Z).catch(he=>console.error("Upsert error:",he))}}else console.log("üîê Google OAuth user found, skipping Supabase auth check")}catch(ve){console.error("Auth fetch error:",ve),p&&(u(null),v(!1))}};Ce();let Oe;const{data:{subscription:it}}=R.auth.onAuthStateChange((Le,Ye)=>{Oe&&clearTimeout(Oe),Oe=setTimeout(()=>{if(p){const I=localStorage.getItem("isAuthenticated"),J=localStorage.getItem("user");console.log("üîÑ Auth state change detected:",Le,"Google OAuth user exists:",!!(I&&J)),!I||!J?(console.log("üîÑ No Google OAuth user, refetching from Supabase..."),Ce()):console.log("üîÑ Google OAuth user exists, skipping Supabase refetch")}},100)});return()=>{p=!1,window.removeEventListener("oauthSuccess",ee),window.removeEventListener("creatorThankYouSignOut",ie),window.removeEventListener("userLoggedIn",we),Oe&&clearTimeout(Oe),it.unsubscribe()}},[]),c.useEffect(()=>{const p=window.innerWidth<=768||"ontouchstart"in window,ee=we=>{if(p)setTimeout(()=>{const Ce=we.target.closest(".user-profile-container")||we.target.closest(".user-dropdown");_&&!Ce&&(console.log("üîÑ Closing dropdown - clicked outside (mobile)"),b(!1))},10);else{const Ce=we.target.closest(".user-profile-container")||we.target.closest(".user-dropdown");_&&!Ce&&(console.log("üîÑ Closing dropdown - clicked outside (desktop)"),b(!1))}},ie=we=>{we.key==="Escape"&&_&&(console.log("üîÑ Closing dropdown - Escape key"),b(!1))};return document.addEventListener("click",ee,!p),document.addEventListener("keydown",ie),()=>{document.removeEventListener("click",ee,!p),document.removeEventListener("keydown",ie)}},[_]),c.useEffect(()=>{(async()=>{var ee;if(n)try{const ie=await Be.isOrderProcessingAdmin(),we=await Be.isFullAdmin();z(ie),X(we)}catch(ie){(ie==null?void 0:ie.code)!=="PGRST116"&&!((ee=ie==null?void 0:ie.message)!=null&&ee.includes("406"))&&(ie==null?void 0:ie.status)!==406&&console.error("Error checking admin role:",ie),z(!1),X(!1)}else z(!1),X(!1)})()},[n]);const be=()=>{Y("/login")},xe=()=>{Y("/subscription-tiers")},ae=async(p,ee)=>{localStorage.setItem("pending_creator_email",p),localStorage.setItem("pending_creator_location",ee);const ie="https://screenmerch.com",we=window.location.origin==="https://screenmerch.com"||window.location.origin==="https://www.screenmerch.com"?"":"https://screenmerch.fly.dev";try{await fetch(`${we}/api/auth/register-pending-creator`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:(p||"").trim().toLowerCase()}),credentials:"include"})}catch{}const Ce=`${we}/api/auth/google/login?return_url=${encodeURIComponent(ie)}&flow=creator_signup`;window.location.href=Ce},W=()=>{o(!1)},O=async()=>{try{localStorage.removeItem("user"),localStorage.removeItem("isAuthenticated"),localStorage.removeItem("oauth_confirmation_pending"),localStorage.removeItem("customer_authenticated"),localStorage.removeItem("customer_user"),localStorage.removeItem("user_authenticated"),localStorage.removeItem("user_email"),localStorage.removeItem("auth_token"),localStorage.removeItem("pending_creator_email"),localStorage.removeItem("pending_creator_location"),Be.clearCache(),await R.auth.signOut(),u(null),M(null),f(null),console.log("‚úÖ Logged out successfully - all auth data cleared"),window.location.href="/"}catch(p){console.error("Logout error:",p),window.location.href="/"}},de=async()=>{if(window.confirm("Are you sure you want to delete your account? This action cannot be undone."))try{const p=await mo();p.success?(await R.auth.signOut(),u(null),Y("/"),alert("Your account has been successfully deleted."),window.location.reload()):alert(`Failed to delete account: ${p.error||"Unknown error"}`)}catch(p){console.error("Error deleting account:",p),alert("There was an error deleting your account. Please try again or contact support.")}},G=()=>{a(!1)},U=()=>{S.trim()&&Y(`/search?q=${encodeURIComponent(S.trim())}`)},y=p=>{p.key==="Enter"&&U()};return e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"flex-div",children:[e.jsxs("div",{className:"nav-left flex-div",children:[e.jsx("img",{src:so,alt:"Menu",className:"menu-icon",onClick:()=>t(p=>!p),onTouchStart:p=>{p.preventDefault(),p.stopPropagation(),t(ee=>!ee)},style:{touchAction:"manipulation",WebkitTapHighlightColor:"transparent"}}),e.jsxs(mt,{to:"/",onClick:()=>{s(),A("")},children:[" ",e.jsx("img",{src:tr,alt:"",className:`logo ${se?"order-success-logo":""}`})]})]}),e.jsxs("div",{className:"nav-center-right flex-div",children:[e.jsx("div",{className:"nav-middle flex-div",children:e.jsxs("div",{className:"search-box flex-div",children:[e.jsx("input",{type:"text",placeholder:"Search channels",value:S,onChange:p=>A(p.target.value),onKeyPress:y}),e.jsx("img",{src:ro,alt:"",onClick:U,style:{cursor:"pointer"}})]})}),e.jsxs("div",{className:"nav-right flex-div",children:[n&&(n.role==="creator"||n.role==="admin")&&(n.status==="active"||n.status===void 0)&&$.pathname!=="/creator-thank-you"&&!($.pathname==="/subscription-tiers"&&((n==null?void 0:n.status)==="pending"||(n==null?void 0:n.status)===void 0))?console.log("üé• Rendering upload link for creator:",n==null?void 0:n.display_name,"User object:",n)||e.jsx(mt,{to:"/upload",children:e.jsx("img",{src:ao,alt:"Upload"})}):x?console.log("üé• OAuth processing - hiding upload button")||e.jsx("div",{style:{width:"24px",height:"24px"}}):console.log("üé• No creator user - hiding upload button. User:",n,"Role:",n==null?void 0:n.role,"Status:",n==null?void 0:n.status)||e.jsx("div",{style:{width:"24px",height:"24px"}}),h?e.jsx("div",{className:"loading-spinner-navbar"}):(()=>{const p=n&&(n.role==="creator"||n.role==="admin"),ee=n&&(n.status==="active"||n.status===void 0),ie=$.pathname==="/creator-thank-you",we=$.pathname==="/subscription-tiers"&&((n==null?void 0:n.status)==="pending"||(n==null?void 0:n.status)===void 0),Ce=p&&ee&&!ie&&!we;return console.log("üîç Navbar render check:",{hasUser:!!n,role:n==null?void 0:n.role,status:n==null?void 0:n.status,isCreatorOrAdmin:p,isActive:ee,isThankYouPage:ie,isCalculatorAsPending:we,shouldShowProfile:Ce}),Ce})()?e.jsxs(e.Fragment,{children:[console.log("üé® Rendering creator profile for:",(n==null?void 0:n.display_name)||((N=n==null?void 0:n.user_metadata)==null?void 0:N.name)),console.log("üîç Full user object:",n),console.log("üîç User role:",n==null?void 0:n.role,"User status:",n==null?void 0:n.status),e.jsx("button",{className:"subscribe-btn",onClick:xe,children:"Start Free"}),e.jsx("button",{className:"user-profile-container",type:"button",onClick:p=>{console.log("üñ±Ô∏è Container clicked, current dropdown state:",_),p.stopPropagation();const ee=!_;console.log("üñ±Ô∏è Setting dropdown to:",ee),b(ee)},onTouchStart:p=>{console.log("üëÜ Container touched, current dropdown state:",_),p.preventDefault(),p.stopPropagation();const ee=!_;console.log("üëÜ Setting dropdown to:",ee),b(ee)},style:{background:"none",border:"none",padding:0,cursor:"pointer",touchAction:"manipulation",WebkitTapHighlightColor:"transparent",borderRadius:"50%",WebkitBorderRadius:"50%",overflow:"visible",outline:"none"},children:e.jsx("img",{className:"user-profile",src:(()=>{var ee,ie;const p=(n==null?void 0:n.profile_image_url)||(n==null?void 0:n.picture)||(m==null?void 0:m.profile_image_url)||((ee=n==null?void 0:n.user_metadata)==null?void 0:ee.picture)||"/default-avatar.svg";return console.log("üñºÔ∏è [NAVBAR] Resolving profile image URL:",{"user?.profile_image_url":n==null?void 0:n.profile_image_url,"user?.picture":n==null?void 0:n.picture,"userProfile?.profile_image_url":m==null?void 0:m.profile_image_url,"user?.user_metadata?.picture":(ie=n==null?void 0:n.user_metadata)==null?void 0:ie.picture,"final URL":p}),p})(),alt:((D=n==null?void 0:n.user_metadata)==null?void 0:D.name)||(n==null?void 0:n.display_name)||(n==null?void 0:n.name)||"User",onClick:p=>{console.log("üñ±Ô∏è Image clicked, current dropdown state:",_),p.stopPropagation();const ee=!_;console.log("üñ±Ô∏è Image: Setting dropdown to:",ee),b(ee)},onTouchStart:p=>{console.log("üëÜ Image touched, current dropdown state:",_),p.preventDefault(),p.stopPropagation();const ee=!_;console.log("üëÜ Image: Setting dropdown to:",ee),b(ee)},style:{cursor:"pointer",pointerEvents:"auto",userSelect:"none",WebkitUserSelect:"none",display:"block",borderRadius:"50%",WebkitBorderRadius:"50%",objectFit:"cover",WebkitAppearance:"none",width:"35px",height:"35px",backgroundColor:"transparent",zIndex:1,position:"relative"},onError:p=>{var ee,ie;if(!p.target.dataset.fallbackUsed){console.log("üñºÔ∏è [NAVBAR] Image failed to load!"),console.log("üñºÔ∏è [NAVBAR] Failed URL:",p.target.src),console.log("üñºÔ∏è [NAVBAR] User object:",n),console.log("üñºÔ∏è [NAVBAR] UserProfile object:",m);const we=((ee=n==null?void 0:n.youtube_channel)==null?void 0:ee.thumbnail)||(m==null?void 0:m.profile_image_url)||(n==null?void 0:n.profile_image_url)||(n==null?void 0:n.picture)||((ie=n==null?void 0:n.user_metadata)==null?void 0:ie.picture)||"/default-avatar.svg";p.target.src!==we&&we!=="/default-avatar.svg"?(console.log("üñºÔ∏è [NAVBAR] Trying fallback URL:",we),p.target.dataset.fallbackUsed="true",p.target.src=we):(console.log("üñºÔ∏è [NAVBAR] Using default avatar"),p.target.dataset.fallbackUsed="true",p.target.src="/default-avatar.svg")}},onLoad:p=>{if(console.log("üñºÔ∏è [NAVBAR] Profile image loaded successfully"),console.log("üñºÔ∏è [NAVBAR] Loaded image src:",p.target.src),console.log("üñºÔ∏è [NAVBAR] Image natural dimensions:",p.target.naturalWidth,"x",p.target.naturalHeight),p.target.style.display="block",p.target.style.visibility="visible",p.target.style.opacity="1",p.target.style.width="35px",p.target.style.height="35px",p.target.style.objectFit="cover",p.target.style.borderRadius="50%",p.target.style.position="relative",p.target.style.zIndex="10",p.target.parentElement){const ee=p.target.parentElement;Array.from(ee.childNodes).forEach(ie=>{(ie.nodeType===Node.TEXT_NODE||ie.nodeType===Node.ELEMENT_NODE&&ie.tagName!=="IMG"&&ie.tagName!=="DIV")&&ie.textContent&&ie.textContent.trim().length===1&&ie.remove()})}p.target.style.background="none",p.target.style.backgroundColor="transparent"}},`profile-img-${(n==null?void 0:n.id)||"unknown"}-${(m==null?void 0:m.profile_image_url)||(n==null?void 0:n.profile_image_url)||(n==null?void 0:n.picture)||"default"}`)}),console.log("üîΩ Dropdown state:",_,"Class:",`user-dropdown ${_?"open":""}`),e.jsxs("div",{className:`user-dropdown ${_?"open":""}`,children:[e.jsxs("p",{children:["Signed in as ",e.jsx("strong",{children:((w=n==null?void 0:n.user_metadata)==null?void 0:w.name)||(n==null?void 0:n.display_name)})]}),e.jsx("hr",{}),!E&&e.jsx("button",{className:"dropdown-item",onClick:p=>{p.preventDefault(),p.stopPropagation(),console.log("üîó Navigating to Dashboard"),b(!1),Y("/dashboard")},style:{background:"none",border:"none",width:"100%",textAlign:"left",padding:"8px 16px",cursor:"pointer"},children:"Dashboard"}),(E||V)&&e.jsx("button",{className:"dropdown-item",onClick:p=>{p.preventDefault(),p.stopPropagation(),console.log("üîó Navigating to Admin Portal"),b(!1),Y("/admin")},style:{background:"none",border:"none",width:"100%",textAlign:"left",padding:"8px 16px",cursor:"pointer"},children:"Admin Portal"}),!E&&e.jsx("button",{onClick:p=>{p.preventDefault(),p.stopPropagation(),b(!1),de()},className:"dropdown-item delete-account-btn",children:"Delete Account"}),e.jsx("button",{onClick:p=>{p.preventDefault(),p.stopPropagation(),b(!1),O()},style:{background:"none",border:"none",width:"100%",textAlign:"left",padding:"8px 16px",cursor:"pointer"},children:"Logout"})]})]}):x?e.jsx("div",{className:"sign-in-btn",style:{opacity:.5,cursor:"not-allowed"},children:"Processing..."}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"sign-in-btn",onClick:be,title:"Sign in",children:"Sign In"}),e.jsx("button",{className:"subscribe-btn",onClick:xe,children:"Start Free"})]})]})]})]}),e.jsx(oo,{isOpen:r,onClose:G}),e.jsx(Ra,{isOpen:i,onClose:W,onSignup:ae})]})};const fo=()=>e.jsx("footer",{className:"site-footer",children:e.jsx("div",{className:"footer-container",children:e.jsxs("div",{className:"footer-content",children:[e.jsx("div",{className:"footer-logo-section",children:e.jsx("img",{src:tr,alt:"ScreenMerch",className:"footer-logo"})}),e.jsxs("div",{className:"footer-links-section",children:[e.jsx(mt,{to:"/privacy-policy",children:"Privacy Policy"}),e.jsx(mt,{to:"/terms-of-service",children:"Terms of Service"}),e.jsx("a",{href:"mailto:support@screenmerch.com",children:"Contact Us"})]}),e.jsx("div",{className:"footer-copyright",children:e.jsx("p",{children:"¬© 2025 ScreenMerch. All rights reserved."})})]})})});//! moment.js
//! version : 2.30.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
var Ma;function ke(){return Ma.apply(null,arguments)}function yo(t){Ma=t}function Pt(t){return t instanceof Array||Object.prototype.toString.call(t)==="[object Array]"}function ts(t){return t!=null&&Object.prototype.toString.call(t)==="[object Object]"}function Ve(t,s){return Object.prototype.hasOwnProperty.call(t,s)}function Br(t){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(t).length===0;var s;for(s in t)if(Ve(t,s))return!1;return!0}function vt(t){return t===void 0}function Yt(t){return typeof t=="number"||Object.prototype.toString.call(t)==="[object Number]"}function Ps(t){return t instanceof Date||Object.prototype.toString.call(t)==="[object Date]"}function Da(t,s){var r=[],a,i=t.length;for(a=0;a<i;++a)r.push(s(t[a],a));return r}function Vt(t,s){for(var r in s)Ve(s,r)&&(t[r]=s[r]);return Ve(s,"toString")&&(t.toString=s.toString),Ve(s,"valueOf")&&(t.valueOf=s.valueOf),t}function Mt(t,s,r,a){return ii(t,s,r,a,!0).utc()}function xo(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function $e(t){return t._pf==null&&(t._pf=xo()),t._pf}var Er;Array.prototype.some?Er=Array.prototype.some:Er=function(t){var s=Object(this),r=s.length>>>0,a;for(a=0;a<r;a++)if(a in s&&t.call(this,s[a],a,s))return!0;return!1};function Fr(t){var s=null,r=!1,a=t._d&&!isNaN(t._d.getTime());if(a&&(s=$e(t),r=Er.call(s.parsedDateParts,function(i){return i!=null}),a=s.overflow<0&&!s.empty&&!s.invalidEra&&!s.invalidMonth&&!s.invalidWeekday&&!s.weekdayMismatch&&!s.nullInput&&!s.invalidFormat&&!s.userInvalidated&&(!s.meridiem||s.meridiem&&r),t._strict&&(a=a&&s.charsLeftOver===0&&s.unusedTokens.length===0&&s.bigHour===void 0)),Object.isFrozen==null||!Object.isFrozen(t))t._isValid=a;else return a;return t._isValid}function rr(t){var s=Mt(NaN);return t!=null?Vt($e(s),t):$e(s).userInvalidated=!0,s}var _a=ke.momentProperties=[],_r=!1;function $r(t,s){var r,a,i,o=_a.length;if(vt(s._isAMomentObject)||(t._isAMomentObject=s._isAMomentObject),vt(s._i)||(t._i=s._i),vt(s._f)||(t._f=s._f),vt(s._l)||(t._l=s._l),vt(s._strict)||(t._strict=s._strict),vt(s._tzm)||(t._tzm=s._tzm),vt(s._isUTC)||(t._isUTC=s._isUTC),vt(s._offset)||(t._offset=s._offset),vt(s._pf)||(t._pf=$e(s)),vt(s._locale)||(t._locale=s._locale),o>0)for(r=0;r<o;r++)a=_a[r],i=s[a],vt(i)||(t[a]=i);return t}function As(t){$r(this,t),this._d=new Date(t._d!=null?t._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),_r===!1&&(_r=!0,ke.updateOffset(this),_r=!1)}function At(t){return t instanceof As||t!=null&&t._isAMomentObject!=null}function La(t){ke.suppressDeprecationWarnings===!1&&typeof console<"u"&&console.warn&&console.warn("Deprecation warning: "+t)}function St(t,s){var r=!0;return Vt(function(){if(ke.deprecationHandler!=null&&ke.deprecationHandler(null,t),r){var a=[],i,o,n,u=arguments.length;for(o=0;o<u;o++){if(i="",typeof arguments[o]=="object"){i+=`
[`+o+"] ";for(n in arguments[0])Ve(arguments[0],n)&&(i+=n+": "+arguments[0][n]+", ");i=i.slice(0,-2)}else i=arguments[o];a.push(i)}La(t+`
Arguments: `+Array.prototype.slice.call(a).join("")+`
`+new Error().stack),r=!1}return s.apply(this,arguments)},s)}var ja={};function Oa(t,s){ke.deprecationHandler!=null&&ke.deprecationHandler(t,s),ja[t]||(La(s),ja[t]=!0)}ke.suppressDeprecationWarnings=!1;ke.deprecationHandler=null;function Dt(t){return typeof Function<"u"&&t instanceof Function||Object.prototype.toString.call(t)==="[object Function]"}function vo(t){var s,r;for(r in t)Ve(t,r)&&(s=t[r],Dt(s)?this[r]=s:this["_"+r]=s);this._config=t,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function Ir(t,s){var r=Vt({},t),a;for(a in s)Ve(s,a)&&(ts(t[a])&&ts(s[a])?(r[a]={},Vt(r[a],t[a]),Vt(r[a],s[a])):s[a]!=null?r[a]=s[a]:delete r[a]);for(a in t)Ve(t,a)&&!Ve(s,a)&&ts(t[a])&&(r[a]=Vt({},r[a]));return r}function zr(t){t!=null&&this.set(t)}var Tr;Object.keys?Tr=Object.keys:Tr=function(t){var s,r=[];for(s in t)Ve(t,s)&&r.push(s);return r};var bo={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function wo(t,s,r){var a=this._calendar[t]||this._calendar.sameElse;return Dt(a)?a.call(s,r):a}function Rt(t,s,r){var a=""+Math.abs(t),i=s-a.length,o=t>=0;return(o?r?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+a}var Wr=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Bs=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,jr={},ns={};function Re(t,s,r,a){var i=a;typeof a=="string"&&(i=function(){return this[a]()}),t&&(ns[t]=i),s&&(ns[s[0]]=function(){return Rt(i.apply(this,arguments),s[1],s[2])}),r&&(ns[r]=function(){return this.localeData().ordinal(i.apply(this,arguments),t)})}function _o(t){return t.match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function jo(t){var s=t.match(Wr),r,a;for(r=0,a=s.length;r<a;r++)ns[s[r]]?s[r]=ns[s[r]]:s[r]=_o(s[r]);return function(i){var o="",n;for(n=0;n<a;n++)o+=Dt(s[n])?s[n].call(i,t):s[n];return o}}function Ys(t,s){return t.isValid()?(s=Ba(s,t.localeData()),jr[s]=jr[s]||jo(s),jr[s](t)):t.localeData().invalidDate()}function Ba(t,s){var r=5;function a(i){return s.longDateFormat(i)||i}for(Bs.lastIndex=0;r>=0&&Bs.test(t);)t=t.replace(Bs,a),Bs.lastIndex=0,r-=1;return t}var So={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function No(t){var s=this._longDateFormat[t],r=this._longDateFormat[t.toUpperCase()];return s||!r?s:(this._longDateFormat[t]=r.match(Wr).map(function(a){return a==="MMMM"||a==="MM"||a==="DD"||a==="dddd"?a.slice(1):a}).join(""),this._longDateFormat[t])}var ko="Invalid date";function Co(){return this._invalidDate}var Po="%d",Ao=/\d{1,2}/;function Eo(t){return this._ordinal.replace("%d",t)}var Io={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function To(t,s,r,a){var i=this._relativeTime[r];return Dt(i)?i(t,s,r,a):i.replace(/%d/i,t)}function Uo(t,s){var r=this._relativeTime[t>0?"future":"past"];return Dt(r)?r(s):r.replace(/%s/i,s)}var Sa={D:"date",dates:"date",date:"date",d:"day",days:"day",day:"day",e:"weekday",weekdays:"weekday",weekday:"weekday",E:"isoWeekday",isoweekdays:"isoWeekday",isoweekday:"isoWeekday",DDD:"dayOfYear",dayofyears:"dayOfYear",dayofyear:"dayOfYear",h:"hour",hours:"hour",hour:"hour",ms:"millisecond",milliseconds:"millisecond",millisecond:"millisecond",m:"minute",minutes:"minute",minute:"minute",M:"month",months:"month",month:"month",Q:"quarter",quarters:"quarter",quarter:"quarter",s:"second",seconds:"second",second:"second",gg:"weekYear",weekyears:"weekYear",weekyear:"weekYear",GG:"isoWeekYear",isoweekyears:"isoWeekYear",isoweekyear:"isoWeekYear",w:"week",weeks:"week",week:"week",W:"isoWeek",isoweeks:"isoWeek",isoweek:"isoWeek",y:"year",years:"year",year:"year"};function Nt(t){return typeof t=="string"?Sa[t]||Sa[t.toLowerCase()]:void 0}function Yr(t){var s={},r,a;for(a in t)Ve(t,a)&&(r=Nt(a),r&&(s[r]=t[a]));return s}var Ro={date:9,day:11,weekday:11,isoWeekday:11,dayOfYear:4,hour:13,millisecond:16,minute:14,month:8,quarter:7,second:15,weekYear:1,isoWeekYear:1,week:5,isoWeek:5,year:1};function Mo(t){var s=[],r;for(r in t)Ve(t,r)&&s.push({unit:r,priority:Ro[r]});return s.sort(function(a,i){return a.priority-i.priority}),s}var Fa=/\d/,bt=/\d\d/,$a=/\d{3}/,Hr=/\d{4}/,ar=/[+-]?\d{6}/,at=/\d\d?/,za=/\d\d\d\d?/,Wa=/\d\d\d\d\d\d?/,ir=/\d{1,3}/,Xr=/\d{1,4}/,or=/[+-]?\d{1,6}/,ms=/\d+/,nr=/[+-]?\d+/,Do=/Z|[+-]\d\d:?\d\d/gi,lr=/Z|[+-]\d\d(?::?\d\d)?/gi,Lo=/[+-]?\d+(\.\d{1,3})?/,Es=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,ps=/^[1-9]\d?/,Gr=/^([1-9]\d|\d)/,Gs;Gs={};function Pe(t,s,r){Gs[t]=Dt(s)?s:function(a,i){return a&&r?r:s}}function Oo(t,s){return Ve(Gs,t)?Gs[t](s._strict,s._locale):new RegExp(Bo(t))}function Bo(t){return zt(t.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(s,r,a,i,o){return r||a||i||o}))}function zt(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function jt(t){return t<0?Math.ceil(t)||0:Math.floor(t)}function Xe(t){var s=+t,r=0;return s!==0&&isFinite(s)&&(r=jt(s)),r}var Ur={};function tt(t,s){var r,a=s,i;for(typeof t=="string"&&(t=[t]),Yt(s)&&(a=function(o,n){n[s]=Xe(o)}),i=t.length,r=0;r<i;r++)Ur[t[r]]=a}function Is(t,s){tt(t,function(r,a,i,o){i._w=i._w||{},s(r,i._w,i,o)})}function Fo(t,s,r){s!=null&&Ve(Ur,t)&&Ur[t](s,r._a,r,t)}function cr(t){return t%4===0&&t%100!==0||t%400===0}var gt=0,Ft=1,Ut=2,ht=3,Ct=4,$t=5,es=6,$o=7,zo=8;Re("Y",0,0,function(){var t=this.year();return t<=9999?Rt(t,4):"+"+t});Re(0,["YY",2],0,function(){return this.year()%100});Re(0,["YYYY",4],0,"year");Re(0,["YYYYY",5],0,"year");Re(0,["YYYYYY",6,!0],0,"year");Pe("Y",nr);Pe("YY",at,bt);Pe("YYYY",Xr,Hr);Pe("YYYYY",or,ar);Pe("YYYYYY",or,ar);tt(["YYYYY","YYYYYY"],gt);tt("YYYY",function(t,s){s[gt]=t.length===2?ke.parseTwoDigitYear(t):Xe(t)});tt("YY",function(t,s){s[gt]=ke.parseTwoDigitYear(t)});tt("Y",function(t,s){s[gt]=parseInt(t,10)});function ws(t){return cr(t)?366:365}ke.parseTwoDigitYear=function(t){return Xe(t)+(Xe(t)>68?1900:2e3)};var Ya=gs("FullYear",!0);function Wo(){return cr(this.year())}function gs(t,s){return function(r){return r!=null?(Ha(this,t,r),ke.updateOffset(this,s),this):js(this,t)}}function js(t,s){if(!t.isValid())return NaN;var r=t._d,a=t._isUTC;switch(s){case"Milliseconds":return a?r.getUTCMilliseconds():r.getMilliseconds();case"Seconds":return a?r.getUTCSeconds():r.getSeconds();case"Minutes":return a?r.getUTCMinutes():r.getMinutes();case"Hours":return a?r.getUTCHours():r.getHours();case"Date":return a?r.getUTCDate():r.getDate();case"Day":return a?r.getUTCDay():r.getDay();case"Month":return a?r.getUTCMonth():r.getMonth();case"FullYear":return a?r.getUTCFullYear():r.getFullYear();default:return NaN}}function Ha(t,s,r){var a,i,o,n,u;if(!(!t.isValid()||isNaN(r))){switch(a=t._d,i=t._isUTC,s){case"Milliseconds":return void(i?a.setUTCMilliseconds(r):a.setMilliseconds(r));case"Seconds":return void(i?a.setUTCSeconds(r):a.setSeconds(r));case"Minutes":return void(i?a.setUTCMinutes(r):a.setMinutes(r));case"Hours":return void(i?a.setUTCHours(r):a.setHours(r));case"Date":return void(i?a.setUTCDate(r):a.setDate(r));case"FullYear":break;default:return}o=r,n=t.month(),u=t.date(),u=u===29&&n===1&&!cr(o)?28:u,i?a.setUTCFullYear(o,n,u):a.setFullYear(o,n,u)}}function Yo(t){return t=Nt(t),Dt(this[t])?this[t]():this}function Ho(t,s){if(typeof t=="object"){t=Yr(t);var r=Mo(t),a,i=r.length;for(a=0;a<i;a++)this[r[a].unit](t[r[a].unit])}else if(t=Nt(t),Dt(this[t]))return this[t](s);return this}function Xo(t,s){return(t%s+s)%s}var ut;Array.prototype.indexOf?ut=Array.prototype.indexOf:ut=function(t){var s;for(s=0;s<this.length;++s)if(this[s]===t)return s;return-1};function Vr(t,s){if(isNaN(t)||isNaN(s))return NaN;var r=Xo(s,12);return t+=(s-r)/12,r===1?cr(t)?29:28:31-r%7%2}Re("M",["MM",2],"Mo",function(){return this.month()+1});Re("MMM",0,0,function(t){return this.localeData().monthsShort(this,t)});Re("MMMM",0,0,function(t){return this.localeData().months(this,t)});Pe("M",at,ps);Pe("MM",at,bt);Pe("MMM",function(t,s){return s.monthsShortRegex(t)});Pe("MMMM",function(t,s){return s.monthsRegex(t)});tt(["M","MM"],function(t,s){s[Ft]=Xe(t)-1});tt(["MMM","MMMM"],function(t,s,r,a){var i=r._locale.monthsParse(t,a,r._strict);i!=null?s[Ft]=i:$e(r).invalidMonth=t});var Go="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Xa="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Ga=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Vo=Es,qo=Es;function Jo(t,s){return t?Pt(this._months)?this._months[t.month()]:this._months[(this._months.isFormat||Ga).test(s)?"format":"standalone"][t.month()]:Pt(this._months)?this._months:this._months.standalone}function Ko(t,s){return t?Pt(this._monthsShort)?this._monthsShort[t.month()]:this._monthsShort[Ga.test(s)?"format":"standalone"][t.month()]:Pt(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function Zo(t,s,r){var a,i,o,n=t.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],a=0;a<12;++a)o=Mt([2e3,a]),this._shortMonthsParse[a]=this.monthsShort(o,"").toLocaleLowerCase(),this._longMonthsParse[a]=this.months(o,"").toLocaleLowerCase();return r?s==="MMM"?(i=ut.call(this._shortMonthsParse,n),i!==-1?i:null):(i=ut.call(this._longMonthsParse,n),i!==-1?i:null):s==="MMM"?(i=ut.call(this._shortMonthsParse,n),i!==-1?i:(i=ut.call(this._longMonthsParse,n),i!==-1?i:null)):(i=ut.call(this._longMonthsParse,n),i!==-1?i:(i=ut.call(this._shortMonthsParse,n),i!==-1?i:null))}function Qo(t,s,r){var a,i,o;if(this._monthsParseExact)return Zo.call(this,t,s,r);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),a=0;a<12;a++){if(i=Mt([2e3,a]),r&&!this._longMonthsParse[a]&&(this._longMonthsParse[a]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[a]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),!r&&!this._monthsParse[a]&&(o="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[a]=new RegExp(o.replace(".",""),"i")),r&&s==="MMMM"&&this._longMonthsParse[a].test(t))return a;if(r&&s==="MMM"&&this._shortMonthsParse[a].test(t))return a;if(!r&&this._monthsParse[a].test(t))return a}}function Va(t,s){if(!t.isValid())return t;if(typeof s=="string"){if(/^\d+$/.test(s))s=Xe(s);else if(s=t.localeData().monthsParse(s),!Yt(s))return t}var r=s,a=t.date();return a=a<29?a:Math.min(a,Vr(t.year(),r)),t._isUTC?t._d.setUTCMonth(r,a):t._d.setMonth(r,a),t}function qa(t){return t!=null?(Va(this,t),ke.updateOffset(this,!0),this):js(this,"Month")}function en(){return Vr(this.year(),this.month())}function tn(t){return this._monthsParseExact?(Ve(this,"_monthsRegex")||Ja.call(this),t?this._monthsShortStrictRegex:this._monthsShortRegex):(Ve(this,"_monthsShortRegex")||(this._monthsShortRegex=Vo),this._monthsShortStrictRegex&&t?this._monthsShortStrictRegex:this._monthsShortRegex)}function sn(t){return this._monthsParseExact?(Ve(this,"_monthsRegex")||Ja.call(this),t?this._monthsStrictRegex:this._monthsRegex):(Ve(this,"_monthsRegex")||(this._monthsRegex=qo),this._monthsStrictRegex&&t?this._monthsStrictRegex:this._monthsRegex)}function Ja(){function t(m,f){return f.length-m.length}var s=[],r=[],a=[],i,o,n,u;for(i=0;i<12;i++)o=Mt([2e3,i]),n=zt(this.monthsShort(o,"")),u=zt(this.months(o,"")),s.push(n),r.push(u),a.push(u),a.push(n);s.sort(t),r.sort(t),a.sort(t),this._monthsRegex=new RegExp("^("+a.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+s.join("|")+")","i")}function rn(t,s,r,a,i,o,n){var u;return t<100&&t>=0?(u=new Date(t+400,s,r,a,i,o,n),isFinite(u.getFullYear())&&u.setFullYear(t)):u=new Date(t,s,r,a,i,o,n),u}function Ss(t){var s,r;return t<100&&t>=0?(r=Array.prototype.slice.call(arguments),r[0]=t+400,s=new Date(Date.UTC.apply(null,r)),isFinite(s.getUTCFullYear())&&s.setUTCFullYear(t)):s=new Date(Date.UTC.apply(null,arguments)),s}function Vs(t,s,r){var a=7+s-r,i=(7+Ss(t,0,a).getUTCDay()-s)%7;return-i+a-1}function Ka(t,s,r,a,i){var o=(7+r-a)%7,n=Vs(t,a,i),u=1+7*(s-1)+o+n,m,f;return u<=0?(m=t-1,f=ws(m)+u):u>ws(t)?(m=t+1,f=u-ws(t)):(m=t,f=u),{year:m,dayOfYear:f}}function Ns(t,s,r){var a=Vs(t.year(),s,r),i=Math.floor((t.dayOfYear()-a-1)/7)+1,o,n;return i<1?(n=t.year()-1,o=i+Wt(n,s,r)):i>Wt(t.year(),s,r)?(o=i-Wt(t.year(),s,r),n=t.year()+1):(n=t.year(),o=i),{week:o,year:n}}function Wt(t,s,r){var a=Vs(t,s,r),i=Vs(t+1,s,r);return(ws(t)-a+i)/7}Re("w",["ww",2],"wo","week");Re("W",["WW",2],"Wo","isoWeek");Pe("w",at,ps);Pe("ww",at,bt);Pe("W",at,ps);Pe("WW",at,bt);Is(["w","ww","W","WW"],function(t,s,r,a){s[a.substr(0,1)]=Xe(t)});function an(t){return Ns(t,this._week.dow,this._week.doy).week}var on={dow:0,doy:6};function nn(){return this._week.dow}function ln(){return this._week.doy}function cn(t){var s=this.localeData().week(this);return t==null?s:this.add((t-s)*7,"d")}function dn(t){var s=Ns(this,1,4).week;return t==null?s:this.add((t-s)*7,"d")}Re("d",0,"do","day");Re("dd",0,0,function(t){return this.localeData().weekdaysMin(this,t)});Re("ddd",0,0,function(t){return this.localeData().weekdaysShort(this,t)});Re("dddd",0,0,function(t){return this.localeData().weekdays(this,t)});Re("e",0,0,"weekday");Re("E",0,0,"isoWeekday");Pe("d",at);Pe("e",at);Pe("E",at);Pe("dd",function(t,s){return s.weekdaysMinRegex(t)});Pe("ddd",function(t,s){return s.weekdaysShortRegex(t)});Pe("dddd",function(t,s){return s.weekdaysRegex(t)});Is(["dd","ddd","dddd"],function(t,s,r,a){var i=r._locale.weekdaysParse(t,a,r._strict);i!=null?s.d=i:$e(r).invalidWeekday=t});Is(["d","e","E"],function(t,s,r,a){s[a]=Xe(t)});function un(t,s){return typeof t!="string"?t:isNaN(t)?(t=s.weekdaysParse(t),typeof t=="number"?t:null):parseInt(t,10)}function hn(t,s){return typeof t=="string"?s.weekdaysParse(t)%7||7:isNaN(t)?null:t}function qr(t,s){return t.slice(s,7).concat(t.slice(0,s))}var mn="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Za="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),pn="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),gn=Es,fn=Es,yn=Es;function xn(t,s){var r=Pt(this._weekdays)?this._weekdays:this._weekdays[t&&t!==!0&&this._weekdays.isFormat.test(s)?"format":"standalone"];return t===!0?qr(r,this._week.dow):t?r[t.day()]:r}function vn(t){return t===!0?qr(this._weekdaysShort,this._week.dow):t?this._weekdaysShort[t.day()]:this._weekdaysShort}function bn(t){return t===!0?qr(this._weekdaysMin,this._week.dow):t?this._weekdaysMin[t.day()]:this._weekdaysMin}function wn(t,s,r){var a,i,o,n=t.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],a=0;a<7;++a)o=Mt([2e3,1]).day(a),this._minWeekdaysParse[a]=this.weekdaysMin(o,"").toLocaleLowerCase(),this._shortWeekdaysParse[a]=this.weekdaysShort(o,"").toLocaleLowerCase(),this._weekdaysParse[a]=this.weekdays(o,"").toLocaleLowerCase();return r?s==="dddd"?(i=ut.call(this._weekdaysParse,n),i!==-1?i:null):s==="ddd"?(i=ut.call(this._shortWeekdaysParse,n),i!==-1?i:null):(i=ut.call(this._minWeekdaysParse,n),i!==-1?i:null):s==="dddd"?(i=ut.call(this._weekdaysParse,n),i!==-1||(i=ut.call(this._shortWeekdaysParse,n),i!==-1)?i:(i=ut.call(this._minWeekdaysParse,n),i!==-1?i:null)):s==="ddd"?(i=ut.call(this._shortWeekdaysParse,n),i!==-1||(i=ut.call(this._weekdaysParse,n),i!==-1)?i:(i=ut.call(this._minWeekdaysParse,n),i!==-1?i:null)):(i=ut.call(this._minWeekdaysParse,n),i!==-1||(i=ut.call(this._weekdaysParse,n),i!==-1)?i:(i=ut.call(this._shortWeekdaysParse,n),i!==-1?i:null))}function _n(t,s,r){var a,i,o;if(this._weekdaysParseExact)return wn.call(this,t,s,r);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),a=0;a<7;a++){if(i=Mt([2e3,1]).day(a),r&&!this._fullWeekdaysParse[a]&&(this._fullWeekdaysParse[a]=new RegExp("^"+this.weekdays(i,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[a]=new RegExp("^"+this.weekdaysShort(i,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[a]=new RegExp("^"+this.weekdaysMin(i,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[a]||(o="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[a]=new RegExp(o.replace(".",""),"i")),r&&s==="dddd"&&this._fullWeekdaysParse[a].test(t))return a;if(r&&s==="ddd"&&this._shortWeekdaysParse[a].test(t))return a;if(r&&s==="dd"&&this._minWeekdaysParse[a].test(t))return a;if(!r&&this._weekdaysParse[a].test(t))return a}}function jn(t){if(!this.isValid())return t!=null?this:NaN;var s=js(this,"Day");return t!=null?(t=un(t,this.localeData()),this.add(t-s,"d")):s}function Sn(t){if(!this.isValid())return t!=null?this:NaN;var s=(this.day()+7-this.localeData()._week.dow)%7;return t==null?s:this.add(t-s,"d")}function Nn(t){if(!this.isValid())return t!=null?this:NaN;if(t!=null){var s=hn(t,this.localeData());return this.day(this.day()%7?s:s-7)}else return this.day()||7}function kn(t){return this._weekdaysParseExact?(Ve(this,"_weekdaysRegex")||Jr.call(this),t?this._weekdaysStrictRegex:this._weekdaysRegex):(Ve(this,"_weekdaysRegex")||(this._weekdaysRegex=gn),this._weekdaysStrictRegex&&t?this._weekdaysStrictRegex:this._weekdaysRegex)}function Cn(t){return this._weekdaysParseExact?(Ve(this,"_weekdaysRegex")||Jr.call(this),t?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(Ve(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=fn),this._weekdaysShortStrictRegex&&t?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function Pn(t){return this._weekdaysParseExact?(Ve(this,"_weekdaysRegex")||Jr.call(this),t?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(Ve(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=yn),this._weekdaysMinStrictRegex&&t?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function Jr(){function t(k,M){return M.length-k.length}var s=[],r=[],a=[],i=[],o,n,u,m,f;for(o=0;o<7;o++)n=Mt([2e3,1]).day(o),u=zt(this.weekdaysMin(n,"")),m=zt(this.weekdaysShort(n,"")),f=zt(this.weekdays(n,"")),s.push(u),r.push(m),a.push(f),i.push(u),i.push(m),i.push(f);s.sort(t),r.sort(t),a.sort(t),i.sort(t),this._weekdaysRegex=new RegExp("^("+i.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+a.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+s.join("|")+")","i")}function Kr(){return this.hours()%12||12}function An(){return this.hours()||24}Re("H",["HH",2],0,"hour");Re("h",["hh",2],0,Kr);Re("k",["kk",2],0,An);Re("hmm",0,0,function(){return""+Kr.apply(this)+Rt(this.minutes(),2)});Re("hmmss",0,0,function(){return""+Kr.apply(this)+Rt(this.minutes(),2)+Rt(this.seconds(),2)});Re("Hmm",0,0,function(){return""+this.hours()+Rt(this.minutes(),2)});Re("Hmmss",0,0,function(){return""+this.hours()+Rt(this.minutes(),2)+Rt(this.seconds(),2)});function Qa(t,s){Re(t,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),s)})}Qa("a",!0);Qa("A",!1);function ei(t,s){return s._meridiemParse}Pe("a",ei);Pe("A",ei);Pe("H",at,Gr);Pe("h",at,ps);Pe("k",at,ps);Pe("HH",at,bt);Pe("hh",at,bt);Pe("kk",at,bt);Pe("hmm",za);Pe("hmmss",Wa);Pe("Hmm",za);Pe("Hmmss",Wa);tt(["H","HH"],ht);tt(["k","kk"],function(t,s,r){var a=Xe(t);s[ht]=a===24?0:a});tt(["a","A"],function(t,s,r){r._isPm=r._locale.isPM(t),r._meridiem=t});tt(["h","hh"],function(t,s,r){s[ht]=Xe(t),$e(r).bigHour=!0});tt("hmm",function(t,s,r){var a=t.length-2;s[ht]=Xe(t.substr(0,a)),s[Ct]=Xe(t.substr(a)),$e(r).bigHour=!0});tt("hmmss",function(t,s,r){var a=t.length-4,i=t.length-2;s[ht]=Xe(t.substr(0,a)),s[Ct]=Xe(t.substr(a,2)),s[$t]=Xe(t.substr(i)),$e(r).bigHour=!0});tt("Hmm",function(t,s,r){var a=t.length-2;s[ht]=Xe(t.substr(0,a)),s[Ct]=Xe(t.substr(a))});tt("Hmmss",function(t,s,r){var a=t.length-4,i=t.length-2;s[ht]=Xe(t.substr(0,a)),s[Ct]=Xe(t.substr(a,2)),s[$t]=Xe(t.substr(i))});function En(t){return(t+"").toLowerCase().charAt(0)==="p"}var In=/[ap]\.?m?\.?/i,Tn=gs("Hours",!0);function Un(t,s,r){return t>11?r?"pm":"PM":r?"am":"AM"}var ti={calendar:bo,longDateFormat:So,invalidDate:ko,ordinal:Po,dayOfMonthOrdinalParse:Ao,relativeTime:Io,months:Go,monthsShort:Xa,week:on,weekdays:mn,weekdaysMin:pn,weekdaysShort:Za,meridiemParse:In},ot={},vs={},ks;function Rn(t,s){var r,a=Math.min(t.length,s.length);for(r=0;r<a;r+=1)if(t[r]!==s[r])return r;return a}function Na(t){return t&&t.toLowerCase().replace("_","-")}function Mn(t){for(var s=0,r,a,i,o;s<t.length;){for(o=Na(t[s]).split("-"),r=o.length,a=Na(t[s+1]),a=a?a.split("-"):null;r>0;){if(i=dr(o.slice(0,r).join("-")),i)return i;if(a&&a.length>=r&&Rn(o,a)>=r-1)break;r--}s++}return ks}function Dn(t){return!!(t&&t.match("^[^/\\\\]*$"))}function dr(t){var s=null,r;if(ot[t]===void 0&&typeof module<"u"&&module&&module.exports&&Dn(t))try{s=ks._abbr,r=require,r("./locale/"+t),Kt(s)}catch{ot[t]=null}return ot[t]}function Kt(t,s){var r;return t&&(vt(s)?r=Ht(t):r=Zr(t,s),r?ks=r:typeof console<"u"&&console.warn&&console.warn("Locale "+t+" not found. Did you forget to load it?")),ks._abbr}function Zr(t,s){if(s!==null){var r,a=ti;if(s.abbr=t,ot[t]!=null)Oa("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),a=ot[t]._config;else if(s.parentLocale!=null)if(ot[s.parentLocale]!=null)a=ot[s.parentLocale]._config;else if(r=dr(s.parentLocale),r!=null)a=r._config;else return vs[s.parentLocale]||(vs[s.parentLocale]=[]),vs[s.parentLocale].push({name:t,config:s}),null;return ot[t]=new zr(Ir(a,s)),vs[t]&&vs[t].forEach(function(i){Zr(i.name,i.config)}),Kt(t),ot[t]}else return delete ot[t],null}function Ln(t,s){if(s!=null){var r,a,i=ti;ot[t]!=null&&ot[t].parentLocale!=null?ot[t].set(Ir(ot[t]._config,s)):(a=dr(t),a!=null&&(i=a._config),s=Ir(i,s),a==null&&(s.abbr=t),r=new zr(s),r.parentLocale=ot[t],ot[t]=r),Kt(t)}else ot[t]!=null&&(ot[t].parentLocale!=null?(ot[t]=ot[t].parentLocale,t===Kt()&&Kt(t)):ot[t]!=null&&delete ot[t]);return ot[t]}function Ht(t){var s;if(t&&t._locale&&t._locale._abbr&&(t=t._locale._abbr),!t)return ks;if(!Pt(t)){if(s=dr(t),s)return s;t=[t]}return Mn(t)}function On(){return Tr(ot)}function Qr(t){var s,r=t._a;return r&&$e(t).overflow===-2&&(s=r[Ft]<0||r[Ft]>11?Ft:r[Ut]<1||r[Ut]>Vr(r[gt],r[Ft])?Ut:r[ht]<0||r[ht]>24||r[ht]===24&&(r[Ct]!==0||r[$t]!==0||r[es]!==0)?ht:r[Ct]<0||r[Ct]>59?Ct:r[$t]<0||r[$t]>59?$t:r[es]<0||r[es]>999?es:-1,$e(t)._overflowDayOfYear&&(s<gt||s>Ut)&&(s=Ut),$e(t)._overflowWeeks&&s===-1&&(s=$o),$e(t)._overflowWeekday&&s===-1&&(s=zo),$e(t).overflow=s),t}var Bn=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Fn=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,$n=/Z|[+-]\d\d(?::?\d\d)?/,Fs=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],Sr=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],zn=/^\/?Date\((-?\d+)/i,Wn=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Yn={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function si(t){var s,r,a=t._i,i=Bn.exec(a)||Fn.exec(a),o,n,u,m,f=Fs.length,k=Sr.length;if(i){for($e(t).iso=!0,s=0,r=f;s<r;s++)if(Fs[s][1].exec(i[1])){n=Fs[s][0],o=Fs[s][2]!==!1;break}if(n==null){t._isValid=!1;return}if(i[3]){for(s=0,r=k;s<r;s++)if(Sr[s][1].exec(i[3])){u=(i[2]||" ")+Sr[s][0];break}if(u==null){t._isValid=!1;return}}if(!o&&u!=null){t._isValid=!1;return}if(i[4])if($n.exec(i[4]))m="Z";else{t._isValid=!1;return}t._f=n+(u||"")+(m||""),ta(t)}else t._isValid=!1}function Hn(t,s,r,a,i,o){var n=[Xn(t),Xa.indexOf(s),parseInt(r,10),parseInt(a,10),parseInt(i,10)];return o&&n.push(parseInt(o,10)),n}function Xn(t){var s=parseInt(t,10);return s<=49?2e3+s:s<=999?1900+s:s}function Gn(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function Vn(t,s,r){if(t){var a=Za.indexOf(t),i=new Date(s[0],s[1],s[2]).getDay();if(a!==i)return $e(r).weekdayMismatch=!0,r._isValid=!1,!1}return!0}function qn(t,s,r){if(t)return Yn[t];if(s)return 0;var a=parseInt(r,10),i=a%100,o=(a-i)/100;return o*60+i}function ri(t){var s=Wn.exec(Gn(t._i)),r;if(s){if(r=Hn(s[4],s[3],s[2],s[5],s[6],s[7]),!Vn(s[1],r,t))return;t._a=r,t._tzm=qn(s[8],s[9],s[10]),t._d=Ss.apply(null,t._a),t._d.setUTCMinutes(t._d.getUTCMinutes()-t._tzm),$e(t).rfc2822=!0}else t._isValid=!1}function Jn(t){var s=zn.exec(t._i);if(s!==null){t._d=new Date(+s[1]);return}if(si(t),t._isValid===!1)delete t._isValid;else return;if(ri(t),t._isValid===!1)delete t._isValid;else return;t._strict?t._isValid=!1:ke.createFromInputFallback(t)}ke.createFromInputFallback=St("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(t){t._d=new Date(t._i+(t._useUTC?" UTC":""))});function is(t,s,r){return t??s??r}function Kn(t){var s=new Date(ke.now());return t._useUTC?[s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()]:[s.getFullYear(),s.getMonth(),s.getDate()]}function ea(t){var s,r,a=[],i,o,n;if(!t._d){for(i=Kn(t),t._w&&t._a[Ut]==null&&t._a[Ft]==null&&Zn(t),t._dayOfYear!=null&&(n=is(t._a[gt],i[gt]),(t._dayOfYear>ws(n)||t._dayOfYear===0)&&($e(t)._overflowDayOfYear=!0),r=Ss(n,0,t._dayOfYear),t._a[Ft]=r.getUTCMonth(),t._a[Ut]=r.getUTCDate()),s=0;s<3&&t._a[s]==null;++s)t._a[s]=a[s]=i[s];for(;s<7;s++)t._a[s]=a[s]=t._a[s]==null?s===2?1:0:t._a[s];t._a[ht]===24&&t._a[Ct]===0&&t._a[$t]===0&&t._a[es]===0&&(t._nextDay=!0,t._a[ht]=0),t._d=(t._useUTC?Ss:rn).apply(null,a),o=t._useUTC?t._d.getUTCDay():t._d.getDay(),t._tzm!=null&&t._d.setUTCMinutes(t._d.getUTCMinutes()-t._tzm),t._nextDay&&(t._a[ht]=24),t._w&&typeof t._w.d<"u"&&t._w.d!==o&&($e(t).weekdayMismatch=!0)}}function Zn(t){var s,r,a,i,o,n,u,m,f;s=t._w,s.GG!=null||s.W!=null||s.E!=null?(o=1,n=4,r=is(s.GG,t._a[gt],Ns(rt(),1,4).year),a=is(s.W,1),i=is(s.E,1),(i<1||i>7)&&(m=!0)):(o=t._locale._week.dow,n=t._locale._week.doy,f=Ns(rt(),o,n),r=is(s.gg,t._a[gt],f.year),a=is(s.w,f.week),s.d!=null?(i=s.d,(i<0||i>6)&&(m=!0)):s.e!=null?(i=s.e+o,(s.e<0||s.e>6)&&(m=!0)):i=o),a<1||a>Wt(r,o,n)?$e(t)._overflowWeeks=!0:m!=null?$e(t)._overflowWeekday=!0:(u=Ka(r,a,i,o,n),t._a[gt]=u.year,t._dayOfYear=u.dayOfYear)}ke.ISO_8601=function(){};ke.RFC_2822=function(){};function ta(t){if(t._f===ke.ISO_8601){si(t);return}if(t._f===ke.RFC_2822){ri(t);return}t._a=[],$e(t).empty=!0;var s=""+t._i,r,a,i,o,n,u=s.length,m=0,f,k;for(i=Ba(t._f,t._locale).match(Wr)||[],k=i.length,r=0;r<k;r++)o=i[r],a=(s.match(Oo(o,t))||[])[0],a&&(n=s.substr(0,s.indexOf(a)),n.length>0&&$e(t).unusedInput.push(n),s=s.slice(s.indexOf(a)+a.length),m+=a.length),ns[o]?(a?$e(t).empty=!1:$e(t).unusedTokens.push(o),Fo(o,a,t)):t._strict&&!a&&$e(t).unusedTokens.push(o);$e(t).charsLeftOver=u-m,s.length>0&&$e(t).unusedInput.push(s),t._a[ht]<=12&&$e(t).bigHour===!0&&t._a[ht]>0&&($e(t).bigHour=void 0),$e(t).parsedDateParts=t._a.slice(0),$e(t).meridiem=t._meridiem,t._a[ht]=Qn(t._locale,t._a[ht],t._meridiem),f=$e(t).era,f!==null&&(t._a[gt]=t._locale.erasConvertYear(f,t._a[gt])),ea(t),Qr(t)}function Qn(t,s,r){var a;return r==null?s:t.meridiemHour!=null?t.meridiemHour(s,r):(t.isPM!=null&&(a=t.isPM(r),a&&s<12&&(s+=12),!a&&s===12&&(s=0)),s)}function el(t){var s,r,a,i,o,n,u=!1,m=t._f.length;if(m===0){$e(t).invalidFormat=!0,t._d=new Date(NaN);return}for(i=0;i<m;i++)o=0,n=!1,s=$r({},t),t._useUTC!=null&&(s._useUTC=t._useUTC),s._f=t._f[i],ta(s),Fr(s)&&(n=!0),o+=$e(s).charsLeftOver,o+=$e(s).unusedTokens.length*10,$e(s).score=o,u?o<a&&(a=o,r=s):(a==null||o<a||n)&&(a=o,r=s,n&&(u=!0));Vt(t,r||s)}function tl(t){if(!t._d){var s=Yr(t._i),r=s.day===void 0?s.date:s.day;t._a=Da([s.year,s.month,r,s.hour,s.minute,s.second,s.millisecond],function(a){return a&&parseInt(a,10)}),ea(t)}}function sl(t){var s=new As(Qr(ai(t)));return s._nextDay&&(s.add(1,"d"),s._nextDay=void 0),s}function ai(t){var s=t._i,r=t._f;return t._locale=t._locale||Ht(t._l),s===null||r===void 0&&s===""?rr({nullInput:!0}):(typeof s=="string"&&(t._i=s=t._locale.preparse(s)),At(s)?new As(Qr(s)):(Ps(s)?t._d=s:Pt(r)?el(t):r?ta(t):rl(t),Fr(t)||(t._d=null),t))}function rl(t){var s=t._i;vt(s)?t._d=new Date(ke.now()):Ps(s)?t._d=new Date(s.valueOf()):typeof s=="string"?Jn(t):Pt(s)?(t._a=Da(s.slice(0),function(r){return parseInt(r,10)}),ea(t)):ts(s)?tl(t):Yt(s)?t._d=new Date(s):ke.createFromInputFallback(t)}function ii(t,s,r,a,i){var o={};return(s===!0||s===!1)&&(a=s,s=void 0),(r===!0||r===!1)&&(a=r,r=void 0),(ts(t)&&Br(t)||Pt(t)&&t.length===0)&&(t=void 0),o._isAMomentObject=!0,o._useUTC=o._isUTC=i,o._l=r,o._i=t,o._f=s,o._strict=a,sl(o)}function rt(t,s,r,a){return ii(t,s,r,a,!1)}var al=St("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var t=rt.apply(null,arguments);return this.isValid()&&t.isValid()?t<this?this:t:rr()}),il=St("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var t=rt.apply(null,arguments);return this.isValid()&&t.isValid()?t>this?this:t:rr()});function oi(t,s){var r,a;if(s.length===1&&Pt(s[0])&&(s=s[0]),!s.length)return rt();for(r=s[0],a=1;a<s.length;++a)(!s[a].isValid()||s[a][t](r))&&(r=s[a]);return r}function ol(){var t=[].slice.call(arguments,0);return oi("isBefore",t)}function nl(){var t=[].slice.call(arguments,0);return oi("isAfter",t)}var ll=function(){return Date.now?Date.now():+new Date},bs=["year","quarter","month","week","day","hour","minute","second","millisecond"];function cl(t){var s,r=!1,a,i=bs.length;for(s in t)if(Ve(t,s)&&!(ut.call(bs,s)!==-1&&(t[s]==null||!isNaN(t[s]))))return!1;for(a=0;a<i;++a)if(t[bs[a]]){if(r)return!1;parseFloat(t[bs[a]])!==Xe(t[bs[a]])&&(r=!0)}return!0}function dl(){return this._isValid}function ul(){return It(NaN)}function ur(t){var s=Yr(t),r=s.year||0,a=s.quarter||0,i=s.month||0,o=s.week||s.isoWeek||0,n=s.day||0,u=s.hour||0,m=s.minute||0,f=s.second||0,k=s.millisecond||0;this._isValid=cl(s),this._milliseconds=+k+f*1e3+m*6e4+u*1e3*60*60,this._days=+n+o*7,this._months=+i+a*3+r*12,this._data={},this._locale=Ht(),this._bubble()}function Hs(t){return t instanceof ur}function Rr(t){return t<0?Math.round(-1*t)*-1:Math.round(t)}function hl(t,s,r){var a=Math.min(t.length,s.length),i=Math.abs(t.length-s.length),o=0,n;for(n=0;n<a;n++)(r&&t[n]!==s[n]||!r&&Xe(t[n])!==Xe(s[n]))&&o++;return o+i}function ni(t,s){Re(t,0,0,function(){var r=this.utcOffset(),a="+";return r<0&&(r=-r,a="-"),a+Rt(~~(r/60),2)+s+Rt(~~r%60,2)})}ni("Z",":");ni("ZZ","");Pe("Z",lr);Pe("ZZ",lr);tt(["Z","ZZ"],function(t,s,r){r._useUTC=!0,r._tzm=sa(lr,t)});var ml=/([\+\-]|\d\d)/gi;function sa(t,s){var r=(s||"").match(t),a,i,o;return r===null?null:(a=r[r.length-1]||[],i=(a+"").match(ml)||["-",0,0],o=+(i[1]*60)+Xe(i[2]),o===0?0:i[0]==="+"?o:-o)}function ra(t,s){var r,a;return s._isUTC?(r=s.clone(),a=(At(t)||Ps(t)?t.valueOf():rt(t).valueOf())-r.valueOf(),r._d.setTime(r._d.valueOf()+a),ke.updateOffset(r,!1),r):rt(t).local()}function Mr(t){return-Math.round(t._d.getTimezoneOffset())}ke.updateOffset=function(){};function pl(t,s,r){var a=this._offset||0,i;if(!this.isValid())return t!=null?this:NaN;if(t!=null){if(typeof t=="string"){if(t=sa(lr,t),t===null)return this}else Math.abs(t)<16&&!r&&(t=t*60);return!this._isUTC&&s&&(i=Mr(this)),this._offset=t,this._isUTC=!0,i!=null&&this.add(i,"m"),a!==t&&(!s||this._changeInProgress?di(this,It(t-a,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,ke.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?a:Mr(this)}function gl(t,s){return t!=null?(typeof t!="string"&&(t=-t),this.utcOffset(t,s),this):-this.utcOffset()}function fl(t){return this.utcOffset(0,t)}function yl(t){return this._isUTC&&(this.utcOffset(0,t),this._isUTC=!1,t&&this.subtract(Mr(this),"m")),this}function xl(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var t=sa(Do,this._i);t!=null?this.utcOffset(t):this.utcOffset(0,!0)}return this}function vl(t){return this.isValid()?(t=t?rt(t).utcOffset():0,(this.utcOffset()-t)%60===0):!1}function bl(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function wl(){if(!vt(this._isDSTShifted))return this._isDSTShifted;var t={},s;return $r(t,this),t=ai(t),t._a?(s=t._isUTC?Mt(t._a):rt(t._a),this._isDSTShifted=this.isValid()&&hl(t._a,s.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function _l(){return this.isValid()?!this._isUTC:!1}function jl(){return this.isValid()?this._isUTC:!1}function li(){return this.isValid()?this._isUTC&&this._offset===0:!1}var Sl=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,Nl=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function It(t,s){var r=t,a=null,i,o,n;return Hs(t)?r={ms:t._milliseconds,d:t._days,M:t._months}:Yt(t)||!isNaN(+t)?(r={},s?r[s]=+t:r.milliseconds=+t):(a=Sl.exec(t))?(i=a[1]==="-"?-1:1,r={y:0,d:Xe(a[Ut])*i,h:Xe(a[ht])*i,m:Xe(a[Ct])*i,s:Xe(a[$t])*i,ms:Xe(Rr(a[es]*1e3))*i}):(a=Nl.exec(t))?(i=a[1]==="-"?-1:1,r={y:Qt(a[2],i),M:Qt(a[3],i),w:Qt(a[4],i),d:Qt(a[5],i),h:Qt(a[6],i),m:Qt(a[7],i),s:Qt(a[8],i)}):r==null?r={}:typeof r=="object"&&("from"in r||"to"in r)&&(n=kl(rt(r.from),rt(r.to)),r={},r.ms=n.milliseconds,r.M=n.months),o=new ur(r),Hs(t)&&Ve(t,"_locale")&&(o._locale=t._locale),Hs(t)&&Ve(t,"_isValid")&&(o._isValid=t._isValid),o}It.fn=ur.prototype;It.invalid=ul;function Qt(t,s){var r=t&&parseFloat(t.replace(",","."));return(isNaN(r)?0:r)*s}function ka(t,s){var r={};return r.months=s.month()-t.month()+(s.year()-t.year())*12,t.clone().add(r.months,"M").isAfter(s)&&--r.months,r.milliseconds=+s-+t.clone().add(r.months,"M"),r}function kl(t,s){var r;return t.isValid()&&s.isValid()?(s=ra(s,t),t.isBefore(s)?r=ka(t,s):(r=ka(s,t),r.milliseconds=-r.milliseconds,r.months=-r.months),r):{milliseconds:0,months:0}}function ci(t,s){return function(r,a){var i,o;return a!==null&&!isNaN(+a)&&(Oa(s,"moment()."+s+"(period, number) is deprecated. Please use moment()."+s+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),o=r,r=a,a=o),i=It(r,a),di(this,i,t),this}}function di(t,s,r,a){var i=s._milliseconds,o=Rr(s._days),n=Rr(s._months);t.isValid()&&(a=a??!0,n&&Va(t,js(t,"Month")+n*r),o&&Ha(t,"Date",js(t,"Date")+o*r),i&&t._d.setTime(t._d.valueOf()+i*r),a&&ke.updateOffset(t,o||n))}var Cl=ci(1,"add"),Pl=ci(-1,"subtract");function ui(t){return typeof t=="string"||t instanceof String}function Al(t){return At(t)||Ps(t)||ui(t)||Yt(t)||Il(t)||El(t)||t===null||t===void 0}function El(t){var s=ts(t)&&!Br(t),r=!1,a=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],i,o,n=a.length;for(i=0;i<n;i+=1)o=a[i],r=r||Ve(t,o);return s&&r}function Il(t){var s=Pt(t),r=!1;return s&&(r=t.filter(function(a){return!Yt(a)&&ui(t)}).length===0),s&&r}function Tl(t){var s=ts(t)&&!Br(t),r=!1,a=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],i,o;for(i=0;i<a.length;i+=1)o=a[i],r=r||Ve(t,o);return s&&r}function Ul(t,s){var r=t.diff(s,"days",!0);return r<-6?"sameElse":r<-1?"lastWeek":r<0?"lastDay":r<1?"sameDay":r<2?"nextDay":r<7?"nextWeek":"sameElse"}function Rl(t,s){arguments.length===1&&(arguments[0]?Al(arguments[0])?(t=arguments[0],s=void 0):Tl(arguments[0])&&(s=arguments[0],t=void 0):(t=void 0,s=void 0));var r=t||rt(),a=ra(r,this).startOf("day"),i=ke.calendarFormat(this,a)||"sameElse",o=s&&(Dt(s[i])?s[i].call(this,r):s[i]);return this.format(o||this.localeData().calendar(i,this,rt(r)))}function Ml(){return new As(this)}function Dl(t,s){var r=At(t)?t:rt(t);return this.isValid()&&r.isValid()?(s=Nt(s)||"millisecond",s==="millisecond"?this.valueOf()>r.valueOf():r.valueOf()<this.clone().startOf(s).valueOf()):!1}function Ll(t,s){var r=At(t)?t:rt(t);return this.isValid()&&r.isValid()?(s=Nt(s)||"millisecond",s==="millisecond"?this.valueOf()<r.valueOf():this.clone().endOf(s).valueOf()<r.valueOf()):!1}function Ol(t,s,r,a){var i=At(t)?t:rt(t),o=At(s)?s:rt(s);return this.isValid()&&i.isValid()&&o.isValid()?(a=a||"()",(a[0]==="("?this.isAfter(i,r):!this.isBefore(i,r))&&(a[1]===")"?this.isBefore(o,r):!this.isAfter(o,r))):!1}function Bl(t,s){var r=At(t)?t:rt(t),a;return this.isValid()&&r.isValid()?(s=Nt(s)||"millisecond",s==="millisecond"?this.valueOf()===r.valueOf():(a=r.valueOf(),this.clone().startOf(s).valueOf()<=a&&a<=this.clone().endOf(s).valueOf())):!1}function Fl(t,s){return this.isSame(t,s)||this.isAfter(t,s)}function $l(t,s){return this.isSame(t,s)||this.isBefore(t,s)}function zl(t,s,r){var a,i,o;if(!this.isValid())return NaN;if(a=ra(t,this),!a.isValid())return NaN;switch(i=(a.utcOffset()-this.utcOffset())*6e4,s=Nt(s),s){case"year":o=Xs(this,a)/12;break;case"month":o=Xs(this,a);break;case"quarter":o=Xs(this,a)/3;break;case"second":o=(this-a)/1e3;break;case"minute":o=(this-a)/6e4;break;case"hour":o=(this-a)/36e5;break;case"day":o=(this-a-i)/864e5;break;case"week":o=(this-a-i)/6048e5;break;default:o=this-a}return r?o:jt(o)}function Xs(t,s){if(t.date()<s.date())return-Xs(s,t);var r=(s.year()-t.year())*12+(s.month()-t.month()),a=t.clone().add(r,"months"),i,o;return s-a<0?(i=t.clone().add(r-1,"months"),o=(s-a)/(a-i)):(i=t.clone().add(r+1,"months"),o=(s-a)/(i-a)),-(r+o)||0}ke.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";ke.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function Wl(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function Yl(t){if(!this.isValid())return null;var s=t!==!0,r=s?this.clone().utc():this;return r.year()<0||r.year()>9999?Ys(r,s?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):Dt(Date.prototype.toISOString)?s?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",Ys(r,"Z")):Ys(r,s?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function Hl(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var t="moment",s="",r,a,i,o;return this.isLocal()||(t=this.utcOffset()===0?"moment.utc":"moment.parseZone",s="Z"),r="["+t+'("]',a=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",i="-MM-DD[T]HH:mm:ss.SSS",o=s+'[")]',this.format(r+a+i+o)}function Xl(t){t||(t=this.isUtc()?ke.defaultFormatUtc:ke.defaultFormat);var s=Ys(this,t);return this.localeData().postformat(s)}function Gl(t,s){return this.isValid()&&(At(t)&&t.isValid()||rt(t).isValid())?It({to:this,from:t}).locale(this.locale()).humanize(!s):this.localeData().invalidDate()}function Vl(t){return this.from(rt(),t)}function ql(t,s){return this.isValid()&&(At(t)&&t.isValid()||rt(t).isValid())?It({from:this,to:t}).locale(this.locale()).humanize(!s):this.localeData().invalidDate()}function Jl(t){return this.to(rt(),t)}function hi(t){var s;return t===void 0?this._locale._abbr:(s=Ht(t),s!=null&&(this._locale=s),this)}var mi=St("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(t){return t===void 0?this.localeData():this.locale(t)});function pi(){return this._locale}var qs=1e3,ls=60*qs,Js=60*ls,gi=(365*400+97)*24*Js;function cs(t,s){return(t%s+s)%s}function fi(t,s,r){return t<100&&t>=0?new Date(t+400,s,r)-gi:new Date(t,s,r).valueOf()}function yi(t,s,r){return t<100&&t>=0?Date.UTC(t+400,s,r)-gi:Date.UTC(t,s,r)}function Kl(t){var s,r;if(t=Nt(t),t===void 0||t==="millisecond"||!this.isValid())return this;switch(r=this._isUTC?yi:fi,t){case"year":s=r(this.year(),0,1);break;case"quarter":s=r(this.year(),this.month()-this.month()%3,1);break;case"month":s=r(this.year(),this.month(),1);break;case"week":s=r(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":s=r(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":s=r(this.year(),this.month(),this.date());break;case"hour":s=this._d.valueOf(),s-=cs(s+(this._isUTC?0:this.utcOffset()*ls),Js);break;case"minute":s=this._d.valueOf(),s-=cs(s,ls);break;case"second":s=this._d.valueOf(),s-=cs(s,qs);break}return this._d.setTime(s),ke.updateOffset(this,!0),this}function Zl(t){var s,r;if(t=Nt(t),t===void 0||t==="millisecond"||!this.isValid())return this;switch(r=this._isUTC?yi:fi,t){case"year":s=r(this.year()+1,0,1)-1;break;case"quarter":s=r(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":s=r(this.year(),this.month()+1,1)-1;break;case"week":s=r(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":s=r(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":s=r(this.year(),this.month(),this.date()+1)-1;break;case"hour":s=this._d.valueOf(),s+=Js-cs(s+(this._isUTC?0:this.utcOffset()*ls),Js)-1;break;case"minute":s=this._d.valueOf(),s+=ls-cs(s,ls)-1;break;case"second":s=this._d.valueOf(),s+=qs-cs(s,qs)-1;break}return this._d.setTime(s),ke.updateOffset(this,!0),this}function Ql(){return this._d.valueOf()-(this._offset||0)*6e4}function ec(){return Math.floor(this.valueOf()/1e3)}function tc(){return new Date(this.valueOf())}function sc(){var t=this;return[t.year(),t.month(),t.date(),t.hour(),t.minute(),t.second(),t.millisecond()]}function rc(){var t=this;return{years:t.year(),months:t.month(),date:t.date(),hours:t.hours(),minutes:t.minutes(),seconds:t.seconds(),milliseconds:t.milliseconds()}}function ac(){return this.isValid()?this.toISOString():null}function ic(){return Fr(this)}function oc(){return Vt({},$e(this))}function nc(){return $e(this).overflow}function lc(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}Re("N",0,0,"eraAbbr");Re("NN",0,0,"eraAbbr");Re("NNN",0,0,"eraAbbr");Re("NNNN",0,0,"eraName");Re("NNNNN",0,0,"eraNarrow");Re("y",["y",1],"yo","eraYear");Re("y",["yy",2],0,"eraYear");Re("y",["yyy",3],0,"eraYear");Re("y",["yyyy",4],0,"eraYear");Pe("N",aa);Pe("NN",aa);Pe("NNN",aa);Pe("NNNN",vc);Pe("NNNNN",bc);tt(["N","NN","NNN","NNNN","NNNNN"],function(t,s,r,a){var i=r._locale.erasParse(t,a,r._strict);i?$e(r).era=i:$e(r).invalidEra=t});Pe("y",ms);Pe("yy",ms);Pe("yyy",ms);Pe("yyyy",ms);Pe("yo",wc);tt(["y","yy","yyy","yyyy"],gt);tt(["yo"],function(t,s,r,a){var i;r._locale._eraYearOrdinalRegex&&(i=t.match(r._locale._eraYearOrdinalRegex)),r._locale.eraYearOrdinalParse?s[gt]=r._locale.eraYearOrdinalParse(t,i):s[gt]=parseInt(t,10)});function cc(t,s){var r,a,i,o=this._eras||Ht("en")._eras;for(r=0,a=o.length;r<a;++r){switch(typeof o[r].since){case"string":i=ke(o[r].since).startOf("day"),o[r].since=i.valueOf();break}switch(typeof o[r].until){case"undefined":o[r].until=1/0;break;case"string":i=ke(o[r].until).startOf("day").valueOf(),o[r].until=i.valueOf();break}}return o}function dc(t,s,r){var a,i,o=this.eras(),n,u,m;for(t=t.toUpperCase(),a=0,i=o.length;a<i;++a)if(n=o[a].name.toUpperCase(),u=o[a].abbr.toUpperCase(),m=o[a].narrow.toUpperCase(),r)switch(s){case"N":case"NN":case"NNN":if(u===t)return o[a];break;case"NNNN":if(n===t)return o[a];break;case"NNNNN":if(m===t)return o[a];break}else if([n,u,m].indexOf(t)>=0)return o[a]}function uc(t,s){var r=t.since<=t.until?1:-1;return s===void 0?ke(t.since).year():ke(t.since).year()+(s-t.offset)*r}function hc(){var t,s,r,a=this.localeData().eras();for(t=0,s=a.length;t<s;++t)if(r=this.clone().startOf("day").valueOf(),a[t].since<=r&&r<=a[t].until||a[t].until<=r&&r<=a[t].since)return a[t].name;return""}function mc(){var t,s,r,a=this.localeData().eras();for(t=0,s=a.length;t<s;++t)if(r=this.clone().startOf("day").valueOf(),a[t].since<=r&&r<=a[t].until||a[t].until<=r&&r<=a[t].since)return a[t].narrow;return""}function pc(){var t,s,r,a=this.localeData().eras();for(t=0,s=a.length;t<s;++t)if(r=this.clone().startOf("day").valueOf(),a[t].since<=r&&r<=a[t].until||a[t].until<=r&&r<=a[t].since)return a[t].abbr;return""}function gc(){var t,s,r,a,i=this.localeData().eras();for(t=0,s=i.length;t<s;++t)if(r=i[t].since<=i[t].until?1:-1,a=this.clone().startOf("day").valueOf(),i[t].since<=a&&a<=i[t].until||i[t].until<=a&&a<=i[t].since)return(this.year()-ke(i[t].since).year())*r+i[t].offset;return this.year()}function fc(t){return Ve(this,"_erasNameRegex")||ia.call(this),t?this._erasNameRegex:this._erasRegex}function yc(t){return Ve(this,"_erasAbbrRegex")||ia.call(this),t?this._erasAbbrRegex:this._erasRegex}function xc(t){return Ve(this,"_erasNarrowRegex")||ia.call(this),t?this._erasNarrowRegex:this._erasRegex}function aa(t,s){return s.erasAbbrRegex(t)}function vc(t,s){return s.erasNameRegex(t)}function bc(t,s){return s.erasNarrowRegex(t)}function wc(t,s){return s._eraYearOrdinalRegex||ms}function ia(){var t=[],s=[],r=[],a=[],i,o,n,u,m,f=this.eras();for(i=0,o=f.length;i<o;++i)n=zt(f[i].name),u=zt(f[i].abbr),m=zt(f[i].narrow),s.push(n),t.push(u),r.push(m),a.push(n),a.push(u),a.push(m);this._erasRegex=new RegExp("^("+a.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+s.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+t.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+r.join("|")+")","i")}Re(0,["gg",2],0,function(){return this.weekYear()%100});Re(0,["GG",2],0,function(){return this.isoWeekYear()%100});function hr(t,s){Re(0,[t,t.length],0,s)}hr("gggg","weekYear");hr("ggggg","weekYear");hr("GGGG","isoWeekYear");hr("GGGGG","isoWeekYear");Pe("G",nr);Pe("g",nr);Pe("GG",at,bt);Pe("gg",at,bt);Pe("GGGG",Xr,Hr);Pe("gggg",Xr,Hr);Pe("GGGGG",or,ar);Pe("ggggg",or,ar);Is(["gggg","ggggg","GGGG","GGGGG"],function(t,s,r,a){s[a.substr(0,2)]=Xe(t)});Is(["gg","GG"],function(t,s,r,a){s[a]=ke.parseTwoDigitYear(t)});function _c(t){return xi.call(this,t,this.week(),this.weekday()+this.localeData()._week.dow,this.localeData()._week.dow,this.localeData()._week.doy)}function jc(t){return xi.call(this,t,this.isoWeek(),this.isoWeekday(),1,4)}function Sc(){return Wt(this.year(),1,4)}function Nc(){return Wt(this.isoWeekYear(),1,4)}function kc(){var t=this.localeData()._week;return Wt(this.year(),t.dow,t.doy)}function Cc(){var t=this.localeData()._week;return Wt(this.weekYear(),t.dow,t.doy)}function xi(t,s,r,a,i){var o;return t==null?Ns(this,a,i).year:(o=Wt(t,a,i),s>o&&(s=o),Pc.call(this,t,s,r,a,i))}function Pc(t,s,r,a,i){var o=Ka(t,s,r,a,i),n=Ss(o.year,0,o.dayOfYear);return this.year(n.getUTCFullYear()),this.month(n.getUTCMonth()),this.date(n.getUTCDate()),this}Re("Q",0,"Qo","quarter");Pe("Q",Fa);tt("Q",function(t,s){s[Ft]=(Xe(t)-1)*3});function Ac(t){return t==null?Math.ceil((this.month()+1)/3):this.month((t-1)*3+this.month()%3)}Re("D",["DD",2],"Do","date");Pe("D",at,ps);Pe("DD",at,bt);Pe("Do",function(t,s){return t?s._dayOfMonthOrdinalParse||s._ordinalParse:s._dayOfMonthOrdinalParseLenient});tt(["D","DD"],Ut);tt("Do",function(t,s){s[Ut]=Xe(t.match(at)[0])});var vi=gs("Date",!0);Re("DDD",["DDDD",3],"DDDo","dayOfYear");Pe("DDD",ir);Pe("DDDD",$a);tt(["DDD","DDDD"],function(t,s,r){r._dayOfYear=Xe(t)});function Ec(t){var s=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return t==null?s:this.add(t-s,"d")}Re("m",["mm",2],0,"minute");Pe("m",at,Gr);Pe("mm",at,bt);tt(["m","mm"],Ct);var Ic=gs("Minutes",!1);Re("s",["ss",2],0,"second");Pe("s",at,Gr);Pe("ss",at,bt);tt(["s","ss"],$t);var Tc=gs("Seconds",!1);Re("S",0,0,function(){return~~(this.millisecond()/100)});Re(0,["SS",2],0,function(){return~~(this.millisecond()/10)});Re(0,["SSS",3],0,"millisecond");Re(0,["SSSS",4],0,function(){return this.millisecond()*10});Re(0,["SSSSS",5],0,function(){return this.millisecond()*100});Re(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});Re(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});Re(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});Re(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});Pe("S",ir,Fa);Pe("SS",ir,bt);Pe("SSS",ir,$a);var qt,bi;for(qt="SSSS";qt.length<=9;qt+="S")Pe(qt,ms);function Uc(t,s){s[es]=Xe(("0."+t)*1e3)}for(qt="S";qt.length<=9;qt+="S")tt(qt,Uc);bi=gs("Milliseconds",!1);Re("z",0,0,"zoneAbbr");Re("zz",0,0,"zoneName");function Rc(){return this._isUTC?"UTC":""}function Mc(){return this._isUTC?"Coordinated Universal Time":""}var me=As.prototype;me.add=Cl;me.calendar=Rl;me.clone=Ml;me.diff=zl;me.endOf=Zl;me.format=Xl;me.from=Gl;me.fromNow=Vl;me.to=ql;me.toNow=Jl;me.get=Yo;me.invalidAt=nc;me.isAfter=Dl;me.isBefore=Ll;me.isBetween=Ol;me.isSame=Bl;me.isSameOrAfter=Fl;me.isSameOrBefore=$l;me.isValid=ic;me.lang=mi;me.locale=hi;me.localeData=pi;me.max=il;me.min=al;me.parsingFlags=oc;me.set=Ho;me.startOf=Kl;me.subtract=Pl;me.toArray=sc;me.toObject=rc;me.toDate=tc;me.toISOString=Yl;me.inspect=Hl;typeof Symbol<"u"&&Symbol.for!=null&&(me[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"});me.toJSON=ac;me.toString=Wl;me.unix=ec;me.valueOf=Ql;me.creationData=lc;me.eraName=hc;me.eraNarrow=mc;me.eraAbbr=pc;me.eraYear=gc;me.year=Ya;me.isLeapYear=Wo;me.weekYear=_c;me.isoWeekYear=jc;me.quarter=me.quarters=Ac;me.month=qa;me.daysInMonth=en;me.week=me.weeks=cn;me.isoWeek=me.isoWeeks=dn;me.weeksInYear=kc;me.weeksInWeekYear=Cc;me.isoWeeksInYear=Sc;me.isoWeeksInISOWeekYear=Nc;me.date=vi;me.day=me.days=jn;me.weekday=Sn;me.isoWeekday=Nn;me.dayOfYear=Ec;me.hour=me.hours=Tn;me.minute=me.minutes=Ic;me.second=me.seconds=Tc;me.millisecond=me.milliseconds=bi;me.utcOffset=pl;me.utc=fl;me.local=yl;me.parseZone=xl;me.hasAlignedHourOffset=vl;me.isDST=bl;me.isLocal=_l;me.isUtcOffset=jl;me.isUtc=li;me.isUTC=li;me.zoneAbbr=Rc;me.zoneName=Mc;me.dates=St("dates accessor is deprecated. Use date instead.",vi);me.months=St("months accessor is deprecated. Use month instead",qa);me.years=St("years accessor is deprecated. Use year instead",Ya);me.zone=St("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",gl);me.isDSTShifted=St("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",wl);function Dc(t){return rt(t*1e3)}function Lc(){return rt.apply(null,arguments).parseZone()}function wi(t){return t}var qe=zr.prototype;qe.calendar=wo;qe.longDateFormat=No;qe.invalidDate=Co;qe.ordinal=Eo;qe.preparse=wi;qe.postformat=wi;qe.relativeTime=To;qe.pastFuture=Uo;qe.set=vo;qe.eras=cc;qe.erasParse=dc;qe.erasConvertYear=uc;qe.erasAbbrRegex=yc;qe.erasNameRegex=fc;qe.erasNarrowRegex=xc;qe.months=Jo;qe.monthsShort=Ko;qe.monthsParse=Qo;qe.monthsRegex=sn;qe.monthsShortRegex=tn;qe.week=an;qe.firstDayOfYear=ln;qe.firstDayOfWeek=nn;qe.weekdays=xn;qe.weekdaysMin=bn;qe.weekdaysShort=vn;qe.weekdaysParse=_n;qe.weekdaysRegex=kn;qe.weekdaysShortRegex=Cn;qe.weekdaysMinRegex=Pn;qe.isPM=En;qe.meridiem=Un;function Ks(t,s,r,a){var i=Ht(),o=Mt().set(a,s);return i[r](o,t)}function _i(t,s,r){if(Yt(t)&&(s=t,t=void 0),t=t||"",s!=null)return Ks(t,s,r,"month");var a,i=[];for(a=0;a<12;a++)i[a]=Ks(t,a,r,"month");return i}function oa(t,s,r,a){typeof t=="boolean"?(Yt(s)&&(r=s,s=void 0),s=s||""):(s=t,r=s,t=!1,Yt(s)&&(r=s,s=void 0),s=s||"");var i=Ht(),o=t?i._week.dow:0,n,u=[];if(r!=null)return Ks(s,(r+o)%7,a,"day");for(n=0;n<7;n++)u[n]=Ks(s,(n+o)%7,a,"day");return u}function Oc(t,s){return _i(t,s,"months")}function Bc(t,s){return _i(t,s,"monthsShort")}function Fc(t,s,r){return oa(t,s,r,"weekdays")}function $c(t,s,r){return oa(t,s,r,"weekdaysShort")}function zc(t,s,r){return oa(t,s,r,"weekdaysMin")}Kt("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(t){var s=t%10,r=Xe(t%100/10)===1?"th":s===1?"st":s===2?"nd":s===3?"rd":"th";return t+r}});ke.lang=St("moment.lang is deprecated. Use moment.locale instead.",Kt);ke.langData=St("moment.langData is deprecated. Use moment.localeData instead.",Ht);var Ot=Math.abs;function Wc(){var t=this._data;return this._milliseconds=Ot(this._milliseconds),this._days=Ot(this._days),this._months=Ot(this._months),t.milliseconds=Ot(t.milliseconds),t.seconds=Ot(t.seconds),t.minutes=Ot(t.minutes),t.hours=Ot(t.hours),t.months=Ot(t.months),t.years=Ot(t.years),this}function ji(t,s,r,a){var i=It(s,r);return t._milliseconds+=a*i._milliseconds,t._days+=a*i._days,t._months+=a*i._months,t._bubble()}function Yc(t,s){return ji(this,t,s,1)}function Hc(t,s){return ji(this,t,s,-1)}function Ca(t){return t<0?Math.floor(t):Math.ceil(t)}function Xc(){var t=this._milliseconds,s=this._days,r=this._months,a=this._data,i,o,n,u,m;return t>=0&&s>=0&&r>=0||t<=0&&s<=0&&r<=0||(t+=Ca(Dr(r)+s)*864e5,s=0,r=0),a.milliseconds=t%1e3,i=jt(t/1e3),a.seconds=i%60,o=jt(i/60),a.minutes=o%60,n=jt(o/60),a.hours=n%24,s+=jt(n/24),m=jt(Si(s)),r+=m,s-=Ca(Dr(m)),u=jt(r/12),r%=12,a.days=s,a.months=r,a.years=u,this}function Si(t){return t*4800/146097}function Dr(t){return t*146097/4800}function Gc(t){if(!this.isValid())return NaN;var s,r,a=this._milliseconds;if(t=Nt(t),t==="month"||t==="quarter"||t==="year")switch(s=this._days+a/864e5,r=this._months+Si(s),t){case"month":return r;case"quarter":return r/3;case"year":return r/12}else switch(s=this._days+Math.round(Dr(this._months)),t){case"week":return s/7+a/6048e5;case"day":return s+a/864e5;case"hour":return s*24+a/36e5;case"minute":return s*1440+a/6e4;case"second":return s*86400+a/1e3;case"millisecond":return Math.floor(s*864e5)+a;default:throw new Error("Unknown unit "+t)}}function Xt(t){return function(){return this.as(t)}}var Ni=Xt("ms"),Vc=Xt("s"),qc=Xt("m"),Jc=Xt("h"),Kc=Xt("d"),Zc=Xt("w"),Qc=Xt("M"),ed=Xt("Q"),td=Xt("y"),sd=Ni;function rd(){return It(this)}function ad(t){return t=Nt(t),this.isValid()?this[t+"s"]():NaN}function ss(t){return function(){return this.isValid()?this._data[t]:NaN}}var id=ss("milliseconds"),od=ss("seconds"),nd=ss("minutes"),ld=ss("hours"),cd=ss("days"),dd=ss("months"),ud=ss("years");function hd(){return jt(this.days()/7)}var Bt=Math.round,os={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function md(t,s,r,a,i){return i.relativeTime(s||1,!!r,t,a)}function pd(t,s,r,a){var i=It(t).abs(),o=Bt(i.as("s")),n=Bt(i.as("m")),u=Bt(i.as("h")),m=Bt(i.as("d")),f=Bt(i.as("M")),k=Bt(i.as("w")),M=Bt(i.as("y")),h=o<=r.ss&&["s",o]||o<r.s&&["ss",o]||n<=1&&["m"]||n<r.m&&["mm",n]||u<=1&&["h"]||u<r.h&&["hh",u]||m<=1&&["d"]||m<r.d&&["dd",m];return r.w!=null&&(h=h||k<=1&&["w"]||k<r.w&&["ww",k]),h=h||f<=1&&["M"]||f<r.M&&["MM",f]||M<=1&&["y"]||["yy",M],h[2]=s,h[3]=+t>0,h[4]=a,md.apply(null,h)}function gd(t){return t===void 0?Bt:typeof t=="function"?(Bt=t,!0):!1}function fd(t,s){return os[t]===void 0?!1:s===void 0?os[t]:(os[t]=s,t==="s"&&(os.ss=s-1),!0)}function yd(t,s){if(!this.isValid())return this.localeData().invalidDate();var r=!1,a=os,i,o;return typeof t=="object"&&(s=t,t=!1),typeof t=="boolean"&&(r=t),typeof s=="object"&&(a=Object.assign({},os,s),s.s!=null&&s.ss==null&&(a.ss=s.s-1)),i=this.localeData(),o=pd(this,!r,a,i),r&&(o=i.pastFuture(+this,o)),i.postformat(o)}var Nr=Math.abs;function as(t){return(t>0)-(t<0)||+t}function mr(){if(!this.isValid())return this.localeData().invalidDate();var t=Nr(this._milliseconds)/1e3,s=Nr(this._days),r=Nr(this._months),a,i,o,n,u=this.asSeconds(),m,f,k,M;return u?(a=jt(t/60),i=jt(a/60),t%=60,a%=60,o=jt(r/12),r%=12,n=t?t.toFixed(3).replace(/\.?0+$/,""):"",m=u<0?"-":"",f=as(this._months)!==as(u)?"-":"",k=as(this._days)!==as(u)?"-":"",M=as(this._milliseconds)!==as(u)?"-":"",m+"P"+(o?f+o+"Y":"")+(r?f+r+"M":"")+(s?k+s+"D":"")+(i||a||t?"T":"")+(i?M+i+"H":"")+(a?M+a+"M":"")+(t?M+n+"S":"")):"P0D"}var Ge=ur.prototype;Ge.isValid=dl;Ge.abs=Wc;Ge.add=Yc;Ge.subtract=Hc;Ge.as=Gc;Ge.asMilliseconds=Ni;Ge.asSeconds=Vc;Ge.asMinutes=qc;Ge.asHours=Jc;Ge.asDays=Kc;Ge.asWeeks=Zc;Ge.asMonths=Qc;Ge.asQuarters=ed;Ge.asYears=td;Ge.valueOf=sd;Ge._bubble=Xc;Ge.clone=rd;Ge.get=ad;Ge.milliseconds=id;Ge.seconds=od;Ge.minutes=nd;Ge.hours=ld;Ge.days=cd;Ge.weeks=hd;Ge.months=dd;Ge.years=ud;Ge.humanize=yd;Ge.toISOString=mr;Ge.toString=mr;Ge.toJSON=mr;Ge.locale=hi;Ge.localeData=pi;Ge.toIsoString=St("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",mr);Ge.lang=mi;Re("X",0,0,"unix");Re("x",0,0,"valueOf");Pe("x",nr);Pe("X",Lo);tt("X",function(t,s,r){r._d=new Date(parseFloat(t)*1e3)});tt("x",function(t,s,r){r._d=new Date(Xe(t))});//! moment.js
ke.version="2.30.1";yo(rt);ke.fn=me;ke.min=ol;ke.max=nl;ke.now=ll;ke.utc=Mt;ke.unix=Dc;ke.months=Oc;ke.isDate=Ps;ke.locale=Kt;ke.invalid=rr;ke.duration=It;ke.isMoment=At;ke.weekdays=Fc;ke.parseZone=Lc;ke.localeData=Ht;ke.isDuration=Hs;ke.monthsShort=Bc;ke.weekdaysMin=zc;ke.defineLocale=Zr;ke.updateLocale=Ln;ke.locales=On;ke.weekdaysShort=$c;ke.normalizeUnits=Nt;ke.relativeTimeRounding=gd;ke.relativeTimeThreshold=fd;ke.calendarFormat=Ul;ke.prototype=me;ke.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};const ki=({videos:t})=>{const s=ct();return e.jsx("div",{className:"feed",children:t.map(r=>e.jsxs("div",{className:"card",style:{cursor:"pointer"},onClick:()=>{console.log("Clicked item:",r),s(`/video/${r.categoryId||0}/${r.id}`)},children:[e.jsx("img",{src:r.thumbnail||"https://via.placeholder.com/320x180?text=No+Thumbnail",alt:""}),e.jsx("h2",{children:r.title}),e.jsx("h3",{children:r.channelTitle||"Creator"})]},r.id))})};const xd=typeof import.meta<"u"&&{VITE_API_BASE_URL:"https://api.screenmerch.com",VITE_SUPABASE_URL:"https://sojxbydpcdcdzfdtbypd.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&{}.VITE_BACKEND_URL||"https://screenmerch.fly.dev",us=()=>{const t=window.location.hostname,s=t.split(".");if(t==="localhost"||/^\d+\.\d+\.\d+\.\d+$/.test(t))return null;if(s.length>=3){const r=s[0].toLowerCase();return r==="www"?null:r}return null},Zs=async t=>{if(!t)return null;try{const s=t.toLowerCase().trim();console.log("üîç Looking up creator for subdomain via API:",s);const r=await fetch(`${xd}/api/subdomain/${s}`,{method:"GET",headers:{Accept:"application/json"}});if(r.ok){const a=await r.json();return a.success&&a.creator?(console.log("‚úÖ Creator found via API:",a.creator),a.creator):(console.log("‚ÑπÔ∏è No creator found for subdomain:",s),null)}else if(r.status!==404){const a=await r.json().catch(()=>({}));console.warn("‚ö†Ô∏è Subdomain API returned error:",r.status,a)}else console.log("‚ÑπÔ∏è Subdomain not found (404) - this is expected for invalid subdomains");return null}catch(s){return console.error("‚ùå Error fetching creator from subdomain:",s),null}},vd=async t=>{if(!t)return null;try{const{supabase:s}=await qi(()=>Promise.resolve().then(()=>co),void 0),r=t.toLowerCase().trim();console.log("üîç Looking up creator for custom domain:",r);let{data:a,error:i}=await s.from("users").select("id, display_name, personalization_enabled, custom_domain").ilike("custom_domain",r).eq("personalization_enabled",!0).single();if(i||!a){const{data:o,error:n}=await s.from("users").select("id, display_name, personalization_enabled, custom_domain").ilike("custom_domain",r).single();if(o&&!n)console.log("‚úÖ Found creator for custom domain (without personalization check):",o),a=o,i=null;else return console.log("‚ùå No creator found for custom domain:",r,i||n),null}return a?(console.log("‚úÖ Creator found for custom domain:",r,a),a):null}catch(s){return console.error("‚ùå Error fetching creator from custom domain:",s),null}},Ci=c.createContext(null),bd=({children:t})=>{const[s,r]=c.useState(null),[a,i]=c.useState(null),[o,n]=c.useState(!0),u=async()=>{n(!0);try{const m=window.location.hostname.toLowerCase();let f=null;if(m.endsWith(".screenmerch.com")||m==="screenmerch.com"){const k=us();k&&(f=await Zs(k))}else f=await vd(m);if(f){r(f);const k={custom_logo_url:f.custom_logo_url||f.logo_url,primary_color:f.primary_color,secondary_color:f.secondary_color,hide_screenmerch_branding:f.hide_screenmerch_branding,custom_favicon_url:f.custom_favicon_url,custom_meta_title:f.custom_meta_title,custom_meta_description:f.custom_meta_description,display_name:f.display_name,personalization_enabled:f.personalization_enabled,profile_image_url:f.profile_image_url};if(console.log("üé® Creator settings from API:",k),k){i(k);const M=k.primary_color||"#667eea",h=k.secondary_color||"#764ba2";(k.primary_color||k.secondary_color)&&(console.log("üé® Applying creator colors:",{primary:M,secondary:h,personalization_enabled:k.personalization_enabled}),document.documentElement.style.setProperty("--primary-color",M),console.log("‚úÖ Set --primary-color to:",M),document.documentElement.style.setProperty("--secondary-color",h),console.log("‚úÖ Set --secondary-color to:",h));const v=document.documentElement,_=v.style.display;v.style.display="none",v.offsetHeight,v.style.display=_;const b=document.body;b&&(b.style.display="none",b.offsetHeight,b.style.display="");const x=document.createElement("style");if(x.textContent=`
            * {
              --primary-color: ${M} !important;
              --secondary-color: ${h} !important;
            }
          `,document.head.appendChild(x),setTimeout(()=>{x.parentNode&&x.parentNode.removeChild(x)},100),k.custom_favicon_url){let T=document.querySelector("link[rel*='icon']");T||(T=document.createElement("link"),T.rel="shortcut icon",document.getElementsByTagName("head")[0].appendChild(T)),T.href=k.custom_favicon_url}if(k.custom_meta_title&&(document.title=k.custom_meta_title),k.custom_meta_description){let T=document.querySelector('meta[name="description"]');T||(T=document.createElement("meta"),T.name="description",document.getElementsByTagName("head")[0].appendChild(T)),T.content=k.custom_meta_description}}}else document.documentElement.style.setProperty("--primary-color","#667eea"),document.documentElement.style.setProperty("--secondary-color","#764ba2")}catch(m){m.message&&!m.message.includes("404")&&!m.message.includes("not found")&&console.error("Error detecting creator:",m),document.documentElement.style.setProperty("--primary-color","#667eea"),document.documentElement.style.setProperty("--secondary-color","#764ba2")}finally{n(!1)}};return c.useEffect(()=>{u();const m=()=>{u()};return window.addEventListener("creatorSettingsUpdated",m),()=>{window.removeEventListener("creatorSettingsUpdated",m)}},[]),e.jsx(Ci.Provider,{value:{currentCreator:s,creatorSettings:a,loading:o,refreshCreator:u},children:t})},Ts=()=>{const t=c.useContext(Ci);return t||{currentCreator:null,creatorSettings:null,loading:!1}};const wd=({isOpen:t,onClose:s,currentPrimaryColor:r,currentSecondaryColor:a,onSave:i})=>{const[o,n]=c.useState(r||"#667eea"),[u,m]=c.useState(a||"#764ba2"),[f,k]=c.useState(!1),[M,h]=c.useState(""),[v,_]=c.useState("");if(c.useEffect(()=>{t&&(n(r||"#667eea"),m(a||"#764ba2"),h(""),_(""))},[t,r,a]),!t)return null;const b=async()=>{k(!0),h(""),_("");try{const x=/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;if(!x.test(o)){h("Primary color must be a valid hex color (e.g., #FF5733)"),_("error"),k(!1);return}if(!x.test(u)){h("Secondary color must be a valid hex color (e.g., #C70039)"),_("error"),k(!1);return}const T=us();if(!T){h("Error: Could not detect subdomain"),_("error"),k(!1);return}const S=await Zs(T);if(!S||!S.id){h("Error: Could not find subdomain owner"),_("error"),k(!1);return}let A=null;const E=localStorage.getItem("isAuthenticated"),z=localStorage.getItem("user");if(E==="true"&&z)try{const se=JSON.parse(z);if(A=se.id,!A&&se.email){const{data:be}=await R.from("users").select("id").eq("email",se.email).single();be&&(A=be.id)}}catch{}if(!A){const{data:{user:se}}=await R.auth.getUser();se&&(A=se.id)}if(!A||A!==S.id){h("You can only edit colors for your own subdomain. Please log in as the owner."),_("error"),k(!1);return}const V=typeof import.meta<"u"&&{VITE_API_BASE_URL:"https://api.screenmerch.com",VITE_SUPABASE_URL:"https://sojxbydpcdcdzfdtbypd.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&{}.VITE_BACKEND_URL||"https://screenmerch.fly.dev",X={primary_color:o,secondary_color:u};console.log("üíæ [COLOR-PICKER] Saving colors via backend API:",{userId:S.id,colors:X});const Y=await fetch(`${V}/api/users/${S.id}/update-profile`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(X)}),$=await Y.json();if(!Y.ok||!$.success)console.error("‚ùå [COLOR-PICKER] Error saving colors:",$.error||"Unknown error"),h(`Error: ${$.error||"Failed to save colors"}`),_("error");else{console.log("‚úÖ [COLOR-PICKER] Colors saved successfully via backend API:",$.user);const se=document.querySelector(".user-flow-section");se&&(se.style.setProperty("background",`linear-gradient(135deg, ${o} 0%, ${u} 100%)`,"important"),se.style.background=`linear-gradient(135deg, ${o} 0%, ${u} 100%)`),document.documentElement.style.setProperty("--primary-color",o),document.documentElement.style.setProperty("--secondary-color",u),window.dispatchEvent(new CustomEvent("creatorSettingsUpdated")),h("‚úÖ Colors saved successfully!"),_("success"),i&&i(o,u),setTimeout(()=>{s()},1e3)}}catch(x){console.error("Error saving colors:",x),h(`Error: ${x.message||"Unknown error"}`),_("error")}finally{k(!1)}};return e.jsx("div",{className:"color-picker-modal-overlay",onClick:s,children:e.jsxs("div",{className:"color-picker-modal",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"color-picker-modal-header",children:[e.jsx("h3",{children:"Edit Progress Bar Colors"}),e.jsx("button",{className:"color-picker-modal-close",onClick:s,children:"√ó"})]}),e.jsxs("div",{className:"color-picker-modal-content",children:[e.jsxs("div",{className:"color-picker-group",children:[e.jsx("label",{className:"color-picker-label",children:"Primary Color"}),e.jsxs("div",{className:"color-picker-input-group",children:[e.jsx("input",{type:"color",value:o,onChange:x=>n(x.target.value),className:"color-picker-input"}),e.jsx("input",{type:"text",value:o,onChange:x=>n(x.target.value),placeholder:"#667eea",className:"color-picker-text-input"})]})]}),e.jsxs("div",{className:"color-picker-group",children:[e.jsx("label",{className:"color-picker-label",children:"Secondary Color"}),e.jsxs("div",{className:"color-picker-input-group",children:[e.jsx("input",{type:"color",value:u,onChange:x=>m(x.target.value),className:"color-picker-input"}),e.jsx("input",{type:"text",value:u,onChange:x=>m(x.target.value),placeholder:"#764ba2",className:"color-picker-text-input"})]})]}),M&&e.jsx("div",{className:`color-picker-message ${v}`,children:M}),e.jsx("div",{className:"color-picker-preview",children:e.jsx("div",{className:"color-picker-preview-bar",style:{background:`linear-gradient(135deg, ${o} 0%, ${u} 100%)`},children:e.jsx("span",{children:"Preview"})})})]}),e.jsxs("div",{className:"color-picker-modal-footer",children:[e.jsx("button",{className:"color-picker-cancel-btn",onClick:s,disabled:f,children:"Cancel"}),e.jsx("button",{className:"color-picker-save-btn",onClick:b,disabled:f,children:f?"Saving...":"Save Colors"})]})]})})},_d=({sidebar:t,category:s,selectedCategory:r,setSelectedCategory:a})=>{const[i,o]=c.useState([]),[n,u]=c.useState(!0),[m,f]=c.useState(""),[k,M]=c.useState(!1),[h,v]=c.useState(!1),[_,b]=c.useState(!1);ct();const{creatorSettings:x,currentCreator:T,refreshCreator:S}=Ts();return c.useEffect(()=>{(async()=>{u(!0),f("");let E=R.from("videos2").select("*").order("created_at",{ascending:!1});s&&s!=="All"&&(E=E.eq("category",s));let{data:z,error:V}=await E;V?(f("Failed to fetch videos."),o([])):o(z||[]),u(!1)})()},[s]),c.useEffect(()=>{(async()=>{const E=us();if(!E||!T){console.log("üîí [HOME] No subdomain or creator:",{currentSubdomain:E,currentCreator:T}),v(!1);return}let z=null;const V=localStorage.getItem("isAuthenticated"),X=localStorage.getItem("user");if(V==="true"&&X)try{const $=JSON.parse(X);if(z=$.id,!z&&$.email){const{data:se}=await R.from("users").select("id").eq("email",$.email).single();se&&(z=se.id)}}catch($){console.error("Error parsing user data:",$)}if(!z)try{const{data:{user:$}}=await R.auth.getUser();$&&(z=$.id)}catch($){console.error("Error getting Supabase user:",$)}const Y=z&&T&&z===T.id;console.log("üîí [HOME] Edit permission check:",{loggedInUserId:z,creatorId:T==null?void 0:T.id,canEdit:Y,subdomain:E}),v(Y)})()},[T]),c.useEffect(()=>{if(x!=null&&x.primary_color&&(x!=null&&x.secondary_color)){const A=document.querySelector(".user-flow-section");A&&(A.style.setProperty("background",`linear-gradient(135deg, ${x.primary_color} 0%, ${x.secondary_color} 100%)`,"important"),console.log("üé® [HOME] Applied colors from creatorSettings:",{primary:x.primary_color,secondary:x.secondary_color}))}},[x==null?void 0:x.primary_color,x==null?void 0:x.secondary_color]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:`container ${t?"":" large-container"}`,children:[e.jsxs("div",{className:"user-flow-section",onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),style:{position:"relative",background:x!=null&&x.primary_color&&(x!=null&&x.secondary_color)?`linear-gradient(135deg, ${x.primary_color} 0%, ${x.secondary_color} 100%) !important`:void 0},children:[h&&e.jsx("button",{className:"progress-bar-edit-btn",onClick:()=>M(!0),style:{opacity:_?1:.7,transition:"opacity 0.2s ease"},title:"Edit colors",children:"‚úèÔ∏è"}),e.jsxs("div",{className:"flow-steps",children:[e.jsxs("div",{className:"flow-step",children:[e.jsx("div",{className:"step-number",children:"1"}),e.jsxs("div",{className:"step-content",children:[e.jsx("h3",{children:"Choose Video"}),e.jsx("p",{children:"Browse and select your favorite video content"})]})]}),e.jsx("div",{className:"flow-arrow",children:"‚Üí"}),e.jsxs("div",{className:"flow-step",children:[e.jsx("div",{className:"step-number",children:"2"}),e.jsxs("div",{className:"step-content",children:[e.jsx("h3",{children:"Select Screenshot"}),e.jsx("p",{children:"Select the perfect moment to capture"})]})]}),e.jsx("div",{className:"flow-arrow",children:"‚Üí"}),e.jsxs("div",{className:"flow-step",children:[e.jsx("div",{className:"step-number",children:"3"}),e.jsxs("div",{className:"step-content",children:[e.jsx("h3",{children:"Make Merch"}),e.jsx("p",{children:"Create custom products with your screenshot"})]})]})]})]}),e.jsx(wd,{isOpen:k,onClose:()=>M(!1),currentPrimaryColor:x==null?void 0:x.primary_color,currentSecondaryColor:x==null?void 0:x.secondary_color,onSave:async(A,E)=>{setTimeout(()=>{S&&S(),window.dispatchEvent(new CustomEvent("creatorSettingsUpdated"))},800)}}),n&&e.jsx("div",{style:{padding:24},children:"Loading videos..."}),m&&e.jsx("div",{style:{padding:24,color:"red"},children:m}),!n&&!m&&i.length>0&&e.jsx(ki,{videos:i})]})})};const na=({isOpen:t,onClose:s,onSuccess:r})=>{const[a,i]=c.useState(!0),[o,n]=c.useState(""),[u,m]=c.useState(""),[f,k]=c.useState(!1),[M,h]=c.useState(""),[v,_]=c.useState(null),b=async T=>{var A,E,z,V,X,Y;T.preventDefault(),k(!0),h("");const S=!a;if(!o.trim()){h({type:"error",text:"Please enter your email."}),k(!1);return}if(a&&!u){h({type:"error",text:"Please enter your password."}),k(!1);return}try{const $=a?"/api/auth/login":"/api/auth/signup/email-only",se=`${ze.BASE_URL}${$}`,be={baseUrl:ze.BASE_URL,fullUrl:se,endpoint:$,email:o.trim(),mode:a?"login":"signup"};console.log("üîç AuthModal - API_CONFIG.BASE_URL:",ze.BASE_URL),console.log("üîç AuthModal - Full URL:",se),console.log("üîç AuthModal - Email:",o.trim()),console.log("üîç AuthModal - Mode:",a?"login":"signup"),_(be);const xe=S?{email:o.trim()}:{email:o.trim(),password:u},ae=new AbortController,W=setTimeout(()=>ae.abort(),45e3),O=await fetch(se,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(xe),credentials:"include",mode:"cors",signal:ae.signal});clearTimeout(W),console.log("Response status:",O.status),console.log("Response ok:",O.ok),_(y=>({...y,responseStatus:O.status,responseOk:O.ok}));const G=(O.headers.get("content-type")||"").includes("application/json");if(!O.ok){const y=await O.text();console.error("Server error response:",y),_(N=>({...N,errorText:y}));try{const N=JSON.parse(y);throw O.status===409&&((A=N.error)!=null&&A.includes("already exists"))?new Error("This email is already registered. Please sign in instead."):N.error?new Error(N.error):new Error(`Server error: ${O.status} - ${y}`)}catch{throw new Error(`Server error: ${O.status} - ${y}`)}}const U=await O.json();if(S&&U.success){h({type:"success",text:"Please check your email to verify your account and set your password."}),n(""),m("");return}U.success?(localStorage.setItem("user_authenticated","true"),localStorage.setItem("user_email",o.trim()),localStorage.setItem("customer_authenticated","true"),localStorage.setItem("customer_user",JSON.stringify({display_name:o.trim(),email:o.trim(),user_type:"customer"})),h({type:"success",text:U.message||"Login successful! Redirecting..."}),setTimeout(()=>{r&&r(),s()},1500)):h({type:"error",text:U.error||"Authentication failed"})}catch($){console.error("Auth error caught:",$),console.error("Error message:",$.message),console.error("Error stack:",$.stack),console.error("Error name:",$.name);let se=$.message||$.toString()||"Unknown error",be="Authentication error";$.name==="AbortError"||(E=$.message)!=null&&E.includes("aborted")?(be="Request timed out. Please check your connection and try again.",se="Request timeout - network may be slow or unstable"):(z=$.message)!=null&&z.includes("Failed to fetch")||(V=$.message)!=null&&V.includes("Load failed")||(X=$.message)!=null&&X.includes("NetworkError")?(be="Network error. Please check your internet connection and try again.",se="Network connection failed - unable to reach server"):(Y=$.message)!=null&&Y.includes("CORS")&&(be="CORS error. Please try refreshing the page.",se="CORS policy blocked the request");const xe=(v==null?void 0:v.baseUrl)||ze.BASE_URL,ae=(v==null?void 0:v.fullUrl)||`${xe}${a?"/api/auth/login":"/api/auth/signup"}`;h({type:"error",text:`${be}: ${se}`}),_(W=>({...W,errorMessage:se,errorName:$.name,baseUrl:xe,fullUrl:ae,networkError:!0}))}finally{k(!1)}},x=()=>{i(!a),h(""),_(null),a||m("")};return t?e.jsx("div",{className:"auth-modal-overlay",onClick:s,children:e.jsxs("div",{className:"auth-modal",onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"auth-modal-header",children:[e.jsx("div",{className:"auth-logo",children:"üéØ"}),e.jsx("h2",{children:"ScreenMerch Login"}),e.jsx("button",{className:"auth-close-btn",onClick:s,children:"√ó"})]}),e.jsxs("div",{className:"auth-message",children:[e.jsx("strong",{children:"Login Required"}),e.jsx("br",{}),"To create merchandise, please log in or create an account with your email address."]}),e.jsxs("form",{onSubmit:b,className:"auth-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email Address"}),e.jsx("input",{type:"email",id:"email",value:o,onChange:T=>n(T.target.value),required:!0,placeholder:"Enter your email"})]}),a&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",id:"password",value:u,onChange:T=>m(T.target.value),required:!0,placeholder:"Enter your password"})]}),e.jsx("button",{type:"submit",className:"auth-submit-btn",disabled:f,children:f?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),"Processing..."]}):a?"Login":"Sign Up"}),a&&e.jsx("div",{className:"auth-forgot-wrap",children:e.jsx(mt,{to:"/set-password",className:"auth-forgot-link",onClick:s,children:"Forgot password? Set password"})})]}),e.jsxs("div",{className:"auth-toggle",children:[e.jsx("span",{children:a?"Don't have an account?":"Already have an account?"}),e.jsx("button",{type:"button",onClick:x,className:"auth-toggle-btn",children:a?"Sign Up":"Login"})]}),M&&e.jsxs("div",{className:`auth-message-display ${M.type}`,children:[M.text,v&&M.type==="error"&&e.jsxs("div",{style:{marginTop:"10px",padding:"10px",background:"rgba(0,0,0,0.1)",borderRadius:"4px",fontSize:"12px",wordBreak:"break-all",color:"#333"},children:[e.jsx("strong",{children:"Debug Info:"}),e.jsx("br",{}),"Base URL: ",v.baseUrl||"N/A",e.jsx("br",{}),"Full URL: ",v.fullUrl||"N/A",e.jsx("br",{}),v.responseStatus&&`Response Status: ${v.responseStatus}`,v.responseStatus&&e.jsx("br",{}),v.errorText&&e.jsxs("div",{style:{marginTop:"5px"},children:[e.jsx("strong",{children:"Error Response:"}),e.jsx("br",{}),v.errorText.substring(0,300)]}),v.errorMessage&&!v.errorText&&e.jsxs("div",{style:{marginTop:"5px"},children:[e.jsx("strong",{children:"Error:"})," ",v.errorMessage]})]})]})]})}):null},jd=()=>{const[t,s]=c.useState(!1),[r,a]=c.useState(!1);return c.useEffect(()=>{const i=()=>{const o=window.innerWidth<=768,n=o&&window.innerHeight>window.innerWidth;s(o),a(n)};return i(),window.addEventListener("resize",i),window.addEventListener("orientationchange",i),()=>{window.removeEventListener("resize",i),window.removeEventListener("orientationchange",i)}},[]),{isMobile:t,isMobilePortrait:r}},Sd=({videoId:t,thumbnail:s,setThumbnail:r,screenshots:a,setScreenshots:i,videoRef:o,onVideoData:n,onScreenshotFunction:u,onVideoPlayed:m,onMakeMerch:f})=>{const k=Cs(),M=t||k.videoId,{isMobile:h,isMobilePortrait:v}=jd(),{creatorSettings:_}=Ts(),[b,x]=c.useState(null),[T,S]=c.useState(!0),[A,E]=c.useState(""),[z,V]=c.useState(null),X=o||c.useRef(null),[Y]=c.useState(c.useRef(null)),[$,se]=c.useState(!1),[be,xe]=c.useState(!1);c.useEffect(()=>{const g=localStorage.getItem("user_authenticated"),te=localStorage.getItem("isAuthenticated"),ge=g==="true"||te==="true";console.log("üîÑ PlayVideo mounted - Auth check:",{user_authenticated:g,isAuthenticated:te,isLoggedIn:ge,allLocalStorage:Object.keys(localStorage).filter(ye=>ye.includes("auth")||ye.includes("user"))}),ge&&be&&(console.log("‚úÖ User is authenticated, closing auth modal"),xe(!1))},[be]);const ae=c.useRef(!1),[W,O]=c.useState(!1),[de,G]=c.useState(0),[U,y]=c.useState(!1),[N,D]=c.useState({x:0,y:0,width:200,height:200}),[w,p]=c.useState(!1),[ee,ie]=c.useState(!1),[we,Ce]=c.useState(null),[Oe,it]=c.useState({x:0,y:0}),[Le,Ye]=c.useState([]),I=c.useCallback(g=>{},[]);c.useEffect(()=>{if(X.current&&h){const g=X.current;g.setAttribute("playsinline","true"),g.setAttribute("webkit-playsinline","true"),g.setAttribute("x-webkit-airplay","allow"),g.setAttribute("preload","metadata"),g.addEventListener("webkitbeginfullscreen",ge=>{ge.preventDefault(),g.webkitExitFullscreen()}),g.addEventListener("webkitendfullscreen",ge=>{ge.preventDefault()});const te=ge=>{g.webkitPresentationMode==="fullscreen"&&g.webkitSetPresentationMode("inline")};return g.addEventListener("webkitpresentationmodechanged",te),()=>{g.removeEventListener("webkitbeginfullscreen",te),g.removeEventListener("webkitendfullscreen",te),g.removeEventListener("webkitpresentationmodechanged",te)}}},[h,X.current]),c.useEffect(()=>{if(!M){E("No video selected."),S(!1);return}(async()=>{S(!0),E("");let{data:te,error:ge}=await R.from("videos2").select("*").eq("id",M).single();if(ge)console.error("Supabase error:",ge),E("Video not found."),x(null);else{if(!te.video_url){console.error("No video URL found in data"),E("Video URL is missing."),x(null),S(!1);return}try{const ye=await fetch(te.video_url,{method:"HEAD"});ye.ok||console.warn("Video URL may not be accessible:",ye.status)}catch(ye){console.warn("Could not test video URL accessibility:",ye)}if(x(te),te.thumbnail||te.poster){const ye=te.thumbnail||te.poster;r(ye),i&&a.length===0&&i([ye])}n&&n(te)}S(!1)})()},[M,r,i]),c.useEffect(()=>{X.current&&X.current.load(),i([]),Ye([]),O(!1),G(0),ae.current=!1,V(null),se(!1)},[M,i]),c.useEffect(()=>{const g=X.current;if(!g)return;const te=()=>{if(!$){console.log("Video play event detected - activating step 2 red pulse"),se(!0);const ge=m;typeof ge=="function"&&ge()}};return g.addEventListener("play",te),()=>{g.removeEventListener("play",te)}},[X,$,m]);const J=c.useCallback(async()=>{if(a.length>=6){I("Maximum 6 screenshots allowed. Please delete some screenshots first.");return}const te=X.current;if(!te){I("Video not loaded yet. Please wait for the video to load.");return}const ge=te.currentTime||0,ye=(b==null?void 0:b.video_url)||te.src,pe=await oe();if(pe){const Te=a.length;if(i(fe=>{const d=fe.length<6?[...fe,pe]:fe;return We(fe.length),d}),Ye(fe=>fe.length<6?[...fe,ge]:fe),ye){try{const j=localStorage.getItem("pending_merch_data");if(j){const C=JSON.parse(j);C.print_quality_upgrade_timestamp=Date.now(),delete C.print_quality_upgrade_failed,localStorage.setItem("pending_merch_data",JSON.stringify(C)),window.dispatchEvent(new Event("localStorageUpdated"))}}catch(j){console.warn("Failed to mark upgrade as starting:",j)}const fe=new AbortController,d=setTimeout(()=>{fe.abort(),console.warn("‚ö†Ô∏è Print quality upgrade timed out after 60 seconds");try{const j=localStorage.getItem("pending_merch_data");if(j){const C=JSON.parse(j);C.print_quality_upgrade_failed=!0,localStorage.setItem("pending_merch_data",JSON.stringify(C)),window.dispatchEvent(new Event("localStorageUpdated"))}}catch(j){console.warn("Failed to mark upgrade as failed:",j)}},6e4);fetch(ze.ENDPOINTS.CAPTURE_PRINT_QUALITY,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({video_url:ye,timestamp:ge,print_dpi:300}),signal:fe.signal}).then(j=>{if(clearTimeout(d),!j.ok)throw new Error(`Server responded with status: ${j.status}`);return j.json()}).then(j=>{if(j.success&&j.screenshot){i(C=>{const Q=[...C];return Q[Te]&&(Q[Te]=j.screenshot),Q});try{const C=localStorage.getItem("pending_merch_data");if(C){const Q=JSON.parse(C);Q.screenshots&&Array.isArray(Q.screenshots)&&Q.screenshots[Te]&&(Q.screenshots[Te]=j.screenshot,Q.selected_screenshot===pe&&(Q.selected_screenshot=j.screenshot),delete Q.print_quality_upgrade_failed,delete Q.print_quality_upgrade_timestamp,localStorage.setItem("pending_merch_data",JSON.stringify(Q)),window.dispatchEvent(new Event("localStorageUpdated")))}}catch(C){console.warn("Failed to update localStorage with print quality screenshot:",C)}console.log("‚úÖ Screenshot upgraded to print quality and saved to localStorage")}else throw new Error(j.error||"Server failed to capture print quality screenshot")}).catch(j=>{clearTimeout(d),j.name==="AbortError"?console.warn("‚ö†Ô∏è Print quality upgrade aborted (timeout)"):console.warn("‚ö†Ô∏è Print quality upgrade failed, keeping client-side capture:",j);try{const C=localStorage.getItem("pending_merch_data");if(C){const Q=JSON.parse(C);Q.print_quality_upgrade_failed=!0,Q.print_quality_upgrade_timestamp=Date.now(),localStorage.setItem("pending_merch_data",JSON.stringify(Q)),window.dispatchEvent(new Event("localStorageUpdated"))}}catch(C){console.warn("Failed to mark upgrade as failed:",C)}})}return}if(!ye){I("No video URL available for screenshot capture.");return}try{const Te=new AbortController,fe=setTimeout(()=>Te.abort(),15e3),d=await fetch(ze.ENDPOINTS.CAPTURE_PRINT_QUALITY,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({video_url:ye,timestamp:ge,print_dpi:300}),signal:Te.signal});if(clearTimeout(fe),!d.ok)throw new Error(`Server responded with status: ${d.status}`);const j=await d.json();if(j.success&&j.screenshot){i(C=>{const Q=C.length<6?[...C,j.screenshot]:C;return We(C.length),Q}),Ye(C=>{const Q=C.length<6?[...C,ge]:Q;return Q});return}else throw new Error(j.error||"Server failed to capture print quality screenshot")}catch(Te){console.error("‚ùå Print quality capture failed, trying regular screenshot endpoint:",Te);try{const d=new AbortController,j=setTimeout(()=>d.abort(),1e4),C=await fetch(ze.ENDPOINTS.CAPTURE_SCREENSHOT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({video_url:ye,timestamp:ge,quality:95}),signal:d.signal});if(clearTimeout(j),C.ok){const Q=await C.json();if(Q.success&&Q.screenshot){i(ce=>{const Ue=ce.length<6?[...ce,Q.screenshot]:ce;return We(ce.length),Ue}),Ye(ce=>{const Ue=ce.length<6?[...ce,ge]:Ue;return Ue});return}}}catch(d){console.error("‚ùå Fallback screenshot capture also failed:",d)}const fe=(b==null?void 0:b.thumbnail)||(b==null?void 0:b.poster)||te.poster;if(fe)console.warn("‚ö†Ô∏è Using thumbnail as last resort - screenshot capture failed"),i(d=>{const j=d.length<6?[...d,fe]:d;return We(d.length),j});else{const d=document.createElement("div");d.style.cssText=`
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #f44336;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 10000;
                    animation: slideIn 0.3s ease-out;
                    max-width: 300px;
                    font-size: 14px;
                    font-weight: 500;
                `,d.textContent="Failed to capture screenshot. Please try again.",document.body.appendChild(d),setTimeout(()=>document.body.removeChild(d),3e3)}}},[b,X,i]);c.useEffect(()=>{u&&b&&!T&&!ae.current&&(u(J),ae.current=!0)},[u,b,T]);const Se=async()=>{if(!(W||Date.now()-de<100)){if(a.length>=6){I("Maximum 6 screenshots allowed. Please delete some screenshots first.");return}O(!0);try{await J()}finally{O(!1)}}},oe=c.useCallback(async()=>{const g=X.current;if(!g)return console.error("Video element not found"),null;try{if(!(g.readyState>=2&&g.videoWidth>0&&g.videoHeight>0))return null;const te=document.createElement("canvas"),ge=te.getContext("2d"),ye=g.getBoundingClientRect();return te.width=ye.width,te.height=ye.height,ge.drawImage(g,0,0,te.width,te.height),te.toDataURL("image/jpeg",.9)}catch(te){return console.error("Error capturing video frame:",te),null}},[h]),ve=async()=>{const g=localStorage.getItem("user_authenticated"),te=localStorage.getItem("isAuthenticated"),ge=g==="true"||te==="true";if(console.log("üõçÔ∏è Make Merch - Auth check after login:",{user_authenticated:g,isAuthenticated:te,isLoggedIn:ge,allLocalStorage:Object.keys(localStorage).filter(fe=>fe.includes("auth")||fe.includes("user"))}),console.log("üõçÔ∏è Make Merch - Auth check:",{user_authenticated:g,isAuthenticated:te,isLoggedIn:ge}),!ge){const fe=X.current?X.current.currentTime||0:Le[0]??0,d={thumbnail:s,videoUrl:(b==null?void 0:b.video_url)||window.location.href,screenshots:a.slice(0,6),screenshot_timestamp:Le[0]??fe,videoTitle:(b==null?void 0:b.title)||"Unknown Video",creatorName:(b==null?void 0:b.channelTitle)||"Unknown Creator"};localStorage.setItem("pending_merch_data",JSON.stringify(d)),xe(!0);return}if(await sr.isCreator()){const fe=X.current?X.current.currentTime||0:Le[0]??0,d={thumbnail:s,videoUrl:(b==null?void 0:b.video_url)||window.location.href,screenshots:a.slice(0,6),screenshot_timestamp:Le[0]??fe,videoTitle:(b==null?void 0:b.title)||"Unknown Video",creatorName:(b==null?void 0:b.channelTitle)||"Unknown Creator"};localStorage.setItem("pending_merch_data",JSON.stringify(d)),localStorage.setItem("creator_favorites_mode","true"),window.location.href="/product/browse?category=mens&creatorMode=favorites";return}const pe=X.current?X.current.currentTime||0:Le[0]??0,Te={thumbnail:s,videoUrl:(b==null?void 0:b.video_url)||window.location.href,screenshots:a.slice(0,6),screenshot_timestamp:Le[0]??pe,videoTitle:(b==null?void 0:b.title)||"Unknown Video",creatorName:(b==null?void 0:b.channelTitle)||"Unknown Creator"};localStorage.setItem("pending_merch_data",JSON.stringify(Te)),await je()},le=()=>{if(y(!U),!U){const g=X.current;if(g){const te=g.getBoundingClientRect(),ge=te.width/2-100,ye=te.height/2-100;D({x:ge,y:ye,width:200,height:200})}}},ne=g=>{if(!U)return;const te=X.current;if(!te)return;const ge=te.getBoundingClientRect(),ye=g.clientX-ge.left,pe=g.clientY-ge.top;ye>=N.x&&ye<=N.x+N.width&&pe>=N.y&&pe<=N.y+N.height&&(p(!0),it({x:ye-N.x,y:pe-N.y}))},De=g=>{if(!U||!w&&!ee)return;const te=X.current;if(!te)return;const ge=te.getBoundingClientRect(),ye=g.clientX-ge.left,pe=g.clientY-ge.top;if(w){const Te=Math.max(0,Math.min(ge.width-N.width,ye-Oe.x)),fe=Math.max(0,Math.min(ge.height-N.height,pe-Oe.y));D(d=>({...d,x:Te,y:fe}))}else if(ee){let Te=N.width,fe=N.height,d=N.x,j=N.y;if(we.includes("right")&&(Te=Math.max(50,ye-N.x)),we.includes("left")){const C=N.x+N.width-50;d=Math.min(C,ye),Te=N.x+N.width-d}if(we.includes("bottom")&&(fe=Math.max(50,pe-N.y)),we.includes("top")){const C=N.y+N.height-50;j=Math.min(C,pe),fe=N.y+N.height-j}D({x:d,y:j,width:Te,height:fe})}},K=()=>{p(!1),ie(!1),Ce(null)},re=g=>{if(!U)return;g.preventDefault(),g.stopPropagation();const te=X.current;if(!te)return;const ge=g.touches[0],ye=te.getBoundingClientRect(),pe=ge.clientX-ye.left,Te=ge.clientY-ye.top;pe>=N.x&&pe<=N.x+N.width&&Te>=N.y&&Te<=N.y+N.height&&(p(!0),it({x:pe-N.x,y:Te-N.y}))},Ae=g=>{if(!U||!w&&!ee)return;g.preventDefault(),g.stopPropagation();const te=X.current;if(!te)return;const ge=g.touches[0],ye=te.getBoundingClientRect(),pe=ge.clientX-ye.left,Te=ge.clientY-ye.top;if(w){const fe=Math.max(0,Math.min(ye.width-N.width,pe-Oe.x)),d=Math.max(0,Math.min(ye.height-N.height,Te-Oe.y));D(j=>({...j,x:fe,y:d}))}else if(ee){let fe=N.width,d=N.height,j=N.x,C=N.y;if(we.includes("right")&&(fe=Math.max(50,pe-N.x)),we.includes("left")){const Q=N.x+N.width-50;j=Math.min(Q,pe),fe=N.x+N.width-j}if(we.includes("bottom")&&(d=Math.max(50,Te-N.y)),we.includes("top")){const Q=N.y+N.height-50;C=Math.min(Q,Te),d=N.y+N.height-C}D({x:j,y:C,width:fe,height:d})}},q=g=>{g&&(g.preventDefault(),g.stopPropagation()),p(!1),ie(!1),Ce(null)},Z=(g,te)=>{te.stopPropagation(),te.preventDefault(),ie(!0),Ce(g)},he=(g,te)=>{te.stopPropagation(),te.preventDefault(),ie(!0),Ce(g)},F=g=>{if(!ee)return;g.preventDefault(),g.stopPropagation();const te=X.current;if(!te)return;const ge=g.touches[0],ye=te.getBoundingClientRect(),pe=ge.clientX-ye.left,Te=ge.clientY-ye.top;let fe=N.width,d=N.height,j=N.x,C=N.y;if(we.includes("right")&&(fe=Math.max(50,pe-N.x)),we.includes("left")){const Q=N.x+N.width-50;j=Math.min(Q,pe),fe=N.x+N.width-j}if(we.includes("bottom")&&(d=Math.max(50,Te-N.y)),we.includes("top")){const Q=N.y+N.height-50;C=Math.min(Q,Te),d=N.y+N.height-C}D({x:j,y:C,width:fe,height:d})},L=g=>{g&&(g.preventDefault(),g.stopPropagation()),ie(!1),Ce(null)},H=async()=>{if(!U)return;const g=X.current;if(g)try{let te=null,ge=!1;if(b!=null&&b.video_url)try{const fe=g.currentTime||0,d=b.video_url;console.log(`Requesting server-side screenshot at ${fe}s from ${d}`);const j=await fetch(ze.ENDPOINTS.CAPTURE_PRINT_QUALITY,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({video_url:d,timestamp:fe,print_dpi:300})});if(j.ok){const C=await j.json();C.success&&C.screenshot?(te=C.screenshot,ge=!0,console.log("Server screenshot captured successfully")):console.warn("Server returned unsuccessful result:",C.error||"Unknown error")}else{const C=await j.text();console.warn(`Server error ${j.status}: ${C}`)}}catch(fe){console.warn("Server screenshot capture failed, using fallback:",fe)}if(!te){console.log("Using client-side screenshot capture as fallback");const fe=document.createElement("canvas"),d=fe.getContext("2d"),j=g.videoWidth||g.clientWidth,C=g.videoHeight||g.clientHeight;fe.width=j,fe.height=C,d.drawImage(g,0,0,j,C),te=fe.toDataURL("image/png"),ge=!1}const ye=document.createElement("canvas"),pe=ye.getContext("2d"),Te=new Image;Te.onload=()=>{try{const fe=g.getBoundingClientRect(),d=fe.width,j=fe.height,C=Te.width/d,Q=Te.height/j,ce=Math.round(N.x*C),Ue=Math.round(N.y*Q),_e=Math.round(N.width*C),Ne=Math.round(N.height*Q),He=Math.max(0,Math.min(Te.width-_e,ce)),Fe=Math.max(0,Math.min(Te.height-Ne,Ue)),Ke=Math.min(_e,Te.width-He),Je=Math.min(Ne,Te.height-Fe);ye.width=Ke,ye.height=Je,pe.clearRect(0,0,ye.width,ye.height),pe.drawImage(Te,He,Fe,Ke,Je,0,0,Ke,Je);const Ze=ye.toDataURL("image/jpeg",.9);i(pt=>pt.length<6?[...pt,Ze]:pt),y(!1)}catch(fe){console.error("Error cropping screenshot:",fe),alert("Failed to crop image. Please try again.")}},Te.onerror=()=>{console.error("Failed to load screenshot for cropping"),alert("Failed to load screenshot for cropping. Please try again.")},Te.src=te}catch(te){console.error("Error applying crop:",te),console.error("Error details:",{videoElement:!!g,videoReadyState:g==null?void 0:g.readyState,cropArea:N,errorMessage:te.message}),alert(`Failed to crop image: ${te.message||"Unknown error"}. Please try again.`)}},ue=()=>{y(!1),p(!1),ie(!1),Ce(null)},je=async()=>{try{const g={thumbnail:s,videoUrl:(b==null?void 0:b.video_url)||window.location.href,screenshots:a.slice(0,6),screenshot_timestamp:Le[0]||0,videoTitle:(b==null?void 0:b.title)||"Unknown Video",creatorName:(b==null?void 0:b.channelTitle)||"Unknown Creator"},te=await fetch(ze.ENDPOINTS.CREATE_PRODUCT,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(g)});if(!te.ok){const ye=await te.text();throw console.error("Server error response:",ye),new Error(`Server error: ${te.status} - ${ye}`)}const ge=await te.json();ge.success?h?setTimeout(()=>{window.location.href="/merchandise"},1e3):window.location.href="/merchandise":(console.error("Failed to create product:",ge),alert(`Failed to create merch product page: ${ge.error||"Unknown error"}`))}catch(g){console.error("Make Merch error:",g),alert(`Error connecting to merch server: ${g.message}. Please check the console for more details.`)}},Me=()=>{xe(!1),setTimeout(()=>{je()},1e3)},We=c.useCallback(g=>{},[]);return T?e.jsxs("div",{style:{padding:24,textAlign:"center",background:"#f8f9fa",borderRadius:"8px",border:"1px solid #dee2e6"},children:[e.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #007bff",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 16px auto"}}),e.jsx("p",{children:"Loading video..."}),b&&e.jsxs("p",{style:{fontSize:"14px",color:"#6c757d"},children:["URL: ",b.video_url]})]}):A||!b?e.jsxs("div",{style:{padding:24,color:"red",background:"#f8d7da",borderRadius:"8px",border:"1px solid #f5c6cb"},children:[e.jsx("h3",{children:"Video Error"}),e.jsx("p",{children:A||"Video not found."}),b&&e.jsxs("div",{style:{marginTop:"12px",fontSize:"14px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Video URL:"})," ",b.video_url]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Video ID:"})," ",M]})]})]}):e.jsxs("div",{className:`play-video ${U?"crop-mode-active":""}`,children:[e.jsx("div",{className:"video-container",ref:Y,style:{position:"relative",display:"inline-block",marginBottom:h?"0px":"15px"},children:e.jsxs("div",{style:{position:"relative",display:"inline-block",width:"100%",maxWidth:"100%"},children:[e.jsx("video",{ref:X,controls:!0,controlsList:"nodownload",poster:b.thumbnail||"",width:"100%",height:h?"320":"360",style:{background:"#000",width:"100%",height:h?"320px":"360px",outline:"none"},src:b.video_url,crossOrigin:"anonymous",playsInline:!0,"webkit-playsinline":"true","x-webkit-airplay":"allow",preload:h?"auto":"metadata",disablePictureInPicture:!0,onCanPlay:()=>{S(!1),setIsBuffering(!1)},onCanPlayThrough:()=>{setIsBuffering(!1),S(!1)},onLoadedData:()=>{S(!1),V(null)},onWaiting:()=>{setIsBuffering(!0)},onStalled:()=>{setIsBuffering(!0)},onProgress:()=>{if(X.current){const g=X.current;if(g.buffered.length>0){const te=g.buffered.end(g.buffered.length-1),ge=g.currentTime;te-ge>3&&setIsBuffering(!1)}}},onPlaying:()=>{setIsBuffering(!1)},onError:g=>{const ge=g.target.error;let ye="Video failed to load.";if(ge)switch(ge.code){case 1:ye="Video loading was aborted.";break;case 2:ye="Network error while loading video. Please check your connection.";break;case 3:ye="Video format not supported or file is corrupted.";break;case 4:ye="Video format not supported or URL is invalid.";break;default:ye=`Video error (code: ${ge.code}). The video file may be corrupted or the URL is invalid.`}console.error("Video playback error:",{code:ge==null?void 0:ge.code,message:ye,videoUrl:b==null?void 0:b.video_url,videoId:M}),V(ye),S(!1)},onPlay:()=>{$||(se(!0),typeof m=="function"&&m())}},M),!$&&!z&&b&&e.jsxs("div",{onClick:async()=>{if(X.current)try{await X.current.play(),$||(se(!0),typeof m=="function"&&m())}catch(g){console.error("Error playing video:",g)}},style:{position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%",zIndex:50,cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"auto",background:"rgba(0, 0, 0, 0.4)",borderRadius:"12px"},children:[e.jsx("div",{className:"play-icon-overlay",style:{background:_!=null&&_.primary_color&&(_!=null&&_.secondary_color)?`linear-gradient(135deg, ${_.primary_color} 0%, ${_.secondary_color} 100%)`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"50%",width:h?"120px":"150px",height:h?"120px":"150px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 12px 40px rgba(102, 126, 234, 0.6), 0 0 0 0 rgba(102, 126, 234, 0.7)",animation:"pulsePlayIcon 2s infinite",border:"6px solid rgba(255, 255, 255, 0.95)",transition:"all 0.3s ease"},children:e.jsx("span",{style:{fontSize:h?"60px":"80px",color:"white",marginLeft:"8px",textShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",lineHeight:"1"},children:"‚ñ∂"})}),e.jsx("p",{style:{marginTop:"30px",color:"white",fontSize:h?"20px":"24px",fontWeight:"700",textShadow:"0 4px 12px rgba(0, 0, 0, 0.9)",textAlign:"center",letterSpacing:"0.5px"},children:"‚ñ∂Ô∏è Play Video"})]}),z&&e.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(220, 53, 69, 0.95)",color:"white",padding:"16px 24px",borderRadius:"8px",zIndex:100,maxWidth:"90%",textAlign:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[e.jsx("h4",{style:{margin:"0 0 8px 0",fontSize:"16px"},children:"‚ö†Ô∏è Video Playback Error"}),e.jsx("p",{style:{margin:"0",fontSize:"14px"},children:z}),(b==null?void 0:b.video_url)&&e.jsxs("p",{style:{margin:"8px 0 0 0",fontSize:"12px",opacity:.9},children:["URL: ",b.video_url.length>50?b.video_url.substring(0,50)+"...":b.video_url]})]}),e.jsxs("button",{onClick:le,type:"button",style:{position:"absolute",top:"10px",left:"10px",background:"rgba(255, 255, 255, 0.95)",border:"2px solid #764ba2",borderRadius:"6px",width:h?"47px":"53px",height:h?"47px":"53px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)",overflow:"hidden",outline:"none",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",borderStyle:"solid",padding:"4px"},onFocus:g=>{g.target.style.outline="none",g.target.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.3)",g.target.style.transform="none",g.target.style.background="rgba(255, 255, 255, 0.95)",g.target.style.border="2px solid #764ba2"},onBlur:g=>{g.target.style.outline="none",g.target.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.3)",g.target.style.transform="none",g.target.style.background="rgba(255, 255, 255, 0.95)",g.target.style.border="2px solid #764ba2"},onMouseDown:g=>{g.preventDefault(),g.target.style.outline="none",g.target.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.3)",g.target.style.transform="none",g.target.style.background="rgba(255, 255, 255, 0.95)",g.target.style.border="2px solid #764ba2"},onMouseUp:g=>{g.target.style.outline="none",g.target.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.3)",g.target.style.transform="none",g.target.style.background="rgba(255, 255, 255, 0.95)",g.target.style.border="2px solid #764ba2"},onMouseEnter:g=>{g.target.style.background="rgba(255, 255, 255, 0.95)",g.target.style.transform="none",g.target.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.3)",g.target.style.border="2px solid #764ba2"},onMouseLeave:g=>{g.target.style.background="rgba(255, 255, 255, 0.95)",g.target.style.transform="none",g.target.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.3)",g.target.style.border="2px solid #764ba2"},onTouchStart:g=>{g.target.style.outline="none",g.target.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.3)",g.target.style.transform="none",g.target.style.background="rgba(255, 255, 255, 0.95)",g.target.style.border="2px solid #764ba2"},onTouchEnd:g=>{g.target.style.outline="none",g.target.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.3)",g.target.style.transform="none",g.target.style.background="rgba(255, 255, 255, 0.95)",g.target.style.border="2px solid #764ba2"},onContextMenu:g=>g.preventDefault(),title:U?"Exit Crop Mode":"Crop Screenshot",children:[e.jsx("svg",{width:h?"20":"22",height:h?"20":"22",viewBox:"0 0 24 24",fill:"none",stroke:"#764ba2",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{position:"absolute",top:"8px",left:"50%",transform:"translateX(-50%)",zIndex:2},children:e.jsx("path",{d:"M6 2v4h4M18 2v4h-4M6 22v-4h4M18 22v-4h-4M2 6h4v4M22 6h-4v4M2 18h4v-4M22 18h-4v-4"})}),e.jsx("span",{style:{position:"absolute",bottom:"6px",left:"50%",transform:"translateX(-50%)",fontSize:h?"8px":"9px",fontWeight:"700",color:"#764ba2",zIndex:2,whiteSpace:"nowrap",lineHeight:"1"},children:"Crop Tool"})]}),U&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:5,cursor:w?"move":"default"},onMouseDown:ne,onMouseMove:De,onMouseUp:K,onMouseLeave:K,onTouchStart:re,onTouchMove:Ae,onTouchEnd:q,children:[e.jsxs("div",{className:"crop-area",style:{position:"absolute",left:N.x,top:N.y,width:N.width,height:N.height,border:"2px dashed #007bff",backgroundColor:"rgba(0, 123, 255, 0.1)",cursor:w?"move":"default"},children:[e.jsx("div",{className:"resize-handle",style:{position:"absolute",top:h?-10:-5,left:h?-10:-5,width:h?20:10,height:h?20:10,backgroundColor:"#007bff",borderRadius:"50%",cursor:"nw-resize",border:h?"2px solid white":"none",boxShadow:h?"0 2px 4px rgba(0,0,0,0.3)":"none",zIndex:10},onMouseDown:g=>Z("top-left",g),onTouchStart:g=>he("top-left",g),onTouchMove:F,onTouchEnd:L}),e.jsx("div",{className:"resize-handle",style:{position:"absolute",top:h?-10:-5,right:h?-10:-5,width:h?20:10,height:h?20:10,backgroundColor:"#007bff",borderRadius:"50%",cursor:"ne-resize",border:h?"2px solid white":"none",boxShadow:h?"0 2px 4px rgba(0,0,0,0.3)":"none",zIndex:10},onMouseDown:g=>Z("top-right",g),onTouchStart:g=>he("top-right",g),onTouchMove:F,onTouchEnd:L}),e.jsx("div",{className:"resize-handle",style:{position:"absolute",bottom:h?-10:-5,left:h?-10:-5,width:h?20:10,height:h?20:10,backgroundColor:"#007bff",borderRadius:"50%",cursor:"sw-resize",border:h?"2px solid white":"none",boxShadow:h?"0 2px 4px rgba(0,0,0,0.3)":"none",zIndex:10},onMouseDown:g=>Z("bottom-left",g),onTouchStart:g=>he("bottom-left",g),onTouchMove:F,onTouchEnd:L}),e.jsx("div",{className:"resize-handle",style:{position:"absolute",bottom:h?-10:-5,right:h?-10:-5,width:h?20:10,height:h?20:10,backgroundColor:"#007bff",borderRadius:"50%",cursor:"se-resize",border:h?"2px solid white":"none",boxShadow:h?"0 2px 4px rgba(0,0,0,0.3)":"none",zIndex:10},onMouseDown:g=>Z("bottom-right",g),onTouchStart:g=>he("bottom-right",g),onTouchMove:F,onTouchEnd:L})]}),e.jsxs("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",display:"flex",gap:"10px",zIndex:6},children:[e.jsx("button",{onClick:ue,onTouchStart:g=>g.stopPropagation(),onTouchEnd:g=>g.stopPropagation(),style:{padding:h?"12px 20px":"8px 16px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:h?"16px":"14px",minHeight:h?"44px":"auto",minWidth:h?"80px":"auto",touchAction:"manipulation",zIndex:20},children:"Cancel"}),e.jsx("button",{onClick:H,onTouchStart:g=>g.stopPropagation(),onTouchEnd:g=>g.stopPropagation(),style:{padding:h?"12px 20px":"8px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:h?"16px":"14px",minHeight:h?"44px":"auto",minWidth:h?"80px":"auto",touchAction:"manipulation",zIndex:20},children:"Apply Crop"})]})]})]})}),e.jsxs("div",{className:"screenmerch-actions",style:{display:"flex",gap:"10px",marginBottom:"0px",marginTop:h?"5px":"0px",flexWrap:"wrap"},children:[e.jsx("button",{className:"screenmerch-btn screenshot-btn",onClick:Se,disabled:W||a.length>=6,style:{padding:"14px 24px",backgroundColor:W||a.length>=6?"#6c757d":"#dc3545",color:"white",border:"none",borderRadius:"5px",cursor:W||a.length>=6?"not-allowed":"pointer",fontWeight:"bold",opacity:W||a.length>=6?.7:1,textAlign:"center",lineHeight:"1.2",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"44px"},children:W?"Capturing...":a.length>=6?"Max Screenshots":"Select Screenshot"}),e.jsx("button",{className:"screenmerch-btn make-merch-btn",onClick:g=>{g.preventDefault(),g.stopPropagation(),f?f():ve()},style:{padding:"14px 24px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",touchAction:"manipulation",minHeight:"44px",lineHeight:"1.2",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center"},children:"Make Merch"})]}),e.jsx("h3",{style:{marginTop:"15px",marginBottom:h?"5px":"15px",fontWeight:"600",fontSize:"22px",textAlign:"center"},children:b.title}),e.jsx("div",{className:"publisher",children:e.jsx("div",{})}),e.jsx(na,{isOpen:be,onClose:()=>xe(!1),onSuccess:Me})]})},Nd=({thumbnail:t,screenshots:s,onDeleteScreenshot:r})=>e.jsx("div",{className:"screenmerch-images-grid",children:[0,1,2,3,4,5].map(a=>e.jsx("div",{className:"screenmerch-image-box",children:s[a]?e.jsxs("div",{className:"screenmerch-img-wrapper",children:[e.jsx("img",{src:s[a],alt:`Screenshot ${a+1}`,className:"screenmerch-preview",style:{maxWidth:"100%",maxHeight:"100%",width:"auto",height:"auto",objectFit:"contain"},onError:i=>console.error(`Failed to load screenshot ${a+1}:`,i.target.src),onLoad:()=>{}}),e.jsx("div",{className:"screenmerch-buttons",children:e.jsx("button",{className:"screenmerch-delete-btn",onClick:()=>r(a),title:"Delete screenshot",children:"√ó"})})]}):e.jsx("div",{className:"screenmerch-placeholder",children:"No screenshot"})},a))});const kd=({sidebar:t})=>{const{videoId:s,categoryId:r}=Cs(),[a,i]=c.useState(null),[o,n]=c.useState([]),[u,m]=c.useState(!1),[f,k]=c.useState(!1),[M,h]=c.useState(!1),[v,_]=c.useState(null),b=c.useRef(null),[x,T]=c.useState(0),[S,A]=c.useState(!1),[E,z]=c.useState(!1),[V,X]=c.useState(!1),[Y,$]=c.useState(!1),{creatorSettings:se}=Ts();c.useEffect(()=>{const U=()=>{const y=window.innerWidth<=768,N=y&&window.innerHeight>window.innerWidth;m(y),k(N)};return U(),window.addEventListener("resize",U),window.addEventListener("orientationchange",U),()=>{window.removeEventListener("resize",U),window.removeEventListener("orientationchange",U)}},[]),c.useEffect(()=>{if(s){const U=setTimeout(()=>{if(u){const y=document.querySelector(".video-container"),N=document.querySelector("nav");if(y&&N){const D=N.offsetHeight,p=y.getBoundingClientRect().top+window.scrollY-D-10;window.scrollTo({top:p,behavior:"smooth"})}else if(y){const w=y.getBoundingClientRect().top+window.scrollY-70;window.scrollTo({top:w,behavior:"smooth"})}else window.scrollTo({top:0,behavior:"smooth"})}else{const y=document.querySelector(".video-container"),N=document.querySelector("nav");if(y&&N){const D=N.offsetHeight,p=y.getBoundingClientRect().top+window.scrollY-D;window.scrollTo({top:p,behavior:"smooth"})}else if(y){const w=y.getBoundingClientRect().top+window.scrollY-80;window.scrollTo({top:w,behavior:"smooth"})}else window.scrollTo({top:0,behavior:"smooth"})}},500);return()=>clearTimeout(U)}},[u,s]),c.useEffect(()=>{a&&o.length===0&&n([a])},[a,o.length]),c.useEffect(()=>{T(o.length),Y||o.length>1?(z(!1),X(!0)):S?(z(!0),X(!1)):(z(!1),X(!1))},[o,Y,S]),c.useEffect(()=>{s&&a&&(n([a]),$(!1),A(!1),z(!1))},[s,a]);const be=()=>{console.log("Video played - activating step 2 red pulse"),A(!0),z(!0),X(!1)};c.useEffect(()=>{S&&!Y&&o.length<=1&&(z(!0),X(!1))},[S,Y,o.length]);const xe=U=>{n(y=>y.filter((N,D)=>D!==U))},ae=(U,y)=>{n(N=>{const D=[...N];return D[U]=y,D})},W=async()=>{console.log("Step 2 clicked - attempting screenshot capture");const U=o.length,y=document.querySelector(".screenmerch-btn");y&&y.textContent.includes("Select Screenshot")?(console.log("Clicking working screenshot button..."),y.click(),$(!0),console.log("Screenshot function completed"),setTimeout(()=>{o.length>U&&console.log("Screenshot successfully added, switching pulse states")},500)):console.log("Screenshot button not found or not ready yet")},O=async()=>{const U=localStorage.getItem("user_authenticated"),y=localStorage.getItem("isAuthenticated"),N=U==="true"||y==="true";console.log("üõçÔ∏è Make Merch - Auth check:",{user_authenticated:U,isAuthenticated:y,isLoggedIn:N});try{const w={thumbnail:a,videoUrl:window.location.href,screenshots:o.slice(0,6),screenshot_timestamp:0,videoTitle:(v==null?void 0:v.title)||"Unknown Video",creatorName:(v==null?void 0:v.channelTitle)||"Unknown Creator"};localStorage.setItem("pending_merch_data",JSON.stringify(w))}catch(w){console.warn("Failed saving pending_merch_data:",w)}if(!N){h(!0);return}if(await sr.isCreator()){localStorage.setItem("creator_favorites_mode","true"),window.location.href="/product/browse?category=mens&creatorMode=favorites";return}await de()},de=async()=>{try{const U=localStorage.getItem("user_authenticated"),y=localStorage.getItem("user_email"),N=window.location.href,D=(v==null?void 0:v.title)||"Unknown Video",w=(v==null?void 0:v.channelTitle)||"Unknown Creator",p={thumbnail:a,videoUrl:N,videoTitle:D,creatorName:w,screenshots:o.slice(0,6),isAuthenticated:U==="true",userEmail:y||""},ee=await fetch(ze.ENDPOINTS.CREATE_PRODUCT,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(p)});if(!ee.ok){const we=await ee.text();throw console.error("Server error response:",we),new Error(`Server error: ${ee.status} - ${we}`)}const ie=await ee.json();if(ie.success&&ie.product_url)if(window.innerWidth<=768)try{window.location.href=ie.product_url}catch{const Ce=document.createElement("div");Ce.style.cssText=`
             position: fixed;
             top: 20px;
             right: 20px;
             background: #4CAF50;
             color: white;
             padding: 12px 20px;
             border-radius: 8px;
             box-shadow: 0 4px 12px rgba(0,0,0,0.15);
             z-index: 10000;
             animation: slideIn 0.3s ease-out;
             max-width: 300px;
             font-size: 14px;
             font-weight: 500;
           `,Ce.textContent=`Your merch page is ready! Please visit: ${ie.product_url}`,document.body.appendChild(Ce),setTimeout(()=>document.body.removeChild(Ce),5e3)}else window.open(ie.product_url,"_blank");else{console.error("Failed to create product:",ie);const we=document.createElement("div");we.style.cssText=`
           position: fixed;
           top: 20px;
           right: 20px;
           background: #f44336;
           color: white;
           padding: 12px 20px;
           border-radius: 8px;
           box-shadow: 0 4px 12px rgba(0,0,0,0.15);
           z-index: 10000;
           animation: slideIn 0.3s ease-out;
           max-width: 300px;
           font-size: 14px;
           font-weight: 500;
         `,we.textContent=`Failed to create merch product page: ${ie.error||"Unknown error"}`,document.body.appendChild(we),setTimeout(()=>document.body.removeChild(we),5e3)}}catch(U){console.error("Make Merch error:",U);const y=document.createElement("div");y.style.cssText=`
         position: fixed;
         top: 20px;
         right: 20px;
         background: #f44336;
         color: white;
         padding: 12px 20px;
         border-radius: 8px;
         box-shadow: 0 4px 12px rgba(0,0,0,0.15);
         z-index: 10000;
         animation: slideIn 0.3s ease-out;
         max-width: 300px;
         font-size: 14px;
         font-weight: 500;
       `,y.textContent=`Error connecting to merch server: ${U.message}`,document.body.appendChild(y),setTimeout(()=>document.body.removeChild(y),5e3)}},G=()=>{O()};return e.jsxs("div",{className:"video-page-container",children:[e.jsx("div",{className:"user-flow-section",style:se!=null&&se.primary_color&&(se!=null&&se.secondary_color)?{background:`linear-gradient(135deg, ${se.primary_color} 0%, ${se.secondary_color} 100%)`}:void 0,children:e.jsxs("div",{className:"flow-steps",children:[e.jsxs("div",{className:"flow-step clickable-step",onClick:W,style:{cursor:"pointer",userSelect:"none",WebkitTapHighlightColor:"transparent"},children:[e.jsx("div",{className:`step-number ${E?"pulse step-red":""}`,children:"2"}),e.jsxs("div",{className:"step-content",children:[e.jsx("h3",{children:"Select Screenshot"}),e.jsx("p",{children:"Select the perfect screenshot to capture"})]})]}),e.jsx("div",{className:"flow-arrow",children:"‚Üí"}),e.jsxs("div",{className:"flow-step",onClick:G,style:{cursor:"pointer",userSelect:"none",WebkitTapHighlightColor:"transparent"},children:[e.jsx("div",{className:`step-number ${V?"pulse step-green":""}`,children:"3"}),e.jsxs("div",{className:"step-content",children:[e.jsx("h3",{children:"Make Merchandise"}),e.jsx("p",{children:"Create custom products with your screenshot"})]})]})]})}),e.jsxs("div",{className:"main-container",children:[e.jsx("div",{className:"video-viewer",children:s?e.jsx(Sd,{videoId:s,thumbnail:a,setThumbnail:i,screenshots:o,setScreenshots:n,videoRef:b,onVideoData:_,onVideoPlayed:be,onMakeMerch:O}):e.jsx("div",{style:{padding:24,color:"red"},children:"No video selected."})}),e.jsxs("div",{className:"screenshots-section",id:"screenshotsSection",style:{position:"relative"},children:[u&&s&&e.jsx("div",{id:"screenshotCounter",style:{position:"absolute",top:"10px",right:"10px",background:x>=6?"#ff4444":"#fff",border:`2px solid ${x>=6?"#ff4444":"#ddd"}`,borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"16px",color:x>=6?"#fff":"#333",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",zIndex:100},children:x}),e.jsx(Nd,{thumbnail:a,screenshots:o,onDeleteScreenshot:xe,onCropScreenshot:ae})]})]}),e.jsx(na,{isOpen:M,onClose:()=>h(!1),onSuccess:de})]})};const Cd=({sidebar:t})=>{var se,be,xe;const[s,r]=c.useState(null),[a,i]=c.useState(null),[o,n]=c.useState(!0),u=ct(),[m,f]=c.useState(""),[k,M]=c.useState(""),[h,v]=c.useState(null),[_,b]=c.useState(null),[x,T]=c.useState(!1),[S,A]=c.useState(""),[E,z]=c.useState(0);c.useEffect(()=>{(async()=>{var W,O,de;try{const G=localStorage.getItem("isAuthenticated"),U=localStorage.getItem("user");let y=null;if(G==="true"&&U)y=JSON.parse(U),console.log("üîê Upload: Found Google OAuth user:",y);else{const{data:{user:w}}=await R.auth.getUser();w&&(y=w,console.log("üîê Upload: Found Supabase user:",y))}if(!y){console.log("üîê Upload: No authenticated user found"),A("‚ùå Please log in to upload videos"),n(!1);return}r(y);const{data:N,error:D}=await R.from("users").select("*").eq("id",y.id).single();if(N)i(N);else if(D&&D.code==="PGRST116"){const{data:w,error:p}=await R.from("users").upsert({id:y.id,email:y.email,username:((W=y.email)==null?void 0:W.split("@")[0])||"user",display_name:((O=y.user_metadata)==null?void 0:O.name)||((de=y.email)==null?void 0:de.split("@")[0])||"User",role:"creator",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{onConflict:"id",ignoreDuplicates:!1}).select().single();if(p&&p.message.includes("duplicate key")){console.log("Duplicate key detected, fetching existing user");const{data:ee,error:ie}=await R.from("users").select("*").eq("id",y.id).single();ee&&i(ee)}else w&&i(w)}}catch(G){console.error("Error fetching user:",G),A("‚ùå Authentication error. Please log in again.")}finally{n(!1)}})()},[]);const V=(ae,W)=>{if(!ae)return"No file selected";if(W==="video"){if(!ae.type.startsWith("video/"))return"Please select a valid video file";if(ae.size>100*1024*1024)return"Video file size must be less than 100MB"}else if(W==="image"){if(!ae.type.startsWith("image/"))return"Please select a valid image file";if(ae.size>10*1024*1024)return"Image file size must be less than 10MB"}return null},X=ae=>{const W=ae.target.files[0],O=V(W,"video");O?(A(`‚ùå ${O}`),v(null)):(v(W),A(""))},Y=ae=>{const W=ae.target.files[0],O=V(W,"image");O?(A(`‚ùå ${O}`),b(null)):(b(W),A(""))},$=async ae=>{var W,O,de;if(ae.preventDefault(),A(""),z(0),!m.trim()){A("‚ùå Please enter a video title");return}if(!k.trim()){A("‚ùå Please enter a video description");return}if(!h){A("‚ùå Please select a video file");return}if(!_){A("‚ùå Please select a thumbnail image");return}if(!s||!s.id){A("‚ùå Please log in to upload videos");return}T(!0);try{console.log("Starting upload process..."),console.log("User ID:",s.id);const G=await fetch("https://screenmerch.fly.dev/api/users/ensure-exists",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:s.id,email:s.email,display_name:(a==null?void 0:a.display_name)||((W=s.user_metadata)==null?void 0:W.name)})});if(!G.ok)throw new Error("Failed to ensure user exists in database");const U=await G.json();console.log("User ensured:",U),z(10);const y=h.name.split(".").pop(),N=`${s.id}/${Date.now()}.${y}`;console.log("Uploading video to:",N);const{error:D,data:w}=await R.storage.from("videos2").upload(N,h,{cacheControl:"3600",upsert:!1});if(D)throw console.error("Video upload error:",D),new Error(`Video upload failed: ${D.message}`);z(50);const{data:p}=R.storage.from("videos2").getPublicUrl(N);console.log("Video uploaded successfully:",p.publicUrl),z(60);const ee=_.name.split(".").pop(),ie=`${s.id}/${Date.now()}_thumb.${ee}`;console.log("Uploading thumbnail to:",ie);const{error:we,data:Ce}=await R.storage.from("thumbnails").upload(ie,_,{cacheControl:"3600",upsert:!1});if(we)throw console.error("Thumbnail upload error:",we),new Error(`Thumbnail upload failed: ${we.message}`);z(80);const{data:Oe}=R.storage.from("thumbnails").getPublicUrl(ie);console.log("Thumbnail uploaded successfully:",Oe.publicUrl),z(90),console.log("Inserting video metadata into database...");const it={title:m.trim(),description:k.trim(),video_url:p.publicUrl,thumbnail:Oe.publicUrl,channelTitle:(a==null?void 0:a.display_name)||((O=s.user_metadata)==null?void 0:O.name)||((de=s.email)==null?void 0:de.split("@")[0])||"Unknown Creator",user_id:s.id,verification_status:"verified_via_supabase_auth",created_at:new Date().toISOString()};console.log("Video metadata:",it);const{error:Le,data:Ye}=await R.from("videos2").insert([it]).select();if(Le)throw console.error("Database insert error:",Le),new Error(`Database error: ${Le.message}`);z(100),console.log("Video uploaded and saved successfully:",Ye),A("‚úÖ Video uploaded successfully! Redirecting you to the homepage..."),f(""),M(""),v(null),b(null),setTimeout(()=>{u("/")},2e3)}catch(G){if(console.error("Upload error:",G),A(`‚ùå Upload failed: ${G.message}`),G.message.includes("Database error")&&h)try{const U=h.name.split(".").pop(),y=`${s.id}/${Date.now()}.${U}`;await R.storage.from("videos2").remove([y]),console.log("Cleaned up uploaded video file")}catch(U){console.error("Failed to cleanup video file:",U)}}finally{T(!1),z(0)}};return o?e.jsx("div",{className:`container ${t?"":" large-container"}`,children:e.jsx("h2",{children:"Loading..."})}):s?e.jsx("div",{className:`container ${t?"":" large-container"}`,children:e.jsxs("div",{style:{maxWidth:700,margin:"20px auto",background:"#fff",padding:24,borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h2",{children:"Upload a New Video"}),e.jsxs("div",{className:"uploader-info",children:[e.jsx("img",{src:(a==null?void 0:a.profile_image_url)||((se=s.user_metadata)==null?void 0:se.picture)||"/default-avatar.jpg",alt:"Your avatar"}),e.jsxs("p",{children:["You are uploading as: ",e.jsx("strong",{children:(a==null?void 0:a.display_name)||((be=s.user_metadata)==null?void 0:be.name)||((xe=s.email)==null?void 0:xe.split("@")[0])||"Your Channel"})]})]}),e.jsxs("form",{onSubmit:$,children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{children:"Title *"}),e.jsx("input",{type:"text",value:m,onChange:ae=>f(ae.target.value),required:!0,style:{width:"100%",padding:8,marginTop:4},placeholder:"Enter video title"})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{children:"Description *"}),e.jsx("textarea",{value:k,onChange:ae=>M(ae.target.value),required:!0,style:{width:"100%",padding:8,marginTop:4},rows:4,placeholder:"Enter video description"})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{children:"Video File * (Max 100MB)"}),e.jsx("input",{type:"file",accept:"video/*",onChange:X,required:!0,style:{display:"block",marginTop:4}}),h&&e.jsxs("small",{style:{color:"#666",marginTop:4,display:"block"},children:["Selected: ",h.name," (",(h.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{children:"Thumbnail Image * (Max 10MB)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:Y,required:!0,style:{display:"block",marginTop:4}}),_&&e.jsxs("small",{style:{color:"#666",marginTop:4,display:"block"},children:["Selected: ",_.name," (",(_.size/1024/1024).toFixed(2)," MB)"]})]}),E>0&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{width:"100%",backgroundColor:"#f0f0f0",borderRadius:4,overflow:"hidden",marginTop:8},children:e.jsx("div",{style:{width:`${E}%`,height:20,backgroundColor:"#4CAF50",transition:"width 0.3s ease"}})}),e.jsxs("small",{style:{color:"#666"},children:["Upload Progress: ",E,"%"]})]}),S&&e.jsx("div",{className:`upload-message ${S.includes("‚úÖ")?"success":"error"}`,children:S}),e.jsx("button",{type:"submit",className:"upload-btn",disabled:x,children:x?"Uploading...":"Upload Video"})]})]})}):e.jsxs("div",{className:`container ${t?"":" large-container"}`,style:{textAlign:"center",paddingTop:"5rem"},children:[e.jsx("h2",{children:"Please Log In to Upload"}),e.jsx("p",{children:"You must sign in with Google to upload videos."}),e.jsx("button",{className:"sign-in-btn",onClick:async()=>{const W=`${window.location.origin==="https://screenmerch.com"||window.location.origin==="https://www.screenmerch.com"?"":"https://screenmerch.fly.dev"}/api/auth/google/login?return_url=${encodeURIComponent(window.location.href)}&format=json`;try{const de=await(await fetch(W,{credentials:"include",headers:{Accept:"application/json"}})).json().catch(()=>({}));if(de.auth_url){window.location.href=de.auth_url;return}}catch{}window.location.href=W.replace("&format=json","")},children:"Sign In with Google"})]})};const Pd=({sidebar:t})=>{const{username:s}=Cs(),r=ct(),[a,i]=c.useState(null),[o,n]=c.useState([]),[u,m]=c.useState([]),[f,k]=c.useState("videos"),[M,h]=c.useState(!0),[v,_]=c.useState(null),[b,x]=c.useState(null);c.useEffect(()=>{s&&(async()=>{h(!0),_(null);const{data:A,error:E}=await R.from("users").select("*").eq("username",s).single();if(E||!A){_("User not found"),h(!1);return}i(A);const z=A.display_name||A.username;console.log("Fetching content for channel:",z,{display_name:A.display_name,username:A.username});const{data:V}=await R.from("videos2").select("*").eq("channelTitle",z).order("created_at",{ascending:!1});n(V||[]),console.log("Fetched videos:",(V==null?void 0:V.length)||0,"items");const{data:X,error:Y}=await R.from("creator_favorites").select("*").eq("user_id",A.id).order("created_at",{ascending:!1});if(Y){console.error("Error fetching favorites:",Y);const{data:$}=await R.from("creator_favorites").select("*").eq("channelTitle",z).order("created_at",{ascending:!1});console.log("Fallback query result (by channelTitle):",($==null?void 0:$.length)||0,"items"),m($||[])}else console.log("Fetched favorites:",(X==null?void 0:X.length)||0,"items"),m(X||[]);h(!1)})()},[s]),c.useEffect(()=>{(async()=>{const{data:{user:A}}=await R.auth.getUser();if(A){const{data:E}=await R.from("users").select("role").eq("id",A.id).single();x({...A,...E})}else x(null)})()},[]);const T=async S=>{const A=localStorage.getItem("user_authenticated"),E=localStorage.getItem("isAuthenticated");if(!(A==="true"||E==="true")){const X={thumbnail:S.image_url||S.thumbnail_url,screenshots:[S.image_url||S.thumbnail_url],videoUrl:window.location.href,videoTitle:S.title||"Favorite Image",creatorName:S.channeltitle||S.channelTitle||(a==null?void 0:a.display_name)||(a==null?void 0:a.username)||"Unknown Creator"};localStorage.setItem("pending_merch_data",JSON.stringify(X)),alert("Please log in to create merchandise");return}const V={thumbnail:S.image_url||S.thumbnail_url,screenshots:[S.image_url||S.thumbnail_url],videoUrl:window.location.href,videoTitle:S.title||"Favorite Image",creatorName:S.channelTitle||(a==null?void 0:a.display_name)||(a==null?void 0:a.username)||"Unknown Creator"};localStorage.setItem("pending_merch_data",JSON.stringify(V));try{const X={thumbnail:S.image_url||S.thumbnail_url,videoUrl:window.location.href,screenshots:[S.image_url||S.thumbnail_url],screenshot_timestamp:0,videoTitle:S.title||"Favorite Image",creatorName:S.channeltitle||S.channelTitle||(a==null?void 0:a.display_name)||(a==null?void 0:a.username)||"Unknown Creator"},Y=await fetch(ze.ENDPOINTS.CREATE_PRODUCT,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(X)});if(!Y.ok){const se=await Y.text();throw console.error("Server error response:",se),new Error(`Server error: ${Y.status} - ${se}`)}const $=await Y.json();$.success?window.location.href="/merchandise":(console.error("Failed to create product:",$),alert(`Failed to create merch product page: ${$.error||"Unknown error"}`))}catch(X){console.error("Make Merch error:",X),alert(`Error connecting to merch server: ${X.message}. Please check the console for more details.`)}};return b&&b.role!=="creator"?e.jsx(Yi,{to:"/",replace:!0}):M?e.jsx("div",{className:"profile-page",children:e.jsx("div",{children:"Loading profile..."})}):v?e.jsx("div",{className:"profile-page",children:e.jsx("div",{children:v})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`channel-header ${t?"":"large-container"}`,children:e.jsxs("div",{className:"channel-cover-container",children:[e.jsx("div",{className:"cover-image-container",children:e.jsx("img",{className:"channel-cover-photo",src:a.cover_image_url||"https://images.unsplash.com/photo-1557683316-973673baf926?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80",alt:"Channel Cover"})}),e.jsxs("div",{className:"channel-info-overlay",children:[e.jsx("div",{className:"channel-avatar-container",children:e.jsx("img",{className:"channel-avatar",src:a.profile_image_url||"/default-avatar.jpg",alt:"Channel Avatar"})}),e.jsxs("div",{className:"channel-details",children:[e.jsx("h1",{className:"channel-name",children:a.display_name||a.username}),e.jsxs("p",{className:"channel-username",children:["@",a.username]}),a.bio&&e.jsx("p",{className:"channel-bio",children:a.bio})]})]})]})}),e.jsxs("div",{className:`profile-page ${t?"":"large-container"}`,children:[e.jsxs("div",{className:"profile-tabs",children:[e.jsx("span",{className:f==="videos"?"active":"",onClick:()=>k("videos"),style:{cursor:"pointer"},children:"Videos"}),e.jsx("span",{className:f==="favorites"?"active":"",onClick:()=>k("favorites"),style:{cursor:"pointer"},children:"Favorites"})]}),f==="videos"&&e.jsx("div",{className:"profile-videos",children:o.length===0?e.jsx("div",{children:"No videos yet."}):e.jsx("div",{className:"profile-video-grid",children:o.map(S=>e.jsxs("div",{className:"profile-video-card",style:{cursor:"pointer"},onClick:()=>{console.log("Clicked video:",S),r(`/video/${S.categoryId||0}/${S.id}`)},children:[e.jsx("img",{src:S.thumbnail||"https://via.placeholder.com/320x180?text=No+Thumbnail",alt:S.title}),e.jsx("h3",{children:S.title}),e.jsx("p",{children:S.description})]},S.id))})}),f==="favorites"&&e.jsx("div",{className:"profile-favorites",children:u.length===0?e.jsx("div",{children:"No favorites yet."}):e.jsx("div",{className:"profile-video-grid",children:u.map(S=>e.jsxs("div",{className:"profile-video-card",children:[e.jsx("img",{src:S.image_url||S.thumbnail_url||"https://via.placeholder.com/320x180?text=No+Image",alt:S.title,style:{cursor:"pointer"},onClick:()=>{console.log("Clicked favorite:",S)}}),e.jsx("h3",{children:S.title}),S.description&&e.jsx("p",{children:S.description}),e.jsx("button",{className:"make-merch-btn-favorite",onClick:A=>{A.stopPropagation(),T(S)},children:"Make Merch"})]},S.id))})})]})]})};const Ad=()=>{const[t]=Et(),[s,r]=c.useState("verifying"),[a,i]=c.useState("");c.useEffect(()=>{const n=t.get("email"),u=t.get("token");if(!n||!u){r("error");return}i(n),setTimeout(()=>{r("success")},2e3)},[t]);const o=()=>{switch(s){case"verifying":return e.jsxs("div",{className:"approval-content",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("h2",{children:"Verifying your subscription..."}),e.jsx("p",{children:"Please wait while we process your request."})]});case"success":return e.jsxs("div",{className:"approval-content success",children:[e.jsx("div",{className:"success-icon",children:"‚úì"}),e.jsx("h2",{children:"Subscription Approved!"}),e.jsxs("p",{children:["Welcome to ScreenMerch, ",e.jsx("strong",{children:a}),"!"]}),e.jsx("p",{children:"Your subscription has been successfully activated. You can now enjoy all our premium features."}),e.jsx(mt,{to:"/",className:"home-btn",children:"Go to Home"})]});case"error":return e.jsxs("div",{className:"approval-content error",children:[e.jsx("div",{className:"error-icon",children:"‚úó"}),e.jsx("h2",{children:"Invalid Link"}),e.jsx("p",{children:"This approval link is invalid or has expired."}),e.jsx("p",{children:"Please try subscribing again or contact support if you continue to have issues."}),e.jsx(mt,{to:"/",className:"home-btn",children:"Go to Home"})]});default:return null}};return e.jsx("div",{className:"approval-page",children:e.jsxs("div",{className:"approval-container",children:[e.jsx("div",{className:"logo-section",children:e.jsx("h1",{children:"ScreenMerch"})}),o()]})})};class la{static async getCurrentUserSubscription(){try{const{data:{user:s}}=await R.auth.getUser();if(!s)return null;const{data:r,error:a}=await R.from("user_subscriptions").select("*").eq("user_id",s.id).single();if(a&&a.code!=="PGRST116")throw a;return r||{tier:"free",status:"active"}}catch(s){return console.error("Error fetching subscription:",s),{tier:"free",status:"active"}}}static async subscribeToFreeTier(){try{const{data:{user:s}}=await R.auth.getUser();if(!s)throw new Error("User not authenticated");const r=new Date,{data:a,error:i}=await R.from("user_subscriptions").upsert({user_id:s.id,tier:"free",status:"active",current_period_start:r.toISOString(),current_period_end:null,updated_at:r.toISOString()},{onConflict:"user_id"}).select().single();if(i)throw i;return{success:!0,subscription:a}}catch(s){return console.error("Error subscribing to free tier:",s),{success:!1,error:s.message}}}static async subscribeToProTier(){try{const{data:{user:s}}=await R.auth.getUser();return s?(window.location.href="/payment-setup",{success:!0,redirecting:!0}):(window.location.href="/payment-setup?flow=new_user",{success:!0,redirecting:!0})}catch(s){return console.error("Error starting PayPal setup flow:",s),{success:!1,error:s.message}}}static async hasMinimumTier(s){try{const r=await this.getCurrentUserSubscription(),a={free:0,pro:1},i=a[(r==null?void 0:r.tier)||"free"],o=a[s];return i>=o}catch(r){return console.error("Error checking tier requirement:",r),!1}}static getTierConfig(s){const r={free:{name:"Free Trial",price:"Free",serviceFee:.3,features:["Upload videos (up to 100MB, 10 minutes)","Basic analytics","Standard features","Community access","Grab screenshots","Preview merch","Buy merchandise","7-day free trial period"],maxUploadSize:"100MB",maxVideoLength:"10 minutes"},pro:{name:"Free Plan",price:"Free",serviceFee:.3,trialDays:0,features:["Everything in Free Trial","Priority support","Custom branding","Enhanced upload limits (2GB, 60 minutes)","Ad-free experience","Early access to new features","Monetization tools","Revenue tracking","Custom channel colors","Branded merchandise","Advanced analytics"],maxUploadSize:"2GB",maxVideoLength:"60 minutes"}};return r[s]||r.free}static async isInTrialPeriod(){try{const s=await this.getCurrentUserSubscription();if(!s||s.tier!=="pro"||!s.trial_end)return!1;const r=new Date(s.trial_end);return new Date<r}catch(s){return console.error("Error checking trial period:",s),!1}}static async getTrialDaysRemaining(){try{const s=await this.getCurrentUserSubscription();if(!s||s.tier!=="pro"||!s.trial_end)return 0;const i=new Date(s.trial_end)-new Date,o=Math.ceil(i/(1e3*60*60*24));return Math.max(0,o)}catch(s){return console.error("Error getting trial days remaining:",s),0}}static async activateProSubscription(s,r){try{const a=localStorage.getItem("user_authenticated")==="true",i=localStorage.getItem("user_email");if(!a||!i)throw new Error("User not authenticated");console.log("üîç User authenticated via localStorage:",i),console.log("üîç Ensuring user exists in database...");const o=await fetch("https://screenmerch.fly.dev/api/users/ensure-exists",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i,display_name:i.split("@")[0]})});if(!o.ok)throw console.error("‚ùå Failed to ensure user exists:",await o.text()),new Error("Failed to ensure user exists in database");const n=await o.json();console.log("‚úÖ User ensured in database:",n);const u=n.user.id;console.log("‚úÖ Using user ID from ensure-exists response:",u);const m=new Date;m.setDate(m.getDate()+7);const f=await fetch("https://screenmerch.fly.dev/api/subscriptions/activate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:u,tier:"pro",status:"active",stripe_subscription_id:s,stripe_customer_id:r,trial_end:m.toISOString()})});if(!f.ok)throw console.error("‚ùå Failed to activate subscription:",await f.text()),new Error("Failed to activate subscription in database");const k=await f.json();console.log("‚úÖ Subscription activated:",k);try{const M=i.split("@")[0].toLowerCase().replace(/[^a-z0-9]/g,""),h=`https://screenmerch.com/channel/${M}`,v=await fetch("https://screenmerch.fly.dev/api/users/update-channel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:u,channel_slug:M,channel_url:h})});v.ok?console.log("‚úÖ Channel URL generated:",h):console.error("Error updating channel URL:",await v.text())}catch(M){console.error("Error generating channel URL:",M)}return{success:!0,subscription:k.subscription||k}}catch(a){return console.error("Error activating pro subscription:",a),{success:!1,error:a.message}}}static async sendWelcomeEmail(s){try{return await(await fetch("https://screenmerch.fly.dev/api/send-welcome-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})})).json()}catch(r){throw console.error("Error sending welcome email:",r),r}}}const Ed=()=>{const[t,s]=c.useState({subdomain:"",custom_domain:"",custom_logo_url:"",primary_color:"#667eea",secondary_color:"#764ba2",hide_screenmerch_branding:!1,custom_favicon_url:"",custom_meta_title:"",custom_meta_description:"",personalization_enabled:!1}),[r,a]=c.useState(!1),[i,o]=c.useState(!1),[n,u]=c.useState(""),[m,f]=c.useState("");c.useEffect(()=>{k()},[]);const k=async()=>{a(!0);try{const h=us();let v=null,_=null;if(h){console.log("üîç PersonalizationSettings: Detected subdomain:",h);const A=await Zs(h);if(A&&A.id){v=A.id,console.log("‚úÖ PersonalizationSettings: Found creator for subdomain:",A.display_name,"ID:",v);const{data:E,error:z}=await R.from("users").select("subdomain, custom_domain, custom_logo_url, primary_color, secondary_color, hide_screenmerch_branding, custom_favicon_url, custom_meta_title, custom_meta_description, personalization_enabled, email").eq("id",v).single();if(E&&!z){console.log("‚úÖ PersonalizationSettings: Loaded settings for subdomain user:",E),s({subdomain:E.subdomain||"",custom_domain:E.custom_domain||"",custom_logo_url:E.custom_logo_url||"",primary_color:E.primary_color||"#667eea",secondary_color:E.secondary_color||"#764ba2",hide_screenmerch_branding:E.hide_screenmerch_branding||!1,custom_favicon_url:E.custom_favicon_url||"",custom_meta_title:E.custom_meta_title||"",custom_meta_description:E.custom_meta_description||"",personalization_enabled:E.personalization_enabled||!1}),a(!1);return}else console.error("‚ùå PersonalizationSettings: Error loading settings for subdomain user:",z)}else console.warn("‚ö†Ô∏è PersonalizationSettings: No creator found for subdomain:",h)}let b=null,x=null;const T=localStorage.getItem("isAuthenticated"),S=localStorage.getItem("user");if(T==="true"&&S)try{const A=JSON.parse(S);if(b=A,x=A.id,!x&&A.email){console.log("üîê PersonalizationSettings: User missing id, looking up by email:",A.email);try{const{data:E,error:z}=await R.from("users").select("id").eq("email",A.email).single();E&&E.id&&(x=E.id,b={...b,id:E.id},console.log("üîê PersonalizationSettings: Found user id from database:",x))}catch(E){console.error("Error looking up user by email:",E)}}}catch(A){console.error("Error parsing user data:",A)}if(!b||!x)try{const{data:{user:A},error:E}=await R.auth.getUser();A&&(b=A,x=A.id)}catch(A){console.error("Error getting Supabase user:",A)}if(x){const{data:A,error:E}=await R.from("users").select("subdomain, custom_domain, custom_logo_url, primary_color, secondary_color, hide_screenmerch_branding, custom_favicon_url, custom_meta_title, custom_meta_description, personalization_enabled").eq("id",x).single();A&&!E?(console.log("‚úÖ PersonalizationSettings: Loaded settings from database:",A),s({subdomain:A.subdomain||"",custom_domain:A.custom_domain||"",custom_logo_url:A.custom_logo_url||"",primary_color:A.primary_color||"#667eea",secondary_color:A.secondary_color||"#764ba2",hide_screenmerch_branding:A.hide_screenmerch_branding||!1,custom_favicon_url:A.custom_favicon_url||"",custom_meta_title:A.custom_meta_title||"",custom_meta_description:A.custom_meta_description||"",personalization_enabled:A.personalization_enabled||!1})):E&&console.error("‚ùå PersonalizationSettings: Error loading settings:",E)}else if(b&&b.email){console.log("üîê PersonalizationSettings: Trying to load settings by email:",b.email);const{data:A,error:E}=await R.from("users").select("id, subdomain, custom_domain, custom_logo_url, primary_color, secondary_color, hide_screenmerch_branding, custom_favicon_url, custom_meta_title, custom_meta_description, personalization_enabled").eq("email",b.email).single();A&&!E&&(console.log("‚úÖ PersonalizationSettings: Loaded settings by email:",A),s({subdomain:A.subdomain||"",custom_domain:A.custom_domain||"",custom_logo_url:A.custom_logo_url||"",primary_color:A.primary_color||"#667eea",secondary_color:A.secondary_color||"#764ba2",hide_screenmerch_branding:A.hide_screenmerch_branding||!1,custom_favicon_url:A.custom_favicon_url||"",custom_meta_title:A.custom_meta_title||"",custom_meta_description:A.custom_meta_description||"",personalization_enabled:A.personalization_enabled||!1}))}}catch(h){console.error("Error loading settings:",h),u("Error loading settings"),f("error")}finally{a(!1)}},M=async()=>{o(!0),u(""),f("");try{let h=null,v=null;const _=us();let b=null;if(_){console.log("üîç PersonalizationSettings: Detected subdomain for save:",_);const z=await Zs(_);if(z&&z.id){b=z.id,console.log("‚úÖ PersonalizationSettings: Will save to subdomain owner:",z.display_name,"ID:",b);let V=null;const X=localStorage.getItem("isAuthenticated"),Y=localStorage.getItem("user");if(X==="true"&&Y)try{const $=JSON.parse(Y);if(V=$.id,!V&&$.email){const{data:se}=await R.from("users").select("id").eq("email",$.email).single();se&&(V=se.id)}}catch{}if(!V){const{data:{user:$}}=await R.auth.getUser();$&&(V=$.id)}if(V&&V!==b){console.error("‚ùå PersonalizationSettings: Logged-in user does not own this subdomain"),u("You can only edit settings for your own subdomain. Please log in as the owner of this subdomain."),f("error"),o(!1);return}h=b}else console.warn("‚ö†Ô∏è PersonalizationSettings: No creator found for subdomain:",_)}if(!h){let z=null;const V=localStorage.getItem("isAuthenticated"),X=localStorage.getItem("user");if(V==="true"&&X)try{const Y=JSON.parse(X);if(z=Y,h=Y.id,!h&&Y.email){console.log("üîê PersonalizationSettings: User missing id, looking up by email:",Y.email);try{const{data:$,error:se}=await R.from("users").select("id").eq("email",Y.email).single();$&&$.id&&(h=$.id,z={...z,id:$.id},console.log("üîê PersonalizationSettings: Found user id from database:",h))}catch($){console.error("Error looking up user by email:",$)}}}catch(Y){console.error("Error parsing user data:",Y)}if(!h)try{const{data:{user:Y},error:$}=await R.auth.getUser();Y&&Y.id?(h=Y.id,z=Y,console.log("üîê PersonalizationSettings: Using authenticated user ID from Supabase:",h)):$&&console.error("Error getting Supabase user:",$)}catch(Y){console.error("Error getting Supabase user:",Y)}}if(!h){const z=localStorage.getItem("isAuthenticated"),V=localStorage.getItem("user");console.error("üîê PersonalizationSettings: No user id found. isAuthenticated:",z,"userData:",V),u("Please log in to save settings"),f("error"),o(!1);return}if(t.subdomain){if(!/^[a-z0-9]([a-z0-9-]*[a-z0-9])?$/.test(t.subdomain.toLowerCase())){u("Subdomain can only contain lowercase letters, numbers, and hyphens. Cannot start or end with hyphen."),f("error"),o(!1);return}if(t.subdomain.length<3||t.subdomain.length>63){u("Subdomain must be between 3 and 63 characters"),f("error"),o(!1);return}if(["www","api","admin","app","mail","ftp","localhost","test","staging","dev","prod","cdn","static","assets","images","media","blog","shop","store","help","support","docs","status"].includes(t.subdomain.toLowerCase())){u("This subdomain is reserved and cannot be used"),f("error"),o(!1);return}}const x=/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;if(t.primary_color&&!x.test(t.primary_color)){u("Primary color must be a valid hex color (e.g., #FF5733)"),f("error"),o(!1);return}if(t.secondary_color&&!x.test(t.secondary_color)){u("Secondary color must be a valid hex color (e.g., #C70039)"),f("error"),o(!1);return}const T=t.subdomain?t.subdomain.toLowerCase().trim():null;console.log("üíæ PersonalizationSettings: Saving settings for userId:",h,"user:",v),console.log("üíæ PersonalizationSettings: Settings to save:",{subdomain:T,primary_color:t.primary_color,secondary_color:t.secondary_color,hide_screenmerch_branding:t.hide_screenmerch_branding,personalization_enabled:t.personalization_enabled});let S=null,A=null;const E={subdomain:T||null,custom_domain:t.custom_domain?t.custom_domain.toLowerCase().trim():null,custom_logo_url:t.custom_logo_url||null,primary_color:t.primary_color||"#667eea",secondary_color:t.secondary_color||"#764ba2",hide_screenmerch_branding:t.hide_screenmerch_branding||!1,custom_favicon_url:t.custom_favicon_url||null,custom_meta_title:t.custom_meta_title||null,custom_meta_description:t.custom_meta_description||null,personalization_enabled:t.personalization_enabled||!1};if(h){console.log("üíæ PersonalizationSettings: Attempting to update user with ID:",h),console.log("üíæ PersonalizationSettings: Update data:",E);const z=await R.from("users").update(E).eq("id",h).select();S=z.data,A=z.error,A&&(console.error("‚ùå Update failed with error:",A),console.error("   Error code:",A.code),console.error("   Error message:",A.message),console.error("   Error details:",A.details),console.error("   Error hint:",A.hint))}else console.error("‚ùå No userId available for update"),A={message:"No user ID available. Please log in again."};if(console.log("üíæ PersonalizationSettings: Update result:",S,"Error:",A),A)console.error("‚ùå Error saving settings:",A),console.error("   Error details:",JSON.stringify(A,null,2)),u(`Error: ${A.message||"Failed to save settings"}`),f("error");else{if(console.log("‚úÖ Settings saved successfully! Update result:",S),S&&S.length>0){const $=S[0];console.log("‚úÖ Verified saved settings from update response:",{subdomain:$.subdomain,primary_color:$.primary_color,secondary_color:$.secondary_color,hide_screenmerch_branding:$.hide_screenmerch_branding,personalization_enabled:$.personalization_enabled});const{data:se,error:be}=await R.from("users").select("subdomain, primary_color, secondary_color, personalization_enabled").eq("id",h).single();!be&&se?(console.log("‚úÖ Database verification - actual saved values:",se),se.subdomain!==T&&console.warn("‚ö†Ô∏è WARNING: Subdomain mismatch! Expected:",T,"Got:",se.subdomain)):console.error("‚ùå Failed to verify saved settings:",be)}else console.warn("‚ö†Ô∏è Update result is empty or null");t.personalization_enabled&&t.subdomain?u(`‚úÖ Settings saved! Your personalized app is now active at ${t.subdomain}.screenmerch.com`):t.subdomain?u(`‚úÖ Settings saved! Don't forget to check "Enable Personalization" at the top and save again to activate your app at ${t.subdomain}.screenmerch.com`):u("‚úÖ Settings saved successfully!"),f("success"),console.log("üîÑ Reloading settings after save..."),await k(),console.log("üîÑ Triggering creator settings update event"),window.dispatchEvent(new CustomEvent("creatorSettingsUpdated")),t.primary_color&&(document.documentElement.style.setProperty("--primary-color",t.primary_color),console.log("‚úÖ Immediately set --primary-color to:",t.primary_color)),t.secondary_color&&(document.documentElement.style.setProperty("--secondary-color",t.secondary_color),console.log("‚úÖ Immediately set --secondary-color to:",t.secondary_color));const z=document.documentElement,V=z.style.display;z.style.display="none",z.offsetHeight,z.style.display=V;const X=window.location.hostname.toLowerCase(),Y=T?`${T}.screenmerch.com`:null;Y&&(X===Y||X.includes(T))?(console.log("üîÑ On subdomain, reloading page to apply changes"),setTimeout(()=>{window.location.reload()},500)):t.personalization_enabled&&T&&(console.log("üîÑ Redirecting to subdomain to see changes:",Y),setTimeout(()=>{window.location.href=`https://${Y}${window.location.pathname}`},500))}}catch(h){console.error("Error saving settings:",h),u(`Error: ${h.message||"Unknown error"}`),f("error")}finally{o(!1)}};return r?e.jsx("div",{className:"personalization-settings-loading",children:"Loading settings..."}):e.jsxs("div",{className:"personalization-settings",children:[e.jsx("h2",{children:"Personalize Your ScreenMerch App"}),e.jsx("p",{className:"personalization-description",children:"Create your own branded ScreenMerch app with a custom subdomain, colors, and branding. Your personalized app will show only your content."}),e.jsxs("div",{className:"setting-group",children:[e.jsxs("label",{className:"setting-label",children:[e.jsx("input",{type:"checkbox",checked:t.personalization_enabled,onChange:h=>s({...t,personalization_enabled:h.target.checked})}),e.jsx("span",{className:"setting-label-text",children:"Enable Personalization"})]}),e.jsx("p",{className:"help-text",children:"Turn on to activate your personalized app"})]}),t.personalization_enabled&&e.jsxs("div",{className:"personalization-form",children:[e.jsxs("div",{className:"setting-group",children:[e.jsx("label",{className:"setting-label",children:"Subdomain *"}),e.jsx("input",{type:"text",value:t.subdomain,onChange:h=>s({...t,subdomain:h.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"")}),placeholder:"yourname",className:"setting-input"}),e.jsxs("p",{className:"help-text",children:["Your app will be available at: ",e.jsxs("strong",{children:[t.subdomain||"yourname",".screenmerch.com"]})]}),e.jsx("p",{className:"help-text-small",children:"Only lowercase letters, numbers, and hyphens. 3-63 characters. Cannot start or end with hyphen."})]}),e.jsxs("div",{className:"setting-group",children:[e.jsx("label",{className:"setting-label",children:"Custom Domain (Premium)"}),e.jsx("input",{type:"text",value:t.custom_domain,onChange:h=>s({...t,custom_domain:h.target.value}),placeholder:"merch.yourdomain.com",className:"setting-input"}),e.jsx("p",{className:"help-text",children:"Connect your own domain (requires DNS configuration)"})]}),e.jsxs("div",{className:"setting-group",children:[e.jsx("label",{className:"setting-label",children:"Custom Logo URL"}),e.jsx("input",{type:"url",value:t.custom_logo_url,onChange:h=>s({...t,custom_logo_url:h.target.value}),placeholder:"https://example.com/logo.png",className:"setting-input"}),e.jsx("p",{className:"help-text",children:"URL to your custom logo image (recommended: 200x50px PNG or SVG)"})]}),e.jsxs("div",{className:"color-settings",children:[e.jsxs("div",{className:"setting-group",children:[e.jsx("label",{className:"setting-label",children:"Primary Color"}),e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{type:"color",value:t.primary_color,onChange:h=>s({...t,primary_color:h.target.value}),className:"color-picker"}),e.jsx("input",{type:"text",value:t.primary_color,onChange:h=>s({...t,primary_color:h.target.value}),placeholder:"#667eea",className:"color-text-input"})]}),e.jsx("p",{className:"help-text",children:"Main brand color used in gradients and buttons"})]}),e.jsxs("div",{className:"setting-group",children:[e.jsx("label",{className:"setting-label",children:"Secondary Color"}),e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{type:"color",value:t.secondary_color,onChange:h=>s({...t,secondary_color:h.target.value}),className:"color-picker"}),e.jsx("input",{type:"text",value:t.secondary_color,onChange:h=>s({...t,secondary_color:h.target.value}),placeholder:"#764ba2",className:"color-text-input"})]}),e.jsx("p",{className:"help-text",children:"Secondary brand color used in gradients"})]})]}),e.jsxs("div",{className:"setting-group",children:[e.jsxs("label",{className:"setting-label",children:[e.jsx("input",{type:"checkbox",checked:t.hide_screenmerch_branding,onChange:h=>s({...t,hide_screenmerch_branding:h.target.checked})}),e.jsx("span",{className:"setting-label-text",children:'Hide "Powered by ScreenMerch" Branding'})]}),e.jsx("p",{className:"help-text",children:"Remove ScreenMerch branding from your personalized app"})]}),e.jsxs("div",{className:"setting-group",children:[e.jsx("label",{className:"setting-label",children:"Custom Favicon URL"}),e.jsx("input",{type:"url",value:t.custom_favicon_url,onChange:h=>s({...t,custom_favicon_url:h.target.value}),placeholder:"https://example.com/favicon.ico",className:"setting-input"}),e.jsx("p",{className:"help-text",children:"URL to your custom favicon (recommended: 32x32px ICO or PNG)"})]}),e.jsxs("div",{className:"setting-group",children:[e.jsx("label",{className:"setting-label",children:"Custom Meta Title"}),e.jsx("input",{type:"text",value:t.custom_meta_title,onChange:h=>s({...t,custom_meta_title:h.target.value}),placeholder:"Your Brand Name - Merchandise",className:"setting-input",maxLength:255}),e.jsx("p",{className:"help-text",children:"Page title shown in browser tabs and search results"})]}),e.jsxs("div",{className:"setting-group",children:[e.jsx("label",{className:"setting-label",children:"Custom Meta Description"}),e.jsx("textarea",{value:t.custom_meta_description,onChange:h=>s({...t,custom_meta_description:h.target.value}),placeholder:"Description for search engines",rows:3,className:"setting-textarea",maxLength:500}),e.jsx("p",{className:"help-text",children:"Description shown in search engine results (recommended: 150-160 characters)"})]})]}),e.jsx("div",{className:"settings-actions",children:e.jsx("button",{onClick:M,disabled:i||!t.personalization_enabled,className:"save-settings-btn",children:i?"Saving...":"Save Settings"})}),n&&e.jsx("div",{className:`settings-message ${m}`,children:n})]})},Id=({sidebar:t})=>{var Te,fe;const[s,r]=c.useState(null),[a,i]=c.useState(null),[o,n]=c.useState(null),[u,m]=c.useState([]),[f,k]=c.useState(!0),[M,h]=c.useState(!1),[v,_]=c.useState({display_name:"",bio:"",cover_image_url:"",profile_image_url:""}),[b,x]=c.useState(!1),[T,S]=c.useState({cover:null,profile:null}),[A,E]=c.useState(!1),[z,V]=c.useState(!1);Et();const[X,Y]=c.useState("videos"),[$,se]=c.useState(null),[be,xe]=c.useState({paypal_email:"",tax_id:""}),[ae,W]=c.useState(!1),[O,de]=c.useState(""),[G,U]=c.useState([]),[y,N]=c.useState(!1),[D,w]=c.useState(!1),[p,ee]=c.useState({title:"",description:"",image:null,imagePreview:null}),[ie,we]=c.useState({total_sales:0,total_revenue:0,products_sold_count:0,videos_with_sales_count:0,avg_order_value:0,products_sold:[],recent_sales:[],daily_sales:[]}),[Ce,Oe]=c.useState(!1),[it,Le]=c.useState(!1),[Ye,I]=c.useState(null),[J,Se]=c.useState({title:"",thumbnail:"",video_url:""}),[oe,ve]=c.useState(!1),[le,ne]=c.useState(!1),[De,K]=c.useState(null),re=c.useRef(null),Ae=ct();c.useEffect(()=>{(async()=>{var j,C,Q;try{const ce=localStorage.getItem("isAuthenticated"),Ue=localStorage.getItem("user");let _e=null;if(ce==="true"&&Ue)_e=JSON.parse(Ue),console.log("üîê Dashboard: Found authenticated user from localStorage:",_e);else{const{data:{user:Fe},error:Ke}=await R.auth.getUser();Fe&&(_e=Fe,console.log("üîê Dashboard: Found Supabase user:",_e))}if(!_e){console.log("üîê Dashboard: No authenticated user found, redirecting to home"),Ae("/");return}r(_e);let Ne=null;if(_e.id&&(console.log("üîç [DASHBOARD] Fetching latest profile from backend for user ID:",_e.id),Ne=await _s(_e.id),Ne&&console.log("‚úÖ [DASHBOARD] Fetched profile from backend:",{profile_image_url:Ne==null?void 0:Ne.profile_image_url,cover_image_url:Ne==null?void 0:Ne.cover_image_url,display_name:Ne==null?void 0:Ne.display_name})),Ne){const Fe=Ne.profile_image_url||"",Ke=Ne.cover_image_url||"",Je={...Ne,profile_image_url:Fe,cover_image_url:Ke};i(Je),_({display_name:Ne.display_name||"",bio:Ne.bio||"",cover_image_url:Ke,profile_image_url:Fe});const Ze={..._e,profile_image_url:Fe,cover_image_url:Ke,display_name:Ne.display_name||_e.display_name||((j=_e.user_metadata)==null?void 0:j.name)||"",bio:Ne.bio||_e.bio||""};localStorage.setItem("user",JSON.stringify(Ze)),console.log("üíæ [DASHBOARD] Updated localStorage with profile_image_url:",Ze.profile_image_url),r(Ze),console.log("‚úÖ [DASHBOARD] Updated user state with profile_image_url:",Ze.profile_image_url),xe({paypal_email:Ne.paypal_email||"",tax_id:Ne.tax_id||""})}else{console.log("‚ö†Ô∏è [DASHBOARD] No database profile found, using localStorage data");const Fe=_e.profile_image_url||_e.picture||((C=_e.user_metadata)==null?void 0:C.picture)||"",Ke=_e.cover_image_url||"",Je={..._e,profile_image_url:Fe,cover_image_url:Ke,display_name:_e.display_name||((Q=_e.user_metadata)==null?void 0:Q.name)||"",bio:_e.bio||""};i(Je),_({display_name:Je.display_name,bio:Je.bio,cover_image_url:Je.cover_image_url,profile_image_url:Fe})}const He=await la.getCurrentUserSubscription();if(n(He),_e.id){const{data:Fe,error:Ke}=await R.from("videos2").select("*").eq("user_id",_e.id).order("created_at",{ascending:!1});Fe&&m(Fe);const{data:Je,error:Ze}=await R.from("creator_favorites").select("*").eq("user_id",_e.id).order("created_at",{ascending:!1});Je&&U(Je)}else m([]),U([])}catch(ce){console.error("Error fetching data:",ce),Ae("/")}finally{k(!1)}})()},[Ae]),c.useEffect(()=>{(async()=>{const j=localStorage.getItem("isAuthenticated"),C=localStorage.getItem("user");if(j==="true"&&C){const Q=JSON.parse(C);se({...Q,role:"creator"})}else{const{data:{user:Q}}=await R.auth.getUser();if(Q){const{data:ce}=await R.from("users").select("role").eq("id",Q.id).single();se({...Q,...ce})}else se(null)}})()},[]);const q=async(d,j)=>{try{x(!0);const C=d.name.split(".").pop(),Q=`${s.id}/${j}-${Date.now()}.${C}`,{data:ce,error:Ue}=await R.storage.from("profile-images").upload(Q,d,{cacheControl:"3600",upsert:!0});if(Ue)return console.error("Error uploading image:",Ue),alert("Failed to upload image. Please try again."),null;const{data:{publicUrl:_e}}=R.storage.from("profile-images").getPublicUrl(Q);return _e}catch(C){return console.error("Error in uploadImageToSupabase:",C),alert("Failed to upload image. Please try again."),null}finally{x(!1)}},Z=async(d,j)=>{if(!d.type.startsWith("image/")){alert("Please select a valid image file.");return}if(d.size>5*1024*1024){alert("File size must be less than 5MB.");return}const C=new FileReader;C.onload=ce=>{S(Ue=>({...Ue,[j]:ce.target.result}))},C.readAsDataURL(d);const Q=await q(d,j);Q&&_(ce=>({...ce,[`${j}_image_url`]:Q}))},he=async()=>{try{let d=s==null?void 0:s.id;if(!d&&(s!=null&&s.email)){console.log("üîê Dashboard: User missing id, looking up by email:",s.email);try{const{data:Fe,error:Ke}=await R.from("users").select("id").eq("email",s.email).single();Fe&&Fe.id&&(d=Fe.id,console.log("üîê Dashboard: Found user id from database:",d))}catch(Fe){console.error("Error looking up user by email:",Fe)}}if(!d){console.error("Error: No user ID available"),alert("Error: Unable to identify user. Please try logging in again.");return}const j={}.VITE_BACKEND_URL||"https://screenmerch.fly.dev";console.log("üíæ Dashboard: Saving profile for user:",d),console.log("üíæ Dashboard: Profile data:",{display_name:v.display_name,bio:v.bio,cover_image_url:v.cover_image_url,profile_image_url:v.profile_image_url});const C=await fetch(`${j}/api/users/${d}/update-profile`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({display_name:v.display_name,bio:v.bio,cover_image_url:v.cover_image_url,profile_image_url:v.profile_image_url})});if(console.log("üíæ Dashboard: Response status:",C.status,C.statusText),!C.ok){const Fe=C.headers.get("content-type");let Ke;if(Fe&&Fe.includes("application/json"))Ke=await C.json().catch(()=>({error:"Unknown error"}));else{const Je=await C.text();console.error("üíæ Dashboard: Non-JSON error response:",Je),Ke={error:`Server error: ${C.status} - ${Je.substring(0,100)}`}}throw new Error(Ke.error||`Server error: ${C.status}`)}const Q=await C.json(),ce=Q==null?void 0:Q.user;console.log("üíæ Dashboard: Backend returned updated user:",ce),console.log("üíæ Dashboard: Updated profile_image_url from backend:",ce==null?void 0:ce.profile_image_url);const Ue=ce||{...a,display_name:v.display_name,bio:v.bio,cover_image_url:v.cover_image_url,profile_image_url:v.profile_image_url};i(Ue);const _e=localStorage.getItem("user");let Ne=null;if(_e)try{Ne={...JSON.parse(_e),profile_image_url:(ce==null?void 0:ce.profile_image_url)||v.profile_image_url,cover_image_url:(ce==null?void 0:ce.cover_image_url)||v.cover_image_url,display_name:(ce==null?void 0:ce.display_name)||v.display_name,bio:(ce==null?void 0:ce.bio)||v.bio},localStorage.setItem("user",JSON.stringify(Ne)),r(Ne),console.log("üíæ Dashboard: Updated localStorage with profile_image_url:",Ne.profile_image_url)}catch(Fe){console.error("Error updating localStorage user:",Fe)}const He=ce?{...Ne,...ce,profile_image_url:ce.profile_image_url||(Ne==null?void 0:Ne.profile_image_url),cover_image_url:ce.cover_image_url||(Ne==null?void 0:Ne.cover_image_url)}:Ne;He&&(console.log("üì° Dashboard: Preparing to dispatch events with profile_image_url:",He.profile_image_url),window.dispatchEvent(new CustomEvent("profileUpdated",{detail:{user:He}})),console.log("üì° Dashboard: ‚úÖ Dispatched profileUpdated event IMMEDIATELY with profile_image_url:",He.profile_image_url),window.dispatchEvent(new CustomEvent("userLoggedIn",{detail:{user:He}})),console.log("üì° Dashboard: Dispatched userLoggedIn event with profile image:",He.profile_image_url)),h(!1),S({cover:null,profile:null}),console.log("‚úÖ Profile saved successfully via backend API")}catch(d){console.error("Error saving profile:",d),alert(`Failed to save profile: ${d.message||"Unknown error"}`)}},F=async(d,j,C)=>{if(C.stopPropagation(),!!window.confirm(`Are you sure you want to delete "${j}"? This action cannot be undone.`))try{const ce=await Be.deleteVideo(d);ce.success?(m(Ue=>Ue.filter(_e=>_e.id!==d)),alert("Video deleted successfully!")):alert(`Failed to delete video: ${ce.error}`)}catch(ce){console.error("Error deleting video:",ce),alert("Failed to delete video. Please try again.")}},L=async()=>{if(!p.title||!p.image){alert("Please provide a title and image.");return}let d=null,j=null;const{data:{user:C},error:Q}=await R.auth.getUser();if(C&&C.id)d=C.id,console.log("Using Supabase Auth user ID:",d);else{j=Q,console.log("No Supabase Auth session, checking for Google OAuth user...");const ce=localStorage.getItem("isAuthenticated"),Ue=localStorage.getItem("user");if(ce==="true"&&Ue)try{const _e=JSON.parse(Ue);if(console.log("Found Google OAuth user:",_e),_e.email){const{data:Ne,error:He}=await R.from("users").select("id").eq("email",_e.email).single();Ne&&Ne.id?(d=Ne.id,console.log("Found user ID from users table:",d)):console.error("User not found in users table:",He)}}catch(_e){console.error("Error parsing Google OAuth user:",_e)}}if(!d){console.error("Auth error:",j),alert("Authentication required. Please ensure you are logged in. If you are using Google OAuth, you may need to sign in through Supabase Auth to upload favorites.");return}try{if(N(!0),p.image.size>5*1024*1024){alert("File size must be less than 5MB."),N(!1);return}const ce=p.image.name.split(".").pop(),Ue=`${d}/favorites/${Date.now()}.${ce}`;console.log("Uploading favorite image:",Ue),console.log("User ID:",d);const{data:_e,error:Ne}=await R.storage.from("thumbnails").upload(Ue,p.image,{cacheControl:"3600",upsert:!1});if(Ne){console.error("Error uploading image:",Ne),console.error("Error details:",JSON.stringify(Ne,null,2)),Ne.message&&Ne.message.includes("not found")?alert("Storage bucket not found. Please check your Supabase storage configuration."):Ne.message&&Ne.message.includes("row-level security")?alert("Permission denied. Please check your Supabase storage policies."):alert(`Failed to upload image: ${Ne.message||"Unknown error"}`),N(!1);return}console.log("Image uploaded successfully:",_e);const{data:{publicUrl:He}}=R.storage.from("thumbnails").getPublicUrl(Ue);console.log("Public URL:",He);const Fe=(a==null?void 0:a.display_name)||(a==null?void 0:a.username)||"Unknown";console.log("Saving favorite to database with channelTitle:",Fe),console.log("User profile data:",{display_name:a==null?void 0:a.display_name,username:a==null?void 0:a.username});let Ke={user_id:d,channelTitle:Fe,title:p.title,description:p.description||null,image_url:He,thumbnail_url:He};const{data:Je,error:Ze}=await R.from("creator_favorites").insert(Ke).select().single();if(Ze){if(console.error("Error saving favorite:",Ze),console.error("Error details:",JSON.stringify(Ze,null,2)),Ze.message&&(Ze.message.includes("channelTitle")||Ze.message.includes("channeltitle"))){console.log("Retrying with lowercase column name as fallback...");const pt={user_id:d,channeltitle:Fe,title:p.title,description:p.description||null,image_url:He,thumbnail_url:He},{data:ft,error:Lt}=await R.from("creator_favorites").insert(pt).select().single();Lt?(console.error("Retry also failed:",Lt),alert(`Failed to save favorite: ${Lt.message||"Unknown error"}. Please check that the creator_favorites table exists and has the correct columns.`)):(console.log("Favorite saved successfully with lowercase column:",ft),U(Ie=>[ft,...Ie]),ee({title:"",description:"",image:null,imagePreview:null}),w(!1),alert("Favorite uploaded successfully!")),N(!1);return}alert(`Failed to save favorite: ${Ze.message||"Unknown error"}`)}else console.log("Favorite saved successfully:",Je),U(pt=>[Je,...pt]),ee({title:"",description:"",image:null,imagePreview:null}),w(!1),alert("Favorite uploaded successfully!")}catch(ce){console.error("Error uploading favorite:",ce),console.error("Error stack:",ce.stack),alert(`Failed to upload favorite: ${ce.message||"Unknown error"}`)}finally{N(!1)}},H=async d=>{const j=localStorage.getItem("user_authenticated"),C=localStorage.getItem("isAuthenticated");if(!(j==="true"||C==="true")){const Ue={thumbnail:d.image_url||d.thumbnail_url,screenshots:[d.image_url||d.thumbnail_url],videoUrl:window.location.href,videoTitle:d.title||"Favorite Image",creatorName:d.channeltitle||d.channelTitle||(a==null?void 0:a.display_name)||(a==null?void 0:a.username)||"Unknown Creator"};localStorage.setItem("pending_merch_data",JSON.stringify(Ue)),alert("Please log in to create merchandise");return}const ce={thumbnail:d.image_url||d.thumbnail_url,screenshots:[d.image_url||d.thumbnail_url],videoUrl:window.location.href,videoTitle:d.title||"Favorite Image",creatorName:d.channeltitle||d.channelTitle||(a==null?void 0:a.display_name)||(a==null?void 0:a.username)||"Unknown Creator"};localStorage.setItem("pending_merch_data",JSON.stringify(ce)),Ae("/merchandise")},ue=async(d,j)=>{if(window.confirm(`Are you sure you want to delete "${j}"? This action cannot be undone.`))try{const{error:Q}=await R.from("creator_favorites").delete().eq("id",d);Q?(console.error("Error deleting favorite:",Q),alert("Failed to delete favorite. Please try again.")):(U(ce=>ce.filter(Ue=>Ue.id!==d)),alert("Favorite deleted successfully!"))}catch(Q){console.error("Error deleting favorite:",Q),alert("Failed to delete favorite. Please try again.")}},je=(d,j)=>{j.stopPropagation(),I(d),Se({title:d.title||"",thumbnail:d.thumbnail||"",video_url:d.video_url||""}),K(null)};c.useEffect(()=>{Ye&&re.current&&(re.current.scrollTop=0,re.current.offsetHeight)},[Ye]);const Me=()=>{I(null),Se({title:"",thumbnail:"",video_url:""}),K(null)},We=async d=>{try{ne(!0);const j=d.name.split(".").pop(),C=`${s.id}/thumbnails/${Date.now()}.${j}`,{data:Q,error:ce}=await R.storage.from("thumbnails").upload(C,d,{cacheControl:"3600",upsert:!0});if(ce)return console.error("Error uploading thumbnail:",ce),alert("Failed to upload thumbnail. Please try again."),null;const{data:{publicUrl:Ue}}=R.storage.from("thumbnails").getPublicUrl(C);return Ue}catch(j){return console.error("Error in uploadThumbnailToSupabase:",j),alert("Failed to upload thumbnail. Please try again."),null}finally{ne(!1)}},g=async d=>{try{if(ve(!0),!s||!s.id)return alert("User not found. Please sign in again."),null;const j=d.name.split(".").pop(),C=`${s.id}/videos/${Date.now()}.${j}`;console.log("Attempting to upload video:",C),console.log("User ID:",s.id);const{data:Q,error:ce}=await R.storage.from("videos2").upload(C,d,{cacheControl:"3600",upsert:!0});if(ce)return console.error("Error uploading video:",ce),console.error("Error details:",JSON.stringify(ce,null,2)),ce.message&&ce.message.includes("row-level security")?alert("Upload failed: Permission denied. The storage policies may not allow uploads for your account. Please use the Video URL field instead, or ensure you are authenticated through Supabase Auth."):ce.message&&ce.message.includes("new row violates")?alert("Upload failed: Storage policy error. Please check your Supabase storage policies or use the Video URL field instead."):alert(`Failed to upload video: ${ce.message||"Unknown error. Please try using the Video URL field instead."}`),null;const{data:{publicUrl:Ue}}=R.storage.from("videos2").getPublicUrl(C);return console.log("Video uploaded successfully:",Ue),Ue}catch(j){return console.error("Error in uploadVideoToSupabase:",j),console.error("Error stack:",j.stack),alert(`Failed to upload video: ${j.message||"Please try again or use the Video URL field instead."}`),null}finally{ve(!1)}},te=async d=>{const j=d.target.files[0];if(!j)return;if(!j.type.startsWith("image/")){alert("Please select a valid image file.");return}if(j.size>5*1024*1024){alert("File size must be less than 5MB.");return}const C=new FileReader;C.onload=ce=>{K(ce.target.result)},C.readAsDataURL(j);const Q=await We(j);Q&&Se(ce=>({...ce,thumbnail:Q}))},ge=async d=>{const j=d.target.files[0];if(!j)return;if(!j.type.startsWith("video/")){alert("Please select a valid video file.");return}const C=await g(j);C&&Se(Q=>({...Q,video_url:C}))},ye=async()=>{if(Ye)try{const d={};if(J.title.trim()&&(d.title=J.title.trim()),J.thumbnail&&(d.thumbnail=J.thumbnail),J.video_url&&(d.video_url=J.video_url),Object.keys(d).length===0){alert("No changes to save.");return}const j=await Be.updateVideo(Ye.id,d);j.success?(m(C=>C.map(Q=>Q.id===Ye.id?{...Q,...d}:Q)),alert("Video updated successfully!"),Me()):alert(`Failed to update video: ${j.error}`)}catch(d){console.error("Error updating video:",d),alert("Failed to update video. Please try again.")}};c.useEffect(()=>{let d=!0;return(async()=>{if(s!=null&&s.email)try{const j=await Be.checkAdminStatus();d&&Le((j==null?void 0:j.isMasterAdmin)||!1)}catch{d&&Le(!1)}})(),()=>{d=!1}},[s==null?void 0:s.email]);const pe=async()=>{if(!s||!s.id){console.warn("Cannot fetch analytics: user not found");return}Oe(!0);try{const d=typeof import.meta<"u"&&{VITE_API_BASE_URL:"https://api.screenmerch.com",VITE_SUPABASE_URL:"https://sojxbydpcdcdzfdtbypd.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&{}.VITE_BACKEND_URL||"https://screenmerch.fly.dev",j=await fetch(`${d}/api/analytics?user_id=${s.id}`,{method:"GET",headers:{Accept:"application/json","Cache-Control":"no-cache"}});if(!j.ok)throw new Error(`Analytics API error: ${j.status}`);const C=await j.json();console.log("üìä Analytics data received:",C),we({total_sales:C.total_sales||0,total_revenue:C.total_revenue||0,avg_order_value:C.avg_order_value||0,products_sold_count:C.products_sold_count||0,videos_with_sales_count:C.videos_with_sales_count||0,sales_data:C.sales_data||[],products_sold:C.products_sold||[],videos_with_sales:C.videos_with_sales||[],recent_sales:C.recent_sales||[],daily_sales:C.daily_sales||[]})}catch(d){console.error("Error fetching analytics:",d)}finally{Oe(!1)}};return $&&(!$.role||$.role!=="creator")?(console.log("User role issue:",$.role,"User:",$),e.jsxs("div",{className:"dashboard-error",children:["Access denied. Only creators can view this page.",e.jsx("br",{}),e.jsx("button",{onClick:async()=>{var d,j,C;try{console.log("Fixing role for user:",$.id);const{data:Q,error:ce}=await R.from("users").select("*").eq("id",$.id).single();if(ce&&ce.code==="PGRST116"){console.log("User not found, creating new user record");const{data:Ue,error:_e}=await R.from("users").upsert({id:$.id,email:$.email,username:((d=$.email)==null?void 0:d.split("@")[0])||"user",display_name:((j=$.user_metadata)==null?void 0:j.name)||((C=$.email)==null?void 0:C.split("@")[0])||"User",role:"creator",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{onConflict:"id",ignoreDuplicates:!1}).select();if(_e)if(console.error("Error creating user:",_e),_e.message.includes("duplicate key")){console.log("Duplicate key detected, updating existing user");const{data:Ne,error:He}=await R.from("users").update({role:"creator",updated_at:new Date().toISOString()}).eq("id",$.id).select();He?(console.error("Error updating user:",He),alert("Failed to update user: "+He.message)):(console.log("User updated successfully:",Ne),alert("User updated! Reloading page..."),window.location.reload())}else alert("Failed to create user: "+_e.message);else console.log("User created successfully:",Ue),alert("User created! Reloading page..."),window.location.reload()}else if(Q){const{data:Ue,error:_e}=await R.from("users").update({role:"creator"}).eq("id",$.id).select();_e?(console.error("Error updating role:",_e),alert("Failed to update role: "+_e.message)):(console.log("Role updated successfully:",Ue),alert("Role updated! Reloading page..."),window.location.reload())}else console.error("Unexpected error checking user:",ce),alert("Error checking user: "+ce.message)}catch(Q){console.error("Error in role fix:",Q),alert("Error fixing role: "+Q.message)}},style:{marginTop:"10px",padding:"8px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Fix Role & Reload"})]})):f?e.jsx("div",{className:"dashboard-loading",children:"Loading your dashboard..."}):s?e.jsxs("div",{className:`dashboard-container ${t?"":" large-container"}`,children:[e.jsx("div",{className:"channel-header",children:e.jsxs("div",{className:"channel-cover-container",children:[A?e.jsxs("div",{className:"edit-cover-section",children:[e.jsx("div",{className:"cover-edit-backdrop",onClick:()=>{E(!1),S(d=>({...d,cover:null}))}}),e.jsx("div",{className:"cover-edit-overlay",onClick:d=>d.stopPropagation(),children:e.jsxs("div",{className:"cover-edit-controls",children:[e.jsx("button",{className:"cover-edit-close-btn",onClick:()=>{E(!1),S(d=>({...d,cover:null}))},title:"Close",children:"√ó"}),e.jsx("h3",{children:"üì∏ Update Cover Image"}),e.jsxs("div",{className:"file-upload-section",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:d=>d.target.files[0]&&Z(d.target.files[0],"cover"),id:"cover-upload",className:"file-input",disabled:b}),e.jsx("label",{htmlFor:"cover-upload",className:"file-upload-btn",children:b?"‚è≥ Uploading...":"üìÅ Choose Cover Image"})]}),e.jsx("p",{className:"edit-tip",children:"üí° Tip: Max 5MB, high-quality image (1920x1080 recommended)"})]})}),(T.cover||v.cover_image_url)&&e.jsx("img",{src:T.cover||v.cover_image_url||(a==null?void 0:a.cover_image_url)||"https://images.unsplash.com/photo-1557683316-973673baf926?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80",alt:"Cover preview",className:"channel-cover-photo"})]}):e.jsxs("div",{className:"cover-image-container",children:[e.jsx("img",{className:"channel-cover-photo",src:v.cover_image_url||(a==null?void 0:a.cover_image_url)||"https://images.unsplash.com/photo-1557683316-973673baf926?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80",alt:"Channel Cover"}),e.jsx("button",{className:"corner-edit-icon cover-edit",onClick:()=>E(!0),title:"Edit cover image",children:"‚úèÔ∏è"})]}),e.jsxs("div",{className:"channel-info-overlay",children:[e.jsx("div",{className:"channel-avatar-container",children:z?e.jsxs("div",{className:"edit-avatar-section",children:[e.jsx("img",{className:"channel-avatar editing",src:T.profile||v.profile_image_url||(a==null?void 0:a.profile_image_url)||(s==null?void 0:s.profile_image_url)||((Te=s==null?void 0:s.user_metadata)==null?void 0:Te.picture)||(s==null?void 0:s.picture)||"/default-avatar.jpg",alt:"Channel Avatar"}),e.jsxs("div",{className:"avatar-upload-section",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:d=>d.target.files[0]&&Z(d.target.files[0],"profile"),id:"avatar-upload",className:"file-input",disabled:b}),e.jsx("label",{htmlFor:"avatar-upload",className:"avatar-upload-btn",children:b?"‚è≥ Uploading...":"üì∑ Change Avatar"})]}),e.jsxs("div",{className:"avatar-edit-buttons",children:[e.jsx("button",{onClick:async()=>{await he(),V(!1),S(d=>({...d,profile:null}))},className:"save-btn",disabled:b,children:"Save"}),e.jsx("button",{onClick:()=>{V(!1),S(d=>({...d,profile:null})),_(d=>({...d,profile_image_url:(a==null?void 0:a.profile_image_url)||""}))},className:"cancel-btn",children:"Cancel"})]})]}):e.jsxs("div",{className:"avatar-with-edit",children:[e.jsx("img",{className:"channel-avatar",src:(()=>{var j;return a!=null&&a.profile_image_url&&a.profile_image_url.trim()!==""?a.profile_image_url:s!=null&&s.profile_image_url&&s.profile_image_url.trim()!==""?s.profile_image_url:((j=s==null?void 0:s.user_metadata)==null?void 0:j.picture)||(s==null?void 0:s.picture)||"/default-avatar.jpg"})(),alt:"Channel Avatar"}),e.jsx("button",{className:"corner-edit-icon avatar-edit",onClick:()=>V(!0),title:"Edit avatar",children:"‚úèÔ∏è"})]})}),e.jsx("div",{className:"channel-details",children:M?e.jsxs("div",{className:"edit-details-section",children:[e.jsx("input",{type:"text",placeholder:"Display name",value:v.display_name,onChange:d=>_({...v,display_name:d.target.value}),className:"edit-input edit-title"}),e.jsx("textarea",{placeholder:"Bio/Description",value:v.bio,onChange:d=>_({...v,bio:d.target.value}),className:"edit-textarea",rows:"2"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"channel-name",children:(a==null?void 0:a.display_name)||((fe=s.user_metadata)==null?void 0:fe.name)||"Your Channel"}),e.jsxs("p",{className:"channel-username",children:["@",(a==null?void 0:a.username)||"username"]}),(a==null?void 0:a.bio)&&e.jsx("p",{className:"channel-bio",children:a.bio})]})}),e.jsx("div",{className:"edit-controls",children:M?e.jsxs("div",{className:"edit-buttons",children:[e.jsx("button",{onClick:he,className:"save-btn",children:"Save Changes"}),e.jsx("button",{onClick:()=>h(!1),className:"cancel-btn",children:"Cancel"})]}):null})]})]})}),e.jsxs("div",{className:"dashboard-tabs",children:[e.jsxs("button",{className:`tab-button ${X==="videos"?"active":""}`,onClick:()=>Y("videos"),children:["üìπ Videos (",u.length,")"]}),e.jsxs("button",{className:`tab-button ${X==="favorites"?"active":""}`,onClick:()=>{console.log("Favorites tab clicked"),Y("favorites")},children:["‚≠ê Favorites (",G.length,")"]}),e.jsx("button",{className:`tab-button ${X==="analytics"?"active":""}`,onClick:()=>{Y("analytics"),pe()},children:"üìä Analytics"}),e.jsx("button",{className:`tab-button ${X==="payout"?"active":""}`,onClick:()=>Y("payout"),children:"üí∞ Payout Setup"}),e.jsx("button",{className:`tab-button ${X==="personalization"?"active":""}`,onClick:()=>Y("personalization"),children:"üé® Personalization"})]}),e.jsxs("div",{className:"tab-content",children:[X==="videos"&&e.jsxs("div",{className:"videos-tab",children:[e.jsxs("div",{className:"getting-started-section",children:[e.jsx("h2",{children:"Getting Started"}),e.jsxs("div",{className:"tips-grid",children:[e.jsxs("div",{className:"tip-card",children:[e.jsx("h4",{children:"üé® Customize Your Channel"}),e.jsx("p",{children:"Add a cover image, profile picture, and bio to make your channel unique."})]}),e.jsxs("div",{className:"tip-card clickable",onClick:()=>Ae("/upload"),children:[e.jsx("h4",{children:"üìπ Upload Content"}),e.jsx("p",{children:"Start sharing your videos and build your audience."}),e.jsx("div",{className:"card-action",children:"Click to upload ‚Üí"})]}),e.jsxs("div",{className:"tip-card",children:[e.jsx("h4",{children:"üìä Check Your Analytics"}),e.jsx("p",{children:"Monitor your sales and track your performance."})]})]})]}),e.jsxs("div",{className:"user-videos-section",children:[e.jsx("div",{className:"section-header",children:e.jsxs("h2",{children:["Your Videos (",u.length,")"]})}),u.length>0?e.jsx("div",{className:"dashboard-video-grid",children:u.map(d=>e.jsxs("div",{className:"dashboard-video-card",onClick:()=>{const j={thumbnail:d.thumbnail||"",screenshots:d.screenshots||[],videoUrl:d.video_url||"",videoTitle:d.title||"Unknown Video",creatorName:(a==null?void 0:a.display_name)||(a==null?void 0:a.username)||"Unknown Creator",videoId:d.id};localStorage.setItem("pending_merch_data",JSON.stringify(j)),localStorage.setItem("creator_favorites_mode","true"),Ae("/product/browse?category=mens&creatorMode=favorites")},children:[e.jsx("img",{src:d.thumbnail,alt:d.title,className:"dashboard-video-thumbnail"}),e.jsxs("div",{className:"dashboard-video-info",children:[e.jsx("h4",{children:d.title}),e.jsx("p",{children:new Date(d.created_at).toLocaleDateString()}),e.jsx("span",{className:"video-views",children:"0 views"})]}),e.jsx("button",{className:"edit-video-btn",onClick:j=>je(d,j),title:"Edit Video",children:"‚úèÔ∏è"}),e.jsx("button",{className:"delete-video-btn",onClick:j=>F(d.id,d.title,j),title:"Delete Video",children:"üóëÔ∏è"})]},d.id))}):e.jsx("div",{className:"no-videos-placeholder",children:e.jsxs("div",{className:"placeholder-content",children:[e.jsx("h3",{children:"No videos yet"}),e.jsx("p",{children:"Start building your content library by uploading your first video!"})]})})]})]}),X==="favorites"&&e.jsxs("div",{className:"favorites-tab",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h2",{children:["‚≠ê Your Favorites (",G.length,")"]}),e.jsx("button",{className:"add-favorite-btn",onClick:()=>{ee({title:"",description:"",image:null,imagePreview:null}),w(!0)},children:"+ Add Favorite"})]}),G.length>0?e.jsx("div",{className:"dashboard-video-grid",children:G.map(d=>e.jsxs("div",{className:"dashboard-video-card",children:[e.jsx("img",{src:d.image_url||d.thumbnail_url||"https://via.placeholder.com/320x180?text=No+Image",alt:d.title,className:"dashboard-video-thumbnail"}),e.jsxs("div",{className:"dashboard-video-info",children:[e.jsx("h4",{children:d.title}),d.description&&e.jsx("p",{children:d.description}),e.jsx("span",{className:"video-views",children:new Date(d.created_at).toLocaleDateString()})]}),e.jsx("button",{className:"make-merch-btn-favorite-dashboard",onClick:j=>{j.stopPropagation(),H(d)},children:"Make Merch"}),e.jsx("button",{className:"delete-video-btn",onClick:j=>{j.stopPropagation(),ue(d.id,d.title)},title:"Delete Favorite",children:"üóëÔ∏è"})]},d.id))}):e.jsx("div",{className:"no-videos-placeholder",children:e.jsxs("div",{className:"placeholder-content",children:[e.jsx("h3",{children:"No favorites yet"}),e.jsx("p",{children:"Upload your favorite images for users to create merchandise from!"}),e.jsx("button",{className:"add-favorite-btn",onClick:()=>{ee({title:"",description:"",image:null,imagePreview:null}),w(!0)},children:"+ Add Your First Favorite"})]})}),D&&e.jsx("div",{className:"favorite-modal-overlay",onClick:()=>w(!1),children:e.jsxs("div",{className:"favorite-modal-content",onClick:d=>d.stopPropagation(),ref:re,children:[e.jsx("span",{className:"favorite-modal-close",onClick:()=>w(!1),children:"√ó"}),e.jsx("h2",{children:"Upload Favorite Image"}),e.jsxs("div",{className:"upload-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Title *"}),e.jsx("input",{type:"text",value:p.title,onChange:d=>ee({...p,title:d.target.value}),placeholder:"Enter favorite title"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:p.description,onChange:d=>ee({...p,description:d.target.value}),placeholder:"Enter description (optional)",rows:"3"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Image *"}),e.jsx("input",{type:"file",accept:"image/*",onChange:d=>{const j=d.target.files[0];if(j){const C=new FileReader;C.onload=Q=>{ee({...p,image:j,imagePreview:Q.target.result})},C.readAsDataURL(j)}}}),p.imagePreview&&e.jsx("img",{src:p.imagePreview,alt:"Preview",style:{maxWidth:"100%",marginTop:"10px",borderRadius:"8px"}})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"save-btn",onClick:L,disabled:y||!p.title||!p.image,children:y?"Uploading...":"Upload Favorite"}),e.jsx("button",{className:"cancel-btn",onClick:()=>{w(!1),ee({title:"",description:"",image:null,imagePreview:null})},children:"Cancel"})]})]})]})})]}),X==="analytics"&&e.jsx("div",{className:"analytics-tab",children:e.jsxs("div",{className:"sales-analytics-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"üìä Sales Analytics"}),e.jsxs("div",{className:"analytics-summary",children:[e.jsxs("span",{className:"total-sales",children:["Total Sales: ",Ce?"Loading...":ie.total_sales]}),e.jsxs("span",{className:"total-revenue",children:["Total Revenue: $",Ce?"0.00":ie.total_revenue.toFixed(2)]}),it&&e.jsx("button",{onClick:async()=>{if(window.confirm("‚ö†Ô∏è WARNING: This will permanently delete all your sales data. This action cannot be undone. Are you absolutely sure?")&&window.confirm("This is your final warning. All sales records will be deleted. Continue?"))try{const d=typeof import.meta<"u"&&{VITE_API_BASE_URL:"https://api.screenmerch.com",VITE_SUPABASE_URL:"https://sojxbydpcdcdzfdtbypd.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&{}.VITE_BACKEND_URL||"https://screenmerch.fly.dev",j=(s==null?void 0:s.email)||(a==null?void 0:a.email),Q=await(await fetch(`${d}/api/admin/reset-sales`,{method:"POST",headers:{"Content-Type":"application/json","X-User-Email":j},body:JSON.stringify({user_id:s.id})})).json();Q.success?(alert(`‚úÖ Sales reset successfully! Deleted ${Q.deleted_count||0} sales records.`),pe()):alert(`‚ùå Failed to reset sales: ${Q.error||"Unknown error"}`)}catch(d){console.error("Error resetting sales:",d),alert(`‚ùå Error resetting sales: ${d.message}`)}},style:{marginLeft:"20px",padding:"8px 16px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px"},title:"Reset all sales data (Master Admin only)",children:"üîÑ Reset Sales"})]})]}),e.jsxs("div",{className:"analytics-dashboard",children:[e.jsxs("div",{className:"analytics-overview-cards",children:[e.jsxs("div",{className:"analytics-card",children:[e.jsx("h4",{children:"üìà Sales Per Day"}),e.jsx("div",{className:"analytics-amount",children:Ce?"...":ie.total_sales}),e.jsx("div",{className:"analytics-change",children:Ce?"Loading...":ie.total_sales>0?"Active sales":"No data yet"})]}),e.jsxs("div",{className:"analytics-card",children:[e.jsx("h4",{children:"üõçÔ∏è Products Sold"}),e.jsx("div",{className:"analytics-amount",children:Ce?"...":ie.products_sold_count}),e.jsx("div",{className:"analytics-change",children:Ce?"Loading...":ie.products_sold_count>0?"Products selling":"No data yet"})]}),e.jsxs("div",{className:"analytics-card",children:[e.jsx("h4",{children:"üé¨ Videos with Sales"}),e.jsx("div",{className:"analytics-amount",children:Ce?"...":ie.videos_with_sales_count}),e.jsx("div",{className:"analytics-change",children:Ce?"Loading...":ie.videos_with_sales_count>0?"Videos performing":"No data yet"})]}),e.jsxs("div",{className:"analytics-card",children:[e.jsx("h4",{children:"üí∞ Avg Order Value"}),e.jsxs("div",{className:"analytics-amount",children:["$",Ce?"0.00":ie.avg_order_value.toFixed(2)]}),e.jsx("div",{className:"analytics-change",children:Ce?"Loading...":ie.avg_order_value>0?"Good average":"No data yet"})]})]}),e.jsxs("div",{className:"sales-chart-section",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{children:"üìä Sales Analytics Dashboard"}),e.jsxs("div",{className:"service-fee-info",children:[e.jsx("span",{className:"fee-badge",children:"30% Service Fee"}),e.jsx("span",{className:"fee-explanation",children:"Net revenue shown after fees"})]})]}),e.jsxs("div",{className:"chart-section",children:[e.jsx("h4",{children:"üìÖ Daily Sales (Last 7 Days)"}),e.jsx("div",{className:"daily-chart-container",children:e.jsx("div",{className:"daily-chart-bars",children:ie.daily_sales&&ie.daily_sales.length>0?(()=>{const d=ie.daily_sales,j=Math.max(...d.map(Q=>Q.sales_count||0),1),C=160;return d.map((Q,ce)=>{const Ue=ce===d.length-1,_e=Q.sales_count||0,Ne=Q.net_revenue||0,He=Q.revenue||0,Fe=_e>0?Math.max(_e/j*C,20):0;return e.jsxs("div",{className:"daily-bar-container",children:[e.jsx("div",{className:`daily-bar ${_e>0?"has-sales":"no-sales"} ${Ue?"today":""}`,style:{height:`${Fe}px`},title:`${Q.date_display}: ${_e} sales | Gross: $${He.toFixed(2)} | Net: $${Ne.toFixed(2)}`,children:e.jsx("span",{className:"daily-bar-value",children:_e})}),e.jsx("div",{className:"daily-bar-label",children:Q.date_display}),_e>0&&e.jsxs("div",{className:"daily-bar-revenue",children:["$",Ne.toFixed(2)]})]},ce)})})():Array.from({length:7},(d,j)=>{const C=new Date;C.setDate(C.getDate()-(6-j));const Q=C.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),ce=j===6;return e.jsxs("div",{className:"daily-bar-container",children:[e.jsx("div",{className:`daily-bar no-sales ${ce?"today":""}`,style:{height:"0px"},title:`${Q}: 0 sales`,children:e.jsx("span",{className:"daily-bar-value",children:"0"})}),e.jsx("div",{className:"daily-bar-label",children:Q})]},j)})})})]}),e.jsxs("div",{className:"weekly-summary",children:[e.jsx("h4",{children:"üìä Weekly Summary"}),e.jsxs("div",{className:"summary-grid",children:[e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"summary-label",children:"This Week"}),e.jsx("div",{className:"summary-value",children:ie.total_sales}),e.jsx("div",{className:"summary-subtitle",children:"Total Sales"})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"summary-label",children:"Gross Revenue"}),e.jsxs("div",{className:"summary-value",children:["$",ie.total_revenue.toFixed(2)]}),e.jsx("div",{className:"summary-subtitle",children:"Before fees"})]}),e.jsxs("div",{className:"summary-card highlight",children:[e.jsx("div",{className:"summary-label",children:"Net Revenue"}),e.jsxs("div",{className:"summary-value",children:["$",(ie.total_revenue*.7).toFixed(2)]}),e.jsx("div",{className:"summary-subtitle",children:"After 30% fee"})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"summary-label",children:"Service Fee"}),e.jsxs("div",{className:"summary-value",children:["$",(ie.total_revenue*.3).toFixed(2)]}),e.jsx("div",{className:"summary-subtitle",children:"Platform fee"})]})]})]}),e.jsxs("div",{className:"recent-activity",children:[e.jsx("h4",{children:"üïí Recent Sales Activity"}),e.jsx("div",{className:"activity-list",children:ie.recent_sales&&ie.recent_sales.length>0?ie.recent_sales.slice(0,5).map((d,j)=>{var Q;let C="Recently";try{if(d.created_at&&d.created_at!=="N/A"){const ce=new Date(d.created_at),_e=new Date-ce,Ne=Math.floor(_e/6e4),He=Math.floor(_e/36e5),Fe=Math.floor(_e/864e5);Ne<1?C="Just now":Ne<60?C=`${Ne} ${Ne===1?"minute":"minutes"} ago`:He<24?C=`${He} ${He===1?"hour":"hours"} ago`:C=`${Fe} ${Fe===1?"day":"days"} ago`}}catch{C="Recently"}return e.jsxs("div",{className:"activity-item",children:[e.jsx("div",{className:"activity-icon",children:"üí∞"}),e.jsxs("div",{className:"activity-details",children:[e.jsx("div",{className:"activity-title",children:"Sale completed"}),e.jsxs("div",{className:"activity-subtitle",children:["Product: ",d.product," | Net: $",((Q=d.net_amount)==null?void 0:Q.toFixed(2))||(d.amount*.7).toFixed(2)]})]}),e.jsx("div",{className:"activity-time",children:C})]},j)}):e.jsxs("div",{className:"activity-item",children:[e.jsx("div",{className:"activity-icon",children:"üìä"}),e.jsxs("div",{className:"activity-details",children:[e.jsx("div",{className:"activity-title",children:"No recent sales"}),e.jsx("div",{className:"activity-subtitle",children:"Start making sales to see activity here"})]}),e.jsx("div",{className:"activity-time",children:"‚Äî"})]})})]})]}),e.jsxs("div",{className:"products-sold-chart",children:[e.jsx("h3",{children:"üõçÔ∏è Products Sold"}),ie.products_sold&&ie.products_sold.length>0?e.jsx("div",{className:"products-chart-container",children:ie.products_sold.map((d,j)=>{const C=Math.max(...ie.products_sold.map(ce=>ce.quantity)),Q=C>0?d.quantity/C*100:0;return e.jsxs("div",{className:"product-chart-item",children:[e.jsxs("div",{className:"product-chart-header",children:[e.jsx("div",{className:"product-name",children:d.product}),e.jsxs("div",{className:"product-stats",children:[e.jsxs("span",{className:"quantity",children:[d.quantity," sold"]}),e.jsxs("span",{className:"revenue",children:["$",d.revenue.toFixed(2)]})]})]}),e.jsx("div",{className:"product-chart-bar-container",children:e.jsx("div",{className:"product-chart-bar",style:{width:`${Q}%`},title:`${d.quantity} units sold - $${d.revenue.toFixed(2)} revenue`,children:e.jsx("span",{className:"bar-label",children:d.quantity})})}),e.jsx("div",{className:"product-source",children:e.jsxs("small",{children:["From: ",d.video_source]})})]},j)})}):e.jsxs("div",{className:"products-chart-empty",children:[e.jsx("div",{className:"empty-icon",children:"üì¶"}),e.jsx("h4",{children:"No products sold yet"}),e.jsx("p",{children:"Start creating content to see your sales data here!"})]})]})]})]})}),X==="personalization"&&e.jsx("div",{className:"personalization-tab",children:e.jsx(Ed,{})}),X==="payout"&&e.jsx("div",{className:"payout-tab",children:e.jsxs("div",{className:"payout-section",children:[e.jsx("div",{className:"section-header",children:e.jsx("p",{className:"payout-main-description",children:"Configure your payment information to receive earnings from your sales"})}),O&&e.jsx("div",{className:`payout-message ${O.includes("error")||O.includes("Failed")?"error":"success"}`,children:O}),e.jsxs("form",{className:"payout-form",onSubmit:async d=>{d.preventDefault(),W(!0),de("");try{if(!s||!s.id)throw new Error("User not found");const j={paypal_email:be.paypal_email.trim(),tax_id:be.tax_id.trim()||null},{data:C,error:Q}=await R.from("users").update(j).eq("id",s.id).select().single();if(Q)throw Q;de("Payout information saved successfully!"),i({...a,...j}),setTimeout(()=>de(""),3e3)}catch(j){console.error("Error saving payout info:",j),de(`Failed to save payout information: ${j.message}`)}finally{W(!1)}},children:[e.jsxs("div",{className:"payout-form-group",children:[e.jsxs("label",{htmlFor:"paypal-email",className:"payout-label",children:["PayPal Email ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"email",id:"paypal-email",className:"payout-input",placeholder:"your.email@example.com",value:be.paypal_email,onChange:d=>xe({...be,paypal_email:d.target.value}),disabled:ae,required:!0}),e.jsx("p",{className:"payout-help-text",children:"This is where we'll send your earnings. Make sure it's a valid PayPal account."})]}),e.jsxs("div",{className:"payout-form-group",children:[e.jsx("label",{htmlFor:"tax-id",className:"payout-label",children:"Tax ID / SSN (Optional)"}),e.jsx("input",{type:"text",id:"tax-id",className:"payout-input",placeholder:"Enter your Tax ID or SSN",value:be.tax_id,onChange:d=>xe({...be,tax_id:d.target.value}),disabled:ae}),e.jsx("p",{className:"payout-help-text",children:"Required for tax reporting in some jurisdictions. Your information is encrypted and secure."})]}),e.jsx("div",{className:"payout-form-actions",children:e.jsx("button",{type:"submit",className:"payout-save-btn",disabled:ae||!be.paypal_email.trim(),children:ae?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner-small"}),"Saving..."]}):"üíæ Save Payout Information"})})]}),e.jsxs("div",{className:"payout-info-box",children:[e.jsx("h3",{children:"‚ÑπÔ∏è Important Information"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Your payout information is encrypted and stored securely"}),e.jsx("li",{children:"Payments are processed monthly after you reach the minimum payout threshold"}),e.jsx("li",{children:"You can update your payout information at any time"}),e.jsx("li",{children:"Make sure your PayPal email is correct to avoid payment delays"})]})]})]})})]}),Ye&&e.jsx("div",{className:"edit-video-modal-overlay",onClick:Me,children:e.jsxs("div",{className:"edit-video-modal",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"edit-video-modal-header",children:[e.jsx("h2",{children:"Edit Video"}),e.jsx("button",{className:"edit-video-modal-close",onClick:Me,children:"√ó"})]}),e.jsxs("div",{className:"edit-video-modal-content",ref:re,children:[e.jsxs("div",{className:"edit-video-form-group",children:[e.jsx("label",{htmlFor:"edit-video-title",children:"Video Name"}),e.jsx("input",{type:"text",id:"edit-video-title",value:J.title,onChange:d=>Se({...J,title:d.target.value}),placeholder:"Enter video name",className:"edit-video-input"})]}),e.jsxs("div",{className:"edit-video-form-group",children:[e.jsx("label",{htmlFor:"edit-video-thumbnail",children:"Thumbnail"}),e.jsx("div",{className:"edit-video-thumbnail-preview",children:(De||J.thumbnail)&&e.jsx("img",{src:De||J.thumbnail,alt:"Thumbnail preview",className:"thumbnail-preview-img"})}),e.jsx("input",{type:"file",id:"edit-video-thumbnail",accept:"image/*",onChange:te,disabled:le,className:"edit-video-file-input"}),e.jsx("label",{htmlFor:"edit-video-thumbnail",className:"edit-video-file-label",children:le?"‚è≥ Uploading...":"üì∑ Choose Thumbnail Image"}),e.jsx("p",{className:"edit-video-tip",children:"Max 5MB, recommended: 1280x720"})]}),e.jsxs("div",{className:"edit-video-form-group",children:[e.jsx("label",{htmlFor:"edit-video-url",children:"Video URL"}),e.jsx("input",{type:"text",id:"edit-video-url",value:J.video_url,onChange:d=>Se({...J,video_url:d.target.value}),placeholder:"Enter video URL (YouTube or direct link)",className:"edit-video-input"}),e.jsx("p",{className:"edit-video-tip",children:"Or upload a video file below"})]}),e.jsxs("div",{className:"edit-video-form-group",children:[e.jsx("label",{htmlFor:"edit-video-file",children:"Upload Video File"}),e.jsx("input",{type:"file",id:"edit-video-file",accept:"video/*",onChange:ge,disabled:oe,className:"edit-video-file-input"}),e.jsx("label",{htmlFor:"edit-video-file",className:"edit-video-file-label",children:oe?"‚è≥ Uploading...":"üé¨ Choose Video File"}),e.jsx("p",{className:"edit-video-tip",children:"Max file size depends on your plan"})]})]}),e.jsxs("div",{className:"edit-video-modal-footer",children:[e.jsx("button",{className:"edit-video-cancel-btn",onClick:Me,children:"Cancel"}),e.jsx("button",{className:"edit-video-save-btn",onClick:ye,disabled:le||oe,children:le||oe?"Saving...":"Save Changes"})]})]})})]}):e.jsx("div",{className:"dashboard-error",children:"Please log in to see your dashboard."})};const Td=()=>{const t=ct();hs();const s={totalRevenue:18228,monthlyRevenue:1519,totalProductsSold:2600,monthlyProductsSold:217,averageProductPrice:14.95,productOverheadCost:4.95,houseCommission:3,yourProfitPerItem:7},[r,a]=c.useState(null),[i,o]=c.useState(null),[n,u]=c.useState(!0),[m,f]=c.useState(!1),[k,M]=c.useState(""),[h,v]=c.useState(!1);c.useEffect(()=>{(async()=>{try{const{data:{user:S}}=await R.auth.getUser();if(a(S),S){const A=await la.getCurrentUserSubscription();o(A)}}catch(S){console.error("Error fetching user data:",S)}finally{u(!1)}})()},[]);const _=async()=>{if(!r){v(!0);return}t("/dashboard?tab=payout")},b=async(T,S)=>{localStorage.setItem("pending_creator_email",T),localStorage.setItem("pending_creator_location",S);const A="https://screenmerch.com",E="https://screenmerch.fly.dev";f(!0);try{await fetch(`${E}/api/auth/register-pending-creator`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:(T||"").trim().toLowerCase()}),credentials:"include"})}catch{}const z=`${E}/api/auth/google/login?return_url=${encodeURIComponent(A)}&flow=creator_signup`;window.location.href=z},x=()=>{v(!1)};return n?e.jsx("div",{className:"subscription-tiers",children:e.jsx("div",{className:"loading",children:"Loading..."})}):e.jsxs("div",{className:"subscription-tiers",children:[e.jsxs("div",{className:"tiers-header",children:[e.jsx("h1",{children:"üí∞ Creator Earnings Calculator"}),e.jsx("p",{children:"See how much you can earn from your content with one of dozens of products to choose from."}),!r&&e.jsx("button",{className:"hero-signup-btn",onClick:()=>_(),disabled:m,children:m?"Processing...":"Sign Up Now"})]}),k&&e.jsx("div",{className:`message ${k.includes("error")||k.includes("Failed")?"error":"success"}`,children:k}),e.jsxs("div",{className:"performance-metrics",children:[e.jsxs("div",{className:"metrics-header",children:[e.jsx("h3",{children:"üìä Example Creator Performance"}),e.jsx("p",{children:"Example earnings using coffee mugs, one of many available products."})]}),e.jsxs("div",{className:"metrics-grid",children:[e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-value",children:s.monthlyProductsSold}),e.jsx("div",{className:"metric-label",children:"Monthly Products Sold"})]}),e.jsxs("div",{className:"metric-card",children:[e.jsxs("div",{className:"metric-value",children:["$",s.monthlyRevenue.toLocaleString()]}),e.jsx("div",{className:"metric-label",children:"Monthly Revenue"})]}),e.jsxs("div",{className:"metric-card",children:[e.jsxs("div",{className:"metric-value",children:["$",s.totalRevenue.toLocaleString()]}),e.jsx("div",{className:"metric-label",children:"Total Revenue (Annual)"})]})]})]}),e.jsxs("div",{className:"tier-calculator-section",children:[e.jsxs("div",{className:"calculator-header",children:[e.jsx("h4",{children:"üéØ ScreenMerch Free Plan"}),e.jsx("p",{children:"It's completely free to use ScreenMerch! No monthly fees, no recurring charges."})]}),e.jsxs("div",{className:"tier-comparison-grid",children:[e.jsxs("div",{className:"tier-card current",children:[e.jsxs("div",{className:"tier-header",children:[e.jsx("h5",{children:"üéØ Free Plan"}),e.jsx("span",{className:"tier-fee",children:"Your Profit 70% Net Sales"})]}),e.jsx("div",{className:"tier-icon-container",children:e.jsx("img",{src:"/passive-icon.png",alt:"Passive Income Icon",className:"tier-icon-image"})}),e.jsxs("div",{className:"tier-savings earnings-bottom",children:[e.jsx("span",{className:"savings-amount",children:"$18,228"}),e.jsx("span",{className:"savings-label",children:"Net Annual Earnings üî•"})]}),e.jsx("div",{className:"tier-content-centered",children:e.jsx("div",{className:"tier-info-text",children:"Free Membership 30% Service Fee"})})]}),e.jsxs("div",{className:"tier-card breakdown-card",children:[e.jsxs("div",{className:"tier-header breakdown-header-aligned",children:[e.jsx("h5",{children:"üí∞ Per Item Example"}),e.jsx("span",{className:"tier-fee",children:"$14.95 Mug"})]}),e.jsxs("div",{className:"item-breakdown-container-vertical",children:[e.jsx("div",{className:"product-visual-centered",children:e.jsx("img",{src:"/mug.png",alt:"Mug Example",className:"product-image-centered"})}),e.jsx("div",{className:"profit-highlight-box",children:e.jsxs("div",{className:"profit-highlight-row",children:[e.jsx("span",{className:"profit-label",children:"Your Profit:"}),e.jsxs("span",{className:"profit-value",children:["$",s.yourProfitPerItem.toFixed(2)]})]})}),e.jsxs("div",{className:"item-breakdown-vertical",children:[e.jsxs("div",{className:"breakdown-row",children:[e.jsx("span",{className:"breakdown-label",children:"Your Selling Price:"}),e.jsxs("span",{className:"breakdown-value",children:["$",s.averageProductPrice.toFixed(2)]})]}),e.jsxs("div",{className:"breakdown-row",children:[e.jsx("span",{className:"breakdown-label",children:"Product Overhead:"}),e.jsxs("span",{className:"breakdown-value cost",children:["-$",s.productOverheadCost.toFixed(2)]})]}),e.jsxs("div",{className:"breakdown-row",children:[e.jsx("span",{className:"breakdown-label",children:"Service Fee (30%):"}),e.jsxs("span",{className:"breakdown-value cost",children:["-$",s.houseCommission.toFixed(2)]})]})]})]})]})]})]}),e.jsxs("div",{className:"value-proposition",children:[e.jsx("h3",{children:"üéØ Why Choose ScreenMerch?"}),e.jsxs("div",{className:"value-grid",children:[e.jsxs("div",{className:"value-item",children:[e.jsx("div",{className:"value-icon",children:"üí∞"}),e.jsx("h4",{children:"Great Rates"}),e.jsx("p",{children:"Keep 70% of your earnings with our competitive 30% service fee"})]}),e.jsxs("div",{className:"value-item",children:[e.jsx("div",{className:"value-icon",children:"üìà"}),e.jsx("h4",{children:"Analytics"}),e.jsx("p",{children:"Track your sales, understand your audience, and optimize for growth"})]}),e.jsxs("div",{className:"value-item",children:[e.jsx("div",{className:"value-icon",children:"üé®"}),e.jsx("h4",{children:"Easy Setup"}),e.jsx("p",{children:"Simple and intuitive platform to monetize your content"})]}),e.jsxs("div",{className:"value-item",children:[e.jsx("div",{className:"value-icon",children:"üöÄ"}),e.jsx("h4",{children:"Completely Free"}),e.jsx("p",{children:"No monthly fees, no recurring charges, no hidden costs - just start earning immediately"})]})]})]}),!r&&e.jsx("div",{className:"signup-cta-section",children:e.jsx("button",{className:"hero-signup-btn",onClick:()=>_(),disabled:m,children:m?"Processing...":"Sign Up Now"})}),e.jsx(Ra,{apiBase:"https://screenmerch.fly.dev",isOpen:h,onClose:x,onSignup:b})]})};const Ud=()=>{const[t]=Et(),s=ct(),[r,a]=c.useState(!0),[i,o]=c.useState(!1),[n,u]=c.useState(null),[m,f]=c.useState(!1),[k,M]=c.useState(null);return c.useEffect(()=>{window.scrollTo(0,0),(()=>{try{const _=JSON.parse(localStorage.getItem("processedSessions")||"[]");if(_.length>10){const b=_.slice(-10);localStorage.setItem("processedSessions",JSON.stringify(b)),console.log("üßπ Cleaned up old processed sessions")}}catch(_){console.error("Error cleaning up sessions:",_)}})(),(async()=>{const _=t.get("session_id"),b=localStorage.getItem("pendingSubscriptionSession"),x=JSON.parse(localStorage.getItem("processedSessions")||"[]"),T=parseInt(localStorage.getItem("loginAttempts")||"0");console.log("üîç Session ID Debug:",{sessionIdFromURL:_,pendingSessionFromStorage:b,processedSessions:x,loginAttempts:T,searchParams:Object.fromEntries(t.entries())});const S=_||b;if(console.log("üéØ Session to use:",S),!S){console.log("üìã No session ID - checking if user is logged in for instructions");const{data:{user:E}}=await R.auth.getUser();if(E){console.log("‚úÖ User is logged in, showing instructions"),M(E.email),o(!0),a(!1);return}else{console.error("‚ùå No session ID and user not logged in"),u("Please sign in to view your instructions and personal link"),a(!1);return}}if(x.includes(S)){console.log("‚ö†Ô∏è Session already processed, redirecting to dashboard"),o(!0);return}if(T>=3){console.error("‚ùå Too many login attempts, showing error"),u("Unable to verify subscription. Please contact support."),localStorage.removeItem("loginAttempts"),a(!1);return}_&&!b&&(localStorage.setItem("pendingSubscriptionSession",_),console.log("üíæ Stored session ID from URL:",_)),localStorage.getItem("justLoggedIn")&&(console.log("üîÑ User just logged in, waiting for auth state to settle..."),localStorage.removeItem("justLoggedIn"),await new Promise(E=>setTimeout(E,3e3)));try{let E=null,z=null,V=0;const X=3;for(;V<X;)try{const se=localStorage.getItem("user_authenticated")==="true",be=localStorage.getItem("user_email");if(se&&be)try{const xe=await fetch("https://screenmerch.fly.dev/api/users/ensure-exists",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:be,display_name:be.split("@")[0]})});if(xe.ok){const ae=await xe.json();E={id:ae.user.id,email:ae.user.email},M(ae.user.email),z=null,console.log("‚úÖ User authenticated via localStorage:",be);break}else console.error("Error ensuring user exists:",await xe.text()),z="Failed to ensure user exists in database"}catch(xe){console.error("Error calling ensure-exists API:",xe),z="Failed to verify user in database"}else E=null,z="Not authenticated in localStorage",console.log(`‚ùå Auth attempt ${V+1} failed:`,z);V<X-1&&(console.log(`‚è≥ Auth not ready, retrying in ${1e3/1e3} seconds... (${V+1}/${X})`),await new Promise(ae=>setTimeout(ae,1e3))),V++}catch(se){console.error(`‚ùå Auth check error on attempt ${V+1}:`,se),V++,V<X&&await new Promise(be=>setTimeout(be,1e3))}if(z||!E){console.log("‚ö†Ô∏è User not authenticated after retries, redirecting to login...");const se=T+1;localStorage.setItem("loginAttempts",se.toString()),f(!0),a(!1),setTimeout(()=>{s("/login?returnTo=/subscription-success")},3e3);return}console.log("‚úÖ User authenticated successfully:",E.email),localStorage.removeItem("loginAttempts"),b&&(localStorage.removeItem("pendingSubscriptionSession"),console.log("üßπ Cleared pending session from localStorage")),console.log("üîç Verifying subscription with session:",S);const $=await(await fetch(`${ze.ENDPOINTS.VERIFY_SUBSCRIPTION}/${S}`)).json();if(console.log("üì° Verification response:",$),$.success){const se=await la.activateProSubscription($.subscription_id,$.customer_id);if(se.success){const be=[...x,S];localStorage.setItem("processedSessions",JSON.stringify(be)),o(!0),localStorage.removeItem("pendingSubscriptionSession")}else u(se.error||"Failed to activate subscription")}else u($.message||"Payment verification failed")}catch(E){console.error("‚ùå Error verifying subscription:",E),u("Failed to verify payment")}finally{a(!1)}})()},[t,s]),r?e.jsx("div",{className:"subscription-success-page",children:e.jsxs("div",{className:"success-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("h2",{children:"Verifying your subscription..."}),e.jsx("p",{children:"Please wait while we confirm your payment."})]})}):m?e.jsx("div",{className:"subscription-success-page",children:e.jsxs("div",{className:"success-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("h2",{children:"Payment Successful! üéâ"}),e.jsx("p",{children:"Your payment has been processed successfully."}),e.jsx("p",{children:e.jsx("strong",{children:"Please sign in to complete your subscription activation."})}),e.jsx("p",{children:"You will be redirected to the login page in a few seconds..."}),e.jsx("button",{onClick:()=>s("/login?returnTo=/subscription-success"),className:"retry-btn",style:{marginTop:"20px"},children:"Sign In Now"})]})}):n?e.jsx("div",{className:"subscription-success-page",children:e.jsxs("div",{className:"success-container error",children:[e.jsx("div",{className:"error-icon",children:"‚ùå"}),e.jsx("h2",{children:"Access Required"}),e.jsx("p",{children:n}),n.includes("sign in")?e.jsx("button",{onClick:()=>s("/login"),className:"retry-btn",children:"Sign In"}):e.jsx("button",{onClick:()=>s("/subscription-tiers"),className:"retry-btn",children:"Get Started"})]})}):e.jsx("div",{className:"subscription-success-page",children:e.jsxs("div",{className:"success-container",children:[e.jsx("div",{className:"success-icon",children:"üéâ"}),e.jsxs("p",{className:"welcome-message",children:["üéâ ",e.jsx("strong",{children:"Welcome to ScreenMerch!"})," You're all set to start sharing amazing content and earning from your merchandise.",e.jsx("div",{className:"trial-notice-simple",children:"‚úÖ Your account is ready to start earning!"})]}),e.jsxs("div",{className:"next-steps",children:[e.jsx("h3",{children:"üöÄ Your Next Steps:"}),e.jsxs("ol",{children:[e.jsx("li",{children:e.jsx("strong",{children:"Go to dashboard"})}),e.jsx("li",{children:e.jsx("strong",{children:"Personalize your page and post content"})}),e.jsx("li",{children:e.jsx("strong",{children:"Promote with your personal link"})}),e.jsx("li",{children:e.jsx("strong",{children:"Track your sales in Analytics"})}),e.jsx("li",{children:e.jsx("strong",{children:"Start earning from your merch sales!"})})]}),e.jsx("p",{className:"monthly-payouts",children:"Monthly Payouts"})]}),e.jsxs("div",{className:"channel-link-section",children:[e.jsx("h3",{children:"üõçÔ∏è Your ScreenMerch Channel"}),e.jsx("p",{children:e.jsx("strong",{children:"Share this link with your audience to sell merch:"})}),e.jsxs("div",{className:"channel-link-container",children:[e.jsx("code",{className:"channel-link",children:k?`https://screenmerch.com/channel/${k.split("@")[0]}`:"https://screenmerch.com/channel/your-name"}),e.jsx("button",{onClick:()=>{const h=k?`https://screenmerch.com/channel/${k.split("@")[0]}`:"https://screenmerch.com/channel/your-name";navigator.clipboard.writeText(h),alert("Channel link copied to clipboard!")},className:"copy-link-btn",children:"üìã Copy Link"})]}),e.jsxs("p",{className:"channel-tip",children:["üí° ",e.jsx("strong",{children:"Pro Tip:"})," Add this link to your YouTube descriptions, social media bios, and website to start selling merch to your audience!"]})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:()=>s("/dashboard"),className:"dashboard-btn primary",children:"üöÄ Go to Dashboard"}),e.jsx("button",{onClick:()=>s("/"),className:"dashboard-btn secondary",children:"üè† Go to Homepage"})]})]})})};const Pa=()=>{const t=ct(),[s,r]=c.useState(null),a=()=>{const i=us();return i?`https://${i}.screenmerch.com/`:"/"};return c.useEffect(()=>{(function(){try{localStorage.removeItem("cart"),localStorage.removeItem("cart_items"),localStorage.removeItem("cartData"),localStorage.removeItem("persistent_cart"),sessionStorage.removeItem("cartData"),sessionStorage.removeItem("cart"),Object.keys(localStorage).forEach(u=>{u.toLowerCase().includes("cart")&&localStorage.removeItem(u)}),Object.keys(sessionStorage).forEach(u=>{u.toLowerCase().includes("cart")&&sessionStorage.removeItem(u)}),console.log("üõí Cart cleared after successful purchase")}catch(u){console.error("Error clearing cart:",u)}})();const i=localStorage.getItem("order_tracking");if(i)try{const n=JSON.parse(i);r(n),localStorage.removeItem("order_tracking")}catch(n){console.error("Error parsing tracking data:",n)}const o=document.querySelector(".order-success-container");o&&(o.style.opacity="0",o.style.transform="translateY(20px)",setTimeout(()=>{o.style.transition="all 0.5s ease",o.style.opacity="1",o.style.transform="translateY(0)"},100))},[]),e.jsx("div",{className:"order-success-page",children:e.jsxs("div",{className:"order-success-container",children:[e.jsx("div",{className:"success-icon",children:"‚úÖ"}),e.jsx("h1",{className:"success-title",children:"Order Successful!"}),e.jsx("div",{className:"thank-you-message",children:e.jsx("p",{children:"Thank you for your order. Your custom merchandise is being created."})}),e.jsxs("div",{className:"next-steps",children:[e.jsx("h3",{children:"üöÄ What happens next:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Your order is being processed automatically"}),e.jsx("li",{children:"Products will be created and fulfilled by Printful"}),e.jsx("li",{children:"You'll receive tracking information once shipped"})]})]}),e.jsx("div",{className:"support-info",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Need help?"})," Contact us at"," ",e.jsx("a",{href:"mailto:support@screenmerch.com",children:"support@screenmerch.com"})]})}),e.jsx("div",{className:"action-buttons",children:e.jsx("button",{onClick:()=>{const i=a();i.startsWith("http")?window.location.href=i:t(i)},className:"home-button",children:"Return to Home"})})]})})};const Rd="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA10lEQVR4nO3QPQrCQBQE4NVCbAVrsbEUC72Cnaews02TmRB4XsE72HkIQbG0tdFKRGuxE2ElkJCwaGJ+wCJ5MLDF7veSUao0Y9t2B8Dei3cuGu8DOJPUXgBcAQwLwUmOAdwDPLLkAWCS98unJJ8mHsmL5CyLXSM5j4HNLESk/pMsIg2SyxS49itbiUgzFgfQIrlOizNcsrMsq/2t7y7JQ1acYY6u6/ZMfADgUgCu/dwcxxlFqzkViOvgTz5WlRdWSfO3BSrjvWqBLmdFW/MRgE3We9WopHkDXTJU7bkaB10AAAAASUVORK5CYII=",Md=({sidebar:t,category:s,setCategory:r})=>{const[a,i]=c.useState(!0),[o,n]=c.useState([]),[u,m]=c.useState(!0);return c.useState("platform"),hs(),c.useEffect(()=>{(async()=>{m(!0);try{const{data:k,error:M}=await R.from("users").select(`
            id,
            username,
            display_name,
            profile_image_url,
            created_at
          `).not("username","is",null).order("created_at",{ascending:!1}).limit(10);if(M)console.error("Error fetching platform creators:",M),n([]);else{const h=k.filter(v=>v.username).map(v=>({id:v.id,username:v.username,name:v.display_name||v.username,avatar:v.profile_image_url,joinedAt:v.created_at,type:"platform"}));n(h)}}catch(k){console.error("Error fetching subscribers:",k),n([])}m(!1)})()},[]),e.jsxs("div",{className:`sidebar ${t?"":"small-sidebar"}`,children:[e.jsxs("div",{className:"shortcut-links",children:[e.jsxs(mt,{to:"/",className:`side-link ${s===0?"active":""}`,onClick:()=>r(0),children:[e.jsx("img",{src:Rd,alt:""}),e.jsx("p",{children:"Home"})]}),e.jsx("hr",{})]}),e.jsxs("div",{className:"subscribed-list",children:[e.jsxs("h3",{style:{cursor:"pointer"},onClick:()=>i(f=>!f),children:["CREATORS ",a?"‚ñ≤":"‚ñº"]}),a&&e.jsx("div",{children:u?e.jsx("div",{className:"loading-subs",children:"Loading creators..."}):o.length===0?e.jsx("div",{className:"no-subs",children:"No creators yet."}):e.jsx("div",{className:"subscribers-list",children:o.map(f=>e.jsx("div",{className:"subscriber-item-container",children:e.jsxs(mt,{to:`/profile/${f.username}`,className:"side-link subscriber-item",children:[e.jsx("img",{src:f.avatar||"/default-avatar.jpg",alt:f.name,className:"subscriber-avatar"}),e.jsx("div",{className:"subscriber-info",children:e.jsx("p",{className:"subscriber-name",children:f.name})})]})},f.id))})})]})]})},Dd=()=>{const t=ct();return e.jsxs("div",{style:{minHeight:"60vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("h1",{style:{fontSize:"3rem",marginBottom:16},children:"üöß Coming Soon!"}),e.jsx("p",{style:{fontSize:"1.2rem",color:"#555",marginBottom:32},children:"This category or feature is not available yet. Check back soon for updates!"}),e.jsx("button",{onClick:()=>t("/"),style:{padding:"12px 32px",fontSize:"1rem",borderRadius:8,background:"#222",color:"#fff",border:"none",cursor:"pointer"},children:"Back to Home"})]})},Lr={"Kids Long Sleeve":{front:{default:{width:10,height:12}},back:{default:{width:10,height:12}},dpi:300,description:"Youth Long Sleeve Tee"},"Kids Shirt":{front:{sizes:{"S-M":{width:10,height:12},"L-XL":{width:12,height:16}},default:{width:10,height:12}},back:{sizes:{"S-M":{width:10,height:12},"L-XL":{width:12,height:16}},default:{width:10,height:12}},dpi:300,description:"Kids T-Shirt"},"Kids Hoodie":{width:12,height:14,dpi:300,description:"Kids Hoodie"},"Youth Heavy Blend Hoodie":{front:{sizes:{XS:{width:10,height:7},S:{width:10,height:8},M:{width:10,height:9},L:{width:11.5,height:11},XL:{width:11.5,height:12}},default:{width:10,height:9}},back:{default:{width:11.5,height:13.8}},dpi:300,description:"Youth Heavy Blend Hoodie"},"Toddler Short Sleeve T-Shirt":{width:8,height:10,dpi:300,description:"Toddler T-Shirt"},"Toddler Jersey T-Shirt":{front:{default:{width:7,height:8}},back:{default:{width:7,height:8}},dpi:300,description:"Toddler Jersey"},"Kids Sweatshirt":{front:{sizes:{"XS-M":{width:10,height:12},"L-XL":{width:12,height:16}},default:{width:10,height:12}},back:{sizes:{"XS-M":{width:10,height:12},"L-XL":{width:12,height:16}},default:{width:10,height:12}},dpi:300,description:"Kids Sweatshirt"},"Baby Staple Tee":{front:{default:{width:7,height:8}},back:{default:{width:7,height:8}},dpi:300,description:"Baby Tee"},"Baby Jersey T-Shirt":{front:{default:{width:7,height:8}},back:{default:{width:7,height:8}},dpi:300,description:"Baby Jersey"},"Baby Body Suit":{front:{default:{width:7,height:8}},back:{default:{width:7,height:8}},dpi:300,description:"Baby Body Suit"},"Unisex Classic Tee":{width:12,height:15,dpi:300,description:"Standard T-Shirt"},"Unisex T-Shirt":{front:{sizes:{"XS-M":{width:11.5,height:13.8},"L-3XL":{width:15,height:18}},default:{width:11.5,height:13.8}},back:{default:{width:12,height:16}},dpi:300,description:"Unisex T-Shirt"},"Men's Tank Top":{front:{default:{width:12,height:16}},back:{default:{width:12,height:16}},dpi:300,description:"Tank Top"},"Men's Fitted Long Sleeve":{front:{default:{width:12,height:16}},back:{default:{width:12,height:16}},dpi:300,description:"Long Sleeve Shirt"},"Men's Long Sleeve Shirt":{front:{default:{width:12,height:16}},back:{default:{width:12,height:16}},dpi:300,description:"Long Sleeve Shirt"},"Unisex Hoodie":{front:{default:{width:13,height:13}},back:{default:{width:12,height:16}},dpi:300,description:"Hoodie"},"Unisex Champion Hoodie":{front:{sizes:{"S-M":{width:11.5,height:11.5},"L-XL":{width:13,height:13},"2XL-3XL":{width:14,height:14}},default:{width:11.5,height:11.5}},back:{default:{width:12,height:16}},dpi:300,description:"Champion Hoodie"},"Unisex Pullover Hoodie":{front:{default:{width:13,height:13}},back:{default:{width:12,height:16}},dpi:300,description:"Pullover Hoodie"},"Unisex Heavyweight T-Shirt":{front:{default:{width:12,height:16}},back:{default:{width:12,height:16}},dpi:300,description:"Heavyweight T-Shirt"},"Unisex Oversized T-Shirt":{front:{default:{width:11.5,height:15.3}},back:{default:{width:11.5,height:15.3}},dpi:300,description:"Oversized T-Shirt"},"Mens Fitted T-Shirt":{front:{default:{width:12,height:16}},back:{default:{width:12,height:16}},dpi:300,description:"Fitted T-Shirt"},"Women's Ribbed Neck":{front:{default:{width:12,height:16}},back:{default:{width:12,height:16}},dpi:300,description:"Women's Ribbed Neck"},"Women's Shirt":{front:{sizes:{"S-M":{width:10,height:12},"L-3XL":{width:12,height:16}},default:{width:10,height:12}},back:{sizes:{"S-M":{width:10,height:12},"L-3XL":{width:12,height:16}},default:{width:10,height:12}},dpi:300,description:"Women's Shirt"},"Women's HD Shirt":{width:10,height:13,dpi:300,description:"Women's HD Shirt"},"Women's Crop Top":{front:{default:{width:10,height:10}},back:{default:{width:10,height:10}},dpi:300,description:"Crop Top"},"Cropped Hoodie":{front:{default:{width:10,height:10}},back:{default:{width:10,height:10}},dpi:300,description:"Cropped Hoodie"},"Fitted Racerback Tank":{front:{sizes:{"XS-S":{width:10,height:12},"M-2XL":{width:12,height:16}},default:{width:10,height:12}},back:{sizes:{"XS-S":{width:10,height:12},"M-2XL":{width:12,height:16}},default:{width:10,height:12}},dpi:300,description:"Racerback Tank"},"Micro-Rib Tank Top":{front:{sizes:{"XS-S":{width:10,height:12},"M-2XL":{width:12,height:16}},default:{width:10,height:12}},back:{sizes:{"XS-S":{width:10,height:12},"M-2XL":{width:12,height:16}},default:{width:10,height:12}},dpi:300,description:"Micro-Rib Tank"},"Distressed Dad Hat":{width:5,height:2,dpi:300,description:'Dad Hat Front (5" √ó 2")'},"Closed Back Cap":{width:5,height:2,dpi:300,description:'Closed Back Cap Front (5" √ó 2")'},"Five Panel Trucker Hat":{width:5.5,height:2.5,dpi:300,description:'Trucker Hat Front (5.5" √ó 2.5")'},"Five Panel Baseball Cap":{width:5,height:2,dpi:300,description:'Baseball Cap Front (5" √ó 2")'},"White Glossy Mug":{width:4,height:4,dpi:300,description:"Mug (Square)"},"Travel Mug":{width:4,height:4,dpi:300,description:"Travel Mug (Square)"},"Enamel Mug":{width:4,height:4,dpi:300,description:"Enamel Mug (Square)"},"Colored Mug":{width:4,height:4,dpi:300,description:"Colored Mug (Square)"},"Canvas Tote":{width:12,height:14,dpi:300,description:"Tote Bag"},"Tote Bag":{width:12,height:14,dpi:300,description:"Tote Bag"},"Large Canvas Bag":{width:14,height:16,dpi:300,description:"Large Canvas Bag"},"Laptop Sleeve":{width:14,height:10,dpi:300,description:"Laptop Sleeve (Horizontal)"},"All-Over Print Drawstring":{width:12,height:14,dpi:300,description:"Drawstring Bag"},"All Over Print Tote Pocket":{width:12,height:14,dpi:300,description:"Tote with Pocket"},"All-Over Print Crossbody Bag":{width:10,height:12,dpi:300,description:"Crossbody Bag"},"All-Over Print Utility Bag":{width:12,height:14,dpi:300,description:"Utility Bag"},"Pet Bowl All-Over Print":{width:6,height:6,dpi:300,description:"Pet Bowl (Square)"},"Pet Bandana Collar":{width:12,height:12,dpi:300,description:"Bandana (Square)"},"All Over Print Leash":{width:1,height:48,dpi:300,description:"Leash (Vertical)"},"All Over Print Collar":{width:1,height:12,dpi:300,description:"Collar (Vertical)"},"Hardcover Bound Notebook":{width:3,height:5,dpi:300,description:'Hardcover Bound Notebook (3" √ó 5")'},Coasters:{width:3.97,height:3.97,dpi:300,description:'Coasters (3.97" √ó 3.97")'},Apron:{width:12,height:14,dpi:300,description:"Apron (All-Over Print - Tools Not Available)"},'Kiss Cut Stickers - 3" √ó 3"':{width:3,height:3,dpi:300,description:'Kiss Cut Stickers (3" √ó 3" - Print 3" √ó 3")'},'Kiss Cut Stickers - 4" √ó 4"':{width:4,height:4,dpi:300,description:'Kiss Cut Stickers (4" √ó 4" - Print 4" √ó 4")'},'Kiss Cut Stickers - 5.5" √ó 5.5"':{width:5.5,height:5.5,dpi:300,description:'Kiss Cut Stickers (5.5" √ó 5.5" - Print 5.5" √ó 5.5")'},'Kiss Cut Stickers - 3.75" √ó 15"':{width:3.75,height:15,dpi:300,description:'Kiss Cut Stickers (3.75" √ó 15" - Print 3.75" √ó 15")'},Bandana:{width:27.5,height:27.5,dpi:300,description:'Bandana (27.5" √ó 27.5")'},'Jigsaw Puzzle with Tin - 10" √ó 18" (110 pcs)':{width:9.84,height:7.83,dpi:300,description:'Jigsaw Puzzle with Tin (10" √ó 18" - 110 pcs - Print 9.84" √ó 7.83")'},'Jigsaw Puzzle with Tin - 10" √ó 18" (30 pcs)':{width:9.84,height:7.83,dpi:300,description:'Jigsaw Puzzle with Tin (10" √ó 18" - 30 pcs - Print 9.84" √ó 7.83")'},'Jigsaw Puzzle with Tin - 14" √ó 11" (252 pcs)':{width:14,height:11,dpi:300,description:'Jigsaw Puzzle with Tin (14" √ó 11" - 252 pcs - Print 14" √ó 11")'},'Jigsaw Puzzle with Tin - 21" √ó 15.5" (500 pcs)':{width:21,height:15.5,dpi:300,description:'Jigsaw Puzzle with Tin (21" √ó 15.5" - 500 pcs - Print 21" √ó 15.50")'},'Jigsaw Puzzle with Tin - 30" √ó 20" (1000 pcs)':{width:30.25,height:20.5,dpi:300,description:'Jigsaw Puzzle with Tin (30" √ó 20" - 1000 pcs - Print 30.25" √ó 20.50")'},'Die-Cut Magnets - 3" √ó 3"':{width:3,height:3,dpi:300,description:'Die-Cut Magnets (3" √ó 3" - Print 3" √ó 3")'},'Die-Cut Magnets - 4" √ó 4"':{width:4,height:4,dpi:300,description:'Die-Cut Magnets (4" √ó 4" - Print 4" √ó 4")'},'Die-Cut Magnets - 6" √ó 6"':{width:6,height:6,dpi:300,description:'Die-Cut Magnets (6" √ó 6" - Print 6" √ó 6")'},'Greeting Card - 4" √ó 6"':{width:4.15,height:6.15,dpi:300,description:'Greeting Card (4" √ó 6" - Print Size 4.15" √ó 6.15")'},'Greeting Card - 5" √ó 7"':{width:5.15,height:7.15,dpi:300,description:'Greeting Card (5" √ó 7" - Print Size 5.15" √ó 7.15")'},'Greeting Card - 5.83" √ó 8.27"':{width:5.98,height:8.42,dpi:300,description:'Greeting Card (5.83" √ó 8.27" - Print Size 5.98" √ó 8.42")'}},Qs=(t,s=null,r="front")=>{const a=Lr[t];if(!a)return null;if(a.front||a.back){const i=a[r]||a.front;if(s&&i.sizes){const o=s.toUpperCase();for(const[n,u]of Object.entries(i.sizes)){const m=n.split("-").map(f=>f.trim().toUpperCase());if(m.length===1){if(o===m[0])return u}else{const f=["XS","S","M","L","XL","2XL","3XL"],k=f.indexOf(m[0]),M=f.indexOf(m[1]),h=f.indexOf(o);if(k!==-1&&M!==-1&&h!==-1&&h>=k&&h<=M)return u}}}return i.default||{width:12,height:16}}return{width:a.width,height:a.height}},Ld=(t,s)=>t/s;const Od=()=>{var ya;const[t,s]=c.useState(null),[r,a]=c.useState(!0),[i,o]=c.useState(!1),[n,u]=c.useState("dashboard"),[m,f]=c.useState([]),[k,M]=c.useState([]),[h,v]=c.useState([]),[_,b]=c.useState([]),[x,T]=c.useState({}),[S,A]=c.useState(""),[E,z]=c.useState("all"),[V,X]=c.useState("creator"),[Y,$]=c.useState("active"),[se,be]=c.useState([]),[xe,ae]=c.useState([]),[W,O]=c.useState(!1),[de,G]=c.useState([]),[U,y]=c.useState(!1),[N,D]=c.useState(""),[w,p]=c.useState(""),[ee,ie]=c.useState(!1),[we,Ce]=c.useState([]),[Oe,it]=c.useState([]),[Le,Ye]=c.useState([]),[I,J]=c.useState("all"),[Se,oe]=c.useState(!1),[ve,le]=c.useState(!1),[ne,De]=c.useState(!1),[K,re]=c.useState(!1),[Ae,q]=c.useState([]),[Z,he]=c.useState([]);c.useState([]),c.useState(""),c.useState(!1);const[F,L]=c.useState(null),[H,ue]=c.useState(""),[je,Me]=c.useState(null),[We,g]=c.useState(!1),[te,ge]=c.useState(""),[ye,pe]=c.useState(""),[Te,fe]=c.useState(""),[d,j]=c.useState(null),[C,Q]=c.useState(null),[ce,Ue]=c.useState(!1),[_e,Ne]=c.useState(!1),[He,Fe]=c.useState(!1),[Ke,Je]=c.useState(null),[Ze,pt]=c.useState(null),[ft,Lt]=c.useState({}),[Ie,yt]=c.useState({print_dpi:300,edge_feather:!1,soft_corners:!1,crop_area:{x:"",y:"",width:"",height:""},feather_edge_percent:0,corner_radius_percent:0,frame_enabled:!1,frame_color:"#FF0000",frame_width:10,double_frame:!1,add_white_background:!1}),kt=ct();c.useEffect(()=>{Zt()},[]),c.useEffect(()=>{i&&n==="users"&&fs()},[S,E,V,i,n]),c.useEffect(()=>{i&&K&&n==="dashboard"&&ca()},[i,K,n]),c.useEffect(()=>{i&&n==="subscriptions"&&gr()},[Y,i,n]),c.useEffect(()=>{i&&n==="payouts"&&ua()},[i,n]),c.useEffect(()=>{i&&K&&n==="pending-approval"&&ys()},[i,K,n]),c.useEffect(()=>{i&&n==="order-processing"&&(Us(),ma(),K&&(Ti(),n==="platform-revenue"&&xr()))},[i,n,I,K]),c.useEffect(()=>{K&&n==="admin-management"&&(fr(),Rs())},[K,n]),c.useEffect(()=>{if(!Ze)return;const l=Ie.edge_feather&&Ie.feather_edge_percent>0||Ie.soft_corners&&Ie.corner_radius_percent>0||Ie.frame_enabled&&Ie.frame_width>0,P=setTimeout(async()=>{try{if(l){const B=await pa();B&&B.startsWith("data:image")&&yr(B)}else Je({success:!0,screenshot:Ze})}catch(B){console.error("Error auto-applying effects:",B)}},500);return()=>clearTimeout(P)},[Ze,Ie.feather_edge_percent,Ie.corner_radius_percent,Ie.edge_feather,Ie.soft_corners,Ie.frame_enabled,Ie.frame_width,Ie.frame_color,Ie.double_frame,Ie.add_white_background]);const Zt=async()=>{var l;try{const P=localStorage.getItem("isAuthenticated"),B=localStorage.getItem("user");let Ee=null;if(P==="true"&&B)Ee=JSON.parse(B),console.log("üîê Admin: Found Google OAuth user:",Ee);else{const{data:{user:xt}}=await R.auth.getUser();xt&&(Ee=xt,console.log("üîê Admin: Found Supabase user:",Ee))}if(!Ee){console.log("üîê Admin: No authenticated user found, redirecting to home"),kt("/");return}s(Ee);const Qe=await Be.isAdmin(),nt=await Be.isMasterAdmin(),lt=await Be.isFullAdmin(),dt=await Be.isOrderProcessingAdmin();if(console.log("üîê Admin Status Check:",{isUserAdmin:Qe,isUserFullAdmin:lt,isUserOrderProcessingAdmin:dt,userEmail:(Ee==null?void 0:Ee.email)||((l=Ee==null?void 0:Ee.user_metadata)==null?void 0:l.email),userId:Ee==null?void 0:Ee.id}),!Qe){alert("Access denied. Admin privileges required."),kt("/");return}o(!0),re(nt),le(lt),De(dt),console.log("‚úÖ Admin access granted. Master Admin:",nt,"Order Processing Admin:",dt),dt&&!nt?(u("order-processing"),ma()):nt&&pr()}catch(P){console.error("Error checking admin status:",P),kt("/")}finally{a(!1)}},pr=async()=>{await Promise.all([fs(),ca(),da(),gr(),Ms()])},ca=async()=>{try{const l=await Be.getUsers(0,5,"","active","all");M(l.users||[])}catch(l){console.error("Error loading recent activity users:",l)}},fs=async()=>{try{const l=await Be.getUsers(0,100,S,E,V);console.log("Loaded users:",l.users),f(l.users)}catch(l){console.error("Error loading users:",l)}},da=async()=>{try{const l=await Be.getVideos(0,100,S,E);v(l.videos)}catch(l){console.error("Error loading videos:",l)}},gr=async()=>{try{const l=await Be.getSubscriptions(Y);b(l)}catch(l){console.error("Error loading subscriptions:",l)}},ua=async()=>{O(!0);try{const[l,P]=await Promise.all([Be.getPendingPayouts(),Be.getPayoutHistory()]);be(l),ae(P)}catch(l){console.error("Error loading payouts:",l)}finally{O(!1)}},ys=async()=>{y(!0);try{const l=await Be.getPendingCreators();G(l)}catch(l){console.error("Error loading pending approval:",l)}finally{y(!1)}},Ei=async l=>{const P=await Be.approveCreator(l);P.success?(await ys(),Ms()):alert(P.error||"Failed to approve")},Ii=async l=>{if(!window.confirm("Disapprove this creator? They will not be able to use the platform."))return;const P=await Be.disapproveCreator(l);P.success?(await ys(),Ms()):alert(P.error||"Failed to disapprove")},ha=async()=>{const l=N.trim().toLowerCase();if(!l){p("Please enter an email address.");return}p(""),ie(!0);try{const P=await Be.setCreatorPending(l);P.success?(D(""),p(P.message||"Creator added to Pending Approval list."),await ys(),Ms()):p(P.error||"Failed to add to pending")}finally{ie(!1)}},Us=async()=>{var l;oe(!0);try{const P=await Be.getProcessingQueue(I);if(ne&&!K){const B=(t==null?void 0:t.email)||((l=t==null?void 0:t.user_metadata)==null?void 0:l.email);if(B){const{data:Ee}=await R.from("users").select("id").ilike("email",B).single();if(Ee!=null&&Ee.id){const Qe=P.filter(nt=>nt.assigned_to===Ee.id);Ce(Qe)}else Ce([])}else Ce([])}else Ce(P)}catch(P){console.error("Error loading processing queue:",P)}finally{oe(!1)}},ma=async()=>{try{const l=await Be.getProcessingHistory(50);it(l)}catch(l){console.error("Error loading processing history:",l)}},Ti=async()=>{try{const l=await Be.getWorkers();Ye(l)}catch(l){console.error("Error loading workers:",l)}},fr=async()=>{try{const l=await Be.getAdminSignupRequests();q(l)}catch(l){console.error("Error loading admin signup requests:",l)}},Rs=async()=>{try{const l=await Be.getAllAdmins();he(l)}catch(l){console.error("Error loading admins:",l)}},Ui=async(l,P)=>{try{const B=await Be.approveAdminSignupRequest(l,P);B.success?(alert("Admin request approved successfully! Please set up the user in Supabase Auth with the provided password."),fr(),Rs()):alert(`Error: ${B.error}`)}catch(B){console.error("Error approving admin request:",B),alert("Failed to approve admin request")}},Ri=async l=>{const P=prompt("Enter rejection notes (optional):");try{const B=await Be.rejectAdminSignupRequest(l,P||"");B.success?(alert("Admin request rejected"),fr()):alert(`Error: ${B.error}`)}catch(B){console.error("Error rejecting admin request:",B),alert("Failed to reject admin request")}},Mi=async(l,P)=>{try{const B=await Be.updateAdminRole(l,P);B.success?(alert("Admin role updated successfully"),Rs()):alert(`Error: ${B.error}`)}catch(B){console.error("Error updating admin role:",B),alert("Failed to update admin role")}},Di=async l=>{if(window.confirm("Are you sure you want to remove admin access from this user?"))try{const P=await Be.removeAdminAccess(l);P.success?(alert("Admin access removed successfully"),Rs()):alert(`Error: ${P.error}`)}catch(P){console.error("Error removing admin access:",P),alert("Failed to remove admin access")}},Li=async()=>{if(C===null||!d||!d.cart){alert("Please select a cart item first");return}const l=d.cart[C];if(!l||!l.img&&!l.selected_screenshot){alert("No screenshot found for this item");return}Ue(!0),Je(null),pt(null);try{const P=l.selected_screenshot||l.img,B={}.REACT_APP_API_URL||"https://screenmerch.fly.dev",Ee=l.product||"",Qe=(l.variants||{}).size||null,nt=Qs(Ee,Qe,"front"),lt={thumbnail_data:P,print_dpi:Ie.print_dpi,soft_corners:!1,edge_feather:!1,frame_enabled:!1,corner_radius_percent:0,feather_edge_percent:0};nt?(lt.print_area_width=nt.width,lt.print_area_height=nt.height,console.log(`üìê [PRINT_QUALITY] Using print area dimensions for ${Ee} (${Qe||"default"}): ${nt.width}"x${nt.height}"`)):console.warn(`‚ö†Ô∏è [PRINT_QUALITY] No print area dimensions found for product: ${Ee}`);const dt=await fetch(`${B}/api/process-thumbnail-print-quality`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(lt)});if(!dt.ok){const Ls=await dt.json();throw new Error(Ls.error||`HTTP error! status: ${dt.status}`)}const xt=await dt.json();if(!xt.success)throw new Error(xt.error||"Failed to generate 300 DPI image");if(!xt.screenshot||!xt.screenshot.startsWith("data:image"))throw console.error("Invalid image data received:",xt),new Error("Invalid image data received from server");console.log("‚úÖ 300 DPI image generated successfully, length:",xt.screenshot.length),pt(xt.screenshot),Je(xt)}catch(P){console.error("Error generating 300 DPI image:",P),alert(`Error generating 300 DPI image: ${P.message}`)}finally{Ue(!1)}},pa=async(l=null)=>{if(!Ze)throw new Error("No 300 DPI image available. Please complete Step 1 first.");const P=l||Ie,B=P.edge_feather,Ee=P.soft_corners,Qe=B&&P.feather_edge_percent||0,nt=Ee&&P.corner_radius_percent||0,lt={}.REACT_APP_API_URL||"https://screenmerch.fly.dev",dt=P.frame_enabled||!1,xt=P.frame_color||"#FF0000",Ls=P.frame_width||10,xa=P.double_frame||!1;console.log(`applyBothEffects: Using unified API (like email generator). Corner: ${nt}%, Feather: ${Qe}%, Frame: ${dt?`enabled (${xt}, ${Ls}px, double: ${xa})`:"disabled"}`);let Os=null;if(d&&C!==null){const Tt=d.cart[C];if(Tt){const Gt=Tt.product||"",wt=(Tt.variants||{}).size||null;Os=Qs(Gt,wt,"front")}}try{const Tt={thumbnail_data:Ze,print_dpi:P.print_dpi||300,soft_corners:Ee,edge_feather:B,corner_radius_percent:nt,feather_edge_percent:Qe,frame_enabled:dt,frame_color:xt,frame_width:Ls,double_frame:xa,add_white_background:P.add_white_background||!1};Os&&(Tt.print_area_width=Os.width,Tt.print_area_height=Os.height);const Gt=await fetch(`${lt}/api/process-thumbnail-print-quality`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(Tt)});if(console.log(`Unified API response status: ${Gt.status}`),Gt.ok){const wt=await Gt.json();if(console.log("Unified API result:",{success:wt.success,hasImage:!!wt.screenshot}),wt.success&&wt.screenshot)return console.log("‚úÖ Both effects applied successfully using unified API"),wt.screenshot;throw console.error("Unified API returned success but no screenshot:",wt),new Error(wt.error||"Failed to apply effects - no image returned")}else{const wt=await Gt.json().catch(()=>({error:"Unknown error"}));throw console.error("Unified API error:",Gt.status,wt),new Error(wt.error||`API error: ${Gt.status}`)}}catch(Tt){throw console.error("Error applying effects with unified API:",Tt),Tt}},yr=l=>{if(C!==null){if(!l||!l.startsWith("data:image")){console.error("Invalid image URL in saveProcessedImage:",l==null?void 0:l.substring(0,100)),alert("Error: Invalid image data received. Please try again.");return}console.log("Saving processed image, URL length:",l.length),Lt(P=>({...P,[C]:{processedImage:l,original300Dpi:Ze}})),Je({success:!0,screenshot:l}),console.log("‚úÖ Processed image saved and displayed")}},Oi=async(l,P)=>{if(!P){alert("Please select a worker");return}try{const B=await Be.assignOrderToWorker(l,P);B.success?(alert("Order assigned successfully"),Us()):alert(`Failed to assign order: ${B.error}`)}catch(B){console.error("Error assigning order:",B),alert("Failed to assign order")}},Bi=async(l,P)=>{if(confirm(`Are you sure you want to delete order ${P?P.slice(0,8):l}? This action cannot be undone.`))try{const B=await Be.deleteOrder(l);B.success?(alert("Order deleted successfully"),Us()):alert(`Failed to delete order: ${B.error}`)}catch(B){console.error("Error deleting order:",B),alert("Failed to delete order")}},Ms=async()=>{try{const l=await Be.getDashboardStats();T({totalUsers:l.total_users||0,totalVideos:l.total_videos||0,totalSubscriptions:l.total_subscriptions||0,pendingVideos:l.pending_videos||0,pendingUsers:l.pending_users||0,activeUsers:l.active_users||0,suspendedUsers:l.suspended_users||0})}catch(l){console.error("Error loading stats:",l)}},xr=async()=>{g(!0);try{const l=await Be.getPlatformRevenue(te||null,ye||null,Te||null);l.success?Me(l):(console.error("Error loading platform revenue:",l.error),alert(`Failed to load platform revenue: ${l.error}`))}catch(l){console.error("Error loading platform revenue:",l),alert("Failed to load platform revenue")}finally{g(!1)}},Ds=async(l,P)=>{if(console.log("üéØ handleUserAction called with:",{userId:l,action:P}),!confirm(`Are you sure you want to ${P} this user?`)){console.log("‚ùå User cancelled the action");return}console.log("‚úÖ User confirmed the action, proceeding...");try{let B;P==="delete"?(console.log("üóëÔ∏è Calling AdminService.deleteUser..."),B=await Be.deleteUser(l),console.log("üóëÔ∏è Delete result:",B)):P==="suspend"?(console.log(`Suspending user ${l}...`),B=await Be.updateUserStatus(l,"suspended"),console.log("Suspend result:",B)):P==="activate"?(console.log(`Activating user ${l}...`),B=await Be.updateUserStatus(l,"active"),console.log("Activate result:",B)):P==="approve"&&(console.log(`Approving user ${l}...`),B=await Be.approveUser(l),console.log("Approve result:",B)),B.success?(alert(`User ${P}d successfully`),console.log("Reloading users..."),await fs(),console.log("Users reloaded")):alert(`Failed to ${P} user: ${B.error}`)}catch(B){console.error(`Error ${P}ing user:`,B),alert(`Failed to ${P} user`)}},Fi=async(l,P)=>{if(confirm("‚ö†Ô∏è WARNING: This will permanently delete all sales and analytics data for this creator. This action cannot be undone. Are you absolutely sure?")&&confirm("This is your final warning. All sales records and analytics will be deleted. Continue?"))try{const B=await Be.resetSales(l);B.success?alert(`‚úÖ Analytics reset successfully! Deleted ${B.deleted_count||0} sales records for ${P||"this creator"}.`):alert(`‚ùå Failed to reset analytics: ${B.error||"Unknown error"}`)}catch(B){console.error("Error resetting analytics:",B),alert(`‚ùå Error resetting analytics: ${B.message}`)}},vr=async(l,P)=>{if(confirm(`Are you sure you want to ${P} this video?`))try{let B;P==="delete"?B=await Be.deleteVideo(l):P==="approve"?B=await Be.updateVideoStatus(l,"approved"):P==="reject"&&(B=await Be.updateVideoStatus(l,"rejected")),B.success?(alert(`Video ${P}d successfully`),da()):alert(`Failed to ${P} video: ${B.error}`)}catch(B){console.error(`Error ${P}ing video:`,B),alert(`Failed to ${P} video`)}},ga=async(l,P)=>{if(confirm(`Are you sure you want to ${P==="delete"?"delete (cancel)":P} this subscription? All data will be preserved.`))try{let Ee;P==="delete"?Ee=await Be.deleteSubscription(l):P==="reactivate"&&(Ee=await Be.reactivateSubscription(l)),Ee.success?(alert(`Subscription ${P==="delete"?"canceled":"reactivated"} successfully`),gr()):alert(`Failed to ${P} subscription: ${Ee.error}`)}catch(Ee){console.error(`Error ${P}ing subscription:`,Ee),alert(`Failed to ${P} subscription`)}},$i=async l=>{if(!l.paypal_email){alert("This creator has not set up their PayPal email. Please ask them to add it in their dashboard.");return}const P=`Process payout of $${l.pending_amount.toFixed(2)} to ${l.display_name}?

PayPal: ${l.paypal_email}

This will mark ${l.earnings_count} earnings as paid.`;if(confirm(P)){O(!0);try{const B=l.earnings.map(Qe=>Qe.id),Ee=await Be.processPayout(l.user_id,l.pending_amount,B);Ee.success?(alert(`Payout processed successfully! Amount: $${l.pending_amount.toFixed(2)}`),await ua()):alert(`Failed to process payout: ${Ee.error}`)}catch(B){console.error("Error processing payout:",B),alert("Failed to process payout")}finally{O(!1)}}},fa=m.filter(l=>{var nt,lt,dt;const P=S.toLowerCase(),B=((nt=l.display_name)==null?void 0:nt.toLowerCase().includes(P))||((lt=l.email)==null?void 0:lt.toLowerCase().includes(P))||((dt=l.subdomain)==null?void 0:dt.toLowerCase().includes(P)),Ee=E==="all"||l.status===E,Qe=V==="all"||l.role===V;return B&&Ee&&Qe}),zi=h.filter(l=>{var Ee,Qe;const P=((Ee=l.title)==null?void 0:Ee.toLowerCase().includes(S.toLowerCase()))||((Qe=l.description)==null?void 0:Qe.toLowerCase().includes(S.toLowerCase())),B=E==="all"||l.verification_status===E;return P&&B});return r?e.jsxs("div",{className:"admin-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading admin panel..."})]}):t?i?e.jsxs("div",{className:"admin-container",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{children:K?"Admin Portal - UPDATED VERSION 2025":"Order Processing Portal"}),e.jsxs("div",{className:"admin-user-info",children:[e.jsxs("span",{children:["Welcome, ",((ya=t==null?void 0:t.user_metadata)==null?void 0:ya.name)||(t==null?void 0:t.email),K&&e.jsx("span",{style:{fontSize:"14px",color:"#ff6b6b",marginLeft:"10px",fontWeight:"bold"},children:"(Master Admin)"}),ne&&!ve&&e.jsx("span",{style:{fontSize:"14px",color:"#999",marginLeft:"10px"},children:"(Order Processing Admin)"})]}),e.jsx("button",{onClick:()=>kt("/"),className:"admin-logout-btn",children:"Back to Site"})]})]}),e.jsxs("div",{className:"admin-content",children:[e.jsxs("div",{className:"admin-sidebar",children:[ve&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`admin-tab ${n==="dashboard"?"active":""}`,onClick:()=>u("dashboard"),children:"Dashboard"}),e.jsx("button",{className:`admin-tab ${n==="users"?"active":""}`,onClick:()=>u("users"),children:"User Management"}),e.jsx("button",{className:`admin-tab ${n==="videos"?"active":""}`,onClick:()=>u("videos"),children:"Content Moderation"}),e.jsx("button",{className:`admin-tab ${n==="subscriptions"?"active":""}`,onClick:()=>u("subscriptions"),children:"Subscriptions"}),e.jsx("button",{className:`admin-tab ${n==="payouts"?"active":""}`,onClick:()=>u("payouts"),children:"üí∞ Payouts"}),K&&e.jsx("button",{className:`admin-tab ${n==="pending-approval"?"active":""}`,onClick:()=>u("pending-approval"),children:"‚è≥ Pending Approval"})]}),(ve||ne)&&e.jsx("button",{className:`admin-tab ${n==="order-processing"?"active":""}`,onClick:()=>u("order-processing"),children:"üì¶ Order Processing"}),K&&e.jsx("button",{className:`admin-tab ${n==="admin-management"?"active":""}`,onClick:()=>u("admin-management"),children:"üë• Admin Management"}),K&&e.jsx("button",{className:`admin-tab ${n==="platform-revenue"?"active":""}`,onClick:()=>u("platform-revenue"),children:"üíµ Platform Revenue"}),ve&&e.jsx("button",{className:`admin-tab ${n==="settings"?"active":""}`,onClick:()=>u("settings"),children:"System Settings"})]}),e.jsxs("div",{className:"admin-main",children:[n==="dashboard"&&K&&e.jsxs("div",{className:"admin-dashboard",children:[e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Users"}),e.jsx("p",{className:"stat-number",children:x.totalUsers})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Active Users"}),e.jsx("p",{className:"stat-number",children:x.activeUsers})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Suspended Users"}),e.jsx("p",{className:"stat-number",children:x.suspendedUsers})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Videos"}),e.jsx("p",{className:"stat-number",children:x.totalVideos})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Active Subscriptions"}),e.jsx("p",{className:"stat-number",children:x.totalSubscriptions})]})]}),e.jsxs("div",{className:"recent-activity",children:[e.jsx("h3",{children:"Recent Activity"}),e.jsx("div",{className:"activity-list",children:k.map(l=>e.jsxs("div",{className:"activity-item",children:[e.jsxs("span",{children:["New user: ",l.display_name||l.email]}),e.jsx("span",{children:l.created_at?new Date(l.created_at).toLocaleDateString():"‚Äî"})]},l.id))})]})]}),n==="users"&&K&&e.jsxs("div",{className:"admin-users",children:[e.jsxs("div",{className:"admin-filters",children:[e.jsx("input",{type:"text",placeholder:"Search users...",value:S,onChange:l=>A(l.target.value),onKeyDown:l=>{l.key==="Enter"&&fs()},className:"admin-search"}),e.jsxs("select",{value:V,onChange:l=>X(l.target.value),className:"admin-filter",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"creator",children:"Creators"}),e.jsx("option",{value:"customer",children:"Customers"})]}),e.jsxs("select",{value:E,onChange:l=>z(l.target.value),className:"admin-filter",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"suspended",children:"Suspended"})]})]}),e.jsx("div",{className:"users-table",style:{overflowX:"auto",width:"100%"},children:e.jsxs("table",{style:{minWidth:"1400px",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Subdomain"}),e.jsx("th",{children:"Joined"}),e.jsx("th",{children:"Status"}),e.jsx("th",{style:{backgroundColor:"#ffeb3b",color:"#000",minWidth:"200px",position:"sticky",right:"0"},children:"Actions"})]})}),e.jsxs("tbody",{children:[console.log("üîç Rendering users table with",fa.length,"users"),fa.map(l=>{var P;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"user-info",children:[e.jsx("img",{src:l.profile_image_url||((P=l.user_metadata)==null?void 0:P.picture)||l.picture||"/default-avatar.jpg",alt:l.display_name,className:"user-avatar",onError:B=>{B.target.dataset.fallbackUsed||(console.log("üñºÔ∏è Admin user image failed to load, using default"),B.target.dataset.fallbackUsed="true",B.target.src="/default-avatar.jpg")}}),e.jsx("span",{children:l.display_name||"No name"})]})}),e.jsx("td",{children:l.email}),e.jsx("td",{children:e.jsx("span",{style:{padding:"4px 8px",borderRadius:"4px",backgroundColor:l.role==="creator"?"#e3f2fd":"#f5f5f5",color:l.role==="creator"?"#1976d2":"#666",textTransform:"capitalize",fontSize:"12px",fontWeight:"500"},children:l.role||"customer"})}),e.jsx("td",{children:F===l.id?e.jsxs("div",{style:{display:"flex",gap:"5px",alignItems:"center"},children:[e.jsx("input",{type:"text",value:H,onChange:B=>ue(B.target.value),placeholder:"subdomain",style:{padding:"4px 8px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"12px",width:"150px"}}),e.jsx("button",{onClick:async()=>{const B=await Be.updateSubdomain(l.id,H);B.success?(alert(B.message||"Subdomain updated successfully!"),L(null),ue(""),fs()):alert(`Error: ${B.error}`)},style:{padding:"4px 8px",fontSize:"11px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"‚úì"}),e.jsx("button",{onClick:()=>{L(null),ue("")},style:{padding:"4px 8px",fontSize:"11px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"‚úï"})]}):e.jsx("div",{style:{display:"flex",gap:"5px",alignItems:"center"},children:l.subdomain?e.jsxs(e.Fragment,{children:[e.jsx("a",{href:`https://${l.subdomain}.screenmerch.com`,target:"_blank",rel:"noopener noreferrer",style:{color:"#667eea",textDecoration:"none",fontSize:"12px"},onClick:B=>B.stopPropagation(),children:l.subdomain}),K&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:async()=>{const B=await Be.validateSubdomain(l.subdomain);B.success?B.is_accessible?alert(`‚úÖ Subdomain is accessible! Status: ${B.status_code||"OK"}`):alert(`‚ùå Subdomain is not accessible. ${B.error||"Check DNS configuration."}`):alert(`Error validating subdomain: ${B.error}`)},style:{padding:"2px 6px",fontSize:"10px",backgroundColor:"#667eea",color:"white",border:"none",borderRadius:"3px",cursor:"pointer"},title:"Validate subdomain",children:"üîç"}),e.jsx("button",{onClick:B=>{B.stopPropagation(),L(l.id),ue(l.subdomain)},style:{padding:"2px 6px",fontSize:"10px",backgroundColor:"#ffc107",color:"black",border:"none",borderRadius:"3px",cursor:"pointer"},title:"Edit subdomain",children:"‚úèÔ∏è"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"#999",fontSize:"12px"},children:"No subdomain"}),K&&e.jsx("button",{onClick:B=>{B.stopPropagation(),L(l.id),ue("")},style:{padding:"2px 6px",fontSize:"10px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"3px",cursor:"pointer"},title:"Add subdomain",children:"+"})]})})}),e.jsx("td",{children:new Date(l.created_at).toLocaleDateString()}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${l.status||"active"}`,children:l.status?l.status.toUpperCase():"ACTIVE"})}),e.jsx("td",{style:{minWidth:"200px",position:"sticky",right:"0",backgroundColor:"#fff",zIndex:10},children:e.jsxs("div",{className:"action-buttons",children:[l.status==="pending"&&e.jsx("button",{onClick:()=>Ds(l.id,"approve"),className:"action-btn approve",style:{backgroundColor:"#28a745",color:"white"},children:"Approve"}),e.jsx("button",{onClick:()=>Ds(l.id,"suspend"),className:"action-btn suspend",disabled:l.status==="suspended",children:"Suspend"}),e.jsx("button",{onClick:()=>Ds(l.id,"activate"),className:"action-btn activate",disabled:l.status==="active"||l.status==="pending",children:"Activate"}),e.jsx("button",{onClick:B=>{B.preventDefault(),B.stopPropagation(),alert("Delete button clicked!"),console.log("üóëÔ∏è DELETE BUTTON CLICKED!"),console.log("üóëÔ∏è User ID:",l.id),console.log("üóëÔ∏è User email:",l.email),console.log("üóëÔ∏è Event:",B),Ds(l.id,"delete")},className:"action-btn delete",style:{backgroundColor:"#dc3545",color:"white",padding:"8px 16px",fontSize:"14px",cursor:"pointer"},children:"Delete"}),K&&l.role==="creator"&&e.jsx("button",{onClick:B=>{B.preventDefault(),B.stopPropagation(),Fi(l.id,l.email)},className:"action-btn reset-analytics",style:{backgroundColor:"#ff9800",color:"white",padding:"8px 16px",fontSize:"14px",cursor:"pointer",marginLeft:"4px"},title:"Reset all sales and analytics data for this creator",children:"üîÑ Reset Analytics"})]})})]},l.id)})]})]})})]}),n==="videos"&&K&&e.jsxs("div",{className:"admin-videos",children:[e.jsxs("div",{className:"admin-filters",children:[e.jsx("input",{type:"text",placeholder:"Search videos...",value:S,onChange:l=>A(l.target.value),className:"admin-search"}),e.jsxs("select",{value:E,onChange:l=>z(l.target.value),className:"admin-filter",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),e.jsx("div",{className:"videos-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Video"}),e.jsx("th",{children:"Creator"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Uploaded"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:zi.map(l=>{var P,B,Ee;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"video-info",children:[e.jsx("img",{src:l.thumbnail||"/default-thumbnail.jpg",alt:l.title,className:"video-thumbnail"}),e.jsxs("div",{children:[e.jsx("h4",{children:l.title}),e.jsxs("p",{children:[(P=l.description)==null?void 0:P.substring(0,100),"..."]})]})]})}),e.jsx("td",{children:((B=l.users)==null?void 0:B.display_name)||((Ee=l.users)==null?void 0:Ee.email)}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${l.verification_status}`,children:l.verification_status})}),e.jsx("td",{children:new Date(l.created_at).toLocaleDateString()}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:()=>vr(l.id,"approve"),className:"action-btn approve",disabled:l.verification_status==="approved",children:"Approve"}),e.jsx("button",{onClick:()=>vr(l.id,"reject"),className:"action-btn reject",disabled:l.verification_status==="rejected",children:"Reject"}),e.jsx("button",{onClick:()=>vr(l.id,"delete"),className:"action-btn delete",children:"Delete"})]})})]},l.id)})})]})})]}),n==="subscriptions"&&K&&e.jsxs("div",{className:"admin-subscriptions",children:[e.jsx("h3",{children:"Subscription Management"}),e.jsxs("p",{className:"admin-note",style:{marginBottom:"12px",fontSize:"13px",color:"#666"},children:["To fully delete a user and reuse their email, you must also delete them in Supabase: ",e.jsx("strong",{children:"Authentication ‚Üí Users"})," (and optionally the row in Table Editor ‚Üí users)."]}),e.jsx("div",{className:"admin-filters",children:e.jsxs("select",{value:Y,onChange:l=>$(l.target.value),className:"admin-filter",children:[e.jsx("option",{value:"active",children:"Active Subscriptions"}),e.jsx("option",{value:"canceled",children:"Canceled Subscriptions"}),e.jsx("option",{value:"all",children:"All Subscriptions"})]})}),e.jsx("div",{className:"subscriptions-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"User email"}),e.jsx("th",{children:"Tier"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Start Date"}),e.jsx("th",{children:"End Date"}),e.jsx("th",{style:{backgroundColor:"#ffeb3b",color:"#000",minWidth:"150px",position:"sticky",right:"0"},children:"Actions"})]})}),e.jsx("tbody",{children:_.map(l=>{var P,B;return e.jsxs("tr",{children:[e.jsx("td",{children:((P=l.users)==null?void 0:P.display_name)||"‚Äî"}),e.jsx("td",{children:((B=l.users)==null?void 0:B.email)||l.email||"‚Äî"}),e.jsx("td",{children:e.jsx("span",{className:`tier-badge ${l.tier}`,children:l.tier})}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${l.status}`,children:l.status})}),e.jsx("td",{children:l.current_period_start?new Date(l.current_period_start).toLocaleDateString():"N/A"}),e.jsx("td",{children:l.current_period_end?new Date(l.current_period_end).toLocaleDateString():"N/A"}),e.jsx("td",{style:{minWidth:"150px",position:"sticky",right:"0",backgroundColor:"#fff",zIndex:10},children:e.jsx("div",{className:"action-buttons",children:l.status==="canceled"?e.jsx("button",{onClick:()=>ga(l.id,"reactivate"),className:"action-btn activate",style:{backgroundColor:"#28a745",color:"white"},children:"Reactivate"}):e.jsx("button",{onClick:()=>ga(l.id,"delete"),className:"action-btn delete",style:{backgroundColor:"#dc3545",color:"white"},children:"Delete"})})})]},l.id)})})]})})]}),n==="payouts"&&K&&e.jsxs("div",{className:"admin-payouts",children:[e.jsxs("div",{className:"payouts-header",children:[e.jsx("h3",{children:"üí∞ Payout Management"}),e.jsx("p",{children:"Process payouts to creators who have reached the $50 minimum threshold"})]}),W?e.jsxs("div",{className:"admin-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading payouts..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"payouts-section",children:[e.jsxs("h4",{children:["Pending Payouts (",se.length,")"]}),se.length===0?e.jsx("div",{className:"no-payouts",children:e.jsx("p",{children:"No pending payouts. All creators with earnings above $50 have been paid."})}):e.jsx("div",{className:"payouts-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Creator"}),e.jsx("th",{children:"PayPal Email"}),e.jsx("th",{children:"Pending Amount"}),e.jsx("th",{children:"Earnings Count"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:se.map(l=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"user-info",children:[e.jsx("img",{src:l.profile_image_url||"/default-avatar.jpg",alt:l.display_name,className:"user-avatar",onError:P=>{P.target.src="/default-avatar.jpg"}}),e.jsxs("div",{children:[e.jsx("div",{children:l.display_name}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:l.email})]})]})}),e.jsx("td",{children:l.paypal_email?e.jsx("span",{style:{color:"#28a745",fontWeight:"500"},children:l.paypal_email}):e.jsx("span",{style:{color:"#dc3545",fontStyle:"italic"},children:"Not set up"})}),e.jsx("td",{children:e.jsxs("span",{style:{fontSize:"18px",fontWeight:"700",color:"#28a745"},children:["$",l.pending_amount.toFixed(2)]})}),e.jsxs("td",{children:[l.earnings_count," sales"]}),e.jsx("td",{children:e.jsx("button",{onClick:()=>$i(l),className:"action-btn approve",disabled:!l.paypal_email||W,style:{backgroundColor:l.paypal_email?"#28a745":"#ccc",color:"white",cursor:l.paypal_email?"pointer":"not-allowed"},children:"Process Payout"})})]},l.user_id))})]})})]}),e.jsxs("div",{className:"payouts-section",style:{marginTop:"40px"},children:[e.jsx("h4",{children:"Payout History"}),xe.length===0?e.jsx("div",{className:"no-payouts",children:e.jsx("p",{children:"No payout history yet."})}):e.jsx("div",{className:"payouts-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Creator"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Payment Method"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Processed Date"})]})}),e.jsx("tbody",{children:xe.map(l=>{var P,B,Ee;return e.jsxs("tr",{children:[e.jsx("td",{children:((P=l.user)==null?void 0:P.display_name)||((B=l.user)==null?void 0:B.email)||"Unknown"}),e.jsx("td",{children:e.jsxs("span",{style:{fontWeight:"600"},children:["$",parseFloat(l.amount).toFixed(2)]})}),e.jsx("td",{children:l.payment_method||"paypal"}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${l.status}`,children:((Ee=l.status)==null?void 0:Ee.toUpperCase())||"COMPLETED"})}),e.jsx("td",{children:l.processed_date?new Date(l.processed_date).toLocaleDateString():new Date(l.payout_date).toLocaleDateString()})]},l.id)})})]})})]})]})]}),n==="pending-approval"&&K&&e.jsxs("div",{className:"admin-pending-approval",children:[e.jsxs("div",{className:"pending-approval-header",children:[e.jsx("h3",{children:"‚è≥ Pending Approval"}),e.jsx("p",{children:"Review and approve or deny new creator sign-ups. Use the sidebar link under Payouts to open this page."}),e.jsx("button",{type:"button",onClick:ys,disabled:U,className:"pending-approval-refresh-btn",children:U?"Loading‚Ä¶":"Refresh list"})]}),e.jsxs("div",{className:"pending-approval-add-section",children:[e.jsx("label",{htmlFor:"add-to-pending-email",className:"pending-approval-add-label",children:"Recovery only: add existing creator to Pending by email (e.g. if a sign-up did not appear automatically)"}),e.jsxs("div",{className:"pending-approval-add-row",children:[e.jsx("input",{id:"add-to-pending-email",type:"email",placeholder:"e.g. creator@example.com",value:N,onChange:l=>{D(l.target.value),p("")},onKeyDown:l=>l.key==="Enter"&&ha(),className:"pending-approval-add-input",disabled:ee}),e.jsx("button",{type:"button",onClick:ha,disabled:ee,className:"pending-approval-add-btn",children:ee?"Adding‚Ä¶":"Add to Pending"})]}),w&&e.jsx("p",{className:`pending-approval-add-message ${w.includes("added")||w.includes("Creator")?"success":"error"}`,children:w})]}),U?e.jsxs("div",{className:"admin-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading pending creators..."})]}):de.length===0?e.jsxs("div",{className:"pending-approval-empty",children:[e.jsx("p",{children:"No pending sign-ups. New creators will appear here after they register."}),e.jsxs("p",{className:"pending-approval-empty-hint",children:["New sign-ups are added automatically when they use Start Free ‚Üí creator signup ‚Üí Google. When there are any, a table will show with each creator and ",e.jsx("strong",{children:"Activate"})," / ",e.jsx("strong",{children:"Deny"}),' buttons. Click "Refresh list" to check again.']})]}):e.jsx("div",{className:"pending-approval-table-wrap",children:e.jsxs("table",{className:"pending-approval-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Creator"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Signed up"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:de.map(l=>e.jsxs("tr",{className:"pending-approval-row",children:[e.jsx("td",{children:e.jsxs("div",{className:"pending-approval-creator-cell",children:[e.jsx("div",{className:"pending-approval-avatar",children:l.profile_image_url?e.jsx("img",{src:l.profile_image_url,alt:""}):e.jsx("span",{className:"pending-approval-initial",children:(l.display_name||l.email||"?").charAt(0).toUpperCase()})}),e.jsx("span",{className:"pending-approval-name",children:l.display_name||"‚Äî"})]})}),e.jsx("td",{className:"pending-approval-email-cell",children:l.email}),e.jsx("td",{className:"pending-approval-date-cell",children:l.created_at?new Date(l.created_at).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"‚Äî"}),e.jsx("td",{children:e.jsxs("div",{className:"pending-approval-actions",children:[e.jsx("button",{type:"button",onClick:()=>Ei(l.id),className:"pending-approval-btn pending-approval-btn-activate",children:"Activate"}),e.jsx("button",{type:"button",onClick:()=>Ii(l.id),className:"pending-approval-btn pending-approval-btn-deny",children:"Deny"})]})})]},l.id))})]})})]}),n==="order-processing"&&(K||ne)&&e.jsxs("div",{className:"admin-order-processing",children:[e.jsxs("div",{className:"order-processing-header",children:[e.jsx("h3",{children:"üì¶ Order Processing Queue"}),e.jsx("p",{children:ne&&!K?"View and process your assigned orders":"Manage order processing queue and assign orders to workers"})]}),Se?e.jsxs("div",{className:"admin-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading processing queue..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"queue-filters",children:[e.jsxs("select",{value:I,onChange:l=>J(l.target.value),className:"admin-filter",children:[e.jsx("option",{value:"all",children:"All Orders"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"})]}),e.jsx("button",{onClick:Us,className:"refresh-btn",children:"Refresh"})]}),ne&&!K&&we.length===0&&!Se&&e.jsxs("div",{style:{padding:"20px",background:"#f8f9fa",borderRadius:"8px",marginTop:"20px",textAlign:"center",color:"#666"},children:[e.jsx("p",{children:"You don't have any assigned orders at the moment."}),e.jsx("p",{style:{fontSize:"14px",marginTop:"8px"},children:"Orders will appear here once they are assigned to you by a Master Admin."})]}),e.jsxs("div",{className:"processing-queue-section",children:[e.jsxs("h4",{children:["Processing Queue (",we.length," orders)"]}),we.length===0?e.jsx("div",{className:"no-orders",children:e.jsx("p",{children:"No orders in the processing queue."})}):e.jsx("div",{className:"queue-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Order ID"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Priority"}),K&&e.jsx("th",{children:"Assigned To"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:we.map(l=>{const P=l.orders||{};return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("strong",{children:P.order_id?P.order_id.slice(0,8):"N/A"}),P.cart&&e.jsxs("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:[P.cart.length," item(s)"]})]}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${l.status}`,children:l.status})}),e.jsxs("td",{children:[l.priority===2&&e.jsx("span",{style:{color:"#dc3545",fontWeight:"bold"},children:"Urgent"}),l.priority===1&&e.jsx("span",{style:{color:"#ff9800",fontWeight:"bold"},children:"High"}),l.priority===0&&e.jsx("span",{style:{color:"#666"},children:"Normal"})]}),K&&e.jsx("td",{children:l.assigned_to_user?e.jsxs("div",{children:[e.jsx("div",{children:l.assigned_to_user.display_name||l.assigned_to_user.email}),e.jsx("div",{style:{fontSize:"11px",color:"#999"},children:l.assigned_at?new Date(l.assigned_at).toLocaleDateString():""})]}):e.jsx("span",{style:{color:"#999",fontStyle:"italic"},children:"Unassigned"})}),e.jsx("td",{children:new Date(l.created_at).toLocaleDateString()}),e.jsxs("td",{children:[e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[e.jsx("button",{className:"btn-view-details",onClick:()=>{j(P),Q(null),Je(null),pt(null),Lt({}),yt({print_dpi:300,edge_feather:!1,soft_corners:!1,crop_area:{x:"",y:"",width:"",height:""},feather_edge_percent:0,corner_radius_percent:0,frame_enabled:!1,frame_color:"#FF0000",frame_width:10,double_frame:!1,add_white_background:!1})},style:{padding:"4px 12px",fontSize:"12px",background:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"View Details"}),K&&l.status==="pending"&&e.jsxs("select",{className:"worker-select",onChange:B=>{B.target.value&&Oi(l.id,B.target.value)},defaultValue:"",style:{fontSize:"12px",padding:"4px 8px"},children:[e.jsx("option",{value:"",children:"Assign..."}),Le.map(B=>{var Ee,Qe;return e.jsx("option",{value:B.user_id,children:((Ee=B.user)==null?void 0:Ee.display_name)||((Qe=B.user)==null?void 0:Qe.email)},B.user_id)})]}),K&&e.jsx("button",{onClick:()=>Bi(l.id,P.order_id),style:{padding:"4px 12px",fontSize:"12px",background:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},title:"Delete order",children:"Delete"})]}),l.status==="completed"&&l.notes&&e.jsx("div",{style:{fontSize:"11px",color:"#666",maxWidth:"200px",marginTop:"4px"},children:l.notes})]})]},l.id)})})]})})]}),e.jsxs("div",{className:"processing-history-section",style:{marginTop:"40px"},children:[e.jsx("h4",{children:"Processing History (Last 50)"}),Oe.length===0?e.jsx("div",{className:"no-history",children:e.jsx("p",{children:"No processing history yet."})}):e.jsx("div",{className:"history-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Order ID"}),e.jsx("th",{children:"Processed By"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Processing Time"}),e.jsx("th",{children:"Date"})]})}),e.jsx("tbody",{children:Oe.map(l=>e.jsxs("tr",{children:[e.jsx("td",{children:l.order_id?l.order_id.slice(0,8):"N/A"}),e.jsx("td",{children:l.processed_by_user?l.processed_by_user.display_name||l.processed_by_user.email:"Unknown"}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${l.status}`,children:l.status})}),e.jsx("td",{children:l.processing_time_seconds?`${l.processing_time_seconds}s`:"N/A"}),e.jsx("td",{children:new Date(l.processed_at).toLocaleString()})]},l.id))})]})})]}),K&&e.jsxs("div",{className:"workers-section",style:{marginTop:"40px"},children:[e.jsxs("h4",{children:["Active Workers (",Le.length,")"]}),Le.length===0?e.jsx("div",{className:"no-workers",children:e.jsx("p",{children:"No active workers. Grant processor permissions to users in User Management."})}):e.jsx("div",{className:"workers-list",children:Le.map(l=>{var P,B;return e.jsxs("div",{className:"worker-card",children:[e.jsxs("div",{children:[e.jsx("strong",{children:((P=l.user)==null?void 0:P.display_name)||((B=l.user)==null?void 0:B.email)}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:["Max orders/day: ",l.max_orders_per_day||50]})]}),e.jsx("span",{className:`status-badge ${l.is_active?"active":"inactive"}`,children:l.is_active?"Active":"Inactive"})]},l.user_id)})})]})]})]}),n==="admin-management"&&K&&e.jsxs("div",{className:"admin-management-page",children:[e.jsxs("header",{className:"admin-mgmt-header",children:[e.jsx("h2",{className:"admin-mgmt-title",children:"Admin Management"}),e.jsx("p",{className:"admin-mgmt-subtitle",children:"Approve signup requests and manage admin roles"})]}),e.jsxs("div",{className:"admin-mgmt-grid",children:[e.jsxs("section",{className:"admin-mgmt-card admin-mgmt-card-pending",children:[e.jsxs("h3",{className:"admin-mgmt-card-title",children:[e.jsx("span",{className:"admin-mgmt-card-icon",children:"üìã"}),"Pending Signup Requests",e.jsx("span",{className:"admin-mgmt-badge",children:Ae.filter(l=>l.status==="pending").length})]}),Ae.filter(l=>l.status==="pending").length===0?e.jsx("p",{className:"admin-mgmt-empty",children:"No pending requests. New admins can request access at the signup page."}):e.jsx("div",{className:"admin-mgmt-table-wrap",children:e.jsxs("table",{className:"admin-table admin-mgmt-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Requested"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:Ae.filter(l=>l.status==="pending").map(l=>e.jsxs("tr",{children:[e.jsx("td",{children:l.email}),e.jsx("td",{children:l.requested_at?new Date(l.requested_at).toLocaleString():"‚Äî"}),e.jsxs("td",{children:[e.jsxs("select",{onChange:P=>{P.target.value&&(Ui(l.id,P.target.value),P.target.value="")},defaultValue:"",className:"admin-mgmt-select",children:[e.jsx("option",{value:"",children:"Approve as..."}),e.jsx("option",{value:"master_admin",children:"Master Admin"}),e.jsx("option",{value:"order_processing_admin",children:"Order Processing Admin"})]}),e.jsx("button",{type:"button",onClick:()=>Ri(l.id),className:"admin-mgmt-btn admin-mgmt-btn-reject",children:"Reject"})]})]},l.id))})]})})]}),e.jsxs("section",{className:"admin-mgmt-card admin-mgmt-card-admins",children:[e.jsxs("h3",{className:"admin-mgmt-card-title",children:[e.jsx("span",{className:"admin-mgmt-card-icon",children:"üë§"}),"All Admins",e.jsx("span",{className:"admin-mgmt-badge",children:Z.length})]}),Z.length===0?e.jsx("p",{className:"admin-mgmt-empty",children:"No admins in the system yet. Approve a signup request above or add via Supabase."}):e.jsx("div",{className:"admin-mgmt-table-wrap",children:e.jsxs("table",{className:"admin-table admin-mgmt-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:Z.map(l=>e.jsxs("tr",{children:[e.jsx("td",{children:l.email}),e.jsx("td",{children:l.display_name||"‚Äî"}),e.jsx("td",{children:e.jsxs("select",{value:l.admin_role||"admin",onChange:P=>Mi(l.id,P.target.value),disabled:l.admin_role==="master_admin"&&l.id!==(t==null?void 0:t.id),className:"admin-mgmt-select",children:[e.jsx("option",{value:"master_admin",children:"Master Admin"}),e.jsx("option",{value:"order_processing_admin",children:"Order Processing Admin"})]})}),e.jsx("td",{children:l.created_at?new Date(l.created_at).toLocaleDateString():"‚Äî"}),e.jsx("td",{children:l.admin_role!=="master_admin"&&e.jsx("button",{type:"button",onClick:()=>Di(l.id),className:"admin-mgmt-btn admin-mgmt-btn-remove",children:"Remove"})})]},l.id))})]})})]}),e.jsxs("section",{className:"admin-mgmt-card admin-mgmt-instructions",children:[e.jsxs("h3",{className:"admin-mgmt-card-title",children:[e.jsx("span",{className:"admin-mgmt-card-icon",children:"üìñ"}),"How to add new admins"]}),e.jsxs("ol",{className:"admin-mgmt-steps",children:[e.jsx("li",{children:"Approve a signup request above (user is created in the users table)."}),e.jsx("li",{children:"In Supabase Dashboard ‚Üí Authentication ‚Üí Users, click ‚ÄúAdd user‚Äù and enter the approved email."}),e.jsx("li",{children:"Set a secure password and share it with the admin."}),e.jsx("li",{children:"They can sign in at the admin login with that email and password."})]}),e.jsxs("p",{className:"admin-mgmt-link",children:["Request form: ",e.jsx("a",{href:"/admin-signup",target:"_blank",rel:"noopener noreferrer",children:"/admin-signup"})]})]})]})]}),n==="platform-revenue"&&K&&e.jsxs("div",{className:"platform-revenue",children:[e.jsx("h3",{children:"üíµ Platform Revenue Analytics"}),e.jsx("p",{children:"Track ScreenMerch earnings from 30% commission on creator sales"}),e.jsxs("div",{className:"revenue-filters",style:{marginTop:"20px",marginBottom:"20px",display:"flex",gap:"15px",alignItems:"flex-end",flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"14px",fontWeight:"500"},children:"Start Date:"}),e.jsx("input",{type:"date",value:te,onChange:l=>ge(l.target.value),style:{padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"14px",fontWeight:"500"},children:"End Date:"}),e.jsx("input",{type:"date",value:ye,onChange:l=>pe(l.target.value),style:{padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"14px",fontWeight:"500"},children:"Creator ID (optional):"}),e.jsx("input",{type:"text",value:Te,onChange:l=>fe(l.target.value),placeholder:"Filter by creator ID",style:{padding:"8px",border:"1px solid #ddd",borderRadius:"4px",width:"200px"}})]}),e.jsx("button",{onClick:xr,disabled:We,style:{padding:"8px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:We?"not-allowed":"pointer",opacity:We?.6:1},children:We?"Loading...":"Apply Filters"}),e.jsx("button",{onClick:()=>{ge(""),pe(""),fe(""),xr()},style:{padding:"8px 16px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Clear Filters"})]}),We?e.jsx("div",{style:{textAlign:"center",padding:"40px"},children:e.jsx("p",{children:"Loading platform revenue data..."})}):je&&je.summary?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"revenue-summary",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"20px",marginBottom:"30px"},children:[e.jsxs("div",{style:{backgroundColor:"#f8f9fa",padding:"20px",borderRadius:"8px",border:"1px solid #dee2e6"},children:[e.jsx("h4",{style:{margin:"0 0 10px 0",color:"#666",fontSize:"14px"},children:"Total Platform Revenue"}),e.jsxs("p",{style:{margin:0,fontSize:"24px",fontWeight:"bold",color:"#28a745"},children:["$",je.summary.total_platform_revenue.toFixed(2)]}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"12px",color:"#999"},children:"30% Commission"})]}),e.jsxs("div",{style:{backgroundColor:"#f8f9fa",padding:"20px",borderRadius:"8px",border:"1px solid #dee2e6"},children:[e.jsx("h4",{style:{margin:"0 0 10px 0",color:"#666",fontSize:"14px"},children:"Total Gross Revenue"}),e.jsxs("p",{style:{margin:0,fontSize:"24px",fontWeight:"bold",color:"#007bff"},children:["$",je.summary.total_gross_revenue.toFixed(2)]}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"12px",color:"#999"},children:"All Sales"})]}),e.jsxs("div",{style:{backgroundColor:"#f8f9fa",padding:"20px",borderRadius:"8px",border:"1px solid #dee2e6"},children:[e.jsx("h4",{style:{margin:"0 0 10px 0",color:"#666",fontSize:"14px"},children:"Creator Payouts"}),e.jsxs("p",{style:{margin:0,fontSize:"24px",fontWeight:"bold",color:"#17a2b8"},children:["$",je.summary.total_creator_payouts.toFixed(2)]}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"12px",color:"#999"},children:"70% to Creators"})]}),e.jsxs("div",{style:{backgroundColor:"#f8f9fa",padding:"20px",borderRadius:"8px",border:"1px solid #dee2e6"},children:[e.jsx("h4",{style:{margin:"0 0 10px 0",color:"#666",fontSize:"14px"},children:"Total Transactions"}),e.jsx("p",{style:{margin:0,fontSize:"24px",fontWeight:"bold",color:"#6c757d"},children:je.summary.total_transactions}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"12px",color:"#999"},children:"Sales Count"})]})]}),e.jsxs("div",{style:{marginBottom:"30px"},children:[e.jsx("h4",{children:"Revenue by Creator"}),je.revenue_by_creator&&je.revenue_by_creator.length>0?e.jsxs("table",{className:"admin-table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Creator"}),e.jsx("th",{children:"Subdomain"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Platform Revenue"}),e.jsx("th",{children:"Gross Revenue"}),e.jsx("th",{children:"Creator Payout"}),e.jsx("th",{children:"Transactions"})]})}),e.jsx("tbody",{children:je.revenue_by_creator.map((l,P)=>e.jsxs("tr",{children:[e.jsx("td",{children:l.creator_name}),e.jsx("td",{children:l.creator_subdomain?e.jsxs("span",{style:{fontFamily:"monospace",fontSize:"12px",color:"#666"},children:[l.creator_subdomain,".screenmerch.com"]}):e.jsx("span",{style:{color:"#999",fontStyle:"italic"},children:"No subdomain"})}),e.jsx("td",{children:l.creator_email}),e.jsxs("td",{style:{color:"#28a745",fontWeight:"bold"},children:["$",l.platform_revenue.toFixed(2)]}),e.jsxs("td",{children:["$",l.gross_revenue.toFixed(2)]}),e.jsxs("td",{children:["$",l.creator_payouts.toFixed(2)]}),e.jsx("td",{children:l.transaction_count})]},l.creator_id||P))})]}):e.jsx("p",{children:"No revenue data available"})]}),e.jsxs("div",{style:{marginBottom:"30px"},children:[e.jsx("h4",{children:"Revenue Over Time"}),je.revenue_by_date&&je.revenue_by_date.length>0?e.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:"12px",height:"250px",padding:"20px 20px 40px 20px",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #dee2e6",position:"relative",justifyContent:"flex-start",overflowX:"auto"},children:je.revenue_by_date.map((l,P)=>{const B=Math.max(...je.revenue_by_date.map(dt=>dt.platform_revenue),1),Ee=B>0?Math.max(l.platform_revenue/B*180,l.platform_revenue>0?8:0):0,nt=new Date(l.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}),lt=60;return e.jsxs("div",{style:{width:`${lt}px`,flexShrink:0,display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[l.platform_revenue>0&&e.jsxs("span",{style:{position:"absolute",top:"-20px",fontSize:"11px",fontWeight:"bold",color:"#28a745",whiteSpace:"nowrap",textAlign:"center",width:"100%"},children:["$",l.platform_revenue.toFixed(2)]}),e.jsx("div",{style:{width:`${lt}px`,backgroundColor:l.platform_revenue>0?"#28a745":"#e9ecef",height:`${Ee}px`,minHeight:l.platform_revenue>0?"8px":"2px",borderRadius:"4px 4px 0 0",position:"relative",cursor:"pointer",transition:"background-color 0.2s"},onMouseEnter:dt=>{l.platform_revenue>0&&(dt.currentTarget.style.backgroundColor="#218838")},onMouseLeave:dt=>{l.platform_revenue>0&&(dt.currentTarget.style.backgroundColor="#28a745")},title:`${nt}: $${l.platform_revenue.toFixed(2)} (${l.transaction_count} transaction${l.transaction_count!==1?"s":""})`}),e.jsx("div",{style:{fontSize:"11px",marginTop:"8px",textAlign:"center",color:"#666",whiteSpace:"nowrap",width:"100%"},children:nt})]},P)})}):e.jsx("p",{children:"No date data available"})]}),e.jsxs("div",{style:{marginBottom:"30px"},children:[e.jsx("h4",{children:"Revenue by Product"}),je.revenue_by_product&&je.revenue_by_product.length>0?e.jsxs("table",{className:"admin-table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Platform Revenue"}),e.jsx("th",{children:"Gross Revenue"}),e.jsx("th",{children:"Transactions"})]})}),e.jsx("tbody",{children:je.revenue_by_product.map((l,P)=>e.jsxs("tr",{children:[e.jsx("td",{children:l.product_name}),e.jsxs("td",{style:{color:"#28a745",fontWeight:"bold"},children:["$",l.platform_revenue.toFixed(2)]}),e.jsxs("td",{children:["$",l.gross_revenue.toFixed(2)]}),e.jsx("td",{children:l.transaction_count})]},P))})]}):e.jsx("p",{children:"No product data available"})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"Recent Transactions (Last 100)"}),je.all_transactions&&je.all_transactions.length>0?e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:e.jsxs("table",{className:"admin-table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Creator"}),e.jsx("th",{children:"Subdomain"}),e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Sale Amount"}),e.jsx("th",{children:"Platform Fee (30%)"}),e.jsx("th",{children:"Creator Share (70%)"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:je.all_transactions.map((l,P)=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(l.created_at).toLocaleDateString()}),e.jsx("td",{children:l.creator_name}),e.jsx("td",{children:l.creator_subdomain?e.jsxs("span",{style:{fontFamily:"monospace",fontSize:"11px",color:"#666"},children:[l.creator_subdomain,".screenmerch.com"]}):e.jsx("span",{style:{color:"#999",fontStyle:"italic",fontSize:"11px"},children:"‚Äî"})}),e.jsx("td",{children:l.product_name}),e.jsxs("td",{children:["$",l.sale_amount.toFixed(2)]}),e.jsxs("td",{style:{color:"#28a745",fontWeight:"bold"},children:["$",l.platform_fee.toFixed(2)]}),e.jsxs("td",{children:["$",l.creator_share.toFixed(2)]}),e.jsx("td",{children:e.jsx("span",{style:{padding:"4px 8px",borderRadius:"4px",fontSize:"12px",backgroundColor:l.status==="paid"?"#d4edda":l.status==="pending"?"#fff3cd":"#f8d7da",color:l.status==="paid"?"#155724":l.status==="pending"?"#856404":"#721c24",cursor:l.status==="pending"?"help":"default"},title:l.status==="pending"?"Pending payout to creator (customer payment already received)":l.status==="paid"?"Creator has been paid out":"Transaction cancelled",children:l.status})})]},l.id||P))})]})}):e.jsx("p",{children:"No transactions available"})]})]}):e.jsx("div",{style:{textAlign:"center",padding:"40px"},children:e.jsx("p",{children:'Click "Apply Filters" to load platform revenue data'})})]}),n==="settings"&&K&&e.jsxs("div",{className:"admin-settings",children:[e.jsx("h3",{children:"System Settings"}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h4",{children:"Admin Configuration"}),e.jsx("p",{children:"Configure admin emails and system settings here."}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Admin Emails (comma-separated):"}),e.jsx("input",{type:"text",placeholder:"admin@example.com, admin2@example.com",className:"setting-input"})]}),e.jsx("button",{className:"save-settings-btn",children:"Save Settings"})]})]})]})]}),d&&e.jsx("div",{className:"modal-overlay",onClick:()=>j(null),style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},children:e.jsxs("div",{className:"modal-content",onClick:l=>l.stopPropagation(),style:{background:"white",borderRadius:"8px",padding:"24px",maxWidth:"800px",maxHeight:"90vh",overflow:"auto",position:"relative",width:"90%"},children:[e.jsx("button",{className:"modal-close",onClick:()=>j(null),style:{position:"absolute",top:"16px",right:"16px",background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#666"},children:"√ó"}),e.jsx("h2",{style:{marginTop:0},children:"Order Details"}),e.jsxs("div",{className:"order-details",children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Order ID:"})," ",d.order_id||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",d.status||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Amount:"})," $",d.total_amount?parseFloat(d.total_amount).toFixed(2):"0.00"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Customer Email:"})," ",d.customer_email||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Customer Phone:"})," ",d.customer_phone||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Created:"})," ",d.created_at?new Date(d.created_at).toLocaleString():"N/A"]})]}),d.video_title&&e.jsxs("div",{style:{marginBottom:"20px",padding:"12px",background:"#f5f5f5",borderRadius:"4px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Video Title:"})," ",d.video_title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Creator:"})," ",d.creator_name||"N/A"]}),d.video_url&&e.jsxs("p",{children:[e.jsx("strong",{children:"Video URL:"})," ",e.jsx("a",{href:d.video_url,target:"_blank",rel:"noopener noreferrer",children:d.video_url})]})]}),d.cart&&d.cart.length>0&&e.jsxs("div",{className:"cart-items",style:{marginBottom:"20px"},children:[e.jsxs("h3",{children:["Cart Items (",d.cart.length,"):"]}),d.cart.map((l,P)=>{var B,Ee;return e.jsxs("div",{className:"cart-item",onClick:()=>{Q(P),Je(null),pt(null);let Qe={print_dpi:300,edge_feather:!1,soft_corners:!1,crop_area:{x:"",y:"",width:"",height:""},feather_edge_percent:0,corner_radius_percent:0,frame_enabled:!1,frame_color:"#FF0000",frame_width:10,double_frame:!1,add_white_background:!1};l.toolSettings&&(Qe={print_dpi:300,edge_feather:l.toolSettings.featherEdge>0,soft_corners:l.toolSettings.cornerRadius>0,crop_area:{x:"",y:"",width:"",height:""},feather_edge_percent:l.toolSettings.featherEdge||0,corner_radius_percent:l.toolSettings.cornerRadius||0,frame_enabled:l.toolSettings.frameEnabled||!1,frame_color:l.toolSettings.frameColor||"#FF0000",frame_width:l.toolSettings.frameWidth||10,double_frame:l.toolSettings.doubleFrame||!1},console.log("üì¶ Loaded saved tool settings from cart item:",Qe)),yt(Qe),ft[P]&&(Je(ft[P].processedImage),pt(ft[P].original300Dpi))},style:{border:C===P?"3px solid #007bff":"1px solid #ddd",borderRadius:"4px",padding:"16px",marginBottom:"12px",display:"flex",gap:"16px",cursor:"pointer",backgroundColor:C===P?"#f0f8ff":"white",transition:"all 0.2s ease"},children:[(l.img||l.selected_screenshot)&&e.jsx("div",{style:{flexShrink:0},children:e.jsx("img",{src:l.img||l.selected_screenshot,alt:l.product,style:{width:"120px",height:"120px",objectFit:"cover",borderRadius:"4px",border:"1px solid #ddd"},onError:Qe=>{Qe.target.style.display="none"}})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("p",{style:{fontSize:"16px",fontWeight:"bold",margin:"0 0 8px 0"},children:l.product||"Unknown Product"}),e.jsxs("p",{style:{margin:"4px 0"},children:[e.jsx("strong",{children:"Color:"})," ",((B=l.variants)==null?void 0:B.color)||"N/A"]}),e.jsxs("p",{style:{margin:"4px 0"},children:[e.jsx("strong",{children:"Size:"})," ",((Ee=l.variants)==null?void 0:Ee.size)||"N/A"]}),e.jsxs("p",{style:{margin:"4px 0"},children:[e.jsx("strong",{children:"Price:"})," $",l.price?parseFloat(l.price).toFixed(2):"0.00"]}),l.quantity&&e.jsxs("p",{style:{margin:"4px 0"},children:[e.jsx("strong",{children:"Quantity:"})," ",l.quantity]}),l.note&&e.jsxs("p",{style:{margin:"4px 0",fontStyle:"italic",color:"#666"},children:[e.jsx("strong",{children:"Note:"})," ",l.note]}),l.videoName&&e.jsxs("p",{style:{margin:"4px 0",fontSize:"12px",color:"#666"},children:[e.jsx("strong",{children:"Video:"})," ",l.videoName]}),l.creatorName&&e.jsxs("p",{style:{margin:"4px 0",fontSize:"12px",color:"#666"},children:[e.jsx("strong",{children:"Creator:"})," ",l.creatorName]}),C===P&&e.jsx("p",{style:{margin:"8px 0 0 0",fontSize:"14px",fontWeight:"bold",color:"#007bff"},children:"‚úì Selected for Processing"}),ft[P]&&e.jsx("p",{style:{margin:"8px 0 0 0",fontSize:"14px",fontWeight:"bold",color:"#28a745"},children:"‚úì Processed - Ready for Download"})]})]},P)})]}),e.jsxs("div",{style:{marginBottom:"20px",padding:"12px",background:"#f5f5f5",borderRadius:"4px"},children:[e.jsx("h4",{children:"Shipping Address:"}),d.shipping_address?typeof d.shipping_address=="string"?e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"inherit",margin:0},children:d.shipping_address}):e.jsxs("div",{style:{fontFamily:"inherit"},children:[d.shipping_address.name&&e.jsxs("p",{style:{margin:"4px 0"},children:[e.jsx("strong",{children:"Name:"})," ",d.shipping_address.name]}),d.shipping_address.line1&&e.jsx("p",{style:{margin:"4px 0"},children:d.shipping_address.line1}),d.shipping_address.line2&&e.jsx("p",{style:{margin:"4px 0"},children:d.shipping_address.line2}),(d.shipping_address.city||d.shipping_address.state||d.shipping_address.postal_code)&&e.jsx("p",{style:{margin:"4px 0"},children:[d.shipping_address.city,d.shipping_address.state,d.shipping_address.postal_code].filter(Boolean).join(", ")}),d.shipping_address.country&&e.jsx("p",{style:{margin:"4px 0"},children:d.shipping_address.country}),d.shipping_address.country_code&&e.jsxs("p",{style:{margin:"4px 0"},children:[e.jsx("strong",{children:"Country Code:"})," ",d.shipping_address.country_code]}),d.shipping_address.zip&&e.jsxs("p",{style:{margin:"4px 0"},children:[e.jsx("strong",{children:"ZIP:"})," ",d.shipping_address.zip]}),Object.keys(d.shipping_address).length===0&&e.jsx("p",{style:{color:"#999",fontStyle:"italic"},children:"No address data available"})]}):e.jsx("p",{style:{color:"#999",fontStyle:"italic",margin:0},children:"No shipping address available. Note: Stripe Test Mode may not collect full shipping addresses. Address will be available in Live Mode."})]}),C!==null&&d.cart&&d.cart[C]&&e.jsxs("div",{style:{marginTop:"30px",padding:"20px",background:"#f8f9fa",borderRadius:"8px",border:"2px solid #007bff"},children:[e.jsx("h3",{style:{marginTop:0,color:"#007bff"},children:"üñ®Ô∏è Print Quality Image Generator"}),e.jsxs("p",{style:{color:"#666",fontSize:"14px",marginBottom:"20px"},children:["Processing: ",e.jsx("strong",{children:d.cart[C].product})]}),(()=>{const l=d.cart[C];return e.jsxs("div",{style:{marginBottom:"20px",padding:"16px",background:"white",borderRadius:"4px",border:"1px solid #ddd"},children:[e.jsxs("h4",{style:{marginTop:0},children:["Item ",C+1,": ",l.product]}),(l.img||l.selected_screenshot)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("p",{style:{fontWeight:"bold",marginBottom:"8px"},children:"Original Screenshot:"}),e.jsx("img",{src:l.img||l.selected_screenshot,alt:l.product,style:{maxWidth:"300px",maxHeight:"300px",border:"1px solid #ddd",borderRadius:"4px"},onError:P=>{P.target.style.display="none"}})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:"Print DPI:"}),e.jsxs("select",{value:Ie.print_dpi,onChange:P=>yt({...Ie,print_dpi:parseInt(P.target.value)}),style:{padding:"8px",borderRadius:"4px",border:"1px solid #ddd",width:"200px"},children:[e.jsx("option",{value:300,children:"300 DPI (Standard Print)"}),e.jsx("option",{value:150,children:"150 DPI (Lower Quality)"})]})]}),e.jsxs("div",{style:{background:"#e8f5e8",padding:"20px",borderRadius:"10px",margin:"20px 0",border:"3px solid #28a745",textAlign:"center"},children:[e.jsx("h2",{style:{marginTop:0,color:"#28a745",fontSize:"24px"},children:"üéØ STEP 1: Create 300 DPI Image"}),e.jsx("p",{style:{color:"#666",marginBottom:"20px",fontSize:"16px"},children:"Generate high-resolution 300 DPI image for print quality"}),e.jsx("button",{type:"button",onClick:()=>Li(),disabled:ce,style:{background:ce?"#ccc":"#28a745",color:"white",border:"none",padding:"15px 40px",borderRadius:"8px",cursor:ce?"not-allowed":"pointer",fontWeight:"bold",fontSize:"18px",boxShadow:"0 4px 8px rgba(0,0,0,0.2)"},children:ce?"Generating 300 DPI Image...":"üéØ Generate 300 DPI Image"})]}),e.jsxs("div",{style:{background:"#f8f9fa",padding:"15px",borderRadius:"8px",margin:"20px 0",border:"2px solid #17a2b8"},children:[e.jsx("h3",{style:{marginTop:0,color:"#17a2b8"},children:"‚ú® STEP 2: Feather Edge Tool (Optional)"}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("input",{type:"checkbox",checked:Ie.edge_feather,onChange:P=>{const B=P.target.checked;yt({...Ie,edge_feather:B,feather_edge_percent:B?Ie.feather_edge_percent:0})},style:{transform:"scale(1.2)"}}),"Apply Edge Feathering"]}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"Softens edges to reduce harsh contrast on all clothing products and colors"})]}),Ie.edge_feather&&e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px"},children:"Feather Intensity:"}),e.jsx("input",{type:"range",min:"0",max:"100",value:Ie.feather_edge_percent,onChange:P=>yt({...Ie,feather_edge_percent:parseInt(P.target.value)}),style:{width:"100%"}}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"Adjust the softness of edges (0-100%, higher = more pronounced feather)"}),e.jsxs("div",{style:{marginTop:"5px",fontWeight:"bold",color:"#17a2b8"},children:[Ie.feather_edge_percent,"%"]}),e.jsx("div",{style:{fontSize:"12px",color:"#17a2b8",marginTop:"8px",fontStyle:"italic"},children:"‚úì Effects apply automatically when you adjust the slider"})]})})]}),e.jsxs("div",{style:{background:"#f8f9fa",padding:"15px",borderRadius:"8px",margin:"20px 0",border:"2px solid #28a745"},children:[e.jsx("h3",{style:{marginTop:0,color:"#28a745"},children:"üîÑ STEP 3: Corner Radius Tool (Optional)"}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("input",{type:"checkbox",checked:Ie.soft_corners,onChange:P=>{const B=P.target.checked;yt({...Ie,soft_corners:B,corner_radius_percent:B?Ie.corner_radius_percent:0})},style:{transform:"scale(1.2)"}}),"Apply Rounded Corners"]}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"Adds rounded corners to make images look better on shirts, hoodies, and other apparel"})]}),Ie.soft_corners&&e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px"},children:"Corner Radius:"}),e.jsx("input",{type:"range",min:"0",max:"100",value:Ie.corner_radius_percent,onChange:P=>yt({...Ie,corner_radius_percent:parseInt(P.target.value)}),style:{width:"100%"}}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"Adjust the roundness of corners (0-100%, 100% = perfect circle)"}),e.jsx("div",{style:{marginTop:"5px",fontWeight:"bold",color:"#28a745"},children:Ie.corner_radius_percent===100?"Circle":Ie.corner_radius_percent+"%"}),e.jsx("div",{style:{fontSize:"12px",color:"#28a745",marginTop:"8px",fontStyle:"italic"},children:"‚úì Effects apply automatically when you adjust the slider"})]})})]}),e.jsxs("div",{style:{background:"#f8f9fa",padding:"15px",borderRadius:"8px",margin:"20px 0",border:"2px solid #dc3545"},children:[e.jsx("h3",{style:{marginTop:0,color:"#dc3545"},children:"üñºÔ∏è STEP 4: Framed Border Tool (Optional)"}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("input",{type:"checkbox",checked:Ie.frame_enabled,onChange:P=>{const B=P.target.checked;yt({...Ie,frame_enabled:B})},style:{transform:"scale(1.2)"}}),"Enable Frame"]}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"Add a decorative border frame around the image"})]}),Ie.frame_enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px"},children:"Frame Color:"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("input",{type:"color",value:Ie.frame_color,onChange:P=>yt({...Ie,frame_color:P.target.value}),style:{width:"60px",height:"40px",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer"}}),e.jsx("input",{type:"text",value:Ie.frame_color,onChange:P=>yt({...Ie,frame_color:P.target.value}),style:{padding:"8px",borderRadius:"4px",border:"1px solid #ddd",width:"100px"},placeholder:"#FF0000"})]})]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsxs("label",{style:{display:"block",marginBottom:"8px"},children:["Frame Width: ",Ie.frame_width,"px"]}),e.jsx("input",{type:"range",min:"1",max:"50",value:Ie.frame_width,onChange:P=>yt({...Ie,frame_width:parseInt(P.target.value)}),style:{width:"100%"}}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"Adjust the thickness of the frame border (1-50px)"})]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsxs("label",{style:{fontSize:"14px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("input",{type:"checkbox",checked:Ie.double_frame,onChange:P=>yt({...Ie,double_frame:P.target.checked}),style:{transform:"scale(1.2)"}}),"Double Frame (3D Look)"]}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"Add a second inner frame for a 3D effect"})]}),e.jsxs("div",{style:{marginTop:"20px",padding:"15px",background:"#f0f8ff",borderRadius:"8px",border:"1px solid #4a90e2"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",fontWeight:"bold",color:"#4a90e2"},children:[e.jsx("input",{type:"checkbox",checked:Ie.add_white_background,onChange:P=>yt({...Ie,add_white_background:P.target.checked}),style:{transform:"scale(1.2)"}}),"Add White Background for Printful"]}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px",marginLeft:"28px"},children:"Adds a solid white background behind the design. Recommended for Printful to avoid transparency warnings. Preserves all effects (feather, corner radius, frame)."})]}),e.jsx("button",{type:"button",onClick:async()=>{if(C===null){alert("Please select a cart item first");return}if(!Ze){alert("Please complete Step 1 (Generate 300 DPI Image) first");return}Ne(!0),Fe(!0);try{const P=await pa();if(P){const B=Ie.soft_corners&&Ie.corner_radius_percent||0,Ee=B===100?"Circle":B+"%",Qe=Ie.edge_feather&&Ie.feather_edge_percent||0,nt=Ie.frame_enabled||!1;let lt="";Qe>0&&(lt+=`Feather: ${Qe}%`),B>0&&(lt+=(lt?", ":"")+`Corner Radius: ${Ee}`),nt&&(lt+=(lt?", ":"")+`Frame: ${Ie.frame_width}px ${Ie.double_frame?"(Double)":""}`),lt||(lt="Effects applied"),console.log(`‚úÖ Effects applied: ${lt}`),yr(P)}else throw new Error("Failed to apply effects - no image returned")}catch(P){console.error("Error applying frame effect:",P),alert(`Error applying frame effect: ${P.message}`)}finally{Ne(!1),Fe(!1)}},disabled:_e||He||!Ze,style:{background:_e||He||!Ze?"#ccc":"#dc3545",color:"white",border:"none",padding:"10px 20px",borderRadius:"5px",cursor:_e||He||!Ze?"not-allowed":"pointer",fontWeight:"bold",marginTop:"10px"},children:_e||He?"Applying Effects...":"Apply Frame Effect"})]})]}),Ke&&Ke.success&&e.jsxs("div",{style:{marginTop:"20px",padding:"16px",background:"#d4edda",borderRadius:"4px",border:"1px solid #c3e6cb"},children:[e.jsx("p",{style:{color:"#155724",fontWeight:"bold",marginBottom:"12px"},children:"‚úÖ Image Processed Successfully!"}),e.jsx("div",{style:{marginBottom:"12px"},children:Ke.screenshot?e.jsx("img",{src:Ke.screenshot,alt:"Processed",onError:P=>{var B;console.error("Image failed to load:",(B=Ke.screenshot)==null?void 0:B.substring(0,100)),P.target.style.display="none",alert("Error: Image failed to load. Please try again.")},onLoad:()=>{console.log("Image loaded successfully")},style:{maxWidth:"400px",maxHeight:"400px",border:"1px solid #ddd",borderRadius:"4px",backgroundColor:"#f0f0f0"}}):e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#dc3545"},children:"Error: No image data received"})}),e.jsx("button",{onClick:()=>{Ke.screenshot&&(yr(Ke.screenshot),alert("Image saved! You can now process the next item or download all processed images below."))},style:{padding:"10px 20px",background:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",marginRight:"10px"},children:"‚úì Save & Continue to Next Item"})]})]})]})})()]}),Object.keys(ft).length>0&&e.jsxs("div",{style:{marginTop:"30px",padding:"20px",background:"#e8f5e9",borderRadius:"8px",border:"2px solid #28a745"},children:[e.jsx("h3",{style:{marginTop:0,color:"#28a745"},children:"‚úÖ Processed Images Ready for Download"}),e.jsx("p",{style:{color:"#666",fontSize:"14px",marginBottom:"20px"},children:"All processed images are ready. Download each one individually for Printful."}),d.cart.map((l,P)=>ft[P]?e.jsxs("div",{style:{marginBottom:"20px",padding:"16px",background:"white",borderRadius:"4px",border:"1px solid #28a745"},children:[e.jsxs("h4",{style:{marginTop:0,color:"#28a745"},children:["Item ",P+1,": ",l.product]}),e.jsx("div",{style:{marginBottom:"12px"},children:e.jsx("img",{src:ft[P].processedImage,alt:`Processed ${l.product}`,style:{maxWidth:"300px",maxHeight:"300px",border:"1px solid #ddd",borderRadius:"4px"}})}),e.jsxs("button",{onClick:()=>{const B=document.createElement("a");B.href=ft[P].processedImage,B.download=`print-quality-${(d==null?void 0:d.order_id)||"image"}-item${P+1}-${Date.now()}.png`,document.body.appendChild(B),B.click(),document.body.removeChild(B)},style:{padding:"10px 20px",background:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:["üì• Download ",l.product]})]},P):null)]})]})]})})]}):e.jsxs("div",{className:"admin-access-denied",children:[e.jsx("h2",{children:"Access Denied"}),e.jsx("p",{children:"You don't have admin privileges to access this panel."}),e.jsx("button",{onClick:()=>kt("/"),className:"admin-back-btn",children:"Back to Home"})]}):e.jsx("div",{className:"admin-login-container",children:e.jsxs("div",{className:"admin-login-form",children:[e.jsx("h2",{children:"Admin Portal Login"}),e.jsx("p",{children:"Please sign in with your Google account to access the admin panel."}),e.jsx("button",{onClick:async()=>{const P=`${window.location.origin==="https://screenmerch.com"||window.location.origin==="https://www.screenmerch.com"?"":"https://screenmerch.fly.dev"}/api/auth/google/login?return_url=${encodeURIComponent(window.location.href)}&format=json`;try{const Ee=await(await fetch(P,{credentials:"include",headers:{Accept:"application/json"}})).json().catch(()=>({}));if(Ee.auth_url){window.location.href=Ee.auth_url;return}}catch{}window.location.href=P.replace("&format=json","")},className:"admin-login-btn",children:"Sign in with Google"}),e.jsx("p",{className:"admin-login-note",children:"Only users with admin privileges can access this panel. Admin access requires Google OAuth sign-in for security."})]})})},Bd=()=>{const[t,s]=c.useState(""),[r,a]=c.useState(""),[i,o]=c.useState(!0),[n,u]=c.useState(""),m=ct(),[f]=Et(),k=f.get("returnTo")||"/",M=async h=>{if(h.preventDefault(),u(""),i){const{error:v}=await R.auth.signInWithPassword({email:t,password:r});v?u(v.message):(u("Logged in! Redirecting..."),setTimeout(()=>{m(k)},1e3))}else{const{error:v}=await R.auth.signUp({email:t,password:r});u(v?v.message:"Signup successful! Check your email for a confirmation link.")}};return e.jsxs("div",{style:{maxWidth:400,margin:"2rem auto",padding:20,border:"1px solid #ccc",borderRadius:8},children:[e.jsx("h2",{children:i?"Login":"Sign Up"}),e.jsxs("form",{onSubmit:M,children:[e.jsx("input",{type:"email",placeholder:"Email",value:t,required:!0,onChange:h=>s(h.target.value),style:{width:"100%",marginBottom:10,padding:8}}),e.jsx("input",{type:"password",placeholder:"Password",value:r,required:!0,onChange:h=>a(h.target.value),style:{width:"100%",marginBottom:10,padding:8}}),e.jsx("button",{type:"submit",style:{width:"100%",padding:10},children:i?"Login":"Sign Up"})]}),e.jsx("button",{onClick:()=>{o(!i),u("")},style:{marginTop:10,width:"100%",background:"none",border:"none",color:"#007bff",cursor:"pointer"},children:i?"Don't have an account? Sign Up":"Already have an account? Login"}),n&&e.jsx("div",{style:{marginTop:15,color:"red"},children:n})]})};const Fd=()=>{const t=window.location.hostname;return t!=="screenmerch.com"&&t!=="www.screenmerch.com"},$d=typeof import.meta<"u"&&{VITE_API_BASE_URL:"https://api.screenmerch.com",VITE_SUPABASE_URL:"https://sojxbydpcdcdzfdtbypd.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&{}.VITE_BACKEND_URL||typeof process<"u"&&process.env&&{}.REACT_APP_BACKEND_URL||"https://screenmerch.fly.dev",Aa=()=>{const t=ct(),[s]=Et(),r=hs(),[a,i]=c.useState(""),[o,n]=c.useState(""),[u,m]=c.useState(!1),[f,k]=c.useState(!0),[M,h]=c.useState(!1),[v,_]=c.useState(null),[b,x]=c.useState(!1),[T,S]=c.useState(!1),[A,E]=c.useState(null);c.useEffect(()=>{var $,se;if(r.pathname==="/signup"){k(!1);const be=localStorage.getItem("pending_paypal_email"),xe=localStorage.getItem("pending_payment_method"),ae=((se=($=r.state)==null?void 0:$.from)==null?void 0:se.includes("/payment-setup"))||document.referrer.includes("/payment-setup");x(!!(be||xe||ae))}else x(!1)},[r.pathname,r.state]),c.useEffect(()=>{const $=localStorage.getItem("isAuthenticated"),se=localStorage.getItem("user"),be=s.get("returnTo");if($==="true"&&se&&be)try{const xe=JSON.parse(se);console.log("‚úÖ User already authenticated with returnTo, redirecting...",xe);const ae=xe.role||"customer";be==="merch"?t("/merchandise",{replace:!0}):be==="subscription-success"?t("/subscription-success",{replace:!0}):ae==="customer"?(console.log("üîÑ Already logged in as customer, redirecting to home"),t("/",{replace:!0})):t("/dashboard",{replace:!0})}catch(xe){console.error("Error parsing user data:",xe),localStorage.removeItem("isAuthenticated"),localStorage.removeItem("user")}else if($==="true"&&se)try{const xe=JSON.parse(se);console.log("‚úÖ User already authenticated, but allowing access to login page"),S(!0),E(xe)}catch(xe){console.error("Error parsing user data:",xe)}else S(!1),E(null)},[t,s]),c.useEffect(()=>{s.get("status")==="session_expired"&&_({type:"error",text:"Your session expired. Please sign in again."})},[s]);const z=$=>`${$d}${$}`,V=async $=>{var xe,ae,W;if($.preventDefault(),_(null),!a.trim()){_({type:"error",text:"Please enter your email."});return}if(!o){_({type:"error",text:"Please enter your password."});return}const se=f?"/api/auth/login":"/api/auth/signup",be=z(se);try{h(!0);const O={email:a.trim(),password:o,is_creator:!f&&b},de=await fetch(be,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(O)}),U=(de.headers.get("content-type")||"").includes("application/json");if(!de.ok){const w=await de.text();if(console.error("‚ùå Login failed:",{status:de.status,statusText:de.statusText,url:be,endpoint:se,isLoginMode:f,raw:w.substring(0,500)}),U){let p;try{throw p=JSON.parse(w),console.error("‚ùå Error data:",p),de.status===409||p!=null&&p.error&&p.error.includes("already exists")?new Error('This email is already registered. Please sign in instead, or use "Sign in with Google" if you created your account with Google.'):p!=null&&p.error&&(p.error.includes("23505")||p.error.includes("Key")&&p.error.includes("already exists"))?new Error('This email is already registered. Please sign in instead, or use "Sign in with Google" if you created your account with Google.'):new Error((p==null?void 0:p.error)||`Server error: ${de.status}`)}catch(ee){throw ee.message.includes("already registered")||ee.message.includes("already exists")?ee:new Error(`Server error ${de.status}: ${ee.message}`)}}else throw new Error(`Could not reach auth API (HTTP ${de.status}). Check BACKEND_URL.`)}if(!U)throw new Error("Unexpected response from server (not JSON).");const y=await de.json();if(y!=null&&y.token&&localStorage.setItem("auth_token",y.token),y!=null&&y.user)if(y.user.id&&!y.user.user_metadata)try{const w=await _s(y.user.id);if(w){const p={...y.user,role:w.role!==null&&w.role!==void 0?w.role:y.user.role||"customer",status:w.status!==null&&w.status!==void 0?w.status:y.user.status||"active",profile_image_url:w.profile_image_url||y.user.profile_image_url,cover_image_url:w.cover_image_url||y.user.cover_image_url,display_name:w.display_name||y.user.display_name,bio:w.bio||y.user.bio,subdomain:w.subdomain||y.user.subdomain,user_metadata:{name:w.display_name||y.user.display_name,picture:w.profile_image_url||y.user.profile_image_url}};localStorage.setItem("user",JSON.stringify(p)),console.log("üíæ [LOGIN] Database profile role:",w.role,"status:",w.status),console.log("üíæ [LOGIN] Backend response role:",y.user.role,"status:",y.user.status),console.log("üíæ [LOGIN] Final stored user role:",p.role,"status:",p.status,"profile_image_url:",p.profile_image_url)}else console.warn("‚ö†Ô∏è [LOGIN] No profile found in database, using backend response only"),localStorage.setItem("user",JSON.stringify(y.user))}catch(w){console.error("Error fetching user profile:",w),localStorage.setItem("user",JSON.stringify(y.user))}else{const w={...y.user,profile_image_url:y.user.profile_image_url||y.user.picture||((xe=y.user.user_metadata)==null?void 0:xe.picture)};localStorage.setItem("user",JSON.stringify(w)),console.log("üíæ Stored OAuth user with profile_image_url:",w.profile_image_url)}localStorage.setItem("isAuthenticated","true");const N=window.location.hostname;N!=="screenmerch.com"&&N!=="www.screenmerch.com"&&(localStorage.setItem("email_login_subdomain",N),console.log("üîê Email login: Storing subdomain info:",N));const D=s.get("returnTo");if(D==="subscription-success"&&localStorage.setItem("justLoggedIn","true"),Be.clearCache(),setTimeout(()=>{var ee,ie,we,Ce;const w=localStorage.getItem("user");let p=y.user;if(w)try{p=JSON.parse(w),console.log("üíæ [LOGIN] Dispatching userLoggedIn event with user from localStorage:",p),console.log("üíæ [LOGIN] User ID:",p.id,"Role:",p.role,"Status:",p.status)}catch(Oe){console.warn("‚ö†Ô∏è [LOGIN] Could not parse localStorage user, using data.user:",Oe),console.log("üíæ [LOGIN] Using data.user instead. ID:",(ee=y.user)==null?void 0:ee.id,"Role:",(ie=y.user)==null?void 0:ie.role)}else console.warn("‚ö†Ô∏è [LOGIN] No user in localStorage, using data.user"),console.log("üíæ [LOGIN] data.user ID:",(we=y.user)==null?void 0:we.id,"Role:",(Ce=y.user)==null?void 0:Ce.role);window.dispatchEvent(new CustomEvent("userLoggedIn",{detail:{user:p}}))},100),_({type:"success",text:y.message||"Login successful! Redirecting‚Ä¶"}),f)console.log("‚úÖ Login successful, preparing redirect...",{userRole:(W=y==null?void 0:y.user)==null?void 0:W.role,isSubdomain:Fd(),returnTo:D}),setTimeout(()=>{var p;const w=((p=y==null?void 0:y.user)==null?void 0:p.role)||"customer";D==="merch"?(console.log("üîÑ Redirecting to merchandise"),t("/merchandise",{replace:!0})):D==="subscription-success"?(console.log("üîÑ Redirecting to subscription success"),t("/subscription-success",{replace:!0})):w==="customer"?(console.log("üîÑ Customer login, redirecting to home page"),t("/",{replace:!0})):(console.log("üîÑ Creator/Admin login, staying on homepage"),t("/",{replace:!0}))},700);else{const w=localStorage.getItem("pending_paypal_email"),p=localStorage.getItem("pending_tax_id");b&&((ae=y==null?void 0:y.user)==null?void 0:ae.status)==="pending"?setTimeout(()=>{t("/dashboard",{state:{message:"Your account is pending approval. You will receive an email once approved."}})},2e3):setTimeout(()=>{t(w||p?"/subscription-success":"/payment-setup?ref=new_user")},1e3)}}catch(O){console.error("‚ùå Login error:",O),_({type:"error",text:(O==null?void 0:O.message)||"Authentication error: Load failed"}),h(!1)}},X=()=>{k($=>!$),_(null),r.pathname!=="/signup"&&x(!1)},Y=()=>{localStorage.removeItem("isAuthenticated"),localStorage.removeItem("user"),localStorage.removeItem("customer_authenticated"),localStorage.removeItem("customer_user"),localStorage.removeItem("user_authenticated"),localStorage.removeItem("user_email"),localStorage.removeItem("email_login_subdomain"),R.auth.signOut(),S(!1),E(null),_({type:"success",text:"You have been logged out. You can now sign in with a different account."}),i(""),n("")};return e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-card",children:[e.jsxs("div",{className:"login-card-header",children:[e.jsx("div",{className:"login-logo",children:"üéØ"}),e.jsx("h2",{className:"login-title",children:f?"ScreenMerch Login":"ScreenMerch Sign Up"})]}),e.jsxs("div",{className:"login-info",children:[e.jsx("strong",{children:f?"Login Required":"Create Account"}),e.jsx("p",{children:f?"To create merchandise, please log in or create an account with your email address.":"Join ScreenMerch and start creating merch from your content."})]}),T&&A&&e.jsxs("div",{className:"login-alert login-alert-info",role:"alert",style:{backgroundColor:"#e3f2fd",color:"#1976d2",border:"1px solid #90caf9"},children:[e.jsxs("p",{style:{margin:"0 0 8px 0",fontWeight:"bold"},children:["You are already signed in as ",A.email||A.display_name||"a user"]}),e.jsx("p",{style:{margin:"0 0 12px 0",fontSize:"14px"},children:"To sign in with a different account, please log out first."}),e.jsx("button",{type:"button",onClick:Y,className:"login-submit-btn",style:{backgroundColor:"#f44336",marginTop:"8px"},children:"Log Out"})]}),v&&e.jsx("div",{className:`login-alert ${v.type==="error"?"login-alert-error":"login-alert-success"}`,role:"alert",children:v.text}),e.jsxs("form",{className:"login-form",onSubmit:V,noValidate:!0,children:[e.jsxs("div",{className:"login-field",children:[e.jsx("label",{htmlFor:"email",className:"login-label",children:"Email Address"}),e.jsx("input",{id:"email",type:"email",className:"login-input",placeholder:"you@example.com",autoComplete:"email",value:a,onChange:$=>i($.target.value),disabled:M,required:!0})]}),e.jsxs("div",{className:"login-field",children:[e.jsx("label",{htmlFor:"password",className:"login-label",children:"Password"}),e.jsxs("div",{className:"password-input-wrapper",children:[e.jsx("input",{id:"password",type:u?"text":"password",className:"login-input",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",autoComplete:f?"current-password":"new-password",value:o,onChange:$=>n($.target.value),disabled:M,required:!0}),e.jsx("button",{type:"button",className:"password-toggle-btn",onClick:()=>m(!u),tabIndex:-1,"aria-label":u?"Hide password":"Show password",children:u?"üôà":"üëÅÔ∏è"})]})]}),e.jsx("button",{type:"submit",className:"login-submit-btn",disabled:M,children:M?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),"Processing..."]}):f?"Sign In":"Create Account"}),f&&e.jsx("div",{className:"login-forgot-wrap",children:e.jsx(mt,{to:"/set-password",className:"login-forgot-link",children:"Forgot password? Set password"})})]}),e.jsxs("div",{className:"login-toggle",children:[e.jsx("span",{children:f?"Don't have an account?":"Already have an account?"}),e.jsx("button",{className:"login-toggle-btn",onClick:X,disabled:M,children:f?"Sign Up":"Sign in"})]})]})})};const zd=()=>e.jsx("div",{className:"privacy-policy-container",children:e.jsxs("div",{className:"privacy-policy-content",children:[e.jsx("div",{className:"logo",children:e.jsx("img",{src:tr,alt:"ScreenMerch Logo",className:"logo-img"})}),e.jsx("h1",{children:"Privacy Policy"}),e.jsx("div",{className:"last-updated",children:"Last Updated: January 2025"}),e.jsxs("section",{children:[e.jsx("h2",{children:"Company Information"}),e.jsxs("p",{children:[e.jsx("strong",{children:"ScreenMerch"})," is committed to protecting your privacy and ensuring the security of your personal information. This Privacy Policy explains how we collect, use, protect, and handle your information when you use our custom merchandise platform and services."]}),e.jsxs("div",{className:"highlight-box",children:[e.jsx("strong",{children:"Contact Information:"}),e.jsx("br",{}),"Company: ScreenMerch",e.jsx("br",{}),"Website: screenmerch.com",e.jsx("br",{}),"Email: support@screenmerch.com",e.jsx("br",{}),"Privacy Officer: support@screenmerch.com"]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"Information We Collect"}),e.jsx("h3",{children:"Personal Information"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Account Information:"})," Name, email address, username, password (encrypted)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Contact Details:"})," Phone number (for order notifications), mailing address"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Billing Information:"})," Shipping and billing addresses, payment method details (processed securely through Stripe)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Profile Data:"})," Profile pictures, preferences, customization settings"]})]}),e.jsx("h3",{children:"Content and Usage Information"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Video Content:"})," Video files, screenshots, thumbnails, and images you upload"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Custom Designs:"})," Product customizations, text overlays, design modifications"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Order History:"})," Products ordered, preferences, purchase patterns"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Platform Usage:"})," Navigation patterns, feature usage, time spent on platform"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Technical Data:"})," IP address, browser type, device information, operating system"]})]})]}),e.jsxs("section",{className:"security-box",children:[e.jsx("h2",{children:"Content Processing and Protection"}),e.jsx("h3",{children:"Video Content Handling"}),e.jsx("p",{children:e.jsx("strong",{children:"How We Process Your Content:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Video content is processed through secure, encrypted servers"}),e.jsx("li",{children:"We extract screenshots and thumbnails for merchandise creation"}),e.jsx("li",{children:"All processing occurs within our protected infrastructure"}),e.jsx("li",{children:"Content is never shared with unauthorized third parties"}),e.jsx("li",{children:"We maintain strict access controls for all uploaded content"})]}),e.jsx("h3",{children:"Content Rights and Usage"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Your Content Ownership:"})," You retain ownership of your original content"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Platform License:"})," You grant us limited rights to process content for merchandise creation"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Exclusivity Protection:"})," We ensure your processed content remains exclusive to ScreenMerch"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"No Unauthorized Sharing:"})," Your content is never provided to competing platforms"]})]}),e.jsx("h3",{children:"Data Retention"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Active account content: Retained while account is active"}),e.jsx("li",{children:"Order-related content: Retained for 7 years for legal/tax purposes"}),e.jsx("li",{children:"Backup content: Securely destroyed after 90 days in backups"}),e.jsx("li",{children:"Deleted account content: Permanently removed within 30 days"})]})]}),e.jsxs("section",{className:"sms-section",children:[e.jsx("h2",{children:"SMS Messaging and Communications"}),e.jsx("h3",{children:"SMS Consent and Usage"}),e.jsx("p",{children:"By providing your phone number and checking the SMS consent box during checkout, you explicitly consent to receive SMS text messages from ScreenMerch for the following purposes:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Order Notifications:"})," Updates about your order status, processing, and shipping"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Customer Service:"})," Support communications and order assistance"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Account Security:"})," Two-factor authentication and security alerts"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Important Updates:"})," Critical account or service notifications"]})]}),e.jsxs("div",{className:"highlight-box",children:[e.jsx("strong",{children:"Program Name:"})," ScreenMerch Notifications",e.jsx("br",{}),e.jsx("strong",{children:"Provider:"})," ScreenMerch",e.jsx("br",{}),e.jsx("strong",{children:"Purpose:"})," Order notifications and customer service communications",e.jsx("br",{}),e.jsx("strong",{children:"Frequency:"})," 1-3 messages per order, occasional service messages",e.jsx("br",{}),e.jsx("strong",{children:"Opt-Out:"})," Reply STOP to any SMS to unsubscribe immediately",e.jsx("br",{}),e.jsx("strong",{children:"Help:"})," Reply HELP to any SMS for assistance or contact support@screenmerch.com",e.jsx("br",{}),e.jsx("strong",{children:"Cost:"})," Message and data rates may apply based on your mobile carrier plan"]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"How We Use Your Information"}),e.jsx("h3",{children:"Primary Uses"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Service Delivery:"})," Process and fulfill your custom merchandise orders"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Content Processing:"})," Transform your video content into printable merchandise designs"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Communication:"})," Send order notifications via SMS and email (with consent)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Customer Support:"})," Provide assistance and resolve issues"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Platform Improvement:"})," Enhance our services and user experience"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Security:"})," Protect against fraud and unauthorized access"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Legal Compliance:"})," Meet regulatory and legal obligations"]})]}),e.jsx("h3",{children:"Platform Exclusivity Protection"}),e.jsxs("ul",{children:[e.jsx("li",{children:"We ensure your content remains exclusive to ScreenMerch platform"}),e.jsx("li",{children:"We monitor and prevent unauthorized use of your processed content"}),e.jsx("li",{children:"We maintain audit trails for content usage and access"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"Data Security and Protection"}),e.jsx("h3",{children:"Technical Safeguards"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Encryption:"})," End-to-end encryption for data transmission and storage"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Access Controls:"})," Multi-factor authentication and role-based access"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Monitoring:"})," 24/7 security monitoring and intrusion detection"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Backups:"})," Secure, encrypted backups with restricted access"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Infrastructure:"})," SOC 2 compliant cloud infrastructure"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"Your Privacy Rights"}),e.jsx("p",{children:"You have the right to:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Access:"})," Request a copy of your personal information"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Correction:"})," Update or correct inaccurate information"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Deletion:"})," Request deletion of your information (subject to legal requirements)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Portability:"})," Receive your data in a structured, machine-readable format"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Opt-Out:"})," Withdraw consent for SMS communications"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Restriction:"})," Request limitations on how we process your data"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"Contact Us"}),e.jsx("p",{children:"For privacy-related questions, concerns, or requests, please contact us:"}),e.jsxs("div",{className:"highlight-box",children:[e.jsx("strong",{children:"Privacy Officer:"})," support@screenmerch.com",e.jsx("br",{}),e.jsx("strong",{children:"General Support:"})," support@screenmerch.com",e.jsx("br",{}),e.jsx("strong",{children:"Website:"})," screenmerch.com",e.jsx("br",{}),e.jsx("strong",{children:"SMS Opt-Out:"})," Reply STOP to any message",e.jsx("br",{}),e.jsx("strong",{children:"Data Requests:"})," support@screenmerch.com"]})]}),e.jsxs("div",{className:"navigation-links",children:[e.jsx(mt,{to:"/",className:"nav-link",children:"‚Üê Back to ScreenMerch"})," |",e.jsx(mt,{to:"/terms-of-service",className:"nav-link",children:"Terms of Service ‚Üí"})]})]})});const Wd=()=>e.jsx("div",{className:"terms-container",children:e.jsxs("div",{className:"terms-content",children:[e.jsx("div",{className:"logo",children:e.jsx("img",{src:tr,alt:"ScreenMerch Logo",className:"logo-img"})}),e.jsx("h1",{children:"Terms of Service"}),e.jsx("div",{className:"last-updated",children:"Last Updated: January 2025"}),e.jsxs("section",{children:[e.jsx("h2",{children:"1. Acceptance of Terms"}),e.jsx("p",{children:'By accessing and using ScreenMerch ("the Service"), you accept and agree to be bound by the terms and provision of this agreement. These Terms of Service ("Terms") govern your use of the ScreenMerch website and services. If you do not agree to these terms, you must not use the Service.'})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"2. Description of Service"}),e.jsx("p",{children:"ScreenMerch is a platform that allows users to create custom merchandise from video content, including screenshots and thumbnails. We facilitate the creation and ordering of custom products through third-party providers. Our platform is designed exclusively for creating merchandise through ScreenMerch services."})]}),e.jsxs("section",{className:"critical-box",children:[e.jsx("h2",{children:"3. CRITICAL: Intellectual Property Protection & Platform Exclusivity"}),e.jsx("h3",{children:"3.1 Reverse Engineering Prohibition"}),e.jsx("p",{children:e.jsx("strong",{children:"YOU EXPRESSLY AGREE AND ACKNOWLEDGE THAT:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"You will NOT reverse engineer, decompile, disassemble, or attempt to derive the source code of ScreenMerch platform"}),e.jsx("li",{children:"You will NOT attempt to discover underlying algorithms, methods, or processes used by ScreenMerch"}),e.jsx("li",{children:"You will NOT use any automated tools, bots, or scrapers to extract data or functionality from ScreenMerch"}),e.jsx("li",{children:"You will NOT create competing services based on ScreenMerch's functionality or design"}),e.jsx("li",{children:"You will NOT copy, reproduce, or replicate ScreenMerch's user interface, workflows, or business processes"})]}),e.jsx("h3",{children:"3.2 Platform Exclusivity Agreement"}),e.jsx("p",{children:e.jsx("strong",{children:"EXCLUSIVE USE COMMITMENT:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("strong",{children:"You agree that any video images, screenshots, thumbnails, or content processed through ScreenMerch may ONLY be used to create products through ScreenMerch platform"})}),e.jsx("li",{children:"You will NOT use video content processed on ScreenMerch to create merchandise on any other platform (including but not limited to Printful, Teespring, Redbubble, Etsy, Amazon Merch, etc.)"}),e.jsx("li",{children:"You will NOT download, export, or transfer video images from ScreenMerch to create products elsewhere"}),e.jsx("li",{children:"You will NOT share, distribute, or provide ScreenMerch-processed content to third parties for merchandise creation"}),e.jsx("li",{children:"Any custom designs, layouts, or modifications created through ScreenMerch remain exclusive to ScreenMerch platform"})]}),e.jsx("h3",{children:"3.3 Enforcement and Penalties"}),e.jsx("p",{children:"Violation of these exclusivity and protection terms will result in:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Immediate account termination without refund"}),e.jsx("li",{children:"Legal action for breach of contract and intellectual property infringement"}),e.jsx("li",{children:"Monetary damages including lost profits and legal fees"}),e.jsx("li",{children:"Permanent ban from all ScreenMerch services"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"4. User Accounts"}),e.jsx("h3",{children:"Account Creation"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You may be required to create an account to access certain features"}),e.jsx("li",{children:"You are responsible for maintaining the confidentiality of your account"}),e.jsx("li",{children:"You are responsible for all activities that occur under your account"}),e.jsx("li",{children:"You must provide accurate and complete information when creating an account"}),e.jsx("li",{children:"Each user may only maintain one active account"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"5. Content and Intellectual Property Rights"}),e.jsx("h3",{children:"5.1 User Content Ownership"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You retain ownership of original content you upload to ScreenMerch"}),e.jsx("li",{children:"You grant ScreenMerch a limited, non-exclusive license to process your content for merchandise creation"}),e.jsx("li",{children:"You are responsible for ensuring you have rights to any content you upload"}),e.jsx("li",{children:"You must not upload copyrighted content without proper authorization"})]}),e.jsx("h3",{children:"5.2 ScreenMerch Intellectual Property"}),e.jsxs("ul",{children:[e.jsx("li",{children:"ScreenMerch platform, technology, algorithms, and processes are proprietary and protected"}),e.jsx("li",{children:"All ScreenMerch branding, logos, and design elements are owned by ScreenMerch"}),e.jsx("li",{children:"Product templates, layouts, and customization tools are ScreenMerch intellectual property"}),e.jsx("li",{children:"You may not use ScreenMerch IP for any purpose outside the intended service"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"6. Platform Usage Restrictions"}),e.jsx("h3",{children:"6.1 Prohibited Content"}),e.jsx("p",{children:"You may not upload or create products containing:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Copyrighted material without authorization"}),e.jsx("li",{children:"Illegal, harmful, threatening, or offensive content"}),e.jsx("li",{children:"Content that violates privacy or publicity rights"}),e.jsx("li",{children:"Trademarked material without permission"}),e.jsx("li",{children:"Adult or explicit content"}),e.jsx("li",{children:"Content promoting violence, hate, or discrimination"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"7. Orders and Payment"}),e.jsx("h3",{children:"7.1 Product Orders"}),e.jsxs("ul",{children:[e.jsx("li",{children:"All orders are subject to acceptance and product availability"}),e.jsx("li",{children:"Prices are displayed in USD and may change without notice"}),e.jsx("li",{children:"Payment is processed securely through Stripe"}),e.jsx("li",{children:"You agree to provide accurate billing information"}),e.jsx("li",{children:"Orders cannot be transferred to other platforms"})]}),e.jsx("h3",{children:"7.2 Refunds and Returns"}),e.jsxs("ul",{children:[e.jsx("li",{children:"All items are customized and cannot be returned or refunded"}),e.jsx("li",{children:"Refunds are only available in cases of producer error or manufacturing defects"}),e.jsx("li",{children:"Refund requests for producer errors must be submitted within 30 days of delivery"}),e.jsx("li",{children:"No refunds for violation of exclusivity terms"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"8. Prohibited Uses"}),e.jsx("p",{children:"You may not use ScreenMerch to:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Upload illegal, harmful, or offensive content"}),e.jsx("li",{children:"Infringe on intellectual property rights"}),e.jsx("li",{children:"Engage in fraudulent or deceptive practices"}),e.jsx("li",{children:"Attempt to circumvent security measures"}),e.jsx("li",{children:"Use automated systems to access the service"}),e.jsx("li",{children:"Reverse engineer or replicate our platform"}),e.jsx("li",{children:"Export content for use on competing platforms"}),e.jsx("li",{children:"Violate platform exclusivity agreements"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"9. Termination"}),e.jsx("h3",{children:"9.1 Termination by ScreenMerch"}),e.jsxs("ul",{children:[e.jsx("li",{children:"We may terminate accounts for violation of these terms"}),e.jsx("li",{children:"Immediate termination for reverse engineering or exclusivity violations"}),e.jsx("li",{children:"We reserve the right to refuse service to anyone"})]}),e.jsx("h3",{children:"9.2 Effect of Termination"}),e.jsxs("ul",{children:[e.jsx("li",{children:"All licenses granted to you terminate immediately"}),e.jsx("li",{children:"You must cease all use of ScreenMerch services"}),e.jsx("li",{children:"Outstanding orders may be cancelled"}),e.jsx("li",{children:"Exclusivity obligations survive termination"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"10. Contact Information"}),e.jsxs("div",{className:"highlight-box",children:[e.jsx("strong",{children:"ScreenMerch Support"}),e.jsx("br",{}),"Email: support@screenmerch.com",e.jsx("br",{}),"Website: screenmerch.com",e.jsx("br",{}),"Legal Issues: support@screenmerch.com"]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"11. Entire Agreement"}),e.jsx("p",{children:"These Terms of Service, together with our Privacy Policy, constitute the entire agreement between you and ScreenMerch regarding the use of our services."})]}),e.jsxs("div",{className:"navigation-links",children:[e.jsx(mt,{to:"/",className:"nav-link",children:"‚Üê Back to ScreenMerch"})," |",e.jsx(mt,{to:"/privacy-policy",className:"nav-link",children:"‚Üê Privacy Policy"})]})]})});const Yd=()=>{const[t]=Et(),s=ct(),[r,a]=c.useState([]),[i,o]=c.useState(!1),[n,u]=c.useState(""),[m,f]=c.useState("");c.useEffect(()=>{const v=t.get("q");v&&(f(v),k(v))},[t]);const k=async v=>{if(!v||v.trim().length<2){u("Please enter at least 2 characters to search");return}o(!0),u(""),a([]);try{const _=v.trim();console.log("Searching for channel:",_),s(`/channel/${encodeURIComponent(_)}`)}catch(_){console.error("Search error:",_),u(`Search error: ${_.message}`)}finally{o(!1)}},M=v=>{s(`/profile/${v.username}`)},h=v=>v?new Date(v).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Unknown";return e.jsx("div",{className:"search-page",children:e.jsxs("div",{className:"search-container",children:[e.jsxs("div",{className:"search-header",children:[e.jsx("h1",{children:"Search Results"}),m&&e.jsxs("p",{className:"search-query",children:["Results for: ",e.jsxs("span",{className:"query-text",children:['"',m,'"']})]})]}),i&&e.jsxs("div",{className:"search-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Searching creators..."})]}),n&&e.jsx("div",{className:"search-error",children:e.jsx("p",{children:n})}),!i&&!n&&r.length===0&&m&&e.jsxs("div",{className:"search-no-results",children:[e.jsx("h3",{children:"No creators found"}),e.jsx("p",{children:"Try searching with different keywords or check the spelling."}),e.jsxs("div",{className:"search-suggestions",children:[e.jsx("p",{children:e.jsx("strong",{children:"Tips:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Use shorter keywords"}),e.jsx("li",{children:"Try searching by username or display name"}),e.jsx("li",{children:"Check for typos"})]})]})]}),!i&&r.length>0&&e.jsxs("div",{className:"search-results",children:[e.jsx("div",{className:"results-header",children:e.jsxs("p",{className:"results-count",children:["Found ",r.length," creator",r.length!==1?"s":""]})}),e.jsx("div",{className:"creators-grid",children:r.map(v=>{var _,b;return e.jsxs("div",{className:"creator-card",onClick:()=>M(v),children:[e.jsxs("div",{className:"creator-avatar",children:[v.profile_image_url?e.jsx("img",{src:v.profile_image_url,alt:v.display_name,onError:x=>{x.target.style.display="none",x.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"avatar-placeholder",style:{display:v.profile_image_url?"none":"flex"},children:((b=(_=v.display_name)==null?void 0:_.charAt(0))==null?void 0:b.toUpperCase())||"?"})]}),e.jsxs("div",{className:"creator-info",children:[e.jsx("h3",{className:"creator-name",children:v.display_name}),e.jsxs("p",{className:"creator-username",children:["@",v.username]}),v.bio&&e.jsx("p",{className:"creator-bio",children:v.bio}),e.jsxs("div",{className:"creator-stats",children:[e.jsxs("span",{className:"video-count",children:[v.video_count||0," video",(v.video_count||0)!==1?"s":""]}),e.jsxs("span",{className:"joined-date",children:["Joined ",h(v.created_at)]})]})]}),e.jsx("div",{className:"creator-action",children:e.jsx("button",{className:"view-profile-btn",children:"View Profile"})})]},v.id)})})]})]})})};const Hd=()=>{var k,M;const{channelName:t}=Cs(),s=ct(),[r,a]=c.useState([]),[i,o]=c.useState(!0),[n,u]=c.useState(null),[m,f]=c.useState(null);return c.useEffect(()=>{t&&(async()=>{o(!0),u(null);try{const v=decodeURIComponent(t);console.log("Looking for channel:",v);const{data:_,error:b}=await R.from("videos2").select("channelTitle").limit(10);_&&console.log("Available channels in database:",_.map(X=>X.channelTitle));let x=null,T=null,{data:S,error:A}=await R.from("videos2").select("*").eq("channelTitle",v).order("created_at",{ascending:!1});if(S&&S.length>0)x=S;else{const{data:X,error:Y}=await R.from("users").select("id, username, display_name").or(`username.ilike.%${v}%,display_name.ilike.%${v}%`).limit(1);if(X&&X.length>0){const $=X[0];console.log("Found user:",$);const{data:se,error:be}=await R.from("videos2").select("*").eq("user_id",$.id).order("created_at",{ascending:!1});se&&(x=se),T=be}else T=Y}if(T){console.error("Error fetching channel videos:",T),u("Failed to load channel videos"),o(!1);return}if(!x||x.length===0){u("No videos found for this channel"),o(!1);return}a(x);const E=x[0].user_id;let z=null;if(console.log("Channel videos user_id:",E),E){const{data:X,error:Y}=await R.from("users").select("display_name, username, profile_image_url, cover_image_url").eq("id",E).single();console.log("User profile data:",X),console.log("Profile error:",Y),!Y&&X&&(z=X)}const V={channelTitle:x[0].channelTitle,videoCount:x.length,username:(z==null?void 0:z.username)||v,profileImageUrl:(z==null?void 0:z.profile_image_url)||null,coverImageUrl:(z==null?void 0:z.cover_image_url)||null};console.log("Channel data being set:",V),console.log("Profile image URL:",V.profileImageUrl),console.log("Cover image URL:",V.coverImageUrl),f(V)}catch(v){console.error("Error:",v),u("Failed to load channel")}finally{o(!1)}})()},[t]),i?e.jsx("div",{className:"channel-page",children:e.jsx("div",{className:"channel-loading",children:"Loading channel..."})}):n?e.jsx("div",{className:"channel-page",children:e.jsxs("div",{className:"channel-error",children:[e.jsx("h2",{children:n}),e.jsx("button",{onClick:()=>s("/"),children:"Back to Home"})]})}):e.jsxs("div",{className:"channel-page",children:[m&&e.jsxs("div",{className:"channel-header-container",children:[e.jsx("div",{className:"channel-cover-container",children:e.jsx("img",{className:"channel-cover-photo",src:m.coverImageUrl||"https://images.unsplash.com/photo-1557683316-973673baf926?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80",alt:"Channel Cover"})}),e.jsxs("div",{className:"channel-info-overlay",children:[e.jsx("div",{className:"channel-avatar-container",children:m.profileImageUrl?e.jsx("img",{className:"channel-avatar",src:m.profileImageUrl,alt:m.channelTitle}):e.jsx("div",{className:"channel-avatar-placeholder",children:((M=(k=m.channelTitle)==null?void 0:k.charAt(0))==null?void 0:M.toUpperCase())||"?"})}),e.jsxs("div",{className:"channel-details",children:[e.jsx("h1",{className:"channel-name",children:m.channelTitle}),m.bio&&e.jsx("p",{className:"channel-bio",children:m.bio}),e.jsxs("p",{className:"channel-stats",children:[m.videoCount," video",m.videoCount!==1?"s":""]})]})]})]}),e.jsx("div",{className:"channel-content",children:r.length>0?e.jsx(ki,{videos:r}):e.jsx("div",{className:"no-videos",children:e.jsx("p",{children:"No videos available"})})})]})};const Xd=({sidebar:t})=>{const{creatorSettings:s}=Ts();new URLSearchParams(location.search).has("debug")&&(window.__DEBUG__=!0),ct();const[r,a]=c.useState(!1),[i,o]=c.useState(!1),[n,u]=c.useState(null),m=c.useRef(!1),f=(()=>{try{const T=localStorage.getItem("pending_merch_data");return T?JSON.parse(T):{}}catch{return console.warn("Invalid pending_merch_data. Clearing‚Ä¶"),localStorage.removeItem("pending_merch_data"),{}}})(),k=f.screenshots||[],M=f.thumbnail||"",h={title:f.videoTitle||"Unknown Video",channelTitle:f.creatorName||"Unknown Creator",url:f.videoUrl||""};window.__DEBUG__&&(console.log("üéØ MerchandiseCategories render - sidebar:",!!t),console.log("üì∏ screenshots:",k.length,"thumbnail?",!!M),console.log("üîß API_CONFIG.BASE_URL:",ze==null?void 0:ze.BASE_URL));const v=[{name:"Women's",emoji:"üë©",category:"womens"},{name:"Men's",emoji:"üë®",category:"mens"},{name:"Kids",emoji:"üë∂",category:"kids"},{name:"Mugs",emoji:"‚òï",category:"mugs"},{name:"Hats",emoji:"üß¢",category:"hats"},{name:"Bags",emoji:"üëú",category:"bags"},{name:"Pets",emoji:"üêï",category:"pets"},{name:"Miscellaneous",emoji:"üì¶",category:"misc"},{name:"Product Info",emoji:"üõçÔ∏è",category:"all-products"},{name:"Image Tools",emoji:"üõ†Ô∏è",category:"thumbnails"}],_=T=>{window.__DEBUG__&&console.log("üñ±Ô∏è Category selected:",T);const S=localStorage.getItem("user_authenticated")==="true",A=localStorage.getItem("user_email")||"";if(window.__DEBUG__&&(console.log("üîê Auth check:",{isAuthenticated:S,userEmail:A}),console.log("üì± User Agent:",navigator.userAgent)),!S){window.__DEBUG__&&console.log("üîí Not authenticated, showing auth modal"),u(T),o(!0);return}localStorage.setItem("last_selected_category",T);const E=`/product/browse?category=${encodeURIComponent(T)}&authenticated=${S}&email=${encodeURIComponent(A)}`;window.__DEBUG__&&console.log("üõçÔ∏è Navigating to product page:",E);const z=window.location.origin+E;window.__DEBUG__&&console.log("üåê Full URL:",z),window.location.href=z},b=async T=>{a(!0),m.current=!0;const S=new AbortController,A=setTimeout(()=>S.abort(),2e4);try{const E=localStorage.getItem("user_authenticated")==="true",z=localStorage.getItem("user_email")||"",V=document.referrer||window.location.origin,X=(h==null?void 0:h.title)||"Unknown Video",Y=(h==null?void 0:h.channelTitle)||"Unknown Creator",$={thumbnail:M,videoUrl:V,videoTitle:X,creatorName:Y,screenshots:k.slice(0,6),isAuthenticated:E,userEmail:z,category:T},se=`${ze.BASE_URL}/api/create-product`;window.__DEBUG__&&(console.log("üöÄ POST",se),console.log("üì¶ payload:",$));const be=await fetch(se,{method:"POST",headers:{"Content-Type":"application/json"},signal:S.signal,body:JSON.stringify($)});if(window.__DEBUG__&&console.log("üîç status:",be.status,"ok:",be.ok),!be.ok){const ae=await be.text().catch(()=>"(no body)");throw new Error(`HTTP ${be.status}: ${ae}`)}const xe=await be.json();if(window.__DEBUG__&&console.log("‚úÖ result:",xe),xe!=null&&xe.success&&(xe!=null&&xe.product_url))window.location.assign(xe.product_url);else throw new Error((xe==null?void 0:xe.error)||"Unknown create-product failure")}catch(E){console.error("‚ùå createProduct error:",E),alert("Error creating product. Please try again.")}finally{clearTimeout(A),a(!1),m.current=!1}},x=async()=>{window.__DEBUG__&&console.log("üîì Auth success"),n&&(await b(n),u(null))};return e.jsxs("div",{className:`container ${t?"":" large-container"}`,children:[e.jsx("div",{className:"user-flow-section",style:s!=null&&s.primary_color&&(s!=null&&s.secondary_color)?{background:`linear-gradient(135deg, ${s.primary_color} 0%, ${s.secondary_color} 100%)`}:void 0,children:e.jsx("div",{className:"flow-steps",children:e.jsxs("div",{className:"flow-step",children:[e.jsx("div",{className:"step-number",children:"3"}),e.jsxs("div",{className:"step-content",children:[e.jsx("h3",{children:"Make Merchandise"}),e.jsx("p",{children:"Create custom products with your screenshot"})]})]})})}),e.jsxs("div",{className:"merchandise-categories",children:[e.jsxs("div",{className:"categories-container",children:[e.jsx("h1",{className:"categories-title",children:"Choose a Product Category"}),e.jsx("p",{className:"categories-subtitle",children:"Select a category to browse products for your custom merchandise"}),e.jsx("div",{className:"categories-grid",children:v.map((T,S)=>e.jsxs("button",{type:"button",className:`category-box ${r?"disabled":""}`,"aria-label":`Open ${T.name}`,onClick:()=>_(T.category),onTouchStart:()=>window.__DEBUG__&&console.log("üëÜ touchstart:",T.category),disabled:r,children:[e.jsx("div",{className:"category-emoji","aria-hidden":"true",children:T.emoji}),e.jsx("div",{className:"category-name",children:T.name}),r&&e.jsx("div",{className:"loading-overlay","aria-hidden":"true",children:"Creating..."})]},T.category||S))}),e.jsx("div",{className:"back-button-container",children:e.jsx("button",{type:"button",className:"back-button",onClick:()=>window.history.back(),children:"‚Üê Back to Video"})})]}),e.jsx(na,{isOpen:i,onClose:()=>{o(!1),u(null)},onSuccess:x})]})]})};const kr=({productImage:t,screenshot:s,productName:r,productSize:a,offsetX:i,offsetY:o,onOffsetChange:n,featherEdge:u,cornerRadius:m,printAreaFit:f,selectedProductName:k,screenshotScale:M=100})=>{const h=c.useRef(null),v=c.useRef(null),[_,b]=c.useState(!1),[x,T]=c.useState({x:0,y:0}),S=c.useRef({x:0,y:0}),A=c.useRef({x:0,y:0}),[E,z]=c.useState(s),[V,X]=c.useState({width:150,height:150}),[Y,$]=c.useState({width:0,height:0});c.useEffect(()=>{const ae=f==="product"&&k?k:r;if(!ae)return;(()=>{const O=v.current&&Y.width>0,G=O?Y:{width:400,height:400};!O&&v.current;try{const U=Qs(ae,a||null,"front");if(console.log(`üîç [SIZE_CALC] Product: "${ae}" (from ${f==="product"&&k?"dropdown":"cart"}), Size: "${a||"default"}", Print Area:`,U),U&&G.width>0){const y=G.width,N=G.height,D=U.width/U.height,w=ae.toLowerCase(),p=w.includes("cropped")&&w.includes("hoodie"),ee=Math.abs(D-1)<.01||p,ie=w.includes("hat")||w.includes("cap"),we=w.includes("shirt")||w.includes("tee"),Ce=w.includes("women")&&we,Oe=w.includes("men")&&we,it=w.includes("kids")&&we;let Le,Ye;if(ie){Le=.6,Ye=.75;const Z=U.width,he=Z<=5?.6:.6+(Z-5)/.5*(.75-.6);let F=y*he,L=F/D;const H=y*.8,ue=N*.5;F>H&&(F=H,L=F/D),L>ue&&(L=ue,F=L*D);const je=y*.4,Me=N*.2;F<je&&(F=je,L=F/D),L<Me&&(L=Me,F=L*D),X({width:F,height:L}),console.log(`üìê [PRINT_AREA] ${ae} (${a||"default"}): Print ${U.width}"x${U.height}" (AR: ${D.toFixed(2)}) ‚Üí ${F.toFixed(0)}x${L.toFixed(0)}px (${(F/y*100).toFixed(1)}% x ${(L/N*100).toFixed(1)}% of product)`);return}const I=U.width,J=U.height;let Se=18,oe=24;w.includes("kids")||w.includes("youth")?(Se=14,oe=18):w.includes("hoodie")?(Se=20,oe=26):w.includes("tank")&&(Se=17,oe=22);const ve=I/Se*1.05,le=J/oe*1.05;let ne=y*ve,De=N*le,K=ne,re=K/D;const Ae=De*D,q=De;if(re<N*le&&(K=Ae,re=q),K<y*ve&&(K=y*ve,re=K/D),re<N*le&&(re=N*le,K=re*D),ee){const Z=Math.min(y,N),he=Math.max(K,re);K=Math.min(he,Z*.75),re=K;const F=we?.75:.7,L=.35,H=Z*F,ue=Z*L;K>H&&(K=H,re=H),K<ue&&(K=ue,re=ue)}else{const Z=y*.8,he=N*.8;K>Z?(K=Z,re=K/D,re>he&&(re=he,K=re*D)):re>he&&(re=he,K=re*D,K>Z&&(K=Z,re=K/D));const F=y*.3,L=N*.25;K<F&&K<y*ve&&(K=Math.max(F,y*ve),re=K/D),re<L&&re<N*le&&(re=Math.max(L,N*le),K=re*D)}X({width:K,height:re}),console.log(`üìê [PRINT_AREA] ${ae} (${a||"default"}): Print ${U.width}"x${U.height}" (AR: ${D.toFixed(2)}) ‚Üí ${K.toFixed(0)}x${re.toFixed(0)}px (${(K/y*100).toFixed(1)}% x ${(re/N*100).toFixed(1)}% of product)`)}else{const y=ae.toLowerCase().includes("cropped")?.25:.3,N=Math.min(Y.width,Y.height)*y;X({width:N,height:N})}}catch(U){console.warn("Could not calculate print area size:",U);const y=Math.min(Y.width,Y.height)*.25;X({width:y,height:y})}})()},[r,a,Y,k,f,t]);const se=ae=>{const W=ae.target,O={width:W.offsetWidth||W.naturalWidth,height:W.offsetHeight||W.naturalHeight};$(O)};c.useEffect(()=>{(async()=>{if(!s)return;const W=new Image;W.crossOrigin="anonymous",W.onload=()=>{const O=document.createElement("canvas"),de=O.getContext("2d");if(O.width=W.width,O.height=W.height,de.drawImage(W,0,0),m>0){const G=Math.min(O.width,O.height)/2,U=m>=100?G:Math.round(m/100*G),y=document.createElement("canvas"),N=y.getContext("2d");y.width=O.width,y.height=O.height,N.fillStyle="white",N.fillRect(0,0,y.width,y.height),m>=100?(N.beginPath(),N.arc(O.width/2,O.height/2,U,0,Math.PI*2),N.fill()):(N.beginPath(),N.moveTo(U,0),N.lineTo(O.width-U,0),N.quadraticCurveTo(O.width,0,O.width,U),N.lineTo(O.width,O.height-U),N.quadraticCurveTo(O.width,O.height,O.width-U,O.height),N.lineTo(U,O.height),N.quadraticCurveTo(0,O.height,0,O.height-U),N.lineTo(0,U),N.quadraticCurveTo(0,0,U,0),N.closePath(),N.fill()),de.globalCompositeOperation="destination-in",de.drawImage(y,0,0),de.globalCompositeOperation="source-over"}if(u>0){const G=document.createElement("canvas"),U=G.getContext("2d");G.width=O.width,G.height=O.height,U.fillStyle="white",U.fillRect(0,0,G.width,G.height);const y=U.createRadialGradient(O.width/2,O.height/2,Math.min(O.width,O.height)/2-u,O.width/2,O.height/2,Math.min(O.width,O.height)/2);y.addColorStop(0,"white"),y.addColorStop(1,"transparent"),U.fillStyle=y,U.fillRect(0,0,G.width,G.height),de.globalCompositeOperation="destination-in",de.drawImage(G,0,0),de.globalCompositeOperation="source-over"}z(O.toDataURL("image/png"))},W.src=s})()},[s,u,m]);const be=ae=>{ae.preventDefault(),b(!0);const W={x:ae.clientX,y:ae.clientY};T(W),S.current=W},xe=ae=>{ae.preventDefault();const W=ae.touches[0];b(!0);const O={x:W.clientX,y:W.clientY};T(O),S.current=O};return c.useEffect(()=>{if(_){const ae=O=>{var ie,we;O.touches&&O.preventDefault();const de=O.clientX||O.touches&&((ie=O.touches[0])==null?void 0:ie.clientX),G=O.clientY||O.touches&&((we=O.touches[0])==null?void 0:we.clientY);if(de===void 0||G===void 0)return;const U=.75,y=(de-S.current.x)*U,N=(G-S.current.y)*U;S.current={x:de,y:G};const D=i+y,w=o+N,p=V.width*(M/100),ee=V.height*(M/100);if(Y.width>0&&Y.height>0){const Ce=Y.width*.4,Oe=Y.height*.6,it=Y.height*.4;let Le=Math.max(-Ce,Math.min(Ce,D)),Ye=Math.max(-Oe,Math.min(it,w));A.current={x:Le,y:Ye},n(Le,Ye)}else{const Ce=Math.max(p,ee)*.5,Oe=Math.max(p,ee)*1.2,it=Math.max(p,ee)*.5,Le=Math.max(-Ce,Math.min(Ce,D)),Ye=Math.max(-Oe,Math.min(it,w));n(Le,Ye)}},W=()=>{if(Y.width>0&&Y.height>0){const O=Y.width*.4,de=Y.height*.6,G=Y.height*.4,U=A.current.x,y=A.current.y,N=Y.width*.03,D=Y.height*.03;let w=U,p=y;Math.abs(U)<N&&(w=0),Math.abs(y)<D&&(p=0),w=Math.max(-O,Math.min(O,w)),p=Math.max(-de,Math.min(G,p)),n(w,p)}b(!1)};return document.addEventListener("mousemove",ae),document.addEventListener("mouseup",W),document.addEventListener("touchmove",ae,{passive:!1}),document.addEventListener("touchend",W),document.addEventListener("touchcancel",W),()=>{document.removeEventListener("mousemove",ae),document.removeEventListener("mouseup",W),document.removeEventListener("touchmove",ae),document.removeEventListener("touchend",W),document.removeEventListener("touchcancel",W)}}},[_,x,n,V,Y,M,i,o]),e.jsxs("div",{ref:h,style:{position:"relative",width:"100%",maxWidth:"200px",margin:"0 auto",cursor:_?"grabbing":"grab",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"none"},children:[e.jsx("img",{ref:v,src:t,alt:r,onLoad:se,style:{width:"100%",height:"auto",display:"block",borderRadius:"4px"}}),(()=>{const ae=(r||"").toLowerCase();if((ae.includes("hat")||ae.includes("cap"))&&Y.width>0&&V.width>0){const O=V.width,de=V.height,G=(Y.width-O)/2,U=(Y.height-de)/2-Y.height*.08;return e.jsxs("div",{style:{position:"absolute",left:`${G/Y.width*100}%`,top:`${U/Y.height*100}%`,width:`${O/Y.width*100}%`,height:`${de/Y.height*100}%`,border:"2px dashed #007bff",borderRadius:"4px",pointerEvents:"none",boxSizing:"border-box",opacity:.7,zIndex:1},children:[e.jsx("div",{style:{position:"absolute",top:"-2px",left:"-2px",width:"8px",height:"8px",border:"2px solid #007bff",borderRadius:"2px",backgroundColor:"rgba(0, 123, 255, 0.2)"}}),e.jsx("div",{style:{position:"absolute",top:"-2px",right:"-2px",width:"8px",height:"8px",border:"2px solid #007bff",borderRadius:"2px",backgroundColor:"rgba(0, 123, 255, 0.2)"}}),e.jsx("div",{style:{position:"absolute",bottom:"-2px",left:"-2px",width:"8px",height:"8px",border:"2px solid #007bff",borderRadius:"2px",backgroundColor:"rgba(0, 123, 255, 0.2)"}}),e.jsx("div",{style:{position:"absolute",bottom:"-2px",right:"-2px",width:"8px",height:"8px",border:"2px solid #007bff",borderRadius:"2px",backgroundColor:"rgba(0, 123, 255, 0.2)"}})]})}return null})(),E&&e.jsx("div",{style:{position:"absolute",top:(()=>{const ae=(r||"").toLowerCase();return(ae.includes("hat")||ae.includes("cap"))&&Y.height>0?`${50-8}%`:"50%"})(),left:"50%",transform:`translate(calc(-50% + ${i}px), calc(-50% + ${o}px))`,cursor:_?"grabbing":"grab",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"none",pointerEvents:"auto"},onMouseDown:be,onTouchStart:xe,children:(()=>{const ae=(r||"").toLowerCase(),W=ae.includes("hat")||ae.includes("cap"),O=M/100,de=V.width/V.height,G=Math.abs(de-1)<.01;let U,y;return G?(U=V.width*O,y=U):W||V.width<=V.height?(U=V.width*O,y=U/de):(y=V.height*O,U=y*de),e.jsx("img",{src:E,alt:"Screenshot overlay",style:{width:`${U}px`,height:`${y}px`,objectFit:"contain",display:"block",pointerEvents:"none",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"none"},draggable:!1})})()})]})},Gd=t=>t?["White Glossy Mug","Travel Mug","Enamel Mug","Colored Mug"].some(r=>t.includes(r)||r.includes(t)):!1,Vd=t=>{if(!t)return!1;const s=t.toLowerCase().trim(),a=["distressed dad hat","closed back cap","five panel trucker hat","five panel baseball cap","5 panel baseball cap","snapback hat"].some(i=>{const o=i.toLowerCase().trim();return s.includes(o)||o.includes(s)||s===o});return a&&console.log("üé© [HAT CHECK] Matched:",t,"as hat product"),a},Cr=t=>{if(!t)return!1;const s=["All-Over Print Drawstring","All Over Print Tote Pocket","All-Over Print Crossbody Bag","All-Over Print Utility Bag"],r=["Pet Bowl All-Over Print","All Over Print Leash","All Over Print Collar"],a=["Apron"];return[...s,...r,...a].some(o=>t.includes(o)||o.includes(t)||t.toLowerCase().includes("all over print")||t.toLowerCase().includes("all-over print"))},qd=t=>t?["Greeting Card","Hardcover Bound Notebook","Coasters","Kiss-Cut Stickers","Kiss Cut Stickers","Bandana"].some(r=>t.includes(r)||r.includes(t)):!1,Jd=()=>"https://screenmerch.fly.dev/static/images/hatflatfront.png";let $s=null;const Kd=()=>{if($s)return $s;const t=400,s=480,r=document.createElement("canvas");r.width=t,r.height=s;const a=r.getContext("2d");return a.fillStyle="#f0f0f0",a.fillRect(0,0,t,s),a.fillStyle="#e0e0e0",a.fillRect(20,20,t-40,s-40),$s=r.toDataURL("image/png"),$s},Pi=()=>{const t=ct(),[s]=Et();c.useRef(null),c.useRef(null);const r=c.useRef(null),a=c.useRef(null),[i,o]=c.useState(null),[n,u]=c.useState(""),[m,f]=c.useState(0),[k,M]=c.useState(0),[h,v]=c.useState(!1),[_,b]=c.useState("#FF0000"),[x,T]=c.useState(10),[S,A]=c.useState(!1),[E,z]=c.useState("none"),[V,X]=c.useState(0),[Y,$]=c.useState(0),[se,be]=c.useState(""),[xe,ae]=c.useState(""),[W,O]=c.useState({width:0,height:0}),[de,G]=c.useState(!1),[U,y]=c.useState(!1),N=c.useRef(!1),[D,w]=c.useState([]),[p,ee]=c.useState(null),[ie,we]=c.useState({}),[Ce,Oe]=c.useState(100),[it,Le]=c.useState(!1),[Ye,I]=c.useState(!1),[J,Se]=c.useState(!1),[oe,ve]=c.useState(null),[le,ne]=c.useState(()=>{if(typeof window>"u")return!1;try{const q=window.location.search;if(q&&new URLSearchParams(q).get("order_id")||window.location.href&&window.location.href.includes("order_id="))return!0}catch{}return!1}),De=c.useRef(null);c.useEffect(()=>{const q=()=>{if(r.current&&a.current){const he=a.current.getBoundingClientRect().left+100;r.current.style.left=`${he}px`}};return q(),window.addEventListener("resize",q),window.addEventListener("scroll",q),()=>{window.removeEventListener("resize",q),window.removeEventListener("scroll",q)}},[]),c.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"}),I(!1)},[]),c.useEffect(()=>{try{const q=localStorage.getItem("tools_page_state");if(q){const Z=JSON.parse(q);Z.screenshotScale!==void 0&&Oe(Z.screenshotScale),Z.productImageOffsets&&we(Z.productImageOffsets),Z.selectedCartProductIndex!==void 0&&ee(Z.selectedCartProductIndex),console.log("üì¶ Restored tool page state from localStorage")}}catch(q){console.warn("Could not load tool page state:",q)}},[]),c.useEffect(()=>{try{const q={screenshotScale:Ce,productImageOffsets:ie,selectedCartProductIndex:p};localStorage.setItem("tools_page_state",JSON.stringify(q))}catch(q){console.warn("Could not save tool page state:",q)}},[Ce,ie,p]),c.useEffect(()=>{const q=s.get("order_id");if(!q||String(q).trim()===""){De.current=null;return}const Z=String(q).trim();if(De.current===Z)return;let he=!1;return De.current=Z,Se(!0),ve(null),fetch(`${ze.BASE_URL}/api/get-order-screenshot/${encodeURIComponent(Z)}`).then(async F=>{var H,ue;if(he)return;if(!F.ok){let je="Failed to load order screenshots";try{const Me=await F.json();Me&&Me.error&&(je=Me.error)}catch{}ve(je),w([]),ee(null),De.current=null,ne(!1);return}const L=await F.json();if(!he){if(L.success&&(((H=L.products)==null?void 0:H.length)>0||L.screenshot)){let Me=(((ue=L.products)==null?void 0:ue.length)>0?L.products:[{product:"Order Screenshot",screenshot:L.screenshot,color:"N/A",size:"N/A",index:0}]).map((g,te)=>({originalCartIndex:g.index??te,name:g.product||"Product",color:g.color||"N/A",size:g.size||"N/A",screenshot:g.screenshot||"",productImage:g.preview_image_url&&g.preview_image_url.trim()||"",toolSettings:null,filteredIndex:te})).filter(g=>g.screenshot&&g.screenshot.trim()!=="");w(Me),ee(Me.length>0?0:null),ve(null),ne(!0);const We=Me.filter(g=>g.name&&!g.productImage);if(We.length>0&&Promise.all(We.map(g=>fetch(`${ze.BASE_URL}/api/product-preview-url?name=${encodeURIComponent(g.name)}`).then(te=>te.ok?te.json():null).then(te=>te&&te.url?{...g,productImage:te.url}:g).catch(()=>g))).then(g=>{if(g.some(te=>te.productImage)){const te=Me.map(ge=>{const ye=We.findIndex(pe=>pe.name===ge.name&&pe.originalCartIndex===ge.originalCartIndex);return ye>=0&&g[ye].productImage?{...ge,productImage:g[ye].productImage}:ge});w(te),console.log("üì¶ Fetched product preview URLs for Tools (screenshot over print area)")}}),Me.length>0){const g=Me[0].name;g&&Object.prototype.hasOwnProperty.call(Lr,g)&&(ae(g),z("product"))}console.log(`üì¶ Loaded ${Me.length} screenshot(s) from order ${Z} (same as Print Quality / email)`)}else w([]),ee(null),ve("No screenshots found for this order."),ne(!1);Se(!1)}}).catch(F=>{he||(ve(F.message||"Error loading order screenshots"),w([]),ee(null),De.current=null,ne(!1),Se(!1))}),()=>{he=!0}},[s]),c.useEffect(()=>{xe&&E==="product"&&Oe(100)},[xe,E]),c.useEffect(()=>{if(s.get("order_id"))return;const q=()=>{try{const F=JSON.parse(localStorage.getItem("cart_items")||"[]");if(F&&F.length>0){const L=F.map((H,ue)=>({originalCartIndex:ue,name:H.name||"Product",color:H.color||"N/A",size:H.size||"N/A",screenshot:H.screenshot||"",productImage:H.image||"",toolSettings:H.toolSettings||null})).filter(H=>H.screenshot&&H.screenshot.trim()!=="").map((H,ue)=>({...H,filteredIndex:ue}));if(L.length>0){const H=L[0];if(H.toolSettings){const ue=H.toolSettings;ue.screenshotScale!==void 0&&Oe(ue.screenshotScale),ue.offsetX!==void 0&&ue.offsetY!==void 0&&we(je=>({...je,[H.originalCartIndex]:{x:ue.offsetX,y:ue.offsetY}}))}}w(L),L.length>0&&((p===null||p>=L.length)&&ee(0),L.length>1&&console.log(`üõçÔ∏è Found ${L.length} products in cart`))}else w([]),ee(null)}catch(F){console.warn("Could not load cart items:",F),w([]),ee(null)}};q();const Z=F=>{F.key==="cart_items"&&q()};window.addEventListener("storage",Z);const he=setInterval(q,2e3);return()=>{window.removeEventListener("storage",Z),clearInterval(he)}},[p,s]),c.useEffect(()=>{(()=>{var Z,he;try{if(p!==null&&D.length>0&&D[p]){const H=D[p];if(H.screenshot&&H.screenshot.trim()!==""){const ue=H.screenshot;ue!==n&&(N.current=!1),u(ue),o(ue),G(!1),console.log(`üì∏ Loaded screenshot from cart product ${p+1}: ${H.name}`);return}}const F=localStorage.getItem("pending_merch_data");if(F){const H=JSON.parse(F),ue=H.edited_screenshot||H.selected_screenshot||((Z=H.screenshots)==null?void 0:Z[0])||H.thumbnail||"";if(ue&&(ue!==n&&(N.current=!1),u(ue),o(ue),G(!1)),H.print_quality_upgrade_failed){console.log("üîç [UPGRADE] Found failure flag in localStorage, checking if image is actually upgraded...");const je=H.edited_screenshot||H.selected_screenshot||((he=H.screenshots)==null?void 0:he[0])||H.thumbnail||"";if(H.print_quality_screenshot&&je===H.print_quality_screenshot){console.log("‚úÖ [UPGRADE] Current image matches print_quality_screenshot - clearing failure flag"),y(!1);try{delete H.print_quality_upgrade_failed,localStorage.setItem("pending_merch_data",JSON.stringify(H))}catch(Me){console.warn("Could not clear failure flag:",Me)}}else if(W.width&&W.height&&W.width>=2e3&&W.height>=2e3){console.log("‚úÖ [UPGRADE] Image dimensions indicate print quality - clearing failure flag",{width:W.width,height:W.height}),y(!1);try{delete H.print_quality_upgrade_failed,localStorage.setItem("pending_merch_data",JSON.stringify(H))}catch(Me){console.warn("Could not clear failure flag:",Me)}}else console.log("‚ö†Ô∏è [UPGRADE] Failure flag found and image appears to be small - will check again when image loads"),y(!0),G(!1)}else y(!1);H.selected_product_name&&ae(H.selected_product_name)}const L=s.get("screenshot");L&&(L!==n&&(N.current=!1),u(L),o(L))}catch(F){console.warn("Could not load screenshot from localStorage:",F)}})()},[p,D]),c.useEffect(()=>{const q=F=>{var L;if(F.key==="pending_merch_data"&&F.newValue){const H=localStorage.getItem("pending_merch_data");if(H)try{const ue=JSON.parse(H),je=ue.edited_screenshot||ue.selected_screenshot||((L=ue.screenshots)==null?void 0:L[0])||ue.thumbnail||"";je&&je!==n&&(u(je),o(je))}catch(ue){console.warn("Could not parse storage data:",ue)}}},Z=()=>{var L;const F=localStorage.getItem("pending_merch_data");if(F)try{const H=JSON.parse(F),ue=H.edited_screenshot||H.selected_screenshot||((L=H.screenshots)==null?void 0:L[0])||H.thumbnail||"";ue&&ue!==n&&(u(ue),o(ue))}catch(H){console.warn("Could not parse storage data:",H)}};window.addEventListener("storage",q),window.addEventListener("localStorageUpdated",Z);const he=setInterval(()=>{try{const F=localStorage.getItem("pending_merch_data");if(F){const L=JSON.parse(F);L.print_quality_upgrade_timestamp&&Date.now()-L.print_quality_upgrade_timestamp>6e4&&!L.print_quality_upgrade_failed&&(L.print_quality_upgrade_failed=!0,localStorage.setItem("pending_merch_data",JSON.stringify(L)))}}catch(F){console.warn("Could not check upgrade status:",F)}},2e3);return setTimeout(()=>clearInterval(he),7e4),()=>{window.removeEventListener("storage",q),window.removeEventListener("localStorageUpdated",Z),clearInterval(he)}},[s,n]);const K=(q,Z,he,F,L,H)=>{q.beginPath(),q.moveTo(Z+H,he),q.lineTo(Z+F-H,he),q.quadraticCurveTo(Z+F,he,Z+F,he+H),q.lineTo(Z+F,he+L-H),q.quadraticCurveTo(Z+F,he+L,Z+F-H,he+L),q.lineTo(Z+H,he+L),q.quadraticCurveTo(Z,he+L,Z,he+L-H),q.lineTo(Z,he+H),q.quadraticCurveTo(Z,he,Z+H,he),q.closePath()};c.useEffect(()=>{if(!n)return;const q=new Image;q.crossOrigin="anonymous",q.onload=()=>{const Z={width:q.width,height:q.height};if(O(Z),console.log("üñºÔ∏è [IMAGE] Image loaded with dimensions:",Z),q.width>=2e3&&q.height>=2e3){console.log("‚úÖ [UPGRADE] Image loaded with print quality dimensions:",{width:q.width,height:q.height}),y(!1);try{const fe=localStorage.getItem("pending_merch_data");if(fe){const d=JSON.parse(fe);if(d.print_quality_upgrade_failed){console.log("‚úÖ [UPGRADE] Clearing failure flag because image is at print quality"),delete d.print_quality_upgrade_failed;try{localStorage.setItem("pending_merch_data",JSON.stringify(d)),console.log("‚úÖ [UPGRADE] Failure flag cleared in localStorage")}catch{console.warn("‚ö†Ô∏è [UPGRADE] Could not save cleared flag to localStorage, but image is upgraded")}}}}catch(fe){console.warn("Could not clear failure flag:",fe)}}else console.log("üîç [UPGRADE] Image dimensions are small:",{width:q.width,height:q.height});const F=q.width<2e3||q.height<2e3;F&&!N.current&&G(F);const L=document.createElement("canvas"),H=L.getContext("2d",{alpha:!0});L.width=q.width,L.height=q.height;const ue=document.createElement("canvas"),je=ue.getContext("2d",{alpha:!0});ue.width=q.width,ue.height=q.height;let Me=q.width,We=q.height,g=0,te=0;if(E!=="none"){const fe=q.width/q.height;let d;if(E==="product"&&xe){const j=Qs(xe,null,"front");j?d=Ld(j.width,j.height):d=.67}else switch(E){case"horizontal":d=1.5;break;case"square":d=1;break;case"vertical":d=.67;break;default:d=fe}if(fe>d){Me=q.height*d;const j=q.width-Me;g=(q.width-Me)/2+V/100*(j/2),g=Math.max(0,Math.min(g,j))}else if(fe<d){We=q.width/d;const j=q.height-We;te=(q.height-We)/2-Y/100*(j/2),te=Math.max(0,Math.min(te,j))}}L.width=Me,L.height=We,ue.width=Me,ue.height=We,H.clearRect(0,0,L.width,L.height),je.clearRect(0,0,ue.width,ue.height),je.drawImage(q,g,te,Me,We,0,0,Me,We);const ge=Math.min(L.width,L.height)/2,ye=k>=100,pe=ye?ge:Math.round(k/100*ge);if(pe>0){const fe=document.createElement("canvas"),d=fe.getContext("2d",{alpha:!0});fe.width=L.width,fe.height=L.height,d.clearRect(0,0,fe.width,fe.height),d.fillStyle="white",ye?(d.beginPath(),d.arc(fe.width/2,fe.height/2,ge,0,Math.PI*2),d.fill()):(K(d,0,0,fe.width,fe.height,pe),d.fill());const j=document.createElement("canvas"),C=j.getContext("2d",{alpha:!0});j.width=L.width,j.height=L.height,C.drawImage(ue,0,0),C.globalCompositeOperation="destination-in",C.drawImage(fe,0,0),C.globalCompositeOperation="source-over",L.width=j.width,L.height=j.height,H.clearRect(0,0,L.width,L.height),H.drawImage(j,0,0)}else H.drawImage(ue,0,0);if(m>0){const fe=Math.min(L.width,L.height),d=m/100*(fe*.5),j=document.createElement("canvas"),C=j.getContext("2d",{alpha:!0});if(j.width=L.width,j.height=L.height,C.clearRect(0,0,j.width,j.height),C.fillStyle="white",ye?(C.beginPath(),C.arc(L.width/2,L.height/2,ge,0,Math.PI*2),C.fill()):pe>0?(K(C,0,0,L.width,L.height,pe),C.fill()):C.fillRect(0,0,L.width,L.height),ye){const Q=L.width/2,ce=L.height/2,Ue=Math.max(0,ge-d),_e=ge,Ne=C.createRadialGradient(Q,ce,Ue,Q,ce,_e);Ne.addColorStop(0,"rgba(0, 0, 0, 0)"),Ne.addColorStop(1,"rgba(0, 0, 0, 1)"),C.globalCompositeOperation="destination-out",C.fillStyle=Ne,C.beginPath(),C.arc(Q,ce,_e,0,Math.PI*2),C.fill()}else{const Q=C.getImageData(0,0,j.width,j.height),ce=Q.data;for(let Ue=0;Ue<j.height;Ue++)for(let _e=0;_e<j.width;_e++){let Ne;if(pe>0){const Ke=_e,Je=j.width-_e,Ze=Ue,pt=j.height-Ue,ft=Ke<pe&&Ze<pe,Lt=Je<pe&&Ze<pe,Ie=Ke<pe&&pt<pe,yt=Je<pe&&pt<pe;if(ft||Lt||Ie||yt){let kt,Zt;ft?(kt=pe,Zt=pe):Lt?(kt=j.width-pe,Zt=pe):Ie?(kt=pe,Zt=j.height-pe):(kt=j.width-pe,Zt=j.height-pe);const pr=Math.sqrt(Math.pow(_e-kt,2)+Math.pow(Ue-Zt,2));Ne=Math.max(0,pe-pr)}else Ne=Math.min(Ze,pt,Ke,Je)}else Ne=Math.min(Ue,j.height-Ue,_e,j.width-_e);let He=255;Ne<d&&(He=Math.floor(Ne/d*255));const Fe=(Ue*j.width+_e)*4;ce[Fe+3]=He}C.putImageData(Q,0,0)}C.globalCompositeOperation="source-over",H.globalCompositeOperation="destination-in",H.drawImage(j,0,0),H.globalCompositeOperation="source-over"}if(h){H.strokeStyle=_,H.lineWidth=x,H.lineJoin="round",H.lineCap="round";const fe=Math.min(L.width,L.height)/2,d=k>=100,j=d?fe:k;if(d?(H.beginPath(),H.arc(L.width/2,L.height/2,fe-x/2,0,Math.PI*2)):j>0?K(H,x/2,x/2,L.width-x,L.height-x,Math.max(0,j-x/2)):(H.beginPath(),H.rect(x/2,x/2,L.width-x,L.height-x)),H.stroke(),S){const C=x*1.5,Q=x*.7;H.lineWidth=Q,d?(H.beginPath(),H.arc(L.width/2,L.height/2,fe-x-C,0,Math.PI*2)):j>0?K(H,x+C,x+C,L.width-(x+C)*2,L.height-(x+C)*2,Math.max(0,j-x-C)):(H.beginPath(),H.rect(x+C,x+C,L.width-(x+C)*2,L.height-(x+C)*2)),H.stroke()}}const Te=L.toDataURL("image/png");be(Te)},q.onerror=()=>{console.error("Failed to load image")},q.src=n},[n,m,k,h,_,x,S,E,V,Y,xe]);const re=()=>{const q=se||n;if(!q||!q.trim()){alert("No image to download. Please load a screenshot first.");return}const Z=s.get("order_id")||"",F=(Z?"screenmerch-"+Z:"screenmerch-print-ready")+".png",L=H=>{const ue=URL.createObjectURL(H),je=document.createElement("a");je.href=ue,je.download=F,document.body.appendChild(je),je.click(),document.body.removeChild(je),URL.revokeObjectURL(ue)};if(q.startsWith("data:image"))try{const H=q.indexOf(","),ue=H>=0?q.slice(H+1):"",je=q.match(/data:([^;]+);/),Me=je&&je[1]||"image/png";if(ue){const We=atob(ue),g=new Uint8Array(We.length);for(let te=0;te<We.length;te++)g[te]=We.charCodeAt(te);L(new Blob([g],{type:Me}))}else alert("Download failed. No image data.")}catch(H){console.error(H),alert("Download failed. Try again.")}else q.startsWith("http")?fetch(q,{mode:"cors"}).then(H=>H.blob()).then(L).catch(()=>alert("Download failed. Image may be from another origin.")):alert("Download failed. No valid image.")},Ae=()=>{if(s.get("order_id")||typeof window<"u"&&(window.location.search&&new URLSearchParams(window.location.search).get("order_id")||window.location.href&&window.location.href.includes("order_id="))||le){re();return}if(!se){alert("Please wait for the image to process, or select a screenshot first.");return}try{const Z=localStorage.getItem("pending_merch_data"),he=Z?JSON.parse(Z):{};he.edited_screenshot=se,he.tools_used={featherEdge:m,cornerRadius:k,frameEnabled:h,frameColor:_,frameWidth:x,doubleFrame:S,printAreaFit:E,imageOffsetX:V,imageOffsetY:Y},localStorage.setItem("pending_merch_data",JSON.stringify(he));const F=JSON.parse(localStorage.getItem("cart_items")||"[]");let L;if(p!==null&&D.length>0&&D[p]){const H=D[p],ue=H.originalCartIndex,je=ie[ue]||{x:0,y:0};L=F.map((Me,We)=>We===ue?{...Me,screenshot:se,edited:!0,tools_acknowledged:!0,toolSettings:{screenshotScale:Ce,offsetX:je.x,offsetY:je.y,featherEdge:m,cornerRadius:k,frameEnabled:h,frameColor:_,frameWidth:x,doubleFrame:S,printAreaFit:E}}:Me),console.log(`üíæ Updated screenshot for selected cart product: ${H.name} (cart index: ${H.originalCartIndex})`)}else L=F.map(H=>({...H,screenshot:se,edited:!0,tools_acknowledged:!0})),console.log("üíæ Updated screenshot for all cart items");localStorage.setItem("cart_items",JSON.stringify(L))}catch(Z){console.error("Failed to save edited image:",Z)}t("/checkout")};return e.jsxs("div",{className:"tools-page-container",ref:a,children:[e.jsxs("div",{className:"tools-page-header",children:[e.jsx("h1",{children:"Edit Tools"}),e.jsx("p",{className:"tools-subtitle",children:"Edit your screenshot with professional tools"})]}),s.get("order_id")&&(J||oe)&&e.jsxs("div",{style:{margin:"0 20px 16px",padding:"12px 16px",borderRadius:"8px",background:oe?"#f8d7da":"#cce5ff",color:oe?"#721c24":"#004085",border:`1px solid ${oe?"#f5c6cb":"#b8daff"}`},children:[J&&"‚è≥ Loading screenshots from order (same as in your email)...",oe&&!J&&`‚ùå ${oe}`]}),(()=>{const q=n||se,Z=D.length>0&&p!==null,he=q&&Z;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:`tools-content-reorganized ${he?"":"tools-disabled"}`,style:he?{}:{opacity:.5,pointerEvents:"none"},children:[e.jsxs("div",{className:"tools-left-column",ref:r,children:[e.jsx("div",{className:"cart-products-preview-fixed",children:D.length>0&&p!==null&&D[p]&&e.jsxs("div",{className:"cart-products-preview-section-compact",children:[e.jsxs("h3",{style:{marginTop:"10px",marginBottom:"15px",fontSize:"18px",fontWeight:"bold"},children:["Product Preview (",p+1," of ",D.length,")"]}),(()=>{const F=D[p],L=F.originalCartIndex,H=ie[L]||{x:0,y:0},ue=se||n;return e.jsxs("div",{style:{background:"white",padding:"15px",borderRadius:"8px",border:"2px solid #dee2e6",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",gap:"8px",justifyContent:"center"},children:[e.jsx("span",{style:{background:"#007bff",color:"white",borderRadius:"50%",width:"30px",height:"30px",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"14px",flexShrink:0},children:p+1}),e.jsxs("div",{style:{textAlign:"center",flex:1,minWidth:0},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"14px",wordBreak:"break-word"},children:F.name}),e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:[F.color," ‚Ä¢ ",F.size]})]})]}),(()=>{const je=F.name||"",Me=Gd(je),We=Vd(je),g=Cr(je),te=qd(je);if(We&&console.log("üé© [HAT DETECTED] Product:",je,"Will use generic hat image"),g)return e.jsxs("div",{style:{padding:"20px",textAlign:"center",background:"#fff3cd",border:"2px solid #ffc107",borderRadius:"8px",color:"#856404"},children:[e.jsx("div",{style:{fontSize:"24px",marginBottom:"10px"},children:"‚ö†Ô∏è"}),e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"No Tools for All-Over Print"}),e.jsx("div",{style:{fontSize:"14px"},children:"Editing tools (feather, corner radius, frame) are not available for all-over print products."})]});if(Me)return e.jsxs("div",{style:{padding:"20px",textAlign:"center",background:"#e7f3ff",border:"2px solid #b3d9ff",borderRadius:"8px",color:"#004085",minHeight:"150px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:"24px",marginBottom:"10px"},children:"‚òï"}),e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Preview Not Available"}),e.jsx("div",{style:{fontSize:"14px"},children:"Mug preview is not available due to the curved surface, but you can still use the editing tools to customize your screenshot."})]});if(te)if(ue){const ye=document.createElement("canvas");ye.width=400,ye.height=400;const pe=ye.getContext("2d");pe.fillStyle="#f8f9fa",pe.fillRect(0,0,400,400);const Te=ye.toDataURL();return e.jsxs("div",{style:{position:"relative"},children:[e.jsx(kr,{productImage:Te,screenshot:ue,productName:je,productSize:F.size,offsetX:H.x,offsetY:H.y,onOffsetChange:(fe,d)=>{we(j=>({...j,[L]:{x:fe,y:d}}))},featherEdge:m,cornerRadius:k,printAreaFit:E,selectedProductName:xe,screenshotScale:Ce}),e.jsxs("div",{style:{position:"absolute",top:"10px",left:"10px",right:"10px",background:"rgba(255, 255, 255, 0.9)",padding:"8px",borderRadius:"4px",fontSize:"12px",textAlign:"center",border:"1px solid #dee2e6"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Product Preview Not Available"}),e.jsx("div",{style:{fontSize:"11px",color:"#666"},children:"Screenshot size reflects selected product print area"})]})]})}else return e.jsxs("div",{style:{padding:"20px",textAlign:"center",background:"#f8f9fa",border:"2px solid #dee2e6",borderRadius:"8px",color:"#495057",minHeight:"150px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:"24px",marginBottom:"10px"},children:"‚úèÔ∏è"}),e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Product Preview Not Available"}),e.jsx("div",{style:{fontSize:"14px"},children:"You can use the editing tools to customize your screenshot for this product."})]});if(We){const ge=Jd();return console.log("üé© [HAT DETECTED] Product:",je),console.log("üé© [HAT IMAGE] Using generic hat image:",ge),console.log("üé© [HAT IMAGE] Original product image from cart:",F.productImage),console.log("üé© [HAT IMAGE] Will override with:",ge),ue?e.jsx(kr,{productImage:ge,screenshot:ue,productName:je,productSize:F.size,offsetX:H.x,offsetY:H.y,onOffsetChange:(ye,pe)=>{we(Te=>({...Te,[L]:{x:ye,y:pe}}))},featherEdge:m,cornerRadius:k,printAreaFit:E,selectedProductName:xe,screenshotScale:Ce}):e.jsxs("div",{style:{padding:"20px",textAlign:"center",background:"#f8f9fa",border:"2px solid #dee2e6",borderRadius:"8px",color:"#495057",minHeight:"150px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[e.jsx("img",{src:ge,alt:je,style:{maxWidth:"200px",maxHeight:"150px",marginBottom:"10px"}}),e.jsx("div",{style:{fontSize:"14px",color:"#666"},children:"Add a screenshot to see preview"})]})}if(ue){const ge=F.productImage||Kd();return e.jsx(kr,{productImage:ge,screenshot:ue,productName:je,productSize:F.size,offsetX:H.x,offsetY:H.y,onOffsetChange:(ye,pe)=>{we(Te=>({...Te,[L]:{x:ye,y:pe}}))},featherEdge:m,cornerRadius:k,printAreaFit:E,selectedProductName:xe,screenshotScale:Ce})}return null})()]})})()]})}),e.jsx("div",{className:"tools-left-column-scrollable",children:e.jsxs("div",{className:"tool-control-group",style:{marginTop:"20px"},children:[e.jsx("h3",{style:{textAlign:"center"},children:"Screenshot Size"}),e.jsx("p",{className:"tool-description",style:{textAlign:"center"},children:"Adjust the size of your screenshot to fit the print area perfectly"}),e.jsx("div",{className:"slider-control",children:e.jsxs("div",{className:`${xe&&!it?"screenshot-size-pulse":""}`,style:{display:"flex",alignItems:"center",gap:"10px",padding:"8px",borderRadius:"4px"},children:[e.jsx("input",{type:"range",min:"50",max:"150",value:Ce,onMouseDown:()=>Le(!0),onTouchStart:()=>Le(!0),onChange:F=>{Oe(parseInt(F.target.value)),Le(!0)},onContextMenu:F=>F.preventDefault(),onSelectStart:F=>F.preventDefault(),className:"slider",style:{flex:1,userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"manipulation"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[e.jsx("button",{type:"button",onClick:()=>{Oe(Math.min(150,Ce+1)),Le(!0)},onContextMenu:F=>F.preventDefault(),onSelectStart:F=>F.preventDefault(),style:{background:"#667eea",color:"white",border:"none",borderRadius:"4px",width:"28px",height:"20px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",padding:0,lineHeight:1,userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"manipulation"},title:"Increase size",children:"‚ñ≤"}),e.jsx("button",{type:"button",onClick:()=>{Oe(Math.max(50,Ce-1)),Le(!0)},onContextMenu:F=>F.preventDefault(),onSelectStart:F=>F.preventDefault(),style:{background:"#667eea",color:"white",border:"none",borderRadius:"4px",width:"28px",height:"20px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",padding:0,lineHeight:1,userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"manipulation"},title:"Decrease size",children:"‚ñº"})]}),e.jsxs("span",{className:"slider-value",style:{minWidth:"50px",textAlign:"right",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none"},onContextMenu:F=>F.preventDefault(),onSelectStart:F=>F.preventDefault(),children:[Ce,"%"]})]})})]})})]}),e.jsx("div",{style:{width:"100px",flexShrink:0},className:"tools-left-column-spacer"}),e.jsx("div",{style:{width:"350px",flexShrink:0},className:"tools-left-column-spacer"}),e.jsxs("div",{className:"tools-controls-section",children:[D.length>1&&e.jsxs("div",{className:"tool-control-group",style:{marginBottom:"1rem",position:"relative"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.5rem",fontWeight:"bold"},children:"Select Product From Cart:"}),e.jsxs("select",{value:p!==null?p:"",onChange:F=>{const L=parseInt(F.target.value);isNaN(L)||(ee(L),console.log(`üîÑ Product changed to index ${L}`))},className:"print-area-select",style:{width:"100%"},children:[e.jsx("option",{value:"",children:"-- Select Product --"}),D.map((F,L)=>e.jsxs("option",{value:L,children:[F.name,F.color&&F.color!=="N/A"?` - ${F.color}`:"",F.size&&F.size!=="N/A"?` (${F.size})`:""]},L))]})]}),e.jsxs("div",{className:"tool-control-group",children:[e.jsx("h3",{children:"Fit to Print Area"}),e.jsx("p",{className:"tool-description",children:"Crop image to fit product print areas"}),e.jsxs("div",{className:"select-control product-select-pulse-wrapper",style:{marginBottom:"1rem",position:"relative"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem"},children:"Select Product:"}),e.jsxs("select",{value:xe,onClick:()=>{Ye||I(!0)},onChange:F=>{ae(F.target.value),I(!0),Le(!1),F.target.value&&z("product")},className:`print-area-select ${Ye?"":"product-select-pulse"}`,children:[e.jsx("option",{value:"",children:"-- Select Product --"}),Object.keys(Lr).sort().map(F=>e.jsx("option",{value:F,children:F},F))]})]}),e.jsxs("div",{className:"select-control",children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem"},children:"Fit Type:"}),e.jsxs("select",{value:E,onChange:F=>{z(F.target.value),X(0),$(0)},className:"print-area-select",children:[e.jsx("option",{value:"none",children:"Original (No Fit)"}),xe&&e.jsxs("option",{value:"product",children:["Product Specific (",xe,")"]}),e.jsx("option",{value:"horizontal",children:"Horizontal (Wide - for standard shirts)"}),e.jsx("option",{value:"square",children:"Square (1:1 - for mugs, square items)"}),e.jsx("option",{value:"vertical",children:"Vertical (Tall - for tank tops, vertical shirts)"})]})]}),E!=="none"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"slider-control",style:{marginTop:"1rem"},children:[e.jsx("label",{children:"Move Horizontal:"}),e.jsx("input",{type:"range",min:"-100",max:"100",value:V,onChange:F=>X(parseInt(F.target.value)),className:"slider"}),e.jsx("span",{className:"slider-value",children:V>0?`Right ${V}%`:V<0?`Left ${Math.abs(V)}%`:"Center"})]}),e.jsxs("div",{className:"slider-control",children:[e.jsx("label",{children:"Move Vertical:"}),e.jsx("input",{type:"range",min:"-100",max:"100",value:Y,onChange:F=>$(parseInt(F.target.value)),className:"slider"}),e.jsx("span",{className:"slider-value",children:Y>0?`Down ${Y}%`:Y<0?`Up ${Math.abs(Y)}%`:"Center"})]})]})]}),(()=>{const F=D.length>0&&p!==null?D[p]:null,L=(F==null?void 0:F.name)||"";return Cr(L)?e.jsx("div",{className:"tool-control-group",children:e.jsxs("div",{style:{padding:"20px",textAlign:"center",background:"#fff3cd",border:"2px solid #ffc107",borderRadius:"8px",color:"#856404"},children:[e.jsx("div",{style:{fontSize:"24px",marginBottom:"10px"},children:"‚ö†Ô∏è"}),e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Tools Not Available"}),e.jsx("div",{style:{fontSize:"14px"},children:"Editing tools (feather, corner radius, frame) are not available for all-over print products."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"tool-control-group",children:[e.jsx("h3",{children:"Feather Edge"}),e.jsx("p",{className:"tool-description",children:"Softens the edges of your screenshot"}),e.jsxs("div",{className:"slider-control",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:m,onChange:ue=>f(parseInt(ue.target.value)),className:"slider"}),e.jsxs("span",{className:"slider-value",children:[m,"%"]})]})]}),e.jsxs("div",{className:"tool-control-group",children:[e.jsx("h3",{children:"Corner Radius"}),e.jsx("p",{className:"tool-description",children:"Round the corners of your screenshot (max = perfect circle)"}),e.jsxs("div",{className:"slider-control",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:k,onChange:ue=>M(parseInt(ue.target.value)),className:"slider"}),e.jsx("span",{className:"slider-value",children:k===100?"Circle":`${k}%`})]})]}),e.jsx("div",{className:"tool-control-group",children:e.jsxs("div",{className:"framed-border-container",style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{style:{width:"100%"},children:[e.jsx("h3",{children:"Framed Border"}),e.jsx("p",{className:"tool-description",children:"Add a colored frame around your screenshot"}),e.jsx("div",{className:"checkbox-control",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:h,onChange:ue=>v(ue.target.checked)}),"Enable Frame"]})}),h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"checkbox-control",style:{marginTop:"0.5rem"},children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:S,onChange:ue=>A(ue.target.checked)}),"Double Frame (3D Look)"]})}),e.jsxs("div",{className:"color-control",style:{flexWrap:"wrap",gap:"0.5rem"},children:[e.jsx("label",{style:{minWidth:"100px"},children:"Frame Color:"}),e.jsx("input",{type:"color",value:_,onChange:ue=>b(ue.target.value),className:"color-picker"}),e.jsx("span",{className:"color-value",style:{wordBreak:"break-all"},children:_})]}),e.jsxs("div",{className:"slider-control",children:[e.jsx("label",{children:"Frame Width:"}),e.jsx("input",{type:"range",min:"1",max:"50",value:x,onChange:ue=>T(parseInt(ue.target.value)),className:"slider"}),e.jsxs("span",{className:"slider-value",children:[x,"px"]})]})]})]}),e.jsxs("div",{style:{flexShrink:0,width:"200px",background:"white",borderRadius:"8px",padding:"12px",border:"2px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h4",{className:"screenshot-preview-title",style:{margin:"0 0 8px 0",fontSize:"14px",fontWeight:"bold"},children:"Screenshot Preview"}),e.jsx("div",{style:{width:"100%",minHeight:"120px",maxHeight:"150px",display:"flex",alignItems:"center",justifyContent:"center",background:"#f8f9fa",borderRadius:"6px",overflow:"hidden",border:"1px solid #dee2e6"},children:se?e.jsx("img",{src:se,alt:"Screenshot Preview",style:{maxWidth:"100%",maxHeight:"150px",objectFit:"contain",display:"block"}}):n?e.jsx("img",{src:n,alt:"Screenshot Preview",style:{maxWidth:"100%",maxHeight:"150px",objectFit:"contain",display:"block"}}):e.jsx("p",{style:{color:"#999",fontSize:"0.85rem",margin:0,textAlign:"center",padding:"10px"},children:"No screenshot loaded"})})]})]})})]})})(),(()=>{const F=D.length>0&&p!==null?D[p]:null,L=(F==null?void 0:F.name)||"";return Cr(L),null})(),e.jsxs("div",{className:"tools-actions",children:[(()=>{const F=s.get("order_id");let L=!1;if(typeof window<"u"){const ue=window.location.search;ue&&(L=!!new URLSearchParams(ue).get("order_id")),!L&&window.location.href&&window.location.href.includes("order_id=")&&(L=!0)}return F||L||le?e.jsx("button",{className:"apply-edits-btn download-btn",onClick:re,disabled:!se&&!n,children:"Download"}):e.jsx("button",{className:"apply-edits-btn",onClick:Ae,disabled:!se,children:"Apply Edits"})})(),e.jsx("button",{className:"reset-btn",onClick:()=>{f(0),M(0),v(!1),T(10),b("#FF0000"),A(!1),z("none"),X(0),$(0)},children:"Reset"})]})]})]})})})()]})},Pr={unisexstapletshirt:{name:"Unisex Staple T-Shirt",price:31.99,description:"Comfortable soft t-shirt with custom design",image:"/static/images/guidontee.png",preview:"/static/images/guidonteepreview.png",category:"t-shirts",variables:{sizes:["XS","S","M","L","XL","XXL","XXXL","XXXXL","XXXXXL"],colors:["Black","White","Navy","Black Heather","Athletic Heather","Dark Grey Heather","Red","Kelly","Heather Midnight Navy","True Royal","Asphalt","Heather True Royal","Heather Prism Lilac","Soft Cream","Heather Prism Ice Blue","Mauve","Forest","Heather Forest","Olive","Heather Deep Teal"],availability:{XS:{Black:!0,White:!0,Navy:!0,"Black Heather":!0,"Athletic Heather":!0,"Dark Grey Heather":!0,Red:!0,Kelly:!0,"Heather Midnight Navy":!1,"True Royal":!1,Asphalt:!1,"Heather True Royal":!1,"Heather Prism Lilac":!0,"Soft Cream":!0,"Heather Prism Ice Blue":!0,Mauve:!1,Forest:!1,"Heather Forest":!1,Olive:!1,"Heather Deep Teal":!1},S:{Black:!0,White:!0,Navy:!0,"Black Heather":!0,"Athletic Heather":!0,"Dark Grey Heather":!0,Red:!0,Kelly:!0,"Heather Midnight Navy":!0,"True Royal":!0,Asphalt:!0,"Heather True Royal":!0,"Heather Prism Lilac":!0,"Soft Cream":!0,"Heather Prism Ice Blue":!0,Mauve:!0,Forest:!0,"Heather Forest":!0,Olive:!0,"Heather Deep Teal":!0},M:{Black:!0,White:!0,Navy:!0,"Black Heather":!0,"Athletic Heather":!0,"Dark Grey Heather":!0,Red:!0,Kelly:!0,"Heather Midnight Navy":!0,"True Royal":!0,Asphalt:!0,"Heather True Royal":!0,"Heather Prism Lilac":!0,"Soft Cream":!0,"Heather Prism Ice Blue":!0,Mauve:!0,Forest:!0,"Heather Forest":!0,Olive:!0,"Heather Deep Teal":!0},L:{Black:!0,White:!0,Navy:!0,"Black Heather":!0,"Athletic Heather":!0,"Dark Grey Heather":!0,Red:!0,Kelly:!0,"Heather Midnight Navy":!0,"True Royal":!0,Asphalt:!0,"Heather True Royal":!0,"Heather Prism Lilac":!0,"Soft Cream":!0,"Heather Prism Ice Blue":!0,Mauve:!0,Forest:!0,"Heather Forest":!0,Olive:!0,"Heather Deep Teal":!0},XL:{Black:!0,White:!0,Navy:!0,"Black Heather":!0,"Athletic Heather":!0,"Dark Grey Heather":!0,Red:!0,Kelly:!0,"Heather Midnight Navy":!0,"True Royal":!0,Asphalt:!0,"Heather True Royal":!0,"Heather Prism Lilac":!0,"Soft Cream":!0,"Heather Prism Ice Blue":!0,Mauve:!0,Forest:!0,"Heather Forest":!0,Olive:!0,"Heather Deep Teal":!0},XXL:{Black:!0,White:!0,Navy:!0,"Black Heather":!0,"Athletic Heather":!0,"Dark Grey Heather":!0,Red:!0,Kelly:!0,"Heather Midnight Navy":!0,"True Royal":!0,Asphalt:!0,"Heather True Royal":!0,"Heather Prism Lilac":!0,"Soft Cream":!0,"Heather Prism Ice Blue":!0,Mauve:!0,Forest:!0,"Heather Forest":!0,Olive:!0,"Heather Deep Teal":!0},XXXL:{Black:!0,White:!0,Navy:!0,"Black Heather":!0,"Athletic Heather":!0,"Dark Grey Heather":!0,Red:!0,Kelly:!0,"Heather Midnight Navy":!0,"True Royal":!0,Asphalt:!0,"Heather True Royal":!0,"Heather Prism Lilac":!0,"Soft Cream":!0,"Heather Prism Ice Blue":!0,Mauve:!0,Forest:!0,"Heather Forest":!0,Olive:!0,"Heather Deep Teal":!0},XXXXL:{Black:!0,White:!0,Navy:!0,"Black Heather":!0,"Athletic Heather":!0,"Dark Grey Heather":!0,Red:!0,Kelly:!0,"Heather Midnight Navy":!0,"True Royal":!0,Asphalt:!0,"Heather True Royal":!0,"Heather Prism Lilac":!0,"Soft Cream":!0,"Heather Prism Ice Blue":!0,Mauve:!0,Forest:!0,"Heather Forest":!0,Olive:!0,"Heather Deep Teal":!0},XXXXXL:{Black:!0,White:!0,Navy:!0,"Black Heather":!0,"Athletic Heather":!0,"Dark Grey Heather":!0,Red:!0,Kelly:!0,"Heather Midnight Navy":!1,"True Royal":!1,Asphalt:!1,"Heather True Royal":!1,"Heather Prism Lilac":!1,"Soft Cream":!1,"Heather Prism Ice Blue":!1,Mauve:!1,Forest:!1,"Heather Forest":!1,Olive:!1,"Heather Deep Teal":!1}}}},unisexclassictee:{name:"Unisex Classic Tee",price:34.99,description:"Classic unisex t-shirt",image:"/static/images/unisexclassictee.png",preview:"/static/images/unisexclassicteepreview.png",category:"t-shirts",variables:{sizes:["XS","S","M","L","XL","XXL","XXXL","XXXXL","XXXXXL"],colors:["Black","Navy","Sport Grey","White","Maroon","Red","Natural","Military Green","Orange","Irish Green","Gold","Sky","Ash","Purple","Cardinal"],availability:{XS:{Black:!0,Navy:!0,"Sport Grey":!0,White:!0,Maroon:!0,Red:!0,Natural:!0,"Military Green":!0,Orange:!0,"Irish Green":!0,Gold:!0,Sky:!0,Ash:!0,Purple:!0,Cardinal:!0},S:{Black:!0,Navy:!0,"Sport Grey":!0,White:!0,Maroon:!0,Red:!0,Natural:!0,"Military Green":!0,Orange:!0,"Irish Green":!0,Gold:!0,Sky:!0,Ash:!0,Purple:!0,Cardinal:!0},M:{Black:!0,Navy:!0,"Sport Grey":!0,White:!0,Maroon:!0,Red:!0,Natural:!0,"Military Green":!0,Orange:!0,"Irish Green":!0,Gold:!0,Sky:!0,Ash:!0,Purple:!0,Cardinal:!0},L:{Black:!0,Navy:!0,"Sport Grey":!0,White:!0,Maroon:!0,Red:!0,Natural:!0,"Military Green":!0,Orange:!0,"Irish Green":!0,Gold:!0,Sky:!0,Ash:!0,Purple:!0,Cardinal:!0},XL:{Black:!0,Navy:!0,"Sport Grey":!0,White:!0,Maroon:!0,Red:!0,Natural:!0,"Military Green":!0,Orange:!0,"Irish Green":!0,Gold:!0,Sky:!0,Ash:!0,Purple:!0,Cardinal:!0},XXL:{Black:!0,Navy:!0,"Sport Grey":!0,White:!0,Maroon:!0,Red:!0,Natural:!0,"Military Green":!0,Orange:!0,"Irish Green":!0,Gold:!0,Sky:!0,Ash:!0,Purple:!0,Cardinal:!0},XXXL:{Black:!0,Navy:!0,"Sport Grey":!0,White:!0,Maroon:!0,Red:!0,Natural:!0,"Military Green":!0,Orange:!0,"Irish Green":!0,Gold:!0,Sky:!0,Ash:!0,Purple:!0,Cardinal:!0},XXXXL:{Black:!0,Navy:!0,"Sport Grey":!0,White:!0,Maroon:!0,Red:!0,Natural:!0,"Military Green":!0,Orange:!0,"Irish Green":!0,Gold:!0,Sky:!0,Ash:!0,Purple:!0,Cardinal:!0},XXXXXL:{Black:!0,Navy:!0,"Sport Grey":!0,White:!0,Maroon:!0,Red:!0,Natural:!0,"Military Green":!0,Orange:!0,"Irish Green":!0,Gold:!0,Sky:!0,Ash:!0,Purple:!0,Cardinal:!0}}}},"men'stanktop":{name:"Men's Tank Top",price:24.23,description:"Comfortable men's tank top",image:"/static/images/random.png",preview:"/static/images/randompreview.png",category:"tank-tops",variables:{sizes:["XS"],colors:["White"],availability:{XS:{White:!0}}}},unisexhoodie:{name:"Unisex Hoodie",price:37.95,description:"Comfortable unisex hoodie",image:"/static/images/tested.png",preview:"/static/images/testedpreview.png",category:"hoodies",variables:{sizes:["S","M","L","XL","XXL","XXXL"],colors:["White"],availability:{S:{White:!0},M:{White:!0},L:{White:!0},XL:{White:!0},XXL:{White:!0},XXXL:{White:!0}}}},croppedhoodie:{name:"Cropped Hoodie",price:49.99,description:"Stylish cropped hoodie",image:"/static/images/croppedhoodie.png",preview:"/static/images/croppedhoodiepreview.png",category:"hoodies",variables:{sizes:["S","M","L","XL","XXL"],colors:["Black","Military Green","Storm","Peach"],availability:{S:{Black:!0,"Military Green":!0,Storm:!0,Peach:!1},M:{Black:!0,"Military Green":!0,Storm:!0,Peach:!1},L:{Black:!0,"Military Green":!0,Storm:!0,Peach:!1},XL:{Black:!1,"Military Green":!0,Storm:!0,Peach:!0},XXL:{Black:!1,"Military Green":!0,Storm:!0,Peach:!1}}}},unisexchampionhoodie:{name:"Unisex Champion Hoodie",price:39.99,description:"Premium Champion brand hoodie",image:"/static/images/hoodiechampion.png",preview:"/static/images/hoodiechampionpreview.jpg",category:"hoodies",variables:{sizes:["XS","S","M","L","XL","XXL","XXXL","XXXXL","XXXXXL"],colors:["Black","Gray"],availability:{XS:{Black:!0,Gray:!0},S:{Black:!0,Gray:!0},M:{Black:!0,Gray:!0},L:{Black:!0,Gray:!0},XL:{Black:!0,Gray:!0},XXL:{Black:!0,Gray:!0},XXXL:{Black:!0,Gray:!0},XXXXL:{Black:!0,Gray:!0},XXXXXL:{Black:!0,Gray:!0}}}},"women'sribbedneck":{name:"Women's Ribbed Neck",price:25.6,description:"Women's shirt with ribbed neck design",image:"/static/images/womensribbedneck.png",preview:"/static/images/womensribbedneckpreview.png",category:"women's-shirts",size_pricing:{S:0,M:0,L:0,XL:0,XXL:2,XXXL:4,XXXXL:6,XXXXXL:8},variables:{sizes:["S","M","L","XL","XXL","XXXL","XXXXL","XXXXXL"],colors:["Black","French Navy","Heather Grey","White","Dark Heather Grey","Burgundy","India Ink Grey","Anthracite","Red","Stargazer","Khaki","Desert Dust","Fraiche Peche","Cotton Pink","Lavender"],availability:{S:{Black:!0,"French Navy":!0,"Heather Grey":!0,White:!0,"Dark Heather Grey":!0,Burgundy:!0,"India Ink Grey":!0,Anthracite:!0,Red:!0,Stargazer:!0,Khaki:!0,"Desert Dust":!0,"Fraiche Peche":!0,"Cotton Pink":!0,Lavender:!0},M:{Black:!0,"French Navy":!0,"Heather Grey":!0,White:!0,"Dark Heather Grey":!0,Burgundy:!0,"India Ink Grey":!0,Anthracite:!0,Red:!0,Stargazer:!0,Khaki:!0,"Desert Dust":!0,"Fraiche Peche":!0,"Cotton Pink":!0,Lavender:!0},L:{Black:!0,"French Navy":!0,"Heather Grey":!0,White:!0,"Dark Heather Grey":!0,Burgundy:!0,"India Ink Grey":!0,Anthracite:!0,Red:!0,Stargazer:!0,Khaki:!0,"Desert Dust":!0,"Fraiche Peche":!0,"Cotton Pink":!0,Lavender:!0},XL:{Black:!0,"French Navy":!0,"Heather Grey":!0,White:!0,"Dark Heather Grey":!0,Burgundy:!0,"India Ink Grey":!0,Anthracite:!0,Red:!0,Stargazer:!0,Khaki:!0,"Desert Dust":!0,"Fraiche Peche":!0,"Cotton Pink":!0,Lavender:!0},XXL:{Black:!0,"French Navy":!0,"Heather Grey":!0,White:!0,"Dark Heather Grey":!0,Burgundy:!0,"India Ink Grey":!0,Anthracite:!0,Red:!0,Stargazer:!0,Khaki:!0,"Desert Dust":!0,"Fraiche Peche":!0,"Cotton Pink":!0,Lavender:!0},XXXL:{Black:!0,"French Navy":!0,"Heather Grey":!0,White:!0,"Dark Heather Grey":!1,Burgundy:!1,"India Ink Grey":!1,Anthracite:!1,Red:!1,Stargazer:!1,Khaki:!1,"Desert Dust":!1,"Fraiche Peche":!1,"Cotton Pink":!1,Lavender:!1},XXXXL:{Black:!0,"French Navy":!0,"Heather Grey":!0,White:!0,"Dark Heather Grey":!1,Burgundy:!1,"India Ink Grey":!1,Anthracite:!1,Red:!1,Stargazer:!1,Khaki:!1,"Desert Dust":!1,"Fraiche Peche":!1,"Cotton Pink":!1,Lavender:!1},XXXXXL:{Black:!0,"French Navy":!0,"Heather Grey":!0,White:!0,"Dark Heather Grey":!1,Burgundy:!1,"India Ink Grey":!1,Anthracite:!1,Red:!1,Stargazer:!1,Khaki:!1,"Desert Dust":!1,"Fraiche Peche":!1,"Cotton Pink":!1,Lavender:!1}}}},"women'sshirt":{name:"Women's Shirt",price:36.99,description:"Comfortable women's shirt",image:"/static/images/womensshirt.png",preview:"/static/images/womensshirtpreview.png",category:"women's-shirts",variables:{sizes:["S","M","L","XL","XXL","XXXL"],colors:["Black","White","Dark Grey Heather","Pink","Navy","Heather Mauve","Heather Red","Leaf","Heather Blue Lagoon","Athletic Heather","Heather Stone"],availability:{S:{Black:!0,White:!0,"Dark Grey Heather":!0,Pink:!0,Navy:!0,"Heather Mauve":!0,"Heather Red":!0,Leaf:!0,"Heather Blue Lagoon":!0,"Athletic Heather":!0,"Heather Stone":!0},M:{Black:!0,White:!0,"Dark Grey Heather":!0,Pink:!0,Navy:!0,"Heather Mauve":!0,"Heather Red":!0,Leaf:!0,"Heather Blue Lagoon":!0,"Athletic Heather":!0,"Heather Stone":!0},L:{Black:!0,White:!0,"Dark Grey Heather":!0,Pink:!0,Navy:!0,"Heather Mauve":!0,"Heather Red":!0,Leaf:!0,"Heather Blue Lagoon":!0,"Athletic Heather":!0,"Heather Stone":!0},XL:{Black:!0,White:!0,"Dark Grey Heather":!0,Pink:!0,Navy:!0,"Heather Mauve":!0,"Heather Red":!0,Leaf:!0,"Heather Blue Lagoon":!0,"Athletic Heather":!0,"Heather Stone":!0},XXL:{Black:!0,White:!0,"Dark Grey Heather":!0,Pink:!0,Navy:!0,"Heather Mauve":!0,"Heather Red":!0,Leaf:!0,"Heather Blue Lagoon":!0,"Athletic Heather":!0,"Heather Stone":!0},XXXL:{Black:!0,White:!0,"Dark Grey Heather":!0,Pink:!0,Navy:!0,"Heather Mauve":!0,"Heather Red":!0,Leaf:!0,"Heather Blue Lagoon":!0,"Athletic Heather":!0,"Heather Stone":!0}}}},"women'shdshirt":{name:"Women's HD Shirt",price:38.99,description:"High-definition print women's shirt",image:"/static/images/womenshdshirt.png",preview:"/static/images/womenshdshirtpreview.png",category:"women's-shirts",variables:{sizes:["XS","S","M","L","XL","XXL","XXXL","XXXXL","XXXXXL"],colors:["Black","White","Gray","Navy"],availability:{XS:{Black:!0,White:!0,Gray:!0,Navy:!0},S:{Black:!0,White:!0,Gray:!0,Navy:!0},M:{Black:!0,White:!0,Gray:!0,Navy:!0},L:{Black:!0,White:!0,Gray:!0,Navy:!0},XL:{Black:!0,White:!0,Gray:!0,Navy:!0},XXL:{Black:!0,White:!0,Gray:!0,Navy:!0},XXXL:{Black:!0,White:!0,Gray:!0,Navy:!0},XXXXL:{Black:!0,White:!0,Gray:!0,Navy:!0},XXXXXL:{Black:!0,White:!0,Gray:!0,Navy:!0}}}},kidsshirt:{name:"Kids Shirt",price:29.99,description:"Comfortable kids t-shirt",image:"/static/images/kidshirt.png",preview:"/static/images/kidshirtpreview.png",category:"kids",variables:{sizes:["XS","S","M","L"],colors:["Black","White","Gray","Pink"],availability:{XS:{Black:!0,White:!0,Gray:!0,Pink:!0},S:{Black:!0,White:!0,Gray:!0,Pink:!0},M:{Black:!0,White:!0,Gray:!0,Pink:!0},L:{Black:!0,White:!0,Gray:!0,Pink:!0}}}},kidshoodie:{name:"Kids Hoodie",price:39.99,description:"Warm kids hoodie",image:"/static/images/kidhoodie.png",preview:"/static/images/kidhoodiepreview.png",category:"kids",variables:{sizes:["XS","S","M","L"],colors:["Black","White","Gray","Navy"],availability:{XS:{Black:!0,White:!0,Gray:!0,Navy:!0},S:{Black:!0,White:!0,Gray:!0,Navy:!0},M:{Black:!0,White:!0,Gray:!0,Navy:!0},L:{Black:!0,White:!0,Gray:!0,Navy:!0}}}},kidslongsleeve:{name:"Kids Long Sleeve",price:34.99,description:"Comfortable kids long sleeve shirt",image:"/static/images/kidlongsleeve.png",preview:"/static/images/kidlongsleevepreview.png",category:"kids",variables:{sizes:["XS","S","M","L"],colors:["Black","White","Gray","Pink"],availability:{XS:{Black:!0,White:!0,Gray:!0,Pink:!0},S:{Black:!0,White:!0,Gray:!0,Pink:!0},M:{Black:!0,White:!0,Gray:!0,Pink:!0},L:{Black:!0,White:!0,Gray:!0,Pink:!0}}}},youthswimsuit:{name:"Youth All Over Print Swimsuit",price:24.99,description:"Comfortable youth swimsuit with all-over print",image:"/static/images/Youthalloverprintswimsuit.png",preview:"/static/images/youthalloverprintswimsuitpreview.png",category:"kids",variables:{sizes:["XS","S","M","L","XL"],colors:["White","Navy","Black","Pink","Blue"],availability:{XS:{White:!0,Navy:!0,Black:!0,Pink:!0,Blue:!0},S:{White:!0,Navy:!0,Black:!0,Pink:!0,Blue:!0},M:{White:!0,Navy:!0,Black:!0,Pink:!0,Blue:!0},L:{White:!0,Navy:!0,Black:!0,Pink:!0,Blue:!0},XL:{White:!0,Navy:!0,Black:!0,Pink:!0,Blue:!0}}}},girlsleggings:{name:"Girls Leggings",price:22.99,description:"Comfortable girls leggings with all-over print",image:"/static/images/girlsleggings.png",preview:"/static/images/girlsleggingspreview.png",category:"kids",variables:{sizes:["XS","S","M","L","XL"],colors:["White","Black","Navy","Pink","Purple"],availability:{XS:{White:!0,Black:!0,Navy:!0,Pink:!0,Purple:!0},S:{White:!0,Black:!0,Navy:!0,Pink:!0,Purple:!0},M:{White:!0,Black:!0,Navy:!0,Pink:!0,Purple:!0},L:{White:!0,Black:!0,Navy:!0,Pink:!0,Purple:!0},XL:{White:!0,Black:!0,Navy:!0,Pink:!0,Purple:!0}}}},canvastote:{name:"Canvas Tote",price:28.99,description:"Eco-friendly canvas tote bag",image:"/static/images/allovertotebag.png",preview:"/static/images/allovertotebagpreview.png",category:"bags",variables:{sizes:[],colors:["Natural","Black"],availability:{}}},totebag:{name:"Tote Bag",price:31.99,description:"Versatile tote bag",image:"/static/images/drawstringbag.png",preview:"/static/images/drawstringbagpreview.png",category:"bags",variables:{sizes:[],colors:["White","Black","Blue"],availability:{}}},largecanvasbag:{name:"Large Canvas Bag",price:34.99,description:"Large canvas bag for all your needs",image:"/static/images/largecanvasbag.png",preview:"/static/images/largecanvasbagpreview.png",category:"bags",variables:{sizes:[],colors:["Natural","Black","Navy"],availability:{}}},greetingcard:{name:"Greeting Card",price:32.99,description:"Beautiful greeting card",image:"/static/images/greetingcard.png",preview:"/static/images/greetingcardpreview.png",category:"stationery",variables:{sizes:[],colors:["White","Cream"],availability:{}}},notebook:{name:"Notebook",price:24.99,description:"Hardcover notebook",image:"/static/images/hardcovernotebook.png",preview:"/static/images/hardcovernotebookpreview.png",category:"stationery",variables:{sizes:[],colors:["Black","Blue"],availability:{}}},coasters:{name:"Coasters",price:23.99,description:"Set of custom coasters",image:"/static/images/coaster.png",preview:"/static/images/coasterpreview.jpg",category:"home-&-living",variables:{sizes:[],colors:["Wood","Cork","Black"],availability:{}}},stickerpack:{name:"Sticker Pack",price:18.99,description:"Set of custom stickers",image:"/static/images/stickers.png",preview:"/static/images/stickerspreview.png",category:"accessories",variables:{sizes:[],colors:[],availability:{}}},dogbowl:{name:"Dog Bowl",price:22.99,description:"Custom dog bowl",image:"/static/images/dogbowl.png",preview:"/static/images/dogbowlpreview.png",category:"pet-supplies",variables:{sizes:[],colors:[],availability:{}}},magnetset:{name:"Magnet Set",price:21.99,description:"Set of custom magnets",image:"/static/images/magnet.png",preview:"/static/images/magnetpreview.png",category:"accessories",variables:{sizes:[],colors:[],availability:{}}},"men'slongsleeve":{name:"Men's Long Sleeve",price:39.99,description:"Comfortable men's long sleeve shirt",image:"/static/images/menslongsleeve.png",preview:"/static/images/menslongsleevepreview.jpg",category:"men's-shirts",variables:{sizes:["XS","S","M","L","XL","XXL","XXXL","XXXXL","XXXXXL"],colors:["Black","White","Gray"],availability:{XS:{Black:!0,White:!0,Gray:!0},S:{Black:!0,White:!0,Gray:!0},M:{Black:!0,White:!0,Gray:!0},L:{Black:!0,White:!0,Gray:!0},XL:{Black:!0,White:!0,Gray:!0},XXL:{Black:!0,White:!0,Gray:!0},XXXL:{Black:!0,White:!0,Gray:!0},XXXXL:{Black:!0,White:!0,Gray:!0},XXXXXL:{Black:!0,White:!0,Gray:!0}}}},"women'stank":{name:"Women's Tank",price:32.99,description:"Comfortable women's tank top",image:"/static/images/womenstank.png",preview:"/static/images/womenstankpreview.png",category:"women's-shirts",variables:{sizes:["XS","S","M","L","XL","XXL","XXXL","XXXXL","XXXXXL"],colors:["Black","White","Gray","Pink"],availability:{XS:{Black:!0,White:!0,Gray:!0,Pink:!0},S:{Black:!0,White:!0,Gray:!0,Pink:!0},M:{Black:!0,White:!0,Gray:!0,Pink:!0},L:{Black:!0,White:!0,Gray:!0,Pink:!0},XL:{Black:!0,White:!0,Gray:!0,Pink:!0},XXL:{Black:!0,White:!0,Gray:!0,Pink:!0},XXXL:{Black:!0,White:!0,Gray:!0,Pink:!0},XXXXL:{Black:!0,White:!0,Gray:!0,Pink:!0},XXXXXL:{Black:!0,White:!0,Gray:!0,Pink:!0}}}},unisexpulloverhoodie:{name:"Unisex Pullover Hoodie",price:29.99,description:"Comfortable unisex pullover hoodie",image:"/static/images/unisexpulloverhoodie.png",preview:"/static/images/unisexpulloverhoodiepreview.png",category:"women's-shirts",variables:{sizes:["S","M","L","XL","XXL"],colors:["Black","White","Heather Forest","Heather Navy"]}},"women'stee":{name:"Women's Tee",price:33.99,description:"Comfortable women's t-shirt",image:"/static/images/womenstee.png",preview:"/static/images/womensteepreview.png",category:"women's-shirts",variables:{sizes:["XS","S","M","L","XL","XXL","XXXL","XXXXL","XXXXXL"],colors:["Black","White","Gray","Pink"],availability:{XS:{Black:!0,White:!0,Gray:!0,Pink:!0},S:{Black:!0,White:!0,Gray:!0,Pink:!0},M:{Black:!0,White:!0,Gray:!0,Pink:!0},L:{Black:!0,White:!0,Gray:!0,Pink:!0},XL:{Black:!0,White:!0,Gray:!0,Pink:!0},XXL:{Black:!0,White:!0,Gray:!0,Pink:!0},XXXL:{Black:!0,White:!0,Gray:!0,Pink:!0},XXXXL:{Black:!0,White:!0,Gray:!0,Pink:!0},XXXXXL:{Black:!0,White:!0,Gray:!0,Pink:!0}}}},distresseddadhat:{name:"Distressed Dad Hat",price:24.99,description:"Stylish distressed dad hat",image:"/static/images/distresseddadhat.jpg",preview:"/static/images/distresseddadhatpreview.jpg",category:"hats",variables:{sizes:["One size"],colors:["Khaki"],availability:{"One size":{Khaki:!0}}}},closedbackcap:{name:"Closed Back Cap",price:25.19,description:"Closed back cap",image:"/static/images/closedbackcap.png",preview:"/static/images/hatsclosedbackcappreview.png",category:"hats",variables:{sizes:["One size"],colors:["Dark Navy","Black","Royal Blue","Red","Grey","White","Dark Grey","Multicam Black","Olive","Multicam Green","Khaki"],availability:{"One size":{"Dark Navy":!0,Black:!0,"Royal Blue":!0,Red:!0,Grey:!0,White:!0,"Dark Grey":!0,"Multicam Black":!0,Olive:!0,"Multicam Green":!0,Khaki:!0}}}},fivepaneltruckerhat:{name:"Five Panel Trucker Hat",price:36.99,description:"Five panel trucker hat",image:"/static/images/fivepaneltruckerhat.png",preview:"/static/images/fivepaneltruckerhatpreview.jpg",category:"hats",variables:{sizes:["One Size"],colors:["Black","White","Navy"],availability:{"One Size":{Black:!0,White:!0,Navy:!0}}}},flatbillcap:{name:"Flat Bill Cap",price:34.99,description:"Flat bill cap",image:"/static/images/flatbillcap.png",preview:"/static/images/flatbillcappreview.png",category:"hats",variables:{sizes:["One Size"],colors:["Black","White","Navy","Gray"],availability:{"One Size":{Black:!0,White:!0,Navy:!0,Gray:!0}}}},crossbodybag:{name:"Crossbody Bag",price:42.99,description:"Stylish crossbody bag",image:"/static/images/crossbodybag.png",preview:"/static/images/crossbodybagpreview.png",category:"bags",variables:{sizes:[],colors:["Black","Brown","Tan"],availability:{}}},babybib:{name:"Baby Bib",price:26.99,description:"Custom baby bib",image:"/static/images/babybib.png",preview:"/static/images/babybibpreview.jpg",category:"baby",variables:{sizes:[],colors:["White","Pink","Blue"],availability:{}}},womenscroptop:{name:"Women's Crop Top",price:26.01,description:"Simple and classic crop top",image:"/static/images/womens-crop-top.png",preview:"/static/images/womenscroptoppreview.png",category:"women's-shirts",variables:{sizes:["XS","S","M","L","XL"],colors:["Black","Hazy Pink","Pale Pink","Orchid","Ecru","White","Bubblegum","Bone","Mineral","Natural"],availability:{XS:{Black:!0,"Hazy Pink":!0,"Pale Pink":!0,Orchid:!0,Ecru:!0,White:!0,Bubblegum:!1,Bone:!0,Mineral:!0,Natural:!0},S:{Black:!0,"Hazy Pink":!0,"Pale Pink":!0,Orchid:!0,Ecru:!0,White:!0,Bubblegum:!1,Bone:!0,Mineral:!0,Natural:!0},M:{Black:!0,"Hazy Pink":!0,"Pale Pink":!0,Orchid:!0,Ecru:!0,White:!0,Bubblegum:!1,Bone:!0,Mineral:!0,Natural:!0},L:{Black:!0,"Hazy Pink":!0,"Pale Pink":!0,Orchid:!0,Ecru:!0,White:!0,Bubblegum:!1,Bone:!0,Mineral:!0,Natural:!0},XL:{Black:!0,"Hazy Pink":!0,"Pale Pink":!0,Orchid:!0,Ecru:!0,White:!0,Bubblegum:!1,Bone:!0,Mineral:!0,Natural:!0}}}}};const Zd="https://screenmerch.fly.dev/static/images",ds=()=>{const t=Jt();return!t||typeof t!="string"?Zd:`${t.replace(/\/$/,"")}/static/images`},Or=t=>!t||typeof t!="string"?t:t.replace(/^http:\/\//i,"https://"),zs=(t,s=!0)=>{if(!t)return`${ds()}/placeholder.png`;if(t._displayImageUrl)return t._displayImageUrl;const r=s?t.preview_image_url||t.preview_image:t.main_image_url||t.main_image;return r?r.startsWith("http")?Or(r):r.startsWith("/")?`${Jt().replace(/\/$/,"")}${r}`:`${ds()}/${r}`:`${ds()}/placeholder.png`},Ws=()=>`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,Ea=t=>t!=null&&t.timestamp?`v=${t.timestamp}`:"v=0",Ia=({sidebar:t})=>{const{productId:s}=Cs(),[r]=Et(),a=ct(),{creatorSettings:i}=Ts(),[o,n]=c.useState(null),[u,m]=c.useState(!0),[f,k]=c.useState(null),[M,h]=c.useState(null),[v,_]=c.useState(null),[b,x]=c.useState({}),[T,S]=c.useState({}),[A,E]=c.useState(()=>{try{const I=localStorage.getItem("cart_items");return I?JSON.parse(I):[]}catch{return[]}}),[z,V]=c.useState(!1),[X,Y]=c.useState(!1),[$,se]=c.useState({screenshots:[],thumbnail:""}),[be,xe]=c.useState(!1),[ae,W]=c.useState(!1),[O,de]=c.useState(null),G=r.get("category"),U=c.useMemo(()=>(G||localStorage.getItem("last_selected_category")||"").trim()||"mens",[G]),y=r.get("authenticated")==="true",N=r.get("email")||"",D=r.get("openCart")==="true",w=r.get("creatorMode")==="favorites";c.useEffect(()=>{if(window.__DEBUG__&&(console.log("üîé browse: qsCategory=",G,"resolved category=",U),console.log("üîó full url:",window.location.href)),U&&localStorage.setItem("last_selected_category",U),D){V(!0);const I=new URLSearchParams(r);I.delete("openCart");const J=`${window.location.pathname}?${I.toString()}`;window.history.replaceState({},"",J)}},[G,U,D,r]);const p=[{name:"Women's",emoji:"üë©",category:"womens"},{name:"Men's",emoji:"üë®",category:"mens"},{name:"Kids",emoji:"üë∂",category:"kids"},{name:"Mugs",emoji:"‚òï",category:"mugs"},{name:"Hats",emoji:"üß¢",category:"hats"},{name:"Bags",emoji:"üëú",category:"bags"},{name:"Pets",emoji:"üêï",category:"pets"},{name:"Misc",emoji:"üì¶",category:"misc"},{name:"Product Info",emoji:"üõçÔ∏è",category:"all-products"},{name:"Image Tools",emoji:"üõ†Ô∏è",category:"thumbnails"}],ee=I=>{window.__DEBUG__&&(console.log("üîÑ Category clicked:",I),console.log("üîÑ Current category:",U),console.log("üîÑ Product ID:",s),console.log("üîÑ Authenticated:",y),console.log("üîÑ Email:",N));const oe=`${!s||s==="browse"||s==="undefined"||s==="null"?"/product/browse":`/product/${s}`}?category=${encodeURIComponent(I)}&authenticated=${y}&email=${encodeURIComponent(N||"")}`;try{localStorage.setItem("last_selected_category",I)}catch{}try{a(oe),window.__DEBUG__&&console.log("‚úÖ Navigate called successfully to",oe)}catch(ve){console.error("‚ùå Navigate failed, falling back:",ve),window.location.assign(oe)}},ie=()=>{var J,Se;const I=(J=o==null?void 0:o.product)!=null&&J.screenshots&&o.product.screenshots.length>0?o.product.screenshots:$.screenshots;return M==="thumbnail"?((Se=o==null?void 0:o.product)==null?void 0:Se.thumbnail_url)||$.thumbnail||"":typeof M=="number"&&I&&I[M]?I[M]:""},we=async()=>{if(!O){alert("Please select a screenshot first.");return}const I=ie();if(!I){alert("No screenshot selected.");return}let J="Screenshot";O==="thumbnail"?J="Thumbnail":typeof O=="number"&&(J=`Screenshot ${O+1}`),await Ce(I,J)},Ce=async(I,J)=>{if(!be){alert("Only creators can save screenshots to favorites.");return}try{W(!0);const Se=localStorage.getItem("isAuthenticated"),oe=localStorage.getItem("user");let ve=null,le=null;if(Se==="true"&&oe){const he=JSON.parse(oe);ve=he,le=he.id}else{const{data:{user:he}}=await R.auth.getUser();if(!he){alert("Please sign in to save favorites.");return}ve=he,le=he.id}if(!le){alert("Unable to identify user. Please sign in again.");return}const{data:ne}=await R.from("users").select("display_name, username, channelTitle").eq("id",le).single(),De=(ne==null?void 0:ne.channelTitle)||(ne==null?void 0:ne.display_name)||(ne==null?void 0:ne.username)||(ve==null?void 0:ve.name)||"Unknown Creator",K=localStorage.getItem("pending_merch_data");let re=J||"Screenshot";if(K)try{const he=JSON.parse(K);he.videoTitle&&(re=`${he.videoTitle} - ${J}`)}catch{console.warn("Could not parse pending_merch_data")}const Ae={user_id:le,channelTitle:De,title:re,description:"Saved screenshot from product selection",image_url:I,thumbnail_url:I},{data:q,error:Z}=await R.from("creator_favorites").insert(Ae).select().single();Z?(console.error("Error saving favorite:",Z),alert(`Failed to save favorite: ${Z.message||"Unknown error"}`)):(console.log("Favorite saved successfully:",q),alert("Screenshot saved to favorites!"))}catch(Se){console.error("Error saving favorite:",Se),alert(`Failed to save favorite: ${Se.message||"Unknown error"}`)}finally{W(!1)}},Oe=(I,J)=>{var K,re,Ae,q,Z,he;if(!I||!J)return((K=I==null?void 0:I.options)==null?void 0:K.size)||[];const Se=(I.name||"").trim().toLowerCase(),oe=Object.keys(Pr).find(F=>(Pr[F].name||"").trim().toLowerCase()===Se);if(!oe)return((re=I.options)==null?void 0:re.size)||[];const ve=Pr[oe];if(!((Ae=ve.variables)!=null&&Ae.availability))return((q=I.options)==null?void 0:q.size)||[];const le=ve.variables.availability,De=(ve.variables.sizes||((Z=I.options)==null?void 0:Z.size)||[]).filter(F=>{const L=le[F];return!L||typeof L!="object"?!1:L[J]===!0});return De.length>0?De:((he=I.options)==null?void 0:he.size)||[]},it=(I,J)=>{var ve,le;const Se=I.price||0,oe=T[J]||((le=(ve=I==null?void 0:I.options)==null?void 0:ve.size)==null?void 0:le[0]);return I.size_pricing&&I.size_pricing[oe]!==void 0?Se+I.size_pricing[oe]:Se},Le=I=>{E(I);try{localStorage.setItem("cart_items",JSON.stringify(I))}catch{}},Ye=(I,J)=>{var K,re,Ae,q;const Se=b[J]||((re=(K=I==null?void 0:I.options)==null?void 0:K.color)==null?void 0:re[0])||"Default",oe=T[J]||((q=(Ae=I==null?void 0:I.options)==null?void 0:Ae.size)==null?void 0:q[0])||"One Size",ve=v||ie();let le={};try{const Z=localStorage.getItem("pending_merch_data");if(console.log("üîç Raw localStorage data:",Z),Z){const he=JSON.parse(Z);console.log("üîç Parsed merch data:",he),le={video_url:he.videoUrl,video_title:he.videoTitle,creator_name:he.creatorName,thumbnail:he.thumbnail,screenshot_timestamp:he.screenshot_timestamp},console.log("üîç Video metadata extracted:",le)}}catch(Z){console.warn("Could not load video metadata from localStorage:",Z)}const ne={name:(I==null?void 0:I.name)||"Product",price:it(I,J),image:zs(I,!0),color:Se,size:oe,screenshot:ve,selected_screenshot:ve,qty:1,...le},De=[...A,ne];Le(De),console.log("‚úÖ Item added to cart, showing modal..."),Y(!0)};if(c.useEffect(()=>{(async()=>{const J=await sr.isCreator();xe(J),w&&J&&(h("thumbnail"),de("thumbnail"))})()},[w]),c.useEffect(()=>{try{const I=localStorage.getItem("pending_merch_data");if(I){const J=JSON.parse(I);se({screenshots:Array.isArray(J==null?void 0:J.screenshots)?J.screenshots.slice(0,6):[],thumbnail:(J==null?void 0:J.thumbnail)||""}),w&&(J!=null&&J.thumbnail)&&(_(Se=>Se??J.thumbnail),n({success:!0,product:{thumbnail_url:J.thumbnail,screenshots:Array.isArray(J.screenshots)?J.screenshots:[]},products:[],category:U}))}}catch{console.warn("Invalid pending_merch_data in localStorage, ignoring")}},[s,w,U]),c.useEffect(()=>{const I=U,J=new AbortController;return window.__DEBUG__&&console.log("üîÑ useEffect triggered with:",{productId:s,category:U,authenticated:y,email:N}),(async()=>{var oe,ve,le,ne,De,K,re,Ae,q,Z,he;try{m(!0),k(null);const F=s||"browse",L=!s||s==="browse"||s==="dynamic",H=Jt().replace(/\/$/,""),ue=L?`${H}/api/product/browse?category=${encodeURIComponent(U)}&authenticated=${y}&email=${encodeURIComponent(N||"")}&v=${Date.now()}&mobile=${Date.now()}&cache=${Math.random()}`:`${H}/api/product/${F}?category=${encodeURIComponent(U)}&authenticated=${y}&email=${encodeURIComponent(N||"")}&v=${Date.now()}&mobile=${Date.now()}&cache=${Math.random()}`,je=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);(window.__DEBUG__||je)&&(console.log("üåê Fetching product data from:",ue),console.log("üì± User Agent:",navigator.userAgent),console.log("üì± Is Mobile:",je),console.log("üîß Debug mode enabled for mobile"),console.log("üîß ProductId:",s),console.log("üîß Category:",U),console.log("üîß IsBrowseMode:",L),je&&console.log(`Mobile Debug:
ProductId: ${s}
Category: ${U}
IsBrowseMode: ${L}
URL: ${ue}`));let Me,We;try{(window.__DEBUG__||je)&&(console.log("üöÄ Starting fetch request..."),console.log("üì± Mobile detection:",je),console.log("üì± URL:",ue)),We=setTimeout(()=>J.abort(),3e4),Me=await fetch(ue,{method:"GET",cache:"no-cache",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},signal:J.signal}),clearTimeout(We)}catch(pe){throw We&&clearTimeout(We),pe}if((window.__DEBUG__||je)&&(console.log("‚úÖ Fetch completed, status:",Me.status),console.log("‚úÖ Response headers:",Object.fromEntries(Me.headers.entries()))),window.__DEBUG__&&(console.log("üì° Response status:",Me.status),console.log("üì° Response headers:",Object.fromEntries(Me.headers.entries()))),!Me.ok){const pe=await Me.text();throw console.error("‚ùå API Error Response:",pe),Me.status===429?new Error("Too many requests. Please wait a moment and try again."):new Error(`Failed to fetch product data: ${Me.status} - ${pe}`)}const g=await Me.json();window.__DEBUG__&&(console.log("üì¶ Product Data Received:",g),console.log("üì∏ Thumbnail URL:",(oe=g.product)==null?void 0:oe.thumbnail_url),console.log("üì∏ Screenshots:",(ve=g.product)==null?void 0:ve.screenshots),console.log("üì∏ Screenshots Length:",((ne=(le=g.product)==null?void 0:le.screenshots)==null?void 0:ne.length)||0),console.log("üì¶ Products Count:",((De=g.products)==null?void 0:De.length)||0),console.log("üì¶ Category:",g.category),console.log("üì¶ Success:",g.success)),(window.__DEBUG__||je)&&(console.log("üì¶ Raw API Response:",g),console.log("üì¶ Products array:",g.products),console.log("üì¶ Products length:",(K=g.products)==null?void 0:K.length),console.log("üì¶ Success flag:",g.success));try{localStorage.setItem("cached_products",JSON.stringify(g.products)),window.__DEBUG__&&console.log("üíæ Cached products data for offline use")}catch{console.warn("Could not cache products data")}if((window.__DEBUG__||je)&&(console.log("‚úÖ Using real backend data - API call succeeded"),console.log("‚úÖ Products from backend:",((re=g.products)==null?void 0:re.length)||0),console.log("‚úÖ First product image:",(q=(Ae=g.products)==null?void 0:Ae[0])==null?void 0:q.main_image),console.log("‚úÖ First product preview:",(he=(Z=g.products)==null?void 0:Z[0])==null?void 0:he.preview_image),console.log("‚úÖ Mobile fallback should NOT be used - API succeeded")),g.category!==I){m(!1);return}const te=Jt().replace(/\/$/,""),ge=`${te}/static/images`,ye=(g.products||[]).map(pe=>{if(!pe)return pe;const Te=pe.preview_image_url||(pe.preview_image?pe.preview_image.startsWith("/")?te+pe.preview_image:pe.preview_image.startsWith("http")?Or(pe.preview_image):`${ge}/${pe.preview_image}`:""),fe=pe.main_image_url||(pe.main_image?pe.main_image.startsWith("/")?te+pe.main_image:pe.main_image.startsWith("http")?Or(pe.main_image):`${ge}/${pe.main_image}`:"");return{...pe,_displayImageUrl:Te||fe||`${ge}/placeholder.png`}});n({...g,products:ye})}catch(F){if((F==null?void 0:F.name)==="AbortError")return;console.error("Error fetching product data:",F),k(F.message)}finally{m(!1)}})(),()=>J.abort()},[s,U,y,N]),c.useEffect(()=>{!(o!=null&&o.products)||o.products.length===0||S(I=>{const J={...I};let Se=!1;return o.products.forEach((oe,ve)=>{var K,re,Ae,q,Z,he,F,L,H;if(!oe||!oe.options)return;const le=b[ve]||((re=(K=oe.options)==null?void 0:K.color)==null?void 0:re[0])||((q=(Ae=oe.options)==null?void 0:Ae.handle_color)==null?void 0:q[0]);if(!le&&!((he=(Z=oe.options)==null?void 0:Z.size)!=null&&he.length))return;const ne=Oe(oe,le);if(ne.length===0){(L=(F=oe.options)==null?void 0:F.size)!=null&&L[0]&&!I[ve]&&(J[ve]=(H=oe.options)==null?void 0:H.size[0],Se=!0);return}const De=I[ve];(!De||!ne.includes(De))&&(J[ve]=ne[0],Se=!0)}),Se?J:I})},[o,b]),u&&!o)return e.jsx("div",{className:`container ${t?"":" large-container"}`,children:e.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading product..."})]})});if(f)return e.jsx("div",{className:`container ${t?"":" large-container"}`,children:e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"red"},children:[e.jsx("h2",{children:"Error Loading Product"}),e.jsx("p",{children:f}),e.jsx("button",{onClick:()=>{k(null),m(!0),(async()=>{try{const J=s||"browse",oe=`${Jt().replace(/\/$/,"")}/api/product/${J}?category=${encodeURIComponent(U)}&authenticated=${y}&email=${encodeURIComponent(N||"")}`,ve=await fetch(oe,{method:"GET",signal:AbortSignal.timeout(3e4)});if(!ve.ok)throw new Error(`Failed to fetch product data: ${ve.status}`);const le=await ve.json();n(le)}catch(J){console.error("Retry failed:",J),k(J.message)}finally{m(!1)}})()},children:"Retry"}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("p",{children:"If the error persists, you can still browse products by category:"}),e.jsx("div",{className:"categories-grid",style:{marginTop:"1rem"},children:p.map((I,J)=>e.jsxs("div",{className:`category-box ${I.category===U?"active":""}`,onClick:()=>ee(I.category),style:{cursor:"pointer"},children:[e.jsx("div",{className:"category-emoji",children:I.emoji}),e.jsx("div",{className:"category-name",children:I.name})]},J))})]})]})});if(!o){const I=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return(window.__DEBUG__||I)&&(console.log("‚ùå ProductData is falsy:",o),console.log("‚ùå Loading state:",u),console.log("‚ùå Error state:",f)),e.jsx("div",{className:`container ${t?"":" large-container"}`,children:e.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[e.jsx("h2",{children:"Product Not Found"}),e.jsx("p",{children:"The requested product could not be found."}),e.jsxs("p",{children:["Debug: productData = ",JSON.stringify(o)]})]})})}return U==="thumbnails"?e.jsx(Pi,{}):e.jsxs("div",{className:`container ${t?"":" large-container"}`,children:[(()=>{const I=(U||"").trim().toLowerCase();return I!=="all"&&I!=="all-products"})()&&e.jsx("div",{className:"user-flow-section",style:i!=null&&i.primary_color&&(i!=null&&i.secondary_color)?{background:`linear-gradient(135deg, ${i.primary_color} 0%, ${i.secondary_color} 100%)`}:void 0,children:e.jsx("div",{className:"flow-steps",children:e.jsxs("div",{className:"flow-step",children:[e.jsx("div",{className:"step-number",children:"3"}),e.jsxs("div",{className:"step-content",children:[e.jsx("h3",{children:"Make Merchandise"}),e.jsx("p",{children:"Create custom products with your screenshot"})]})]})})}),(()=>{var oe;const I=(U||"").trim().toLowerCase(),J=I==="all"||I==="all-products",Se=(o==null?void 0:o.products)&&o.products.length>0;return window.__DEBUG__&&console.log("üîç All Products Check:",{category:U,isAllProducts:J,hasProducts:Se,productCount:(oe=o==null?void 0:o.products)==null?void 0:oe.length,productDataExists:!!o}),J&&Se?(window.__DEBUG__&&console.log("‚úÖ Showing All Products informational layout"),!0):(window.__DEBUG__&&console.log("‚ÑπÔ∏è Not showing All Products layout (normal for specific categories):",{reason:J?"no products":"viewing specific category"}),!1)})()&&e.jsxs("div",{className:"all-products-info-container",children:[e.jsx("h1",{className:"product-information-title",children:"Product Information"}),(()=>{window.__DEBUG__&&console.log("‚úÖ Rendering All Products informational layout");const I={womens:[],mens:[],kids:[],mugs:[],hats:[],bags:[],pets:[],misc:[]},J={womens:["Cropped Hoodie","Fitted Racerback Tank","Micro-Rib Tank Top","Women's Ribbed Neck","Women's Shirt","Unisex Heavyweight T-Shirt","Unisex Pullover Hoodie","Women's Crop Top"],mens:["Unisex Hoodie","Men's Tank Top","Mens Fitted T-Shirt","Men's Fitted Long Sleeve","Unisex T-Shirt","Unisex Oversized T-Shirt","Men's Long Sleeve Shirt","Unisex Champion Hoodie"],kids:["Youth Heavy Blend Hoodie","Kids Shirt","Kids Long Sleeve","Toddler Jersey T-Shirt","Kids Sweatshirt","Baby Staple Tee","Baby Jersey T-Shirt","Baby Body Suit"],mugs:["White Glossy Mug","Travel Mug","Enamel Mug","Colored Mug"],hats:["Distressed Dad Hat","Closed Back Cap","Five Panel Trucker Hat","Five Panel Baseball Cap"],bags:["Laptop Sleeve","All-Over Print Drawstring","All Over Print Tote Pocket","All-Over Print Utility Bag"],pets:["Pet Bowl All-Over Print","Pet Bandana Collar","All Over Print Leash","All Over Print Collar"],misc:["Bandana","Hardcover Bound Notebook","Coasters","Apron","Jigsaw Puzzle with Tin","Greeting Card","Kiss-Cut Stickers","Die-Cut Magnets"]};o.products.forEach(oe=>{for(const[ve,le]of Object.entries(J))if(le.includes(oe.name)){I[ve].push(oe);break}});const Se={womens:"Women's",mens:"Men's",kids:"Kids",mugs:"Mugs",hats:"Hats",bags:"Bags",pets:"Pets",misc:"Miscellaneous"};return["womens","mens","kids","mugs","hats","bags","pets","misc"].map(oe=>I[oe].length===0?null:e.jsxs("div",{className:"category-section",children:[e.jsx("h2",{className:"category-section-title",children:Se[oe]}),e.jsxs("div",{className:"products-info-table",children:[e.jsxs("div",{className:"info-table-header",children:[e.jsx("div",{className:"info-col-name",children:"Name"}),e.jsx("div",{className:"info-col-image",children:"Image"}),e.jsx("div",{className:"info-col-description",children:"Description"})]}),I[oe].map((ve,le)=>e.jsxs("div",{className:"info-table-row",children:[e.jsxs("div",{className:"info-col-name",children:[ve.name,ve.name&&ve.name.includes("Jigsaw Puzzle with Tin")&&e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:"normal",color:"#666",display:"block",marginTop:"4px"},children:"(Ages 4+ only)"})]}),e.jsx("div",{className:"info-col-image",children:e.jsx("img",{src:zs(ve,!0),alt:ve.name,className:"info-product-image",onError:ne=>{ne.currentTarget.src=`${ds()}/placeholder.png`}})}),e.jsx("div",{className:"info-col-description",children:ve.description||"No description available."})]},le))]})]},oe))})()]}),(()=>{const I=(U||"").trim().toLowerCase();return I!=="all"&&I!=="all-products"})()&&o.products&&o.products.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"screenshots-section",children:[e.jsx("h2",{className:"screenshots-title",children:w?"Select Screenshot to Add to Favorites":"Select Your Screenshot"}),e.jsx("p",{className:"screenshots-subtitle",children:w?"Choose which screenshot to save to your favorites":"Choose which screenshot to use for your custom merchandise"}),e.jsx("div",{className:"screenshots-preview",children:e.jsxs("div",{className:"screenshot-grid",children:[(()=>{var J;const I=((J=o==null?void 0:o.product)==null?void 0:J.thumbnail_url)||$.thumbnail;return I?e.jsxs("div",{className:`screenshot-item ${M==="thumbnail"?"selected":""}`,children:[e.jsxs("div",{onClick:()=>{h("thumbnail"),w&&de("thumbnail")},style:{cursor:"pointer"},children:[e.jsx("img",{src:I,alt:"Thumbnail",className:"screenshot-image"}),e.jsx("div",{className:"screenshot-label",children:"Thumbnail"})]}),be&&!w&&e.jsx("button",{className:"save-to-favorites-btn",onClick:Se=>{Se.stopPropagation(),Ce(I,"Thumbnail")},disabled:ae,title:"Save to Favorites",children:ae?"Saving...":"‚≠ê Save to Favorites"})]}):null})(),(()=>{var oe,ve;const I=((oe=o==null?void 0:o.product)==null?void 0:oe.thumbnail_url)||$.thumbnail,J=(ve=o==null?void 0:o.product)!=null&&ve.screenshots&&o.product.screenshots.length>0?o.product.screenshots:$.screenshots,Se=(J||[]).filter(le=>le&&le!==I);return Se&&Se.length>0?Se.map((le,ne)=>{const De=J.findIndex(K=>K===le);return e.jsxs("div",{className:`screenshot-item ${M===De?"selected":""}`,children:[e.jsxs("div",{onClick:()=>{h(De),_(le),w&&de(De)},style:{cursor:"pointer"},children:[e.jsx("img",{src:le,alt:`Screenshot ${ne+1}`,className:"screenshot-image"}),e.jsxs("div",{className:"screenshot-label",children:["Screenshot ",ne+1]})]}),be&&!w&&e.jsx("button",{className:"save-to-favorites-btn",onClick:K=>{K.stopPropagation(),Ce(le,`Screenshot ${ne+1}`)},disabled:ae,title:"Save to Favorites",children:ae?"Saving...":"‚≠ê Save to Favorites"})]},ne)}):null})()]})})]}),w&&e.jsx("div",{className:"tools-button-container",children:e.jsx("button",{className:"to-favorite-btn",onClick:we,disabled:ae||!O,children:ae?"Saving...":"‚≠ê Save Favorite"})}),!w&&e.jsx("div",{className:"tools-button-container",children:e.jsx("button",{className:"tools-page-btn",onClick:()=>{const I=v||ie();if(I)try{const J=localStorage.getItem("pending_merch_data"),Se=J?JSON.parse(J):{};Se.selected_screenshot=I,localStorage.setItem("pending_merch_data",JSON.stringify(Se))}catch(J){console.warn("Could not save selected screenshot:",J)}a("/tools")},children:"üõ†Ô∏è Tools Page"})}),!w&&e.jsx("div",{className:"product-page-container",children:e.jsxs("div",{className:"product-main",children:[e.jsx("div",{className:"product-image-section",children:o.img_url&&e.jsx("img",{src:o.img_url.includes("?")?`${o.img_url}&v=${Ws()}`:`${o.img_url}?v=${Ws()}`,alt:"Product Preview",className:"product-preview-image"})}),e.jsxs("div",{className:"product-options-section",children:[e.jsxs("div",{className:"cart-section",children:[e.jsx("button",{className:"view-cart-btn",onClick:()=>V(!0),children:"View Cart"}),e.jsx("button",{className:"checkout-btn",onClick:()=>a("/checkout"),children:"Checkout"})]}),e.jsx("div",{className:"products-grid",children:o.products&&o.products.map((I,J)=>{var Se,oe,ve;return e.jsxs("div",{className:"product-card",children:[(()=>{const le=U==="womens"||U==="mens"||U==="kids",ne=zs(I,!0),De=ne&&typeof ne=="string"?ne:`${ds()}/placeholder.png`;return e.jsx("div",{className:"product-image",children:e.jsx("div",{className:"product-image-wrapper",children:e.jsx("img",{className:le?"product-image-clear":"product-image-normal",src:De+(De.includes("?")?"&":"?")+Ea(o),alt:I.name,loading:"lazy",referrerPolicy:"no-referrer",onError:K=>{const re=zs(I,!1);if(re&&K.currentTarget.src!==re){const Ae=Ea(o);K.currentTarget.src=re+(re.includes("?")?"&":"?")+Ae}else K.currentTarget.src=`${ds()}/placeholder.png`}})})})})(),e.jsxs("h3",{children:[I.name,I.name&&I.name.includes("Jigsaw Puzzle with Tin")&&e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:"normal",color:"#666",display:"block",marginTop:"4px"},children:"(Ages 4+ only)"})]}),e.jsxs("p",{className:"product-price",children:["$",it(I,J).toFixed(2)]}),e.jsxs("div",{className:"product-options",children:[I.options&&I.options.color&&I.options.color.length>0&&e.jsxs("div",{className:"option-group",children:[e.jsx("label",{children:"Color:"}),e.jsx("select",{className:"color-select",value:b[J]||((oe=(Se=I.options)==null?void 0:Se.color)==null?void 0:oe[0])||"",onChange:le=>{var Ae,q;const ne={...b},De=le.target.value;ne[J]=De,x(ne);const K=Oe(I,De),re=T[J]||((q=(Ae=I.options)==null?void 0:Ae.size)==null?void 0:q[0]);if(K.length>0&&!K.includes(re)){const Z={...T};Z[J]=K[0],S(Z)}},children:(((ve=I.options)==null?void 0:ve.color)||[]).map((le,ne)=>e.jsx("option",{value:le,children:le},ne))})]}),I.options&&I.options.handle_color&&I.options.handle_color.length>0&&e.jsxs("div",{className:"option-group",children:[e.jsx("label",{children:"Handle Color:"}),e.jsx("select",{className:"color-select",value:b[J]||I.options.handle_color[0],onChange:le=>{const ne={...b};ne[J]=le.target.value,x(ne)},children:I.options.handle_color.map((le,ne)=>e.jsx("option",{value:le,children:le},ne))})]}),I.options&&I.options.size&&I.options.size.length>0&&(()=>{var re,Ae,q,Z,he,F;const le=b[J]||((Ae=(re=I.options)==null?void 0:re.color)==null?void 0:Ae[0])||((Z=(q=I.options)==null?void 0:q.handle_color)==null?void 0:Z[0]),ne=Oe(I,le),De=T[J];let K;return De&&ne.includes(De)?K=De:ne.length>0?K=ne[0]:K=(F=(he=I.options)==null?void 0:he.size)==null?void 0:F[0],e.jsxs("div",{className:"option-group",children:[e.jsx("label",{children:"Size:"}),e.jsx("select",{className:"size-select",value:K,onChange:L=>{const H={...T};H[J]=L.target.value,S(H)},children:ne.map((L,H)=>e.jsx("option",{value:L,children:L},H))})]})})()]}),e.jsx("button",{className:"add-to-cart-btn",onClick:()=>Ye(I,J),children:"Add to Cart"})]},I!=null&&I.name?`${I.name}-${J}`:J)})}),e.jsxs("div",{className:"cart-section cart-section-bottom",children:[e.jsx("button",{className:"view-cart-btn",onClick:()=>V(!0),children:"View Cart"}),e.jsx("button",{className:"checkout-btn",onClick:()=>a("/checkout"),children:"Checkout"})]})]})]})})]}),!w&&z&&e.jsx("div",{className:"cart-modal",onClick:()=>V(!1),children:e.jsx("div",{className:"cart-modal-content",onClick:I=>I.stopPropagation(),children:A.length===0?e.jsxs("div",{className:"empty-cart-message",children:[e.jsx("div",{className:"empty-cart-icon",children:"üõí"}),e.jsx("p",{children:"Your cart is empty"})]}):e.jsxs("div",{className:"cart-items-wrapper",children:[e.jsx("h2",{className:"cart-section-title",children:"Cart Items"}),e.jsx("div",{className:"cart-items",children:A.map((I,J)=>e.jsxs("div",{className:"cart-item",children:[e.jsxs("div",{className:"cart-item-image-wrapper",children:[I.image&&e.jsx("img",{src:I.image.includes("?")?`${I.image}&v=${Ws()}`:`${I.image}?v=${Ws()}`,alt:I.name}),e.jsxs("div",{className:"cart-item-meta",children:[I.color," ‚Ä¢ ",I.size]})]}),e.jsxs("div",{className:"cart-item-info",children:[e.jsx("div",{className:"cart-item-name",children:I.name}),e.jsxs("div",{className:"cart-item-price",children:["$",(I.price||0).toFixed(2)]})]}),I.screenshot&&e.jsx("img",{className:"cart-item-shot",src:I.screenshot,alt:"screenshot"}),e.jsx("button",{className:"cart-item-delete",onClick:()=>{const Se=A.filter((oe,ve)=>ve!==J);E(Se),localStorage.setItem("cart_items",JSON.stringify(Se))},title:"Remove item",children:"üóëÔ∏è"})]},J))}),e.jsxs("div",{className:"cart-actions",children:[e.jsx("button",{className:"view-cart-btn",onClick:()=>V(!1),children:"Continue Shopping"}),e.jsx("button",{className:"checkout-btn",onClick:()=>a("/checkout"),children:"Checkout"}),e.jsx("button",{className:"edit-tools-btn",onClick:()=>a("/tools"),children:"Edit Tools"})]})]})})}),!w&&X&&e.jsx("div",{className:"added-to-cart-modal-overlay",onClick:()=>Y(!1),children:e.jsxs("div",{className:"added-to-cart-modal",onClick:I=>I.stopPropagation(),children:[e.jsx("button",{className:"added-to-cart-modal-close",onClick:()=>Y(!1),"aria-label":"Close",children:"√ó"}),e.jsxs("div",{className:"added-to-cart-modal-content",children:[e.jsx("div",{className:"added-to-cart-success-icon",children:"‚úì"}),e.jsx("h2",{className:"added-to-cart-title",children:"Added to Cart!"}),e.jsx("p",{className:"added-to-cart-message",children:"Your item has been added successfully."}),e.jsxs("div",{className:"tools-reminder-section",children:[e.jsx("h3",{className:"tools-reminder-title",children:"‚ú® Enhance Your Design with Our Tools"}),e.jsx("p",{className:"tools-reminder-subtitle",children:"Customize your screenshot before checkout:"}),e.jsxs("div",{className:"tools-list",children:[e.jsxs("div",{className:"tool-item",children:[e.jsx("div",{className:"tool-icon",children:"ü™∂"}),e.jsxs("div",{className:"tool-info",children:[e.jsx("h4",{className:"tool-name",children:"Feather Edge"}),e.jsx("p",{className:"tool-description",children:"Softens the edges of your screenshot"})]})]}),e.jsxs("div",{className:"tool-item",children:[e.jsx("div",{className:"tool-icon",children:"‚≠ï"}),e.jsxs("div",{className:"tool-info",children:[e.jsx("h4",{className:"tool-name",children:"Corner Radius"}),e.jsx("p",{className:"tool-description",children:"Round corners (max = perfect circle)"})]})]}),e.jsxs("div",{className:"tool-item",children:[e.jsx("div",{className:"tool-icon",children:"üñºÔ∏è"}),e.jsxs("div",{className:"tool-info",children:[e.jsx("h4",{className:"tool-name",children:"Framed Border"}),e.jsx("p",{className:"tool-description",children:"Add a colored frame around your screenshot"})]})]})]})]}),e.jsxs("div",{className:"added-to-cart-modal-actions",children:[e.jsx("button",{className:"checkout-btn-modal",onClick:()=>{Y(!1),a("/checkout")},children:"Checkout"}),e.jsx("button",{className:"go-to-tools-btn",onClick:()=>{Y(!1),a("/tools")},children:"Go to Tools Page"}),e.jsx("button",{className:"continue-shopping-btn",onClick:()=>Y(!1),children:"Continue Shopping"})]})]})]})})]})};const Qd=({isOpen:t,image:s,onCrop:r,onCancel:a})=>{const[i,o]=c.useState({x:100,y:100,width:200,height:200}),[n,u]=c.useState(!1),[m,f]=c.useState(!1),[k,M]=c.useState(null),[h,v]=c.useState({x:0,y:0}),[_,b]=c.useState({width:0,height:0}),[x,T]=c.useState({width:0,height:0}),S=c.useRef(null),A={"4x6":{width:1200,height:1800,name:'4" x 6" Photo'},"5x7":{width:1500,height:2100,name:'5" x 7" Photo'},"8x10":{width:2400,height:3e3,name:'8" x 10" Photo'},"11x14":{width:3300,height:4200,name:'11" x 14" Photo'},Mug:{width:800,height:800,name:"Coffee Mug"},"T-Shirt":{width:1200,height:1200,name:"T-Shirt Print"},"Phone Case":{width:600,height:1200,name:"Phone Case"}};c.useEffect(()=>{if(t&&s){const W=new Image;W.crossOrigin="anonymous",W.onload=()=>{const O=W.width,de=W.height;b({width:O,height:de}),setTimeout(()=>{const G=document.querySelector(".crop-image");if(G){const U=G.getBoundingClientRect();console.log("Display image size detected:",U),console.log("Image natural size:",{width:G.naturalWidth,height:G.naturalHeight}),console.log("Image CSS size:",{width:G.offsetWidth,height:G.offsetHeight});const y=U.width,N=U.height;T({width:y,height:N});const D=y/2-150,w=N/2-150,p=Math.min(300,Math.min(y,N)*.8);o({x:Math.max(0,D),y:Math.max(0,w),width:p,height:p})}else console.log("Display image not found, using fallback sizes"),T({width:400,height:300}),o({x:100,y:100,width:200,height:200})},300)},W.src=s}},[t,s]);const E=W=>{var U;const O=(U=document.querySelector(".crop-image"))==null?void 0:U.getBoundingClientRect();if(!O)return;const de=W.clientX-O.left,G=W.clientY-O.top;console.log("Mouse down:",{clientX:W.clientX,clientY:W.clientY,imageRect:O,x:de,y:G,cropArea:i}),de>=i.x&&de<=i.x+i.width&&G>=i.y&&G<=i.y+i.height&&(u(!0),v({x:de-i.x,y:G-i.y}))},z=W=>{var U;if(!n&&!m)return;const O=(U=document.querySelector(".crop-image"))==null?void 0:U.getBoundingClientRect();if(!O)return;const de=W.clientX-O.left,G=W.clientY-O.top;if(n){const y=Math.max(0,Math.min(de-h.x,_.width-i.width)),N=Math.max(0,Math.min(G-h.y,_.height-i.height));o(D=>({...D,x:y,y:N}))}else if(m){let y={...i};switch(k){case"bottom-right":y.width=Math.max(50,de-i.x),y.height=Math.max(50,G-i.y);break;case"bottom-left":y.x=Math.min(de,i.x+i.width-50),y.width=i.x+i.width-y.x,y.height=Math.max(50,G-i.y);break;case"top-right":y.y=Math.min(G,i.y+i.height-50),y.width=Math.max(50,de-i.x),y.height=i.y+i.height-y.y;break;case"top-left":y.x=Math.min(de,i.x+i.width-50),y.y=Math.min(G,i.y+i.height-50),y.width=i.x+i.width-y.x,y.height=i.y+i.height-y.y;break}y.x=Math.max(0,Math.min(y.x,_.width-y.width)),y.y=Math.max(0,Math.min(y.y,_.height-y.height)),y.width=Math.min(y.width,_.width-y.x),y.height=Math.min(y.height,_.height-y.y),o(y)}},V=()=>{u(!1),f(!1),M(null)},X=(W,O)=>{O.stopPropagation(),f(!0),M(W)},Y=W=>{if(!x.width||!x.height||!_.width||!_.height)return console.log("Missing size data:",{displaySize:x,imageSize:_}),W;const O=document.querySelector(".crop-image");let de=x.width,G=x.height;if(O){const w=O.getBoundingClientRect();de=w.width,G=w.height,console.log("Current display size:",{width:de,height:G})}const U=_.width/de,y=_.height/G,N=8,D={x:Math.round((W.x-N)*U),y:Math.round(W.y*y),width:Math.round(W.width*U),height:Math.round(W.height*y)};return D.x=Math.max(0,Math.min(D.x,_.width-D.width)),D.y=Math.max(0,Math.min(D.y,_.height-D.height)),console.log("Coordinate conversion:",{displayCrop:W,originalCrop:D,scaleX:U,scaleY:y,offsetAdjustment:N,imageSize:_,actualDisplaySize:{width:de,height:G}}),D},$=()=>{try{const W=document.createElement("canvas"),O=W.getContext("2d"),de=new Image,G=Y(i);console.log("Final crop coordinates:",{display:i,original:G,imageSize:_,displaySize:x}),de.onload=()=>{W.width=G.width,W.height=G.height,console.log("Drawing crop:",{sourceX:G.x,sourceY:G.y,sourceWidth:G.width,sourceHeight:G.height,destX:0,destY:0,destWidth:G.width,destHeight:G.height}),O.clearRect(0,0,W.width,W.height),O.drawImage(de,G.x,G.y,G.width,G.height,0,0,G.width,G.height);const U=W.toDataURL("image/png");r(U)},de.src=s}catch(W){console.error("Error during crop operation:",W),alert("Error cropping image. Please try again.")}},se=async()=>{try{const W=document.createElement("canvas"),O=W.getContext("2d"),de=new Image,G=Y(i);de.onload=async()=>{W.width=G.width,W.height=G.height,O.clearRect(0,0,W.width,W.height),O.drawImage(de,G.x,G.y,G.width,G.height,0,0,G.width,G.height);const y={image_data:W.toDataURL("image/png"),feather_radius:12},N=await fetch("https://screenmerch.fly.dev/api/process-shirt-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});if(N.ok){const D=await N.json(),w={thumbnail_data:D.processed_image,print_dpi:300,soft_corners:!1,edge_feather:!0},p=await fetch("https://screenmerch.fly.dev/api/process-thumbnail-print-quality",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});if(p.ok){const ee=await p.json();r(ee.screenshot),alert("‚ú® Feather effect applied and print quality image generated!")}else r(D.processed_image),alert("‚ú® Feather effect applied!")}else{const D=await N.json();alert("Error applying feather effect: "+(D.error||"Unknown error"))}},de.src=s}catch(W){console.error("Error during feather effect:",W),alert("Error applying feather effect. Please try again.")}},be=()=>{const W={},O=Y(i);return Object.entries(A).forEach(([de,G])=>{const U=O.width>=G.width,y=O.height>=G.height,N=U&&y;W[de]={meetsWidth:U,meetsHeight:y,isSuitable:N,requirements:G,currentWidth:O.width,currentHeight:O.height}}),W},xe=()=>{const W=be(),O=Object.entries(W).filter(([de,G])=>G.isSuitable).sort((de,G)=>{const U=de[1].currentWidth*de[1].currentHeight;return G[1].currentWidth*G[1].currentHeight-U});return O.length>0?O[0]:null};be();const ae=xe();return t?e.jsx("div",{className:"simple-crop-overlay",children:e.jsxs("div",{className:"simple-crop-modal",children:[e.jsxs("div",{className:"simple-crop-header",children:[e.jsx("h3",{children:"Simple Print Crop Tool"}),e.jsx("button",{className:"simple-crop-close",onClick:a,children:"√ó"})]}),e.jsxs("div",{className:"simple-crop-content",children:[e.jsx("div",{className:"simple-print-status",children:ae?e.jsxs("div",{className:"status-ok",children:[e.jsx("span",{className:"status-icon",children:"‚úì"}),e.jsx("span",{className:"status-text",children:"OK for Print"})]}):e.jsxs("div",{className:"status-warning",children:[e.jsx("span",{className:"status-icon",children:"‚ö†"}),e.jsx("span",{className:"status-text",children:"Too Small for Print"})]})}),e.jsxs("div",{className:"crop-instructions",children:[e.jsx("p",{children:"‚Ä¢ Click and drag inside the blue box to move it"}),e.jsx("p",{children:"‚Ä¢ Drag the corner handles to resize"}),e.jsxs("div",{className:"crop-coordinates",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Display:"})," ",Math.round(i.x),", ",Math.round(i.y)," - ",Math.round(i.width),"√ó",Math.round(i.height)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Original:"})," ",Math.round(Y(i).x),", ",Math.round(Y(i).y)," - ",Math.round(Y(i).width),"√ó",Math.round(Y(i).height)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Scale:"})," ",x.width&&_.width?(_.width/x.width).toFixed(2):"N/A","x"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Image Size:"})," ",_.width,"√ó",_.height,"px"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Offset Adjustment:"})," 8px left"]})]})]}),e.jsxs("div",{className:"crop-container",ref:S,onMouseDown:E,onMouseMove:z,onMouseUp:V,onMouseLeave:V,children:[e.jsx("img",{src:s,alt:"Crop",className:"crop-image"}),e.jsxs("div",{className:"crop-box",style:{left:i.x,top:i.y,width:i.width,height:i.height},children:[e.jsx("div",{className:"resize-handle top-left",onMouseDown:W=>X("top-left",W)}),e.jsx("div",{className:"resize-handle top-right",onMouseDown:W=>X("top-right",W)}),e.jsx("div",{className:"resize-handle bottom-left",onMouseDown:W=>X("bottom-left",W)}),e.jsx("div",{className:"resize-handle bottom-right",onMouseDown:W=>X("bottom-right",W)})]})]})]}),e.jsxs("div",{className:"simple-crop-footer",children:[e.jsx("button",{className:"crop-btn cancel",onClick:a,children:"Cancel"}),e.jsx("button",{className:"crop-btn apply",onClick:$,children:"Apply Crop"}),e.jsx("button",{className:"crop-btn feather",onClick:se,children:"‚ú® Apply Feather & Generate Print Quality"})]})]})}):null};const eu=()=>{const[t,s]=c.useState(!1),[r,a]=c.useState(null),[i,o]=c.useState(null),n=f=>{const k=f.target.files[0];if(k){const M=new FileReader;M.onload=h=>{a(h.target.result)},M.readAsDataURL(k)}},u=f=>{o(f),s(!1)},m=()=>{s(!1)};return e.jsxs("div",{className:"print-crop-demo",children:[e.jsxs("div",{className:"demo-header",children:[e.jsx("h2",{children:"Print Crop Tool Demo"}),e.jsx("p",{children:"This is a standalone crop tool designed for print-ready screenshots"})]}),e.jsxs("div",{className:"demo-controls",children:[e.jsxs("div",{className:"file-upload",children:[e.jsx("label",{htmlFor:"image-upload",className:"upload-btn",children:"Choose Screenshot Image"}),e.jsx("input",{id:"image-upload",type:"file",accept:"image/*",onChange:n,style:{display:"none"}})]}),r&&e.jsx("button",{className:"crop-btn",onClick:()=>s(!0),children:"Open Crop Tool"})]}),e.jsxs("div",{className:"demo-images",children:[r&&e.jsxs("div",{className:"image-container",children:[e.jsx("h3",{children:"Original Image"}),e.jsx("img",{src:r,alt:"Original"})]}),i&&e.jsxs("div",{className:"image-container",children:[e.jsx("h3",{children:"Cropped Image"}),e.jsx("img",{src:i,alt:"Cropped"}),e.jsxs("div",{className:"image-info",children:[e.jsx("p",{children:"Preview (scaled down for display)"}),e.jsx("p",{children:"Full size available for download"})]}),e.jsx("a",{href:i,download:"cropped-screenshot.png",className:"download-btn",children:"Download Cropped Image"})]})]}),e.jsx(Qd,{isOpen:t,image:r,onCrop:u,onCancel:m})]})};const tu=()=>e.jsxs("div",{className:"test-crop-page",children:[e.jsxs("div",{className:"test-header",children:[e.jsx("h1",{children:"üß™ Print Crop Tool Test"}),e.jsx("p",{children:"Testing the new standalone crop tool for print-ready screenshots"}),e.jsxs("div",{className:"test-info",children:[e.jsx("h3",{children:"What to test:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"‚úÖ Upload a screenshot image"}),e.jsx("li",{children:"‚úÖ Drag the crop box to move it"}),e.jsx("li",{children:"‚úÖ Use corner handles (crosshair cursor) to resize"}),e.jsx("li",{children:"‚úÖ Check print size validation (green checkmarks)"}),e.jsx("li",{children:"‚úÖ Apply crop and download result"})]})]})]}),e.jsx(eu,{}),e.jsx("div",{className:"test-footer",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," This is a test page. Remove the route and import when done testing."]})})]});class su{static async getCreatorEarnings(){try{const{data:{user:s}}=await R.auth.getUser();if(!s)throw new Error("User not authenticated");const{data:r,error:a}=await R.from("users").select(`
          total_earnings,
          pending_payout,
          payout_enabled,
          paypal_email,
          last_payout_date,
          payout_threshold
        `).eq("id",s.id).single();if(a)throw a;const{data:i,error:o}=await R.from("creator_earnings").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(10);if(o)throw o;const{data:n,error:u}=await R.from("payouts").select("*").eq("user_id",s.id).order("payout_date",{ascending:!1}).limit(5);if(u)throw u;return{success:!0,data:{user:r,recentEarnings:i||[],recentPayouts:n||[]}}}catch(s){return console.error("Error getting creator earnings:",s),{success:!1,error:s.message}}}static async updatePaypalEmail(s){try{const{data:{user:r}}=await R.auth.getUser();if(!r)throw new Error("User not authenticated");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))throw new Error("Please enter a valid PayPal email address");const{error:i}=await R.from("users").update({paypal_email:s,payout_enabled:!0,updated_at:new Date().toISOString()}).eq("id",r.id);if(i)throw i;return{success:!0,message:"PayPal email updated successfully"}}catch(r){return console.error("Error updating PayPal email:",r),{success:!1,error:r.message}}}static async updateTaxInfo(s){try{const{data:{user:r}}=await R.auth.getUser();if(!r)throw new Error("User not authenticated");const{error:a}=await R.from("users").update({tax_id:s,tax_info_verified:!0,updated_at:new Date().toISOString()}).eq("id",r.id);if(a)throw a;return{success:!0,message:"Tax information updated successfully"}}catch(r){return console.error("Error updating tax info:",r),{success:!1,error:r.message}}}static getPayoutSchedule(){return{frequency:"monthly",day:1,minimumAmount:50,processingDays:3,fees:{paypal:.029,platform:.3}}}static getNextPayoutDate(){const s=new Date;return new Date(s.getFullYear(),s.getMonth()+1,1)}static isEligibleForPayout(s){const r=this.getPayoutSchedule();return s>=r.minimumAmount}static formatCurrency(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s)}static async getEarningsSummary(){try{const{data:{user:s}}=await R.auth.getUser();if(!s)throw new Error("User not authenticated");const r=new Date;r.setDate(1),r.setHours(0,0,0,0);const{data:a,error:i}=await R.from("creator_earnings").select("creator_share").eq("user_id",s.id).gte("created_at",r.toISOString());if(i)throw i;const o=a.reduce((m,f)=>m+f.creator_share,0),{data:n,error:u}=await R.from("users").select("total_earnings, pending_payout, payout_enabled").eq("id",s.id).single();if(u)throw u;return{success:!0,data:{monthlyEarnings:o,totalEarnings:n.total_earnings||0,pendingPayout:n.pending_payout||0,payoutEnabled:n.payout_enabled||!1,nextPayoutDate:this.getNextPayoutDate(),isEligible:this.isEligibleForPayout(n.pending_payout||0)}}}catch(s){return console.error("Error getting earnings summary:",s),{success:!1,error:s.message}}}}const Ai=({onComplete:t,onSkip:s,onClose:r})=>{const[a,i]=c.useState("paypal"),[o,n]=c.useState(""),[u,m]=c.useState(""),[f,k]=c.useState(!1),[M,h]=c.useState(null),[v,_]=c.useState(1),[b,x]=c.useState(""),[T,S]=c.useState(""),[A,E]=c.useState("checking"),[z,V]=c.useState(""),[X,Y]=c.useState(""),[$,se]=c.useState("US"),[be,xe]=c.useState([{method_name:"paypal",display_name:"PayPal Business",description:"Fast, secure PayPal Business payments with low fees",fees_percentage:2.9,fees_fixed:.3,processing_time_days:1,min_payout:50,is_available:!0},{method_name:"stripe",display_name:"Stripe Connect",description:"Professional payment processing with advanced features",fees_percentage:2.9,fees_fixed:.3,processing_time_days:2,min_payout:25,is_available:!0},{method_name:"ach",display_name:"Direct Bank Transfer",description:"Direct deposit to your bank account with minimal fees",fees_percentage:.5,fees_fixed:.25,processing_time_days:3,min_payout:50,is_available:!0}]);c.useEffect(()=>{W(),ae()},[]);const ae=async()=>{console.log("üîÑ Loading available payment methods...");const w=[{method_name:"paypal",display_name:"PayPal Business",description:"Fast, secure PayPal Business payments with low fees",fees_percentage:2.9,fees_fixed:.3,processing_time_days:1,min_payout:50,is_available:!0},{method_name:"stripe",display_name:"Stripe Connect",description:"Professional payment processing with advanced features",fees_percentage:2.9,fees_fixed:.3,processing_time_days:2,min_payout:25,is_available:!0},{method_name:"ach",display_name:"Direct Bank Transfer",description:"Direct deposit to your bank account with minimal fees",fees_percentage:.5,fees_fixed:.25,processing_time_days:3,min_payout:50,is_available:!0}];console.log("‚úÖ Setting fallback payment methods:",w),xe(w),setTimeout(()=>{console.log("üîç State after setting methods:",be)},100);try{const{data:p,error:ee}=await R.rpc("get_user_payment_methods",{user_country:"US"});!ee&&p&&p.length>0?(console.log("‚úÖ Database payment methods loaded:",p),xe(p)):console.log("‚ÑπÔ∏è Database function not available, using fallback methods")}catch(p){console.log("‚ÑπÔ∏è Database error, using fallback methods:",p.message)}},W=async()=>{try{const w=localStorage.getItem("user_authenticated")==="true",p=localStorage.getItem("user_email");if(!w||!p){console.log("‚ùå User not authenticated in localStorage");return}const{data:ee,error:ie}=await R.from("users").select("id, paypal_email, tax_id, payout_enabled, preferred_payment_method, ach_routing_number, ach_account_type, stripe_connect_account_id").eq("email",p).single();ee&&(n(ee.paypal_email||""),m(ee.tax_id||""),i(ee.preferred_payment_method||"paypal"),x(ee.ach_routing_number||""),E(ee.ach_account_type||"checking"),Y(ee.stripe_connect_account_id||""))}catch(w){console.error("Error loading payment info:",w)}},O=w=>{i(w),h(null)},de=()=>{if(a==="paypal"){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o))throw new Error("Please enter a valid PayPal email address")}else if(a==="ach"){if(!b||b.length!==9)throw new Error("Please enter a valid 9-digit routing number");if(!T||T.length<4)throw new Error("Please enter a valid account number");if(!z.trim())throw new Error("Please enter the account holder name")}else if(a==="stripe"&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(X))throw new Error("Please enter a valid email for Stripe Connect")},G=async w=>{w.preventDefault(),k(!0),h(null);try{if(new URLSearchParams(window.location.search).get("flow")==="new_user"){localStorage.setItem("pending_payment_method",a),a==="paypal"?localStorage.setItem("pending_paypal_email",o):a==="ach"?localStorage.setItem("pending_ach_info",JSON.stringify({routing:b,account:T,type:A,name:z})):a==="stripe"&&localStorage.setItem("pending_stripe_email",X),_(2);return}const ee=localStorage.getItem("user_authenticated")==="true",ie=localStorage.getItem("user_email");if(!ee||!ie)throw new Error("User not authenticated");const{data:we,error:Ce}=await R.from("users").select("id").eq("email",ie).single();if(Ce||!we)throw new Error("User not found in database");de();const Oe={preferred_payment_method:a,payout_enabled:!0,updated_at:new Date().toISOString()};a==="paypal"?Oe.paypal_email=o:a==="ach"?(Oe.ach_routing_number=b,Oe.ach_account_type=A,Oe.ach_account_number_encrypted=btoa(T),Oe.bank_account_verified=!1):a==="stripe"&&(Oe.stripe_connect_account_id=X,Oe.stripe_connect_status="pending");const{error:it}=await R.from("users").update(Oe).eq("id",we.id);if(it)throw it;_(2)}catch(p){h(p.message)}finally{k(!1)}},U=async w=>{w.preventDefault(),k(!0),h(null);try{const p=localStorage.getItem("user_authenticated")==="true",ee=localStorage.getItem("user_email");if(!p||!ee)throw new Error("User not authenticated");const{data:ie,error:we}=await R.from("users").select("id").eq("email",ee).single();if(we||!ie)throw new Error("User not found in database");const{error:Ce}=await R.from("users").update({tax_id:u,tax_info_verified:!1,updated_at:new Date().toISOString()}).eq("id",ie.id);if(Ce)throw Ce;t&&t()}catch(p){h(p.message)}finally{k(!1)}},y=()=>{s&&s()},N=()=>{switch(a){case"paypal":return e.jsx("div",{className:"payment-form",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"paypal-email",children:"PayPal Business Email"}),e.jsx("input",{type:"email",id:"paypal-email",value:o,onChange:w=>n(w.target.value),placeholder:"your-business@paypal.com",required:!0}),e.jsx("small",{children:"Make sure this is a PayPal Business account"})]})});case"ach":return e.jsxs("div",{className:"payment-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ach-account-name",children:"Account Holder Name"}),e.jsx("input",{type:"text",id:"ach-account-name",value:z,onChange:w=>V(w.target.value),placeholder:"John Doe",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ach-routing",children:"Routing Number"}),e.jsx("input",{type:"text",id:"ach-routing",value:b,onChange:w=>x(w.target.value),placeholder:"123456789",maxLength:"9",required:!0}),e.jsx("small",{children:"9-digit routing number from your bank"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ach-account",children:"Account Number"}),e.jsx("input",{type:"text",id:"ach-account",value:T,onChange:w=>S(w.target.value),placeholder:"1234567890",required:!0}),e.jsx("small",{children:"Your bank account number"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ach-type",children:"Account Type"}),e.jsxs("select",{id:"ach-type",value:A,onChange:w=>E(w.target.value),required:!0,children:[e.jsx("option",{value:"checking",children:"Checking"}),e.jsx("option",{value:"savings",children:"Savings"})]})]})]});case"stripe":return e.jsxs("div",{className:"payment-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"stripe-email",children:"Email for Stripe Connect"}),e.jsx("input",{type:"email",id:"stripe-email",value:X,onChange:w=>Y(w.target.value),placeholder:"your-email@example.com",required:!0}),e.jsx("small",{children:"This email will be used to set up your Stripe Connect account"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"stripe-country",children:"Country"}),e.jsxs("select",{id:"stripe-country",value:$,onChange:w=>se(w.target.value),required:!0,children:[e.jsx("option",{value:"US",children:"United States"}),e.jsx("option",{value:"CA",children:"Canada"}),e.jsx("option",{value:"GB",children:"United Kingdom"}),e.jsx("option",{value:"AU",children:"Australia"}),e.jsx("option",{value:"DE",children:"Germany"}),e.jsx("option",{value:"FR",children:"France"})]})]})]});default:return null}},D=()=>{const w=be.find(p=>p.method_name===a);return w?e.jsxs("div",{className:"payment-benefits",children:[e.jsxs("h4",{children:["Why ",w.display_name,"?"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:["‚úÖ ",w.description]}),e.jsxs("li",{children:["‚úÖ Processing time: ",w.processing_time_days," business day(s)"]}),e.jsxs("li",{children:["‚úÖ Minimum payout: $",w.min_payout]}),e.jsxs("li",{children:["‚úÖ Fees: ",w.fees_percentage,"% + $",w.fees_fixed]})]})]}):null};return console.log("üéØ RENDERING PaymentSetup. availableMethods:",be,"length:",be.length),e.jsx("div",{className:"payment-setup-container",children:e.jsxs("div",{className:"payment-setup-card",children:[e.jsxs("div",{className:"payment-setup-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx("h2",{children:"üí∞ Connect Payment Method"}),e.jsx("p",{children:"Please connect your payment method to receive payouts"})]}),r&&e.jsx("button",{className:"payment-setup-close-btn",onClick:r,"aria-label":"Close payment setup",children:"‚úï"})]}),v===1&&e.jsxs("div",{className:"payment-step",children:[e.jsxs("div",{className:"step-indicator",children:[e.jsx("span",{className:"step active",children:"1"}),e.jsx("span",{className:"step",children:"2"})]}),e.jsx("h3",{children:"Connect Payment Method"}),e.jsx("p",{children:"Please connect your payment method to receive payouts"}),e.jsxs("div",{className:"payment-method-selection",children:[console.log("üîç Rendering payment methods. availableMethods:",be),be.length===0?e.jsx("div",{className:"loading-methods",children:e.jsx("p",{children:"Loading payment methods..."})}):be.map(w=>e.jsxs("div",{className:`payment-method-option ${a===w.method_name?"selected":""} ${w.is_available?"":"unavailable"}`,onClick:()=>w.is_available&&O(w.method_name),children:[e.jsxs("div",{className:"method-header",children:[e.jsx("input",{type:"radio",name:"payment-method",id:w.method_name,value:w.method_name,checked:a===w.method_name,onChange:()=>w.is_available&&O(w.method_name),disabled:!w.is_available}),e.jsxs("label",{htmlFor:w.method_name,children:[e.jsx("span",{className:"method-name",children:w.display_name}),!w.is_available&&e.jsx("span",{className:"unavailable-badge",children:"Not Available"})]})]}),e.jsxs("div",{className:"method-details",children:[e.jsxs("span",{className:"fees",children:[w.fees_percentage,"% + $",w.fees_fixed]}),e.jsxs("span",{className:"processing-time",children:[w.processing_time_days," day(s)"]})]})]},w.method_name))]}),N(),D(),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"submit-btn",onClick:G,disabled:f,children:f?"Processing...":"Connect Payment Method"})}),M&&e.jsx("div",{className:"error-message",children:M})]}),v===2&&e.jsxs("div",{className:"payment-step",children:[e.jsxs("div",{className:"step-indicator",children:[e.jsx("span",{className:"step completed",children:"1"}),e.jsx("span",{className:"step active",children:"2"})]}),e.jsx("h3",{children:"Connect Payment Method"}),e.jsx("p",{children:"Please connect your payment method to receive payouts"}),e.jsxs("form",{onSubmit:U,className:"payment-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payment-email",children:"Payment Email"}),e.jsx("input",{type:"email",id:"payment-email",value:u,onChange:w=>m(w.target.value),placeholder:"your-email@example.com",required:!0}),e.jsx("small",{children:"Enter the email associated with your payment method (PayPal, Stripe, etc.)"}),e.jsxs("div",{className:"security-notice",children:[e.jsx("div",{className:"security-icon",children:"üîí"}),e.jsxs("div",{className:"security-text",children:[e.jsx("strong",{children:"Security Notice:"})," Your payment information is securely handled through trusted third-party processors. We never store sensitive payment details."]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"submit-btn",disabled:f,children:f?"Processing...":"Connect Payment Method"}),e.jsx("button",{type:"button",className:"skip-btn",onClick:y,disabled:f,children:"Skip for Now"})]}),M&&e.jsx("div",{className:"error-message",children:M})]})]})]})})},ru=()=>{var k,M,h,v,_,b,x,T,S,A;const[t,s]=c.useState(null),[r,a]=c.useState(null),[i,o]=c.useState(!0),[n,u]=c.useState(!1),m=ct();c.useEffect(()=>{(async()=>{try{const{data:{user:z},error:V}=await R.auth.getUser();if(!z){m("/");return}s(z),await f()}catch(z){console.error("Error fetching user data:",z),m("/")}finally{o(!1)}})()},[m]);const f=async()=>{try{console.log("üí∞ Starting payment data fetch...");const E=await su.getCreatorEarnings();E.success?(console.log("üí∞ Payment data received:",E.data),a(E.data)):console.error("‚ùå Failed to fetch payment data:",E.error)}catch(E){console.error("‚ùå Error fetching payment data:",E)}};return i?e.jsx("div",{className:"payment-portal-container",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading payment portal..."})]})}):t?e.jsxs("div",{className:"payment-portal-container",children:[e.jsxs("div",{className:"payment-portal-header",children:[e.jsx("button",{className:"back-button",onClick:()=>m(-1),children:"‚Üê Back"}),e.jsx("h1",{children:"üí∞ Connect Payment Method"}),e.jsx("p",{children:"Please connect your payment method to receive payouts"})]}),e.jsx("div",{className:"payment-status-section",children:e.jsxs("div",{className:"payment-status-cards",children:[e.jsxs("div",{className:"status-card",children:[e.jsx("h4",{children:"üìã Payment Method"}),e.jsx("div",{className:"status-indicator",children:(k=r==null?void 0:r.user)!=null&&k.payout_enabled?e.jsx("span",{className:"status-success",children:"‚úÖ Complete"}):e.jsx("span",{className:"status-warning",children:"‚ö†Ô∏è Not Set Up"})}),((M=r==null?void 0:r.user)==null?void 0:M.paypal_email)&&e.jsxs("p",{className:"status-detail",children:["PayPal: ",r.user.paypal_email]})]}),e.jsxs("div",{className:"status-card",children:[e.jsx("h4",{children:"üí∞ Total Earnings"}),e.jsxs("div",{className:"earnings-amount",children:["$",((v=(h=r==null?void 0:r.user)==null?void 0:h.total_earnings)==null?void 0:v.toFixed(2))||"0.00"]}),e.jsx("p",{className:"status-detail",children:"Lifetime earnings"})]}),e.jsxs("div",{className:"status-card",children:[e.jsx("h4",{children:"üí∏ Pending Payout"}),e.jsxs("div",{className:"pending-amount",children:["$",((b=(_=r==null?void 0:r.user)==null?void 0:_.pending_payout)==null?void 0:b.toFixed(2))||"0.00"]}),e.jsx("p",{className:"status-detail",children:((x=r==null?void 0:r.user)==null?void 0:x.pending_payout)>=50?"Ready for payout":"Min $50 required"})]}),e.jsxs("div",{className:"status-card",children:[e.jsx("h4",{children:"üìÖ Next Payout"}),e.jsx("div",{className:"payout-date",children:(T=r==null?void 0:r.user)!=null&&T.last_payout_date?new Date(r.user.last_payout_date).toLocaleDateString():"Not scheduled"}),e.jsx("p",{className:"status-detail",children:"Monthly on the 1st"})]})]})}),e.jsxs("div",{className:"payment-setup-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"üîß Payment Method Required"}),!((S=r==null?void 0:r.user)!=null&&S.payout_enabled)&&e.jsx("button",{className:"setup-payment-btn",onClick:()=>u(!0),children:"Connect Payment Method"})]}),n?e.jsx("div",{className:"payment-setup-modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h4",{children:"Connect Payment Method"}),e.jsx("button",{className:"close-btn",onClick:()=>u(!1),children:"√ó"})]}),e.jsx(Ai,{onComplete:()=>{u(!1),f()},onSkip:()=>u(!1),onClose:()=>u(!1)})]})}):e.jsx("div",{className:"setup-info",children:(A=r==null?void 0:r.user)!=null&&A.payout_enabled?e.jsxs("div",{className:"setup-complete",children:[e.jsx("p",{children:"‚úÖ Your payment method is connected and ready to receive payouts."}),e.jsx("button",{className:"edit-payment-btn",onClick:()=>u(!0),children:"Edit Payment Method"})]}):e.jsxs("div",{className:"setup-required",children:[e.jsx("p",{children:"‚ö†Ô∏è Complete your tax information to receive payouts"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Connect your payment method"}),e.jsx("li",{children:"Complete payment setup"}),e.jsx("li",{children:"Set up automatic monthly payouts"})]})]})})]}),(r==null?void 0:r.recentEarnings)&&r.recentEarnings.length>0&&e.jsxs("div",{className:"recent-earnings-section",children:[e.jsx("h3",{children:"üìà Recent Earnings"}),e.jsx("div",{className:"earnings-list",children:r.recentEarnings.map((E,z)=>{var V;return e.jsxs("div",{className:"earning-item",children:[e.jsxs("div",{className:"earning-info",children:[e.jsxs("span",{className:"earning-amount",children:["$",(V=E.amount)==null?void 0:V.toFixed(2)]}),e.jsx("span",{className:"earning-date",children:new Date(E.created_at).toLocaleDateString()})]}),e.jsx("div",{className:"earning-source",children:E.source||"Product Sale"})]},z)})})]}),(r==null?void 0:r.recentPayouts)&&r.recentPayouts.length>0&&e.jsxs("div",{className:"recent-payouts-section",children:[e.jsx("h3",{children:"üí∏ Recent Payouts"}),e.jsx("div",{className:"payouts-list",children:r.recentPayouts.map((E,z)=>{var V;return e.jsxs("div",{className:"payout-item",children:[e.jsxs("div",{className:"payout-info",children:[e.jsxs("span",{className:"payout-amount",children:["$",(V=E.amount)==null?void 0:V.toFixed(2)]}),e.jsx("span",{className:"payout-date",children:new Date(E.payout_date).toLocaleDateString()})]}),e.jsx("div",{className:"payout-status",children:e.jsx("span",{className:`status-badge ${E.status}`,children:E.status})})]},z)})})]}),e.jsxs("div",{className:"payment-info-section",children:[e.jsx("h3",{children:"‚ÑπÔ∏è Payment Method"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-card",children:[e.jsx("h4",{children:"üí∞ Payment Method"}),e.jsx("p",{children:"Connect payment method to receive payouts"})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h4",{children:"üìÖ Payout Schedule"}),e.jsx("p",{children:"Payouts are processed monthly on the 1st of each month for earnings above $50.00."})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h4",{children:"üìä Tax Reporting"}),e.jsx("p",{children:"Complete tax forms to receive payouts"})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h4",{children:"üîí Security"}),e.jsx("p",{children:"Connect payment method to receive payouts"})]})]})]})]}):e.jsx("div",{className:"payment-portal-container",children:e.jsxs("div",{className:"error-container",children:[e.jsx("p",{children:"Please log in to access the payment portal."}),e.jsx("button",{onClick:()=>m("/"),children:"Go Home"})]})})};const au=()=>{const t=ct(),[s]=Et(),[r,a]=c.useState([]),[i,o]=c.useState(0),[n,u]=c.useState({cost:0,method:"Standard Shipping",loading:!1,error:"",calculated:!1}),[m,f]=c.useState({country_code:"US",zip:""}),k=c.useRef(n);c.useEffect(()=>{k.current=n},[n]),c.useEffect(()=>{try{const h=localStorage.getItem("cart_items"),v=h?JSON.parse(h):[];a(v),o(v.reduce((_,b)=>_+(b.price||0)*(b.qty||1),0))}catch{a([]),o(0)}},[]);const M=c.useCallback(async()=>{if(r.length!==0){u(h=>({...h,loading:!0,error:""}));try{const h=String(m.zip||"").trim(),v=String(m.country_code||"US").trim(),_={shipping_address:{zip:h,country_code:v},cart:r.map(T=>({variant_id:T.printify_variant_id||T.printful_variant_id||1,quantity:T.qty||1}))};console.log("üöÄ Calling shipping API:",ze.ENDPOINTS.CALCULATE_SHIPPING),console.log("üöÄ Payload:",_);const b=await fetch(ze.ENDPOINTS.CALCULATE_SHIPPING,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});if(console.log("üì¶ Response status:",b.status),console.log("üì¶ Response URL:",b.url),b.status===404)throw new Error(`Shipping API endpoint not found (404). Please verify the backend is deployed and the endpoint exists at: ${ze.ENDPOINTS.CALCULATE_SHIPPING}`);if(!b.ok){const T=await b.text();console.error("‚ùå API Error Response:",T);let S;try{S=JSON.parse(T)}catch{S={error:T||`HTTP ${b.status}: ${b.statusText}`}}throw new Error(S.error||`API returned status ${b.status}`)}const x=await b.json();if(console.log("üì¶ Shipping calculation response:",x),console.log("üì¶ Response success:",x==null?void 0:x.success),console.log("üì¶ Response shipping_cost:",x==null?void 0:x.shipping_cost),console.log("üì¶ Response type:",typeof(x==null?void 0:x.shipping_cost)),x&&x.success===!0){let T=x.shipping_cost;if(T==null&&(T=x.cost||x.price||x.amount),T=parseFloat(T),console.log("üì¶ Parsed shipping cost:",T),console.log("üì¶ Is valid number?",!isNaN(T)),console.log("üì¶ Is greater than 0?",T>0),!isNaN(T)&&T>0){console.log("‚úÖ Shipping calculated successfully:",T);const S={cost:T,method:x.shipping_method||x.method||"Standard Shipping",loading:!1,error:"",calculated:!0};console.log("‚úÖ Setting shipping state:",S),u(S),setTimeout(()=>{k.current=S,console.log("‚úÖ Shipping ref updated:",k.current)},100)}else{const S=(x==null?void 0:x.error)||`Invalid shipping cost received: ${x.shipping_cost}. Please verify your ZIP code and try again.`;console.error("‚ùå Shipping cost invalid:",T),console.error("‚ùå Full response:",x);const A={cost:0,method:"",loading:!1,error:S,calculated:!1};u(A),k.current=A}}else{const T=(x==null?void 0:x.error)||"Unable to calculate shipping. Please verify your ZIP code and try again.";console.error("‚ùå Shipping calculation failed:",T),console.error("‚ùå Response data:",x),console.error("‚ùå Response success field:",x==null?void 0:x.success);const S={cost:0,method:"",loading:!1,error:T,calculated:!1};u(S),k.current=S}}catch(h){const v=h.message.includes("404")||h.message.includes("Not found")?"Shipping API endpoint not found. The backend may not be deployed. Please contact support.":`Network error: ${h.message}. Please check your connection and try again.`;console.error("‚ùå Shipping calculation exception:",h);const _={cost:0,method:"",loading:!1,error:v,calculated:!1};u(_),k.current=_}}},[r,m]);return c.useEffect(()=>{var h;if(m.zip&&m.zip.trim()&&m.zip.length>=5&&!n.calculated&&!n.loading&&r.length>0){console.log("‚è±Ô∏è Auto-calculating shipping in 800ms for ZIP:",m.zip);const v=setTimeout(()=>{console.log("üöÄ Triggering auto-calculate shipping..."),M()},800);return()=>clearTimeout(v)}else console.log("‚è∏Ô∏è Skipping auto-calculate:",{hasZip:!!(m.zip&&m.zip.trim()),zipLength:(h=m.zip)==null?void 0:h.length,calculated:n.calculated,loading:n.loading,itemsCount:r.length})},[m.zip,r.length,n.calculated,n.loading,M]),e.jsxs("div",{className:"checkout-container",children:[e.jsxs("div",{className:"checkout-header",children:[e.jsx("h1",{children:"Checkout"}),e.jsxs("div",{className:"checkout-progress",children:[e.jsx("div",{className:"progress-step active",children:"1. Review"}),e.jsx("div",{className:"progress-step",children:"2. Payment"}),e.jsx("div",{className:"progress-step",children:"3. Complete"})]})]}),r.length===0?e.jsxs("div",{className:"empty-cart",children:[e.jsx("div",{className:"empty-cart-icon",children:"üõí"}),e.jsx("h2",{children:"Your cart is empty"}),e.jsx("p",{children:"Add some items to your cart to continue"}),e.jsx("button",{className:"btn-primary",onClick:()=>t("/merchandise"),children:"Continue Shopping"})]}):e.jsxs("div",{className:"checkout-content",children:[e.jsxs("div",{className:"checkout-main",children:[e.jsxs("div",{className:"order-section",children:[e.jsxs("div",{className:"order-section-header",children:[e.jsx("h2",{children:"Order Items"}),e.jsx("button",{className:"back-to-cart-btn",onClick:()=>{const h=localStorage.getItem("last_selected_category")||"mens",v=localStorage.getItem("user_authenticated")==="true",_=localStorage.getItem("user_email")||"";t(`/product/browse?category=${encodeURIComponent(h)}&authenticated=${v}&email=${encodeURIComponent(_)}&openCart=true`)},"aria-label":"Back to Cart",children:e.jsx("span",{className:"back-to-cart-text",children:"BACK TO CART"})})]}),e.jsx("div",{className:"items-list",children:r.map((h,v)=>{const _=h.image||h.img,b=h.screenshot||h.selected_screenshot||h.thumbnail;return e.jsxs("div",{className:"item-card",children:[e.jsxs("div",{className:"item-image-wrapper",children:[_&&e.jsx("img",{src:_.includes("?")?`${_}&v=${Date.now()}`:`${_}?v=${Date.now()}`,alt:h.name||h.product}),e.jsxs("div",{className:"item-variants",children:[h.color," ‚Ä¢ ",h.size]})]}),e.jsxs("div",{className:"item-info",children:[e.jsx("h3",{className:"item-name",children:h.name||h.product}),e.jsxs("div",{className:"item-price",children:["$",(h.price||0).toFixed(2)]})]}),b&&e.jsx("img",{src:b,alt:"Screenshot",className:"item-screenshot"})]},v)})})]}),e.jsxs("div",{className:"order-section",children:[e.jsx("h2",{children:"Shipping Information"}),e.jsxs("div",{className:"shipping-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ZIP / Postal Code"}),e.jsx("input",{type:"text",placeholder:"Enter ZIP code",value:m.zip,onChange:h=>f(v=>({...v,zip:h.target.value})),className:"form-input","aria-label":"ZIP or Postal Code","aria-describedby":"zip-help"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Country"}),e.jsxs("select",{value:m.country_code,onChange:h=>f(v=>({...v,country_code:h.target.value})),className:"form-select","aria-label":"Country",children:[e.jsx("option",{value:"US",children:"United States"}),e.jsx("option",{value:"CA",children:"Canada"}),e.jsx("option",{value:"GB",children:"United Kingdom"}),e.jsx("option",{value:"AU",children:"Australia"}),e.jsx("option",{value:"DE",children:"Germany"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"¬†"}),e.jsx("button",{className:"btn-primary",onClick:()=>{if(!m.zip||!m.zip.trim()){alert("‚ö†Ô∏è Please enter your ZIP / Postal Code first.");return}u(h=>({...h,error:"",loading:!0})),M()},id:"calc-shipping-btn",disabled:n.loading||!m.zip||!m.zip.trim(),style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"700",border:"none",fontSize:"1rem",padding:"16px 20px",borderRadius:"12px",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:"0 8px 32px rgba(102, 126, 234, 0.3)",cursor:n.loading||!m.zip||!m.zip.trim()?"not-allowed":"pointer",opacity:n.loading||!m.zip||!m.zip.trim()?.6:1},onMouseEnter:h=>{!n.loading&&m.zip&&m.zip.trim()&&(h.target.style.transform="translateY(-3px)",h.target.style.boxShadow="0 12px 48px rgba(102, 126, 234, 0.4)")},onMouseLeave:h=>{!n.loading&&m.zip&&m.zip.trim()&&(h.target.style.transform="translateY(0)",h.target.style.boxShadow="0 8px 32px rgba(102, 126, 234, 0.3)")},children:n.loading?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),"Calculating‚Ä¶"]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{fontSize:"1rem",marginRight:"6px"},children:"üöö"}),"Calculate Shipping"]})})]})]}),n.error&&e.jsxs("div",{className:"error-message",style:{background:"#f8d7da",color:"#721c24",padding:"12px",borderRadius:"8px",marginTop:"10px",border:"1px solid #f5c6cb"},children:["‚ùå ",n.error]}),n.loading&&e.jsx("div",{style:{background:"#d1ecf1",color:"#0c5460",padding:"12px",borderRadius:"8px",marginTop:"10px",border:"1px solid #bee5eb",textAlign:"center"},children:"‚è≥ Calculating shipping..."}),n.calculated&&n.cost>0&&e.jsxs("div",{className:"shipping-result",style:{background:"#d4edda",color:"#155724",padding:"12px",borderRadius:"8px",marginTop:"10px",border:"1px solid #c3e6cb"},children:[e.jsxs("div",{className:"shipping-method",children:["‚úì ",n.method]}),e.jsxs("div",{className:"shipping-cost",children:["$",n.cost.toFixed(2)]})]}),!n.calculated&&!n.loading&&!n.error&&m.zip&&m.zip.trim()&&e.jsx("div",{style:{color:"#856404",padding:"8px",fontSize:"0.9rem",textAlign:"center"},children:'‚ö†Ô∏è Click "Calculate Shipping" or wait for auto-calculation...'})]})]})]}),e.jsxs("div",{className:"order-summary",children:[e.jsx("h2",{children:"Order Summary"}),e.jsxs("div",{className:"summary-line",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$",i.toFixed(2)]})]}),e.jsxs("div",{className:"summary-line",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:["$",n.cost.toFixed(2)]})]}),e.jsxs("div",{className:"summary-line total",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",(i+(n.cost||0)).toFixed(2)]})]}),e.jsxs("div",{className:"checkout-actions",children:[e.jsx("button",{className:"btn-outline",onClick:()=>t("/merchandise"),children:"Continue Shopping"}),e.jsxs("button",{className:"btn-primary btn-large",disabled:!m.zip||!m.zip.trim()||n.loading,style:{opacity:!m.zip||!m.zip.trim()||n.loading?.5:1,cursor:!m.zip||!m.zip.trim()||n.loading?"not-allowed":"pointer"},title:!m.zip||!m.zip.trim()?"Please enter ZIP code":n.loading?"Calculating shipping...":"Ready to checkout",onClick:async h=>{var E,z,V,X,Y,$,se,be;const v=document.querySelector('input[aria-label="ZIP or Postal Code"]'),_=String((v==null?void 0:v.value)??m.zip??"").trim(),b=String(m.country_code||"US").trim();if(!_){alert("‚ö†Ô∏è Please enter your ZIP / Postal Code before proceeding.");return}if(n.loading){alert("‚ö†Ô∏è Please wait for shipping calculation to complete.");return}const x=k.current,T=x.cost||0;console.log("üîç Proceeding with checkout:",{zip:_,shippingCost:T,shippingCalculated:x.calculated});const S=h.target,A=S.innerHTML;S.innerHTML='<span className="loading-spinner"></span>Processing Order...',S.disabled=!0;try{if(!_){alert("‚ö†Ô∏è ZIP / Postal Code is required. Please enter your ZIP code."),S.innerHTML=A,S.disabled=!1;return}const xe={zip:String(_).trim(),country_code:String(b||"US").trim()};let ae=null;for(const D of r)if(ae=D.screenshot||D.selected_screenshot||D.thumbnail||D.img,ae&&ae.trim())break;let W=null;try{const D=localStorage.getItem("pending_merch_data");if(D){const w=JSON.parse(D);W=w.screenshot_timestamp??w.timestamp??null,ae||(ae=w.edited_screenshot||w.selected_screenshot||(w.screenshots&&Array.isArray(w.screenshots)&&w.screenshots.length>0?w.screenshots[0]:null)||w.thumbnail||null,ae&&console.log("üì∏ Using screenshot from pending_merch_data (edited_screenshot/selected_screenshot)"))}}catch(D){console.warn("Could not load screenshot from localStorage:",D)}console.log("üì∏ Selected screenshot found:",ae?"Yes":"No");const O=r.map(D=>{const p=D.screenshot||D.selected_screenshot||D.thumbnail||D.img||ae||null;return{product:D.product||D.name,variants:{color:D.color||"Default",size:D.size||"Default"},price:D.price||0,selected_screenshot:p}});console.log("üì∏ Cart items with screenshots:",O.map(D=>({product:D.product,has_screenshot:!!D.selected_screenshot,screenshot_type:D.selected_screenshot?D.selected_screenshot.startsWith("data:image")?"base64":D.selected_screenshot.startsWith("http")?"URL":"other":"none"})));const de=s.get("email")||localStorage.getItem("user_email")||"",G={shipping_address:xe,cart:O,product_id:((E=r[0])==null?void 0:E.product_id)||((z=r[0])==null?void 0:z.id)||null,sms_consent:!1,shipping_cost:T,videoUrl:((V=r[0])==null?void 0:V.video_url)||null,videoTitle:((X=r[0])==null?void 0:X.video_title)||null,creatorName:((Y=r[0])==null?void 0:Y.creator_name)||null,user_email:de,screenshot_timestamp:(($=r[0])==null?void 0:$.screenshot_timestamp)??W??null,timestamp:((se=r[0])==null?void 0:se.screenshot_timestamp)??W??null};if(ae){const D=String(ae);G.selected_screenshot=ae,D.startsWith("data:image")?console.log(`üì∏ Added screenshot (base64, ${Math.round(D.length/1024)}KB) to payload`):D.startsWith("http")||D.startsWith("https")?console.log("üì∏ Added screenshot URL to payload"):console.log("üì∏ Added screenshot (other format) to payload")}if(!G.shipping_address||!G.shipping_address.zip){console.error("‚ùå CRITICAL: shipping_address missing from payload!",G),alert("‚ö†Ô∏è Error: Shipping address is missing. Please refresh and try again."),S.innerHTML=A,S.disabled=!1;return}console.log("üîç FINAL checkout payload to /api/create-checkout-session:",G),console.log("üîç ZIP value being sent:",_),console.log("üîç Country value being sent:",b),console.log("üîç Shipping address object:",G.shipping_address),console.log("üîç Shipping address keys:",Object.keys(G.shipping_address||{})),console.log("üîç Shipping address zip check:",(be=G.shipping_address)==null?void 0:be.zip);const U=JSON.stringify(G);console.log("üîç JSON payload length:",U.length),console.log("üîç JSON string includes shipping_address:",U.includes("shipping_address")),console.log("üîç JSON string includes zip:",U.includes("zip")),console.log("üîç JSON string includes zip value:",U.includes(_)),console.log("üîç API Endpoint:",ze.ENDPOINTS.CREATE_CHECKOUT_SESSION),console.log("üîç Sending POST request to backend...");const y=await fetch(ze.ENDPOINTS.CREATE_CHECKOUT_SESSION,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:U});if(console.log("üîç Response status:",y.status),console.log("üîç Response URL:",y.url),!y.ok){const D=await y.text();console.error("‚ùå Backend Error Response:",D),console.error("‚ùå Response Status:",y.status),console.error("‚ùå Response URL:",y.url),console.error("‚ùå Response Headers:",Object.fromEntries(y.headers.entries())),console.error("‚ùå Request Payload Sent:",G),console.error("‚ùå ZIP Code Sent:",_),console.error("‚ùå Shipping Address Sent:",G.shipping_address);let w;try{w=JSON.parse(D),console.error("‚ùå Parsed Error Data:",w)}catch(ee){w={error:D||`HTTP ${y.status}: ${y.statusText}`},console.error("‚ùå Could not parse error as JSON:",ee)}const p=w.error||w.message||w.details||`API returned status ${y.status}`;throw console.error("‚ùå Final Error Message:",p),alert(`‚ö†Ô∏è Checkout Error: ${p}`),new Error(p)}const N=await y.json();if(N!=null&&N.url){try{localStorage.removeItem("cart"),localStorage.removeItem("cart_items"),localStorage.removeItem("cartData"),localStorage.removeItem("persistent_cart"),Object.keys(localStorage).forEach(D=>{D.toLowerCase().includes("cart")&&localStorage.removeItem(D)}),Object.keys(sessionStorage).forEach(D=>{D.toLowerCase().includes("cart")&&sessionStorage.removeItem(D)}),console.log("üõí Cart cleared before redirecting to Stripe checkout")}catch(D){console.error("Error clearing cart:",D)}window.location.href=N.url}else try{const D=await fetch(ze.ENDPOINTS.PLACE_ORDER,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:U});if(!D.ok){const p=await D.text();let ee;try{ee=JSON.parse(p)}catch{ee={error:p||`HTTP ${D.status}: ${D.statusText}`}}throw new Error(ee.error||ee.message||`API returned status ${D.status}`)}const w=await D.json();if(w!=null&&w.next_url){try{localStorage.removeItem("cart"),localStorage.removeItem("cart_items"),localStorage.removeItem("cartData"),localStorage.removeItem("persistent_cart"),Object.keys(localStorage).forEach(p=>{p.toLowerCase().includes("cart")&&localStorage.removeItem(p)}),Object.keys(sessionStorage).forEach(p=>{p.toLowerCase().includes("cart")&&sessionStorage.removeItem(p)}),console.log("üõí Cart cleared before redirecting to Stripe checkout (fallback)")}catch(p){console.error("Error clearing cart:",p)}window.location.href=w.next_url}else S.innerHTML=A,S.disabled=!1,alert((N==null?void 0:N.error)||(w==null?void 0:w.error)||"Failed to start checkout")}catch{S.innerHTML=A,S.disabled=!1,alert("Network error starting checkout")}}catch(xe){console.error("‚ùå Checkout error:",xe),S.innerHTML=A,S.disabled=!1,alert(`‚ö†Ô∏è Checkout error: ${xe.message||"Network error starting checkout"}`)}},children:[e.jsx("span",{children:"Place Order"}),e.jsx("span",{className:"btn-icon",children:"‚Üí"})]})]})]})]})]})};const iu=()=>{const t=ct(),s=hs(),[r,a]=c.useState(null),[i,o]=c.useState(!0);c.useEffect(()=>{(async()=>{try{const{data:{user:f},error:k}=await R.auth.getUser(),M=new URLSearchParams(window.location.search).get("flow")==="new_user";if(!f&&!M){t("/signup",{state:{from:s.pathname,message:"Please sign up to set up your payment information and start earning."}});return}a(f)}catch(f){console.error("Error checking authentication:",f),new URLSearchParams(window.location.search).get("flow")==="new_user"||t("/signup")}finally{o(!1)}})()},[t,s]);const n=()=>{new URLSearchParams(window.location.search).get("flow")==="new_user"?t("/signup",{state:{message:"Great! Your PayPal is set up. Now create your account to start earning!"}}):t("/dashboard",{state:{message:"Payment information set up successfully! You can now start earning with ScreenMerch - completely free!"}})},u=()=>{new URLSearchParams(window.location.search).get("flow")==="new_user"?t("/signup",{state:{message:"No problem! You can set up PayPal later. Let's create your account!"}}):t("/dashboard",{state:{message:"Welcome to ScreenMerch! You can set up payment information later in your dashboard to start earning."}})};return i?e.jsx("div",{className:"payment-setup-page",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading..."})]})}):e.jsxs("div",{className:"payment-setup-page",children:[e.jsxs("div",{className:"payment-setup-header",children:[e.jsx("h1",{children:"üí∞ Welcome to ScreenMerch!"}),e.jsx("p",{children:"Set up your payment information to start earning from your merchandise sales - It's completely free!"})]}),e.jsx(Ai,{onComplete:n,onSkip:u})]})};const ou=typeof import.meta<"u"&&{VITE_API_BASE_URL:"https://api.screenmerch.com",VITE_SUPABASE_URL:"https://sojxbydpcdcdzfdtbypd.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&{}.VITE_BACKEND_URL||typeof process<"u"&&process.env&&{}.REACT_APP_BACKEND_URL||"https://screenmerch.fly.dev",nu=()=>{ct();const[t]=Et(),[s,r]=c.useState(""),[a,i]=c.useState(""),[o,n]=c.useState(!1),[u,m]=c.useState(null),[f,k]=c.useState(null),[M,h]=c.useState(null);c.useEffect(()=>{const _=t.get("token"),b=t.get("email");!_||!b?m({type:"error",text:"Invalid verification link. Please check your email and try again."}):(k(_),h(b))},[t]);const v=async _=>{var b;if(_.preventDefault(),m(null),!s){m({type:"error",text:"Please enter a password."});return}if(s.length<6){m({type:"error",text:"Password must be at least 6 characters long."});return}if(s!==a){m({type:"error",text:"Passwords do not match."});return}if(!f||!M){m({type:"error",text:"Invalid verification link."});return}try{n(!0);const x=await fetch(`${ou}/api/auth/verify-email`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({token:f,email:M,password:s})}),S=(x.headers.get("content-type")||"").includes("application/json");if(!x.ok){const z=await x.text();if(S){let V;try{V=JSON.parse(z)}catch{throw new Error(`Server error ${x.status}`)}throw new Error((V==null?void 0:V.error)||`Server error: ${x.status}`)}else throw new Error(`Could not reach verification API (HTTP ${x.status}).`)}if(!S)throw new Error("Unexpected response from server (not JSON).");const A=await x.json();A!=null&&A.token&&localStorage.setItem("auth_token",A.token),A!=null&&A.user&&localStorage.setItem("user",JSON.stringify(A.user)),localStorage.setItem("isAuthenticated","true");try{sessionStorage.setItem("from_password_set","1")}catch{}m({type:"success",text:"Email verified and password set successfully! Redirecting to home..."});const E=typeof window<"u"&&((b=window.location)!=null&&b.origin)?window.location.origin+"/":"/";setTimeout(()=>{window.location.replace(E)},800)}catch(x){m({type:"error",text:(x==null?void 0:x.message)||"Verification failed. Please try again."})}finally{n(!1)}};return e.jsx("div",{className:"verify-email-page",children:e.jsxs("div",{className:"verify-email-card",children:[e.jsx("h2",{className:"verify-email-title",children:"Set Your Password"}),e.jsx("p",{className:"verify-email-subtitle",children:"Please create a password to complete your account setup"}),u&&e.jsx("div",{className:`verify-email-alert ${u.type==="error"?"verify-email-alert-error":"verify-email-alert-success"}`,role:"alert",children:u.text}),f&&M?e.jsxs("form",{className:"verify-email-form",onSubmit:v,noValidate:!0,children:[e.jsxs("div",{className:"verify-email-field",children:[e.jsx("label",{htmlFor:"email",className:"verify-email-label",children:"Email"}),e.jsx("input",{id:"email",type:"email",className:"verify-email-input",value:M,disabled:!0})]}),e.jsxs("div",{className:"verify-email-field",children:[e.jsx("label",{htmlFor:"password",className:"verify-email-label",children:"Password"}),e.jsx("input",{id:"password",type:"password",className:"verify-email-input",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",autoComplete:"new-password",value:s,onChange:_=>r(_.target.value),disabled:o,required:!0,minLength:6}),e.jsx("p",{className:"verify-email-hint",children:"Must be at least 6 characters"})]}),e.jsxs("div",{className:"verify-email-field",children:[e.jsx("label",{htmlFor:"confirmPassword",className:"verify-email-label",children:"Confirm Password"}),e.jsx("input",{id:"confirmPassword",type:"password",className:"verify-email-input",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",autoComplete:"new-password",value:a,onChange:_=>i(_.target.value),disabled:o,required:!0,minLength:6})]}),e.jsx("button",{type:"submit",className:"verify-email-submit-btn",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),"Verifying..."]}):"Verify & Set Password"})]}):e.jsx("div",{className:"verify-email-error",children:e.jsx("p",{children:"Invalid verification link. Please check your email and try again."})})]})})};const lu=()=>{const[t,s]=c.useState(""),[r,a]=c.useState(!1),[i,o]=c.useState(null),[n,u]=c.useState(!1),m=async f=>{f.preventDefault(),o(null);const k=(t||"").trim().toLowerCase();if(!k||!k.includes("@")){o({type:"error",text:"Please enter a valid email address."});return}try{a(!0);const M=await fetch(`${Jt()}/api/auth/request-set-password`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:k})}),h=await M.json().catch(()=>({}));if(!M.ok){o({type:"error",text:h.error||"Something went wrong. Please try again."});return}u(!0),o({type:"success",text:h.message||"If an account exists with that email, we sent a link to set your password. Check your inbox."})}catch{o({type:"error",text:"Could not reach the server. Please try again."})}finally{a(!1)}};return e.jsx("div",{className:"request-set-password-page",children:e.jsxs("div",{className:"request-set-password-card",children:[e.jsxs("div",{className:"request-set-password-header",children:[e.jsx("div",{className:"request-set-password-logo",children:"üéØ"}),e.jsx("h2",{className:"request-set-password-title",children:"Set your password"}),e.jsx("p",{className:"request-set-password-subtitle",children:"Enter the email for your ScreenMerch account. We‚Äôll send you a link to set or reset your password (valid for 24 hours)."})]}),i&&e.jsx("div",{className:`request-set-password-alert ${i.type==="error"?"request-set-password-alert-error":"request-set-password-alert-success"}`,role:"alert",children:i.text}),n?null:e.jsxs("form",{className:"request-set-password-form",onSubmit:m,noValidate:!0,children:[e.jsxs("div",{className:"request-set-password-field",children:[e.jsx("label",{htmlFor:"request-set-password-email",className:"request-set-password-label",children:"Email address"}),e.jsx("input",{id:"request-set-password-email",type:"email",className:"request-set-password-input",placeholder:"you@example.com",autoComplete:"email",value:t,onChange:f=>s(f.target.value),disabled:r})]}),e.jsx("button",{type:"submit",className:"request-set-password-submit",disabled:r,children:r?"Sending‚Ä¶":"Send set-password link"})]}),e.jsx("div",{className:"request-set-password-footer",children:e.jsx(mt,{to:"/login",className:"request-set-password-link",children:"Back to sign in"})})]})})};const cu=()=>{const[t,s]=Et(),[r,a]=c.useState(!1);return c.useEffect(()=>{t.get("existing_pending")==="1"&&(a(!0),t.delete("existing_pending"),s(t,{replace:!0}))},[]),e.jsxs("div",{className:"creator-thank-you",children:[r&&e.jsx("div",{className:"creator-thank-you-modal-overlay",onClick:()=>a(!1),children:e.jsxs("div",{className:"creator-thank-you-modal",onClick:i=>i.stopPropagation(),children:[e.jsx("div",{className:"creator-thank-you-modal-icon",children:"‚ÑπÔ∏è"}),e.jsx("h2",{children:"This email is already registered"}),e.jsxs("p",{children:["This email address is already registered and is ",e.jsx("strong",{children:"awaiting approval"}),". You do not need to sign up again. We will notify you once your account is approved."]}),e.jsx("button",{type:"button",className:"creator-thank-you-modal-btn",onClick:()=>a(!1),children:"OK"})]})}),e.jsxs("div",{className:"creator-thank-you-card",children:[e.jsx("div",{className:"creator-thank-you-icon",children:"‚úì"}),e.jsx("h1",{children:"Thank you for signing up!"}),e.jsx("p",{className:"creator-thank-you-message",children:"Your creator account has been submitted successfully. Our team will review your application and approve your account shortly. You‚Äôll receive an email at the address you signed up with once your account is approved."}),e.jsx("p",{className:"creator-thank-you-note",children:"In the meantime, feel free to explore ScreenMerch and see how creators like you are earning from their content."}),e.jsx(mt,{to:"/subscription-tiers",className:"creator-thank-you-btn",children:"Back to Creator Calculator"}),e.jsx(mt,{to:"/",className:"creator-thank-you-link",onClick:()=>{try{sessionStorage.setItem("creator_thank_you_go_home","1")}catch{}a(!1)},children:"Go to Homepage"})]})]})},du=()=>{const[t,s]=c.useState(!1),[r,a]=c.useState(0),[i,o]=c.useState(null),[n,u]=c.useState("All"),[m,f]=c.useState(!1),k=()=>u("All"),M=hs(),h=ct(),v=c.useRef(!1);c.useEffect(()=>{const b=()=>{f(window.innerWidth<=900)};return b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]),c.useEffect(()=>{var A;const b=new URLSearchParams(M.search),x=b.get("login"),T=b.get("user"),S=b.get("message");if(console.log("[THANKYOU] OAuth effect run",{pathname:M.pathname,search:(A=M.search)==null?void 0:A.slice(0,80),loginStatus:x,hasUserData:!!T,alreadyProcessed:v.current}),x==="success"){if(v.current){console.log("[THANKYOU] Already processed ‚Äî checking if we need to send back to thank-you");const E=localStorage.getItem("user");if(E)try{const z=JSON.parse(E);(z==null?void 0:z.role)==="creator"&&((z==null?void 0:z.status)==="pending"||(z==null?void 0:z.status)===void 0)&&M.pathname!=="/creator-thank-you"&&(console.log("[THANKYOU] Redirecting to /creator-thank-you (already-processed path)"),h("/creator-thank-you",{replace:!0}))}catch{}return}if(localStorage.removeItem("user"),localStorage.removeItem("isAuthenticated"),localStorage.removeItem("oauth_confirmation_pending"),localStorage.removeItem("customer_authenticated"),localStorage.removeItem("customer_user"),localStorage.removeItem("user_authenticated"),localStorage.removeItem("user_email"),!T){console.error("OAuth success but no user data in URL"),alert("Login successful but session data was missing. Please sign in again."),h("/",{replace:!0});return}try{const E=JSON.parse(decodeURIComponent(T));if(!E||!E.email){console.error("OAuth user data invalid:",E),alert("Login successful but your data was invalid. Please sign in again."),h("/",{replace:!0});return}console.log("üéâ Google OAuth successful! User:",E.email,E.display_name),v.current=!0,localStorage.setItem("user",JSON.stringify(E)),localStorage.setItem("isAuthenticated","true"),console.log("‚úÖ User auto-signed in via OAuth"),window.dispatchEvent(new CustomEvent("oauthSuccess",{detail:E}));const z=E.role==="creator"&&(E.status==="pending"||E.status===void 0),V=M.pathname==="/creator-thank-you",X=z&&!V?"/creator-thank-you":M.pathname||"/";h(X,{replace:!0})}catch(E){console.error("[THANKYOU] Error parsing user data -> navigate(/)",E),alert("Login successful but there was an error processing your data. Please sign in again."),h("/",{replace:!0})}}else x==="error"&&(console.error("[THANKYOU] OAuth error -> navigate(/)",S),localStorage.removeItem("oauth_confirmation_pending"),alert(`Login failed: ${S||"An unknown error occurred. Please try again."}`),h("/",{replace:!0}));b.get("clear")==="true"&&(localStorage.removeItem("user"),localStorage.removeItem("isAuthenticated"),localStorage.removeItem("oauth_confirmation_pending"),localStorage.removeItem("customer_authenticated"),localStorage.removeItem("customer_user"),localStorage.removeItem("user_authenticated"),localStorage.removeItem("user_email"),window.supabase&&window.supabase.auth.signOut(),console.log("[THANKYOU] clear=true -> navigate(/)"),h("/",{replace:!0}))},[M.search,h]),c.useEffect(()=>{if(M.pathname!=="/")return;if(typeof sessionStorage<"u"&&sessionStorage.getItem("creator_thank_you_go_home")){sessionStorage.removeItem("creator_thank_you_go_home"),localStorage.removeItem("user"),localStorage.removeItem("isAuthenticated"),localStorage.removeItem("oauth_confirmation_pending"),v.current=!1,window.dispatchEvent(new CustomEvent("creatorThankYouSignOut"));return}if(typeof sessionStorage<"u"&&sessionStorage.getItem("from_password_set")){sessionStorage.removeItem("from_password_set");return}const b=localStorage.getItem("user"),x=localStorage.getItem("isAuthenticated")==="true";if(console.log("[THANKYOU] On path / ‚Äî safety net check",{hasUser:!!b,isAuth:x}),!(!x||!b))try{const T=JSON.parse(b);(T==null?void 0:T.role)==="creator"&&((T==null?void 0:T.status)==="pending"||(T==null?void 0:T.status)===void 0)&&(console.log("[THANKYOU] Safety net: redirecting / -> /creator-thank-you"),h("/creator-thank-you",{replace:!0}))}catch{}},[M.pathname,h]),c.useEffect(()=>{(async()=>{const x=M.pathname.match(/^\/profile\/(.+)$/);if(x){const T=x[1];try{const S=await fetch(`${ze.ENDPOINTS.USER_SUBSCRIPTION}/${T}/subscription`);if(S.ok){const A=await S.json();o(A)}else o({isThirdTier:!1})}catch(S){console.error("Error fetching subscription data:",S),o({isThirdTier:!1})}}else o(null)})()},[M.pathname]);const _=t&&!(i!=null&&i.isThirdTier);return console.log("üöÄ App.jsx rendering - current path:",M.pathname),e.jsx(bd,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsx(go,{setSidebar:s,resetCategory:k}),e.jsxs("div",{style:{display:"flex",flex:1},children:[_&&e.jsx(Md,{sidebar:t,category:r,setCategory:a}),t&&m&&e.jsx("div",{className:"mobile-sidebar-backdrop",onClick:()=>s(!1),style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999,display:"block"}}),e.jsxs("div",{className:"main-content-area",style:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{flex:1},children:e.jsxs(Hi,{children:[e.jsx(et,{path:"/",element:e.jsx(_d,{sidebar:t,category:r,selectedCategory:n,setSelectedCategory:u})}),e.jsx(et,{path:"/video/:categoryId/:videoId",element:e.jsx(kd,{sidebar:t})}),e.jsx(et,{path:"/upload",element:e.jsx(Cd,{sidebar:t})}),e.jsx(et,{path:"/profile/:username",element:e.jsx(Pd,{sidebar:t})}),e.jsx(et,{path:"/approve-subscription",element:e.jsx(Ad,{})}),e.jsx(et,{path:"/dashboard",element:e.jsx(Id,{sidebar:t})}),e.jsx(et,{path:"/subscription-tiers",element:e.jsx(Td,{})}),e.jsx(et,{path:"/subscription-success",element:e.jsx(Ud,{})}),e.jsx(et,{path:"/success",element:e.jsx(Pa,{})}),e.jsx(et,{path:"/order-success",element:e.jsx(Pa,{})}),e.jsx(et,{path:"/coming-soon",element:e.jsx(Dd,{})}),e.jsx(et,{path:"/admin",element:e.jsx(Od,{})}),e.jsx(et,{path:"/auth",element:e.jsx(Bd,{})}),e.jsx(et,{path:"/login",element:e.jsx(Aa,{})}),e.jsx(et,{path:"/signup",element:e.jsx(Aa,{})}),e.jsx(et,{path:"/privacy-policy",element:e.jsx(zd,{})}),e.jsx(et,{path:"/terms-of-service",element:e.jsx(Wd,{})}),e.jsx(et,{path:"/search",element:e.jsx(Yd,{})}),e.jsx(et,{path:"/channel/:channelName",element:e.jsx(Hd,{})}),e.jsx(et,{path:"/merchandise",element:e.jsx(Xd,{sidebar:t})}),e.jsx(et,{path:"/product/browse",element:e.jsx(Ia,{sidebar:t})}),e.jsx(et,{path:"/product/:productId",element:e.jsx(Ia,{sidebar:t})}),e.jsx(et,{path:"/test-crop-tool",element:e.jsx(tu,{})}),e.jsx(et,{path:"/payment-portal",element:e.jsx(ru,{})}),e.jsx(et,{path:"/checkout",element:e.jsx(au,{})}),e.jsx(et,{path:"/payment-setup",element:e.jsx(iu,{})}),e.jsx(et,{path:"/tools",element:e.jsx(Pi,{})}),e.jsx(et,{path:"/verify-email",element:e.jsx(nu,{})}),e.jsx(et,{path:"/set-password",element:e.jsx(lu,{})}),e.jsx(et,{path:"/creator-thank-you",element:e.jsx(cu,{})})]})}),e.jsx(fo,{})]})]})]})})};console.log("Cache busted - FORCING API CONFIG OVERRIDE");console.log("Timestamp:",new Date().toISOString());console.log("Build ID:",Math.random().toString(36).substring(7));console.log("üîß FORCING BACKEND URL TO: https://screenmerch.fly.dev");Ar.createRoot(document.getElementById("root")).render(e.jsx(Xi.StrictMode,{children:e.jsx(Gi,{children:e.jsx(du,{})})}));

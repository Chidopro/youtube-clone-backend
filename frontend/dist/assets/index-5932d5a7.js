import{r as c,a as ya,u as Oe,L as Ve,b as $t,N as wa,d as yt,e as zt,R as ja,f as Ie,h as Sa,B as ba}from"./vendor-86b923c5.js";import{c as _a}from"./supabase-0ee22f2c.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}})();var yr={exports:{}},as={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Na=c,Ca=Symbol.for("react.element"),ka=Symbol.for("react.fragment"),Pa=Object.prototype.hasOwnProperty,Ta=Na.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Aa={key:!0,ref:!0,__self:!0,__source:!0};function wr(t,s,r){var a,i={},n=null,l=null;r!==void 0&&(n=""+r),s.key!==void 0&&(n=""+s.key),s.ref!==void 0&&(l=s.ref);for(a in s)Pa.call(s,a)&&!Aa.hasOwnProperty(a)&&(i[a]=s[a]);if(t&&t.defaultProps)for(a in s=t.defaultProps,s)i[a]===void 0&&(i[a]=s[a]);return{$$typeof:Ca,type:t,key:n,ref:l,props:i,_owner:Ta.current}}as.Fragment=ka;as.jsx=wr;as.jsxs=wr;yr.exports=as;var e=yr.exports,ks={},lr=ya;ks.createRoot=lr.createRoot,ks.hydrateRoot=lr.hydrateRoot;const Ea="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAhCAYAAABN2CLhAAAAAXNSR0IArs4c6QAAARhJREFUWAntWNENgjAQpYYBdAM3EDZgA9lAnMC4ARs4AnWDuoEbqBt0BNjA9z5M+kNaI8WS3CWXUO64vr42uUdV0zRVlmUXeAFP2SzAGa31WQH0A4PUAbtkliuMNu6bBTwXBG0WANSFaBRHOCI8HrUbSfDZAhPPdJ8gNoEkDAgDwoAwsHQGKJi2WMQJzq74L+uVUqbrumsIAII2SNyHJM+QU6JNP33zUDBVvqQZ43XIXKmpPO6613JktHBuSdAqkRfDLIpSwRGHmDAgDAgDwoAwMD8Dn3sPdsPdBNP3qHFDZ7MT1BotkUPlaUQPoxnfB1p8EvWqjYJpas2xBhEV6kYzgr5HqB5V+BB0C+cfwwD/1V4ocIx93/YG6YM08g0WFTYAAAAASUVORK5CYII=",is="/assets/screenmerch_logo.png-13fa081f.png",Ia="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAYCAYAAAARfGZ1AAAAAXNSR0IArs4c6QAAAh5JREFUSA2tlDFP60AMx0m6doCJkZGxfRIDEwoDAxNlKSuv6ohE+QCIdGOEiaGVyjcARrYgsTd8kac3MLf8fLWPS0hRW9WSY5/v778dXy7RxhwZjUYtthpogjZRkRzNptNp3ul0Xlzkl0dU3oNUiEaoEZYhtpZCfxGxlRKHUYhT1mO0SXcf2D56iG6pit/XPSk+JucGWym+cyU24D0d9SozCILdxKToJSpyBf5u5n4/HTlg14WGTwE+f0Pme+S12H1SxJ/yiNxYeM1HBUjHCxELXrH3mivnVJBYqkdR1JA5Au4VdhdbpHYG+iY+SzpvyooCC3fss3Fo6H+Q67hsP6ZqoovMgitYlxtwOQrfOat8BVJLcbkyXguILXzn4cYqPp37T9vIrePCvJYkt1zjcukxr5IpUaJ2FeNyAy7HIWOxaid8SpvLMmvOieYZ14xcLoJ9p0RSBS1jJMf9i/RS+Vx3oLzOuUYuyxfBIyscxbr/S8Dhkf50AaZE7cd1h9+XC+KRgaOjEGxPw1dgJacgnlyipQI5IRlZRlfy+93Ab+AnuC20iYrcEt+bTCZn3W733yw0exbIJUQBmd8jJIULESaJD+ZDR/HAcp/1uF6vH7Tb7U/D/iC3DYq47khKiFmXOYQZ69wObzgc7sRx/EZ8B+w7BY6twFxyCBYWLfBKgd2wwFrIpYvBYLBdq9XkDVwB7NHayCsKXK+VPChwwezTL5f411qp3J6CAAAAAElFTkSuQmCC",cr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAAXNSR0IArs4c6QAAAidJREFUaAXtmN1NwzAQx++SSuWNVPAOGxBASOWJbAAjdISyAWzABu0mLU8UISAjtO9IgQFic1fJUWi+HLBaB9kPdXK+2P79a+cuBnDFKeAUcAo4BZwCToH/owAqlCQMg7TvTxBkBIiBsm+zlgBzP01vBy9x3HZcTz1AEFNEuNkVBM+DVI2E581YVDWvqpp9kmF4rNozEIK4Vsad1rwa9iCsmwNDiL4/I59j5ZeBKIPtdQaBP2E7BVIFweL3TPwDB4vX7KWh+vsYns0R8Erd/7Wug+C+O/GPNEF0AkQHwnoQXQirQdpAMIiRzc4dmSyp8APsw4wiZG08yY9pJQiinLTNMDRB5IryoGVegaZrlBBL+ikrZA5ooidlbWvbL3I9TRCYHi7e7ioHLmk4eH4bl5jXJsqRIgE+pxjGSifiiA6tA9FRaZs+unvkKLk8rcybBk/vj5uTTi7CEHq4v2nneyG8E/74MFk0QXAkJI5qBi5MK/W9B5QVSWPBu6ZnzSY794iUtyDhS5Nh7WYliIci9kQatYGxEoQl5gOINjDWgrSFsRqkDYz1ILowmq9f7q66fAzPC3kTSmk0VvCeodhE517+nGJQIT4ZAaGwEBUw6aDMdKmD6cTSygtS9TbLgchV/oEdXy/rxs9gUvhUftnSkgLHtBqmZetPOW+nlveDRbxsGoth8j4/FjJ/8Dedu+YfNn5NCm9O0PgYrkOngFPAKeAUcAr8ZwW+ASU7qyTOpG88AAAAAElFTkSuQmCC";const Ma={development:{API_BASE_URL:"http://127.0.0.1:5000",EMAIL_API_URL:"http://localhost:3001",SUBSCRIPTION_API_URL:"http://localhost:3002",SUPABASE_URL:"https://sojxbydpcdcdzfdtbypd.supabase.co",SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no"},production:{API_BASE_URL:"https://screenmerch.fly.dev",EMAIL_API_URL:"https://screenmerch.fly.dev",SUBSCRIPTION_API_URL:"https://screenmerch.fly.dev",SUPABASE_URL:"https://sojxbydpcdcdzfdtbypd.supabase.co",SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no"}},Fe=Ma.production;console.log("üîß USING PRODUCTION API BASE URL:",Fe.API_BASE_URL),console.log("üîß Backend URL:",Fe.API_BASE_URL);const Me={BASE_URL:Fe.API_BASE_URL,EMAIL_API_URL:Fe.EMAIL_API_URL,SUBSCRIPTION_API_URL:Fe.SUBSCRIPTION_API_URL,SUPABASE_URL:Fe.SUPABASE_URL,SUPABASE_ANON_KEY:Fe.SUPABASE_ANON_KEY,ENDPOINTS:{CREATE_PRODUCT:`${Fe.API_BASE_URL}/api/create-product`,CALCULATE_SHIPPING:`${Fe.API_BASE_URL}/api/calculate-shipping`,PLACE_ORDER:`${Fe.API_BASE_URL}/api/place-order`,CREATE_CHECKOUT_SESSION:`${Fe.API_BASE_URL}/api/create-checkout-session`,SEND_SUBSCRIPTION_EMAIL:`${Fe.EMAIL_API_URL}/api/send-subscription-email`,VERIFY_SUBSCRIPTION:`${Fe.SUBSCRIPTION_API_URL}/api/verify-subscription`,USER_SUBSCRIPTION:`${Fe.SUBSCRIPTION_API_URL}/api/users`,CAPTURE_SCREENSHOT:`${Fe.API_BASE_URL}/api/capture-screenshot`,CAPTURE_PRINT_QUALITY:`${Fe.API_BASE_URL}/api/capture-print-quality`,CAPTURE_MULTIPLE_SCREENSHOTS:`${Fe.API_BASE_URL}/api/capture-multiple-screenshots`,VIDEO_INFO:`${Fe.API_BASE_URL}/api/video-info`}},Ua=({isOpen:t,onClose:s})=>{const[r,a]=c.useState(""),[i,n]=c.useState(!1),[l,h]=c.useState(""),[v,S]=c.useState(""),b=async _=>{if(_.preventDefault(),!r){h("Please enter a valid email address"),S("error");return}n(!0),h("");try{const m=await fetch(Me.ENDPOINTS.SEND_SUBSCRIPTION_EMAIL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r})}),x=await m.json();if(m.ok)h(`Subscription email sent to ${r}! Please check your inbox for approval link.`),S("success"),a(""),setTimeout(()=>{s(),h("")},3e3);else throw new Error(x.error||"Failed to send email")}catch(m){console.error("Error:",m),m.message.includes("fetch")?h("Backend server is not running. Please start the backend server first."):h(`Failed to send email: ${m.message}`),S("error")}finally{n(!1)}};return t?e.jsx("div",{className:"modal-overlay",onClick:s,children:e.jsxs("div",{className:"modal-content",onClick:_=>_.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Subscribe to ScreenMerch"}),e.jsx("button",{className:"close-btn",onClick:s,children:"√ó"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("p",{children:"Enter your email to receive a subscription approval link:"}),e.jsxs("form",{onSubmit:b,children:[e.jsx("div",{className:"email-input-group",children:e.jsx("input",{type:"email",value:r,onChange:_=>a(_.target.value),placeholder:"Enter your email address",required:!0,disabled:i})}),l&&e.jsx("div",{className:`message ${v}`,children:l}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:s,disabled:i,children:"Cancel"}),e.jsx("button",{type:"submit",className:"subscribe-modal-btn",disabled:i,children:i?"Sending...":"Send Approval Link"})]})]})]})]})}):null},Da=Me.SUPABASE_URL,Ra=Me.SUPABASE_ANON_KEY,R=_a(Da,Ra,{auth:{redirectTo:window.location.origin}});typeof window<"u"&&(window.supabase=R,window.__SUPABASE__=R);console.log("VITE ENV:",{VITE_API_BASE_URL:"https://screenmerch.fly.dev",VITE_SUPABASE_URL:"https://sojxbydpcdcdzfdtbypd.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no",VITE_API_URL:"https://screenmerch.fly.dev",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1});class Oa{static async getCurrentUserProfile(){try{const{data:{user:s}}=await R.auth.getUser();if(!s)return null;const{data:r,error:a}=await R.from("users").select("*").eq("id",s.id).single();return a?(console.error("Error fetching user profile:",a),null):r}catch(s){return console.error("Error in getCurrentUserProfile:",s),null}}static async upsertUserProfile(s){try{const{data:{user:r}}=await R.auth.getUser();if(!r)throw new Error("No authenticated user");const a={id:r.id,email:r.email,role:"creator",...s,updated_at:new Date().toISOString()},{data:i,error:n}=await R.from("users").upsert(a,{onConflict:"id",ignoreDuplicates:!1}).select().single();return n?(console.error("Error upserting user profile:",n),null):i}catch(r){return console.error("Error in upsertUserProfile:",r),null}}static async updateUserProfile(s){try{const{data:{user:r}}=await R.auth.getUser();if(!r)throw new Error("No authenticated user");const{data:a,error:i}=await R.from("users").update(s).eq("id",r.id).select().single();return i?(console.error("Error updating user profile:",i),null):a}catch(r){return console.error("Error in updateUserProfile:",r),null}}static async getUserProfileById(s){try{const{data:r,error:a}=await R.from("users").select("id, display_name, profile_image_url, cover_image_url, bio, created_at").eq("id",s).single();return a?(console.error("Error fetching user profile by ID:",a),null):r}catch(r){return console.error("Error in getUserProfileById:",r),null}}static async uploadProfileImage(s,r="profile-images"){try{const{data:{user:a}}=await R.auth.getUser();if(!a)throw new Error("No authenticated user");const i=s.name.split(".").pop(),n=`${a.id}-${Date.now()}.${i}`,l=`${r}/${n}`,{data:h,error:v}=await R.storage.from("profile-images").upload(l,s);if(v)return console.error("Error uploading profile image:",v),null;const{data:{publicUrl:S}}=R.storage.from("profile-images").getPublicUrl(l);return S}catch(a){return console.error("Error in uploadProfileImage:",a),null}}static async deleteProfileImage(s){try{const r=s.split("/"),i=`profile-images/${r[r.length-1]}`,{error:n}=await R.storage.from("profile-images").remove([i]);return n?(console.error("Error deleting profile image:",n),!1):!0}catch(r){return console.error("Error in deleteProfileImage:",r),!1}}static async deleteUserAccount(){try{const{data:{user:s}}=await R.auth.getUser();if(!s)return{success:!1,error:"No authenticated user found"};const r=await fetch(`https://screenmerch.fly.dev/api/users/${s.id}/delete-account`,{method:"DELETE",headers:{"Content-Type":"application/json"}});return r.ok?await r.json():{success:!1,error:(await r.json()).error||"Failed to delete account"}}catch(s){return console.error("Error in deleteUserAccount:",s),{success:!1,error:s.message}}}}const{getCurrentUserProfile:Ec,upsertUserProfile:La,updateUserProfile:Ic,getUserProfileById:Mc,uploadProfileImage:Uc,deleteProfileImage:Dc,deleteUserAccount:Ya}=Oa,Fa=({setSidebar:t,resetCategory:s})=>{var X,z,B;const[r,a]=c.useState(!1),[i,n]=c.useState(null),[l,h]=c.useState(null),[v,S]=c.useState(null),[b,_]=c.useState(!0),[m,x]=c.useState(!1),[C,M]=c.useState(!1),[y,L]=c.useState(""),Y=Oe();c.useEffect(()=>{let u=!0;const p=f=>{var g,T,d;console.log("üì° Navbar received oauthSuccess event:",f.detail),console.log("üì° OAuth user picture:",(g=f.detail)==null?void 0:g.picture),console.log("üì° OAuth user metadata picture:",(d=(T=f.detail)==null?void 0:T.user_metadata)==null?void 0:d.picture),u&&(n(f.detail),_(!1),M(!1),console.log("üîÑ Navbar state updated from OAuth event"),setTimeout(()=>{u&&(console.log("üîÑ Forcing Navbar re-render after OAuth (1st attempt)"),n(w=>({...w,...f.detail})))},50),setTimeout(()=>{u&&(console.log("üîÑ Forcing Navbar re-render after OAuth (2nd attempt)"),n(f.detail))},200))};window.addEventListener("oauthSuccess",p);const N=async()=>{var f,g,T;try{let d=localStorage.getItem("oauth_confirmation_pending");if(d==="true"){console.log("üîê OAuth confirmation pending, waiting..."),M(!0);let ae=0;for(;d==="true"&&ae<50;)await new Promise(we=>setTimeout(we,100)),d=localStorage.getItem("oauth_confirmation_pending"),ae++;console.log("üîê OAuth processing completed or timeout reached"),M(!1)}await new Promise(ae=>setTimeout(ae,200));const w=localStorage.getItem("isAuthenticated"),P=localStorage.getItem("user");if(w==="true"&&P)try{const ae=JSON.parse(P);if(console.log("üîê Found Google OAuth user (creator):",ae),console.log("üîê User picture URL:",ae==null?void 0:ae.picture),console.log("üîê Setting user state in Navbar..."),u){n(ae),console.log("üîê User state set in Navbar:",ae);const{data:we,error:fe}=await R.from("users").select("*").eq("id",ae.id).single();we?(console.log("üîê Found user profile:",we),h(we)):console.log("üîê No user profile found:",fe)}}catch(ae){console.error("Error parsing Google OAuth user data:",ae)}else console.log("üîê No Google OAuth user found. isAuthenticated:",w,"userData:",P);const Q=localStorage.getItem("customer_authenticated"),me=localStorage.getItem("customer_user");if(Q==="true"&&me)try{const ae=JSON.parse(me);console.log("üõí Found customer user:",ae),u&&S(ae)}catch(ae){console.error("Error parsing customer user data:",ae)}if(u&&_(!1),!w||!P){console.log("üîê No Google OAuth user found, checking Supabase auth...");const ae=R.auth.getUser(),we=new Promise((Se,Ce)=>setTimeout(()=>Ce(new Error("Auth timeout")),5e3)),{data:{user:fe}}=await Promise.race([ae,we]);if(u&&(console.log("üîê Supabase auth result:",fe),n(fe),_(!1),fe)){const Se={id:fe.id,username:((g=(f=fe.user_metadata)==null?void 0:f.name)==null?void 0:g.replace(/\s+/g,"").toLowerCase())||fe.email,display_name:((T=fe.user_metadata)==null?void 0:T.name)||fe.email,email:fe.email};console.log("Upserting user profile with:",Se),La(Se).catch(Ce=>console.error("Upsert error:",Ce))}}else console.log("üîê Google OAuth user found, skipping Supabase auth check")}catch(d){console.error("Auth fetch error:",d),u&&(n(null),_(!1))}};N();let j;const{data:{subscription:o}}=R.auth.onAuthStateChange((f,g)=>{j&&clearTimeout(j),j=setTimeout(()=>{if(u){const T=localStorage.getItem("isAuthenticated"),d=localStorage.getItem("user");console.log("üîÑ Auth state change detected:",f,"Google OAuth user exists:",!!(T&&d)),!T||!d?(console.log("üîÑ No Google OAuth user, refetching from Supabase..."),N()):console.log("üîÑ Google OAuth user exists, skipping Supabase refetch")}},100)});return()=>{u=!1,window.removeEventListener("oauthSuccess",p),j&&clearTimeout(j),o.unsubscribe()}},[]),c.useEffect(()=>{const u=N=>{m&&!N.target.closest(".user-profile-container")&&x(!1)},p=N=>{N.key==="Escape"&&m&&x(!1)};return document.addEventListener("click",u),document.addEventListener("keydown",p),()=>{document.removeEventListener("click",u),document.removeEventListener("keydown",p)}},[m]);const J=()=>{const u=`https://screenmerch.fly.dev/api/auth/google/login?return_url=${encodeURIComponent(window.location.href)}`;console.log("Redirecting to:",u),window.location.href=u},F=async()=>{try{localStorage.removeItem("user"),localStorage.removeItem("isAuthenticated"),localStorage.removeItem("oauth_confirmation_pending"),localStorage.removeItem("customer_authenticated"),localStorage.removeItem("customer_user"),localStorage.removeItem("user_authenticated"),localStorage.removeItem("user_email"),await R.auth.signOut(),n(null),S(null),console.log("‚úÖ Logged out successfully - all auth data cleared"),Y("/")}catch(u){console.error("Logout error:",u)}},H=async()=>{if(window.confirm("Are you sure you want to delete your account? This action cannot be undone."))try{const u=await Ya();u.success?(await R.auth.signOut(),n(null),Y("/"),alert("Your account has been successfully deleted."),window.location.reload()):alert(`Failed to delete account: ${u.error||"Unknown error"}`)}catch(u){console.error("Error deleting account:",u),alert("There was an error deleting your account. Please try again or contact support.")}},K=()=>{Y("/subscription-tiers")},O=()=>{a(!1)},re=()=>{y.trim()&&Y(`/search?q=${encodeURIComponent(y.trim())}`)},Z=u=>{u.key==="Enter"&&re()};return e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"flex-div",children:[e.jsxs("div",{className:"nav-left flex-div",children:[e.jsx("img",{src:Ea,alt:"Menu",className:"menu-icon",onClick:()=>t(u=>!u),onTouchStart:u=>{u.preventDefault(),u.stopPropagation(),t(p=>!p)},style:{touchAction:"manipulation",WebkitTapHighlightColor:"transparent"}}),e.jsxs(Ve,{to:"/",onClick:()=>{s(),L("")},children:[" ",e.jsx("img",{src:is,alt:"",className:"logo"})]})]}),e.jsxs("div",{className:"nav-center-right flex-div",children:[e.jsx("div",{className:"nav-middle flex-div",children:e.jsxs("div",{className:"search-box flex-div",children:[e.jsx("input",{type:"text",placeholder:"Search channels",value:y,onChange:u=>L(u.target.value),onKeyPress:Z}),e.jsx("img",{src:Ia,alt:"",onClick:re,style:{cursor:"pointer"}})]})}),e.jsxs("div",{className:"nav-right flex-div",children:[i?console.log("üé• Rendering upload link for user:",i==null?void 0:i.display_name,"User object:",i)||e.jsx(Ve,{to:"/upload",children:e.jsx("img",{src:cr,alt:"Upload"})}):C?console.log("üé• OAuth processing - hiding upload button")||e.jsx("div",{style:{width:"24px",height:"24px"}}):console.log("üé• Rendering upload link - no user, user state:",i,"loading:",b)||e.jsx(Ve,{to:"/upload",children:e.jsx("img",{src:cr,alt:"Upload",style:{cursor:"pointer"},title:"Upload videos"})}),b?e.jsx("div",{className:"loading-spinner-navbar"}):i?e.jsxs(e.Fragment,{children:[console.log("üé® Rendering user profile for:",(i==null?void 0:i.display_name)||((X=i==null?void 0:i.user_metadata)==null?void 0:X.name)),console.log("üîç Full user object:",i),e.jsx("button",{className:"subscribe-btn",onClick:K,children:"Start Free"}),e.jsxs("div",{className:"user-profile-container",children:[e.jsx("img",{className:"user-profile",src:(()=>{var p,N,j;const u=(l==null?void 0:l.profile_image_url)||((p=i==null?void 0:i.user_metadata)==null?void 0:p.picture)||"/default-avatar.svg";return console.log("üñºÔ∏è Profile image URL:",u),console.log("üñºÔ∏è User metadata picture:",(N=i==null?void 0:i.user_metadata)==null?void 0:N.picture),console.log("üñºÔ∏è User picture:",i==null?void 0:i.picture),console.log("üñºÔ∏è YouTube channel thumbnail:",(j=i==null?void 0:i.youtube_channel)==null?void 0:j.thumbnail),console.log("üñºÔ∏è Avatar URL:",i==null?void 0:i.avatar_url),u})(),alt:((z=i==null?void 0:i.user_metadata)==null?void 0:z.name)||(i==null?void 0:i.display_name)||(i==null?void 0:i.name)||"User",onClick:u=>{u.preventDefault(),u.stopPropagation(),x(!m)},style:{cursor:"pointer"},onError:u=>{var p,N;u.target.dataset.fallbackUsed||(console.log("üñºÔ∏è Image failed to load!"),console.log("üñºÔ∏è Failed URL:",u.target.src),u.target.src!==((p=i==null?void 0:i.youtube_channel)==null?void 0:p.thumbnail)?(console.log("üñºÔ∏è Trying YouTube thumbnail..."),u.target.dataset.fallbackUsed="true",u.target.src=((N=i==null?void 0:i.youtube_channel)==null?void 0:N.thumbnail)||"/default-avatar.svg"):(console.log("üñºÔ∏è Using default avatar"),u.target.dataset.fallbackUsed="true",u.target.src="/default-avatar.svg"))},onLoad:u=>{console.log("üñºÔ∏è Profile image loaded successfully"),console.log("üñºÔ∏è Loaded image src:",u.target.src)}}),e.jsxs("div",{className:`user-dropdown ${m?"open":""}`,children:[e.jsxs("p",{children:["Signed in as ",e.jsx("strong",{children:((B=i==null?void 0:i.user_metadata)==null?void 0:B.name)||(i==null?void 0:i.display_name)})]}),e.jsx("hr",{}),e.jsx("button",{className:"dropdown-item",onClick:u=>{u.preventDefault(),u.stopPropagation(),console.log("üîó Navigating to Dashboard"),x(!1),Y("/dashboard")},style:{background:"none",border:"none",width:"100%",textAlign:"left",padding:"8px 16px",cursor:"pointer"},children:"Dashboard"}),e.jsx("button",{className:"dropdown-item",onClick:u=>{u.preventDefault(),u.stopPropagation(),console.log("üîó Navigating to Admin Portal"),x(!1),Y("/admin")},style:{background:"none",border:"none",width:"100%",textAlign:"left",padding:"8px 16px",cursor:"pointer"},children:"Admin Portal"}),e.jsx("button",{onClick:u=>{u.preventDefault(),u.stopPropagation(),x(!1),H()},className:"dropdown-item delete-account-btn",children:"Delete Account"}),e.jsx("button",{onClick:u=>{u.preventDefault(),u.stopPropagation(),x(!1),F()},style:{background:"none",border:"none",width:"100%",textAlign:"left",padding:"8px 16px",cursor:"pointer"},children:"Logout"})]})]})]}):C?e.jsx("div",{className:"sign-in-btn",style:{opacity:.5,cursor:"not-allowed"},children:"Processing..."}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"sign-in-btn",onClick:J,title:"Sign in with Google",children:"Sign In"}),e.jsx("button",{className:"subscribe-btn",onClick:K,children:"Start Free"})]})]})]})]}),e.jsx(Ua,{isOpen:r,onClose:O})]})};const $a=()=>e.jsx("footer",{className:"site-footer",children:e.jsx("div",{className:"footer-container",children:e.jsxs("div",{className:"footer-content",children:[e.jsx("div",{className:"footer-logo-section",children:e.jsx("img",{src:is,alt:"ScreenMerch",className:"footer-logo"})}),e.jsxs("div",{className:"footer-links-section",children:[e.jsx(Ve,{to:"/privacy-policy",children:"Privacy Policy"}),e.jsx(Ve,{to:"/terms-of-service",children:"Terms of Service"}),e.jsx("a",{href:"mailto:support@screenmerch.com",children:"Contact Us"})]}),e.jsx("div",{className:"footer-copyright",children:e.jsx("p",{children:"¬© 2025 ScreenMerch. All rights reserved."})})]})})});const za=t=>t>=1e6?Math.floor(t/1e6)+"M":t>=1e3?Math.floor(t/1e3)+"K":t;//! moment.js
//! version : 2.30.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
var jr;function ee(){return jr.apply(null,arguments)}function Ba(t){jr=t}function Qe(t){return t instanceof Array||Object.prototype.toString.call(t)==="[object Array]"}function St(t){return t!=null&&Object.prototype.toString.call(t)==="[object Object]"}function Pe(t,s){return Object.prototype.hasOwnProperty.call(t,s)}function Ds(t){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(t).length===0;var s;for(s in t)if(Pe(t,s))return!1;return!0}function We(t){return t===void 0}function mt(t){return typeof t=="number"||Object.prototype.toString.call(t)==="[object Number]"}function Bt(t){return t instanceof Date||Object.prototype.toString.call(t)==="[object Date]"}function Sr(t,s){var r=[],a,i=t.length;for(a=0;a<i;++a)r.push(s(t[a],a));return r}function ft(t,s){for(var r in s)Pe(s,r)&&(t[r]=s[r]);return Pe(s,"toString")&&(t.toString=s.toString),Pe(s,"valueOf")&&(t.valueOf=s.valueOf),t}function it(t,s,r,a){return Hr(t,s,r,a,!0).utc()}function Wa(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function ye(t){return t._pf==null&&(t._pf=Wa()),t._pf}var Ps;Array.prototype.some?Ps=Array.prototype.some:Ps=function(t){var s=Object(this),r=s.length>>>0,a;for(a=0;a<r;a++)if(a in s&&t.call(this,s[a],a,s))return!0;return!1};function Rs(t){var s=null,r=!1,a=t._d&&!isNaN(t._d.getTime());if(a&&(s=ye(t),r=Ps.call(s.parsedDateParts,function(i){return i!=null}),a=s.overflow<0&&!s.empty&&!s.invalidEra&&!s.invalidMonth&&!s.invalidWeekday&&!s.weekdayMismatch&&!s.nullInput&&!s.invalidFormat&&!s.userInvalidated&&(!s.meridiem||s.meridiem&&r),t._strict&&(a=a&&s.charsLeftOver===0&&s.unusedTokens.length===0&&s.bigHour===void 0)),Object.isFrozen==null||!Object.isFrozen(t))t._isValid=a;else return a;return t._isValid}function ns(t){var s=it(NaN);return t!=null?ft(ye(s),t):ye(s).userInvalidated=!0,s}var dr=ee.momentProperties=[],js=!1;function Os(t,s){var r,a,i,n=dr.length;if(We(s._isAMomentObject)||(t._isAMomentObject=s._isAMomentObject),We(s._i)||(t._i=s._i),We(s._f)||(t._f=s._f),We(s._l)||(t._l=s._l),We(s._strict)||(t._strict=s._strict),We(s._tzm)||(t._tzm=s._tzm),We(s._isUTC)||(t._isUTC=s._isUTC),We(s._offset)||(t._offset=s._offset),We(s._pf)||(t._pf=ye(s)),We(s._locale)||(t._locale=s._locale),n>0)for(r=0;r<n;r++)a=dr[r],i=s[a],We(i)||(t[a]=i);return t}function Wt(t){Os(this,t),this._d=new Date(t._d!=null?t._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),js===!1&&(js=!0,ee.updateOffset(this),js=!1)}function et(t){return t instanceof Wt||t!=null&&t._isAMomentObject!=null}function br(t){ee.suppressDeprecationWarnings===!1&&typeof console<"u"&&console.warn&&console.warn("Deprecation warning: "+t)}function Je(t,s){var r=!0;return ft(function(){if(ee.deprecationHandler!=null&&ee.deprecationHandler(null,t),r){var a=[],i,n,l,h=arguments.length;for(n=0;n<h;n++){if(i="",typeof arguments[n]=="object"){i+=`
[`+n+"] ";for(l in arguments[0])Pe(arguments[0],l)&&(i+=l+": "+arguments[0][l]+", ");i=i.slice(0,-2)}else i=arguments[n];a.push(i)}br(t+`
Arguments: `+Array.prototype.slice.call(a).join("")+`
`+new Error().stack),r=!1}return s.apply(this,arguments)},s)}var hr={};function _r(t,s){ee.deprecationHandler!=null&&ee.deprecationHandler(t,s),hr[t]||(br(s),hr[t]=!0)}ee.suppressDeprecationWarnings=!1;ee.deprecationHandler=null;function nt(t){return typeof Function<"u"&&t instanceof Function||Object.prototype.toString.call(t)==="[object Function]"}function Ha(t){var s,r;for(r in t)Pe(t,r)&&(s=t[r],nt(s)?this[r]=s:this["_"+r]=s);this._config=t,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function Ts(t,s){var r=ft({},t),a;for(a in s)Pe(s,a)&&(St(t[a])&&St(s[a])?(r[a]={},ft(r[a],t[a]),ft(r[a],s[a])):s[a]!=null?r[a]=s[a]:delete r[a]);for(a in t)Pe(t,a)&&!Pe(s,a)&&St(t[a])&&(r[a]=ft({},r[a]));return r}function Ls(t){t!=null&&this.set(t)}var As;Object.keys?As=Object.keys:As=function(t){var s,r=[];for(s in t)Pe(t,s)&&r.push(s);return r};var Va={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function Ga(t,s,r){var a=this._calendar[t]||this._calendar.sameElse;return nt(a)?a.call(s,r):a}function at(t,s,r){var a=""+Math.abs(t),i=s-a.length,n=t>=0;return(n?r?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+a}var Ys=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Gt=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Ss={},kt={};function he(t,s,r,a){var i=a;typeof a=="string"&&(i=function(){return this[a]()}),t&&(kt[t]=i),s&&(kt[s[0]]=function(){return at(i.apply(this,arguments),s[1],s[2])}),r&&(kt[r]=function(){return this.localeData().ordinal(i.apply(this,arguments),t)})}function qa(t){return t.match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function Ja(t){var s=t.match(Ys),r,a;for(r=0,a=s.length;r<a;r++)kt[s[r]]?s[r]=kt[s[r]]:s[r]=qa(s[r]);return function(i){var n="",l;for(l=0;l<a;l++)n+=nt(s[l])?s[l].call(i,t):s[l];return n}}function Jt(t,s){return t.isValid()?(s=Nr(s,t.localeData()),Ss[s]=Ss[s]||Ja(s),Ss[s](t)):t.localeData().invalidDate()}function Nr(t,s){var r=5;function a(i){return s.longDateFormat(i)||i}for(Gt.lastIndex=0;r>=0&&Gt.test(t);)t=t.replace(Gt,a),Gt.lastIndex=0,r-=1;return t}var Xa={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function Za(t){var s=this._longDateFormat[t],r=this._longDateFormat[t.toUpperCase()];return s||!r?s:(this._longDateFormat[t]=r.match(Ys).map(function(a){return a==="MMMM"||a==="MM"||a==="DD"||a==="dddd"?a.slice(1):a}).join(""),this._longDateFormat[t])}var Ka="Invalid date";function Qa(){return this._invalidDate}var ei="%d",ti=/\d{1,2}/;function si(t){return this._ordinal.replace("%d",t)}var ri={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function ai(t,s,r,a){var i=this._relativeTime[r];return nt(i)?i(t,s,r,a):i.replace(/%d/i,t)}function ii(t,s){var r=this._relativeTime[t>0?"future":"past"];return nt(r)?r(s):r.replace(/%s/i,s)}var ur={D:"date",dates:"date",date:"date",d:"day",days:"day",day:"day",e:"weekday",weekdays:"weekday",weekday:"weekday",E:"isoWeekday",isoweekdays:"isoWeekday",isoweekday:"isoWeekday",DDD:"dayOfYear",dayofyears:"dayOfYear",dayofyear:"dayOfYear",h:"hour",hours:"hour",hour:"hour",ms:"millisecond",milliseconds:"millisecond",millisecond:"millisecond",m:"minute",minutes:"minute",minute:"minute",M:"month",months:"month",month:"month",Q:"quarter",quarters:"quarter",quarter:"quarter",s:"second",seconds:"second",second:"second",gg:"weekYear",weekyears:"weekYear",weekyear:"weekYear",GG:"isoWeekYear",isoweekyears:"isoWeekYear",isoweekyear:"isoWeekYear",w:"week",weeks:"week",week:"week",W:"isoWeek",isoweeks:"isoWeek",isoweek:"isoWeek",y:"year",years:"year",year:"year"};function Xe(t){return typeof t=="string"?ur[t]||ur[t.toLowerCase()]:void 0}function Fs(t){var s={},r,a;for(a in t)Pe(t,a)&&(r=Xe(a),r&&(s[r]=t[a]));return s}var ni={date:9,day:11,weekday:11,isoWeekday:11,dayOfYear:4,hour:13,millisecond:16,minute:14,month:8,quarter:7,second:15,weekYear:1,isoWeekYear:1,week:5,isoWeek:5,year:1};function oi(t){var s=[],r;for(r in t)Pe(t,r)&&s.push({unit:r,priority:ni[r]});return s.sort(function(a,i){return a.priority-i.priority}),s}var Cr=/\d/,Ge=/\d\d/,kr=/\d{3}/,$s=/\d{4}/,os=/[+-]?\d{6}/,De=/\d\d?/,Pr=/\d\d\d\d?/,Tr=/\d\d\d\d\d\d?/,ls=/\d{1,3}/,zs=/\d{1,4}/,cs=/[+-]?\d{1,6}/,At=/\d+/,ds=/[+-]?\d+/,li=/Z|[+-]\d\d:?\d\d/gi,hs=/Z|[+-]\d\d(?::?\d\d)?/gi,ci=/[+-]?\d+(\.\d{1,3})?/,Ht=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Et=/^[1-9]\d?/,Bs=/^([1-9]\d|\d)/,Kt;Kt={};function ie(t,s,r){Kt[t]=nt(s)?s:function(a,i){return a&&r?r:s}}function di(t,s){return Pe(Kt,t)?Kt[t](s._strict,s._locale):new RegExp(hi(t))}function hi(t){return ht(t.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(s,r,a,i,n){return r||a||i||n}))}function ht(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function qe(t){return t<0?Math.ceil(t)||0:Math.floor(t)}function Ne(t){var s=+t,r=0;return s!==0&&isFinite(s)&&(r=qe(s)),r}var Es={};function Ee(t,s){var r,a=s,i;for(typeof t=="string"&&(t=[t]),mt(s)&&(a=function(n,l){l[s]=Ne(n)}),i=t.length,r=0;r<i;r++)Es[t[r]]=a}function Vt(t,s){Ee(t,function(r,a,i,n){i._w=i._w||{},s(r,i._w,i,n)})}function ui(t,s,r){s!=null&&Pe(Es,t)&&Es[t](s,r._a,r,t)}function us(t){return t%4===0&&t%100!==0||t%400===0}var Be=0,ct=1,rt=2,Ye=3,Ke=4,dt=5,jt=6,mi=7,pi=8;he("Y",0,0,function(){var t=this.year();return t<=9999?at(t,4):"+"+t});he(0,["YY",2],0,function(){return this.year()%100});he(0,["YYYY",4],0,"year");he(0,["YYYYY",5],0,"year");he(0,["YYYYYY",6,!0],0,"year");ie("Y",ds);ie("YY",De,Ge);ie("YYYY",zs,$s);ie("YYYYY",cs,os);ie("YYYYYY",cs,os);Ee(["YYYYY","YYYYYY"],Be);Ee("YYYY",function(t,s){s[Be]=t.length===2?ee.parseTwoDigitYear(t):Ne(t)});Ee("YY",function(t,s){s[Be]=ee.parseTwoDigitYear(t)});Ee("Y",function(t,s){s[Be]=parseInt(t,10)});function Rt(t){return us(t)?366:365}ee.parseTwoDigitYear=function(t){return Ne(t)+(Ne(t)>68?1900:2e3)};var Ar=It("FullYear",!0);function gi(){return us(this.year())}function It(t,s){return function(r){return r!=null?(Er(this,t,r),ee.updateOffset(this,s),this):Ot(this,t)}}function Ot(t,s){if(!t.isValid())return NaN;var r=t._d,a=t._isUTC;switch(s){case"Milliseconds":return a?r.getUTCMilliseconds():r.getMilliseconds();case"Seconds":return a?r.getUTCSeconds():r.getSeconds();case"Minutes":return a?r.getUTCMinutes():r.getMinutes();case"Hours":return a?r.getUTCHours():r.getHours();case"Date":return a?r.getUTCDate():r.getDate();case"Day":return a?r.getUTCDay():r.getDay();case"Month":return a?r.getUTCMonth():r.getMonth();case"FullYear":return a?r.getUTCFullYear():r.getFullYear();default:return NaN}}function Er(t,s,r){var a,i,n,l,h;if(!(!t.isValid()||isNaN(r))){switch(a=t._d,i=t._isUTC,s){case"Milliseconds":return void(i?a.setUTCMilliseconds(r):a.setMilliseconds(r));case"Seconds":return void(i?a.setUTCSeconds(r):a.setSeconds(r));case"Minutes":return void(i?a.setUTCMinutes(r):a.setMinutes(r));case"Hours":return void(i?a.setUTCHours(r):a.setHours(r));case"Date":return void(i?a.setUTCDate(r):a.setDate(r));case"FullYear":break;default:return}n=r,l=t.month(),h=t.date(),h=h===29&&l===1&&!us(n)?28:h,i?a.setUTCFullYear(n,l,h):a.setFullYear(n,l,h)}}function fi(t){return t=Xe(t),nt(this[t])?this[t]():this}function xi(t,s){if(typeof t=="object"){t=Fs(t);var r=oi(t),a,i=r.length;for(a=0;a<i;a++)this[r[a].unit](t[r[a].unit])}else if(t=Xe(t),nt(this[t]))return this[t](s);return this}function vi(t,s){return(t%s+s)%s}var Le;Array.prototype.indexOf?Le=Array.prototype.indexOf:Le=function(t){var s;for(s=0;s<this.length;++s)if(this[s]===t)return s;return-1};function Ws(t,s){if(isNaN(t)||isNaN(s))return NaN;var r=vi(s,12);return t+=(s-r)/12,r===1?us(t)?29:28:31-r%7%2}he("M",["MM",2],"Mo",function(){return this.month()+1});he("MMM",0,0,function(t){return this.localeData().monthsShort(this,t)});he("MMMM",0,0,function(t){return this.localeData().months(this,t)});ie("M",De,Et);ie("MM",De,Ge);ie("MMM",function(t,s){return s.monthsShortRegex(t)});ie("MMMM",function(t,s){return s.monthsRegex(t)});Ee(["M","MM"],function(t,s){s[ct]=Ne(t)-1});Ee(["MMM","MMMM"],function(t,s,r,a){var i=r._locale.monthsParse(t,a,r._strict);i!=null?s[ct]=i:ye(r).invalidMonth=t});var yi="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Ir="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Mr=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,wi=Ht,ji=Ht;function Si(t,s){return t?Qe(this._months)?this._months[t.month()]:this._months[(this._months.isFormat||Mr).test(s)?"format":"standalone"][t.month()]:Qe(this._months)?this._months:this._months.standalone}function bi(t,s){return t?Qe(this._monthsShort)?this._monthsShort[t.month()]:this._monthsShort[Mr.test(s)?"format":"standalone"][t.month()]:Qe(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function _i(t,s,r){var a,i,n,l=t.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],a=0;a<12;++a)n=it([2e3,a]),this._shortMonthsParse[a]=this.monthsShort(n,"").toLocaleLowerCase(),this._longMonthsParse[a]=this.months(n,"").toLocaleLowerCase();return r?s==="MMM"?(i=Le.call(this._shortMonthsParse,l),i!==-1?i:null):(i=Le.call(this._longMonthsParse,l),i!==-1?i:null):s==="MMM"?(i=Le.call(this._shortMonthsParse,l),i!==-1?i:(i=Le.call(this._longMonthsParse,l),i!==-1?i:null)):(i=Le.call(this._longMonthsParse,l),i!==-1?i:(i=Le.call(this._shortMonthsParse,l),i!==-1?i:null))}function Ni(t,s,r){var a,i,n;if(this._monthsParseExact)return _i.call(this,t,s,r);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),a=0;a<12;a++){if(i=it([2e3,a]),r&&!this._longMonthsParse[a]&&(this._longMonthsParse[a]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[a]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),!r&&!this._monthsParse[a]&&(n="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[a]=new RegExp(n.replace(".",""),"i")),r&&s==="MMMM"&&this._longMonthsParse[a].test(t))return a;if(r&&s==="MMM"&&this._shortMonthsParse[a].test(t))return a;if(!r&&this._monthsParse[a].test(t))return a}}function Ur(t,s){if(!t.isValid())return t;if(typeof s=="string"){if(/^\d+$/.test(s))s=Ne(s);else if(s=t.localeData().monthsParse(s),!mt(s))return t}var r=s,a=t.date();return a=a<29?a:Math.min(a,Ws(t.year(),r)),t._isUTC?t._d.setUTCMonth(r,a):t._d.setMonth(r,a),t}function Dr(t){return t!=null?(Ur(this,t),ee.updateOffset(this,!0),this):Ot(this,"Month")}function Ci(){return Ws(this.year(),this.month())}function ki(t){return this._monthsParseExact?(Pe(this,"_monthsRegex")||Rr.call(this),t?this._monthsShortStrictRegex:this._monthsShortRegex):(Pe(this,"_monthsShortRegex")||(this._monthsShortRegex=wi),this._monthsShortStrictRegex&&t?this._monthsShortStrictRegex:this._monthsShortRegex)}function Pi(t){return this._monthsParseExact?(Pe(this,"_monthsRegex")||Rr.call(this),t?this._monthsStrictRegex:this._monthsRegex):(Pe(this,"_monthsRegex")||(this._monthsRegex=ji),this._monthsStrictRegex&&t?this._monthsStrictRegex:this._monthsRegex)}function Rr(){function t(v,S){return S.length-v.length}var s=[],r=[],a=[],i,n,l,h;for(i=0;i<12;i++)n=it([2e3,i]),l=ht(this.monthsShort(n,"")),h=ht(this.months(n,"")),s.push(l),r.push(h),a.push(h),a.push(l);s.sort(t),r.sort(t),a.sort(t),this._monthsRegex=new RegExp("^("+a.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+s.join("|")+")","i")}function Ti(t,s,r,a,i,n,l){var h;return t<100&&t>=0?(h=new Date(t+400,s,r,a,i,n,l),isFinite(h.getFullYear())&&h.setFullYear(t)):h=new Date(t,s,r,a,i,n,l),h}function Lt(t){var s,r;return t<100&&t>=0?(r=Array.prototype.slice.call(arguments),r[0]=t+400,s=new Date(Date.UTC.apply(null,r)),isFinite(s.getUTCFullYear())&&s.setUTCFullYear(t)):s=new Date(Date.UTC.apply(null,arguments)),s}function Qt(t,s,r){var a=7+s-r,i=(7+Lt(t,0,a).getUTCDay()-s)%7;return-i+a-1}function Or(t,s,r,a,i){var n=(7+r-a)%7,l=Qt(t,a,i),h=1+7*(s-1)+n+l,v,S;return h<=0?(v=t-1,S=Rt(v)+h):h>Rt(t)?(v=t+1,S=h-Rt(t)):(v=t,S=h),{year:v,dayOfYear:S}}function Yt(t,s,r){var a=Qt(t.year(),s,r),i=Math.floor((t.dayOfYear()-a-1)/7)+1,n,l;return i<1?(l=t.year()-1,n=i+ut(l,s,r)):i>ut(t.year(),s,r)?(n=i-ut(t.year(),s,r),l=t.year()+1):(l=t.year(),n=i),{week:n,year:l}}function ut(t,s,r){var a=Qt(t,s,r),i=Qt(t+1,s,r);return(Rt(t)-a+i)/7}he("w",["ww",2],"wo","week");he("W",["WW",2],"Wo","isoWeek");ie("w",De,Et);ie("ww",De,Ge);ie("W",De,Et);ie("WW",De,Ge);Vt(["w","ww","W","WW"],function(t,s,r,a){s[a.substr(0,1)]=Ne(t)});function Ai(t){return Yt(t,this._week.dow,this._week.doy).week}var Ei={dow:0,doy:6};function Ii(){return this._week.dow}function Mi(){return this._week.doy}function Ui(t){var s=this.localeData().week(this);return t==null?s:this.add((t-s)*7,"d")}function Di(t){var s=Yt(this,1,4).week;return t==null?s:this.add((t-s)*7,"d")}he("d",0,"do","day");he("dd",0,0,function(t){return this.localeData().weekdaysMin(this,t)});he("ddd",0,0,function(t){return this.localeData().weekdaysShort(this,t)});he("dddd",0,0,function(t){return this.localeData().weekdays(this,t)});he("e",0,0,"weekday");he("E",0,0,"isoWeekday");ie("d",De);ie("e",De);ie("E",De);ie("dd",function(t,s){return s.weekdaysMinRegex(t)});ie("ddd",function(t,s){return s.weekdaysShortRegex(t)});ie("dddd",function(t,s){return s.weekdaysRegex(t)});Vt(["dd","ddd","dddd"],function(t,s,r,a){var i=r._locale.weekdaysParse(t,a,r._strict);i!=null?s.d=i:ye(r).invalidWeekday=t});Vt(["d","e","E"],function(t,s,r,a){s[a]=Ne(t)});function Ri(t,s){return typeof t!="string"?t:isNaN(t)?(t=s.weekdaysParse(t),typeof t=="number"?t:null):parseInt(t,10)}function Oi(t,s){return typeof t=="string"?s.weekdaysParse(t)%7||7:isNaN(t)?null:t}function Hs(t,s){return t.slice(s,7).concat(t.slice(0,s))}var Li="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Lr="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Yi="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Fi=Ht,$i=Ht,zi=Ht;function Bi(t,s){var r=Qe(this._weekdays)?this._weekdays:this._weekdays[t&&t!==!0&&this._weekdays.isFormat.test(s)?"format":"standalone"];return t===!0?Hs(r,this._week.dow):t?r[t.day()]:r}function Wi(t){return t===!0?Hs(this._weekdaysShort,this._week.dow):t?this._weekdaysShort[t.day()]:this._weekdaysShort}function Hi(t){return t===!0?Hs(this._weekdaysMin,this._week.dow):t?this._weekdaysMin[t.day()]:this._weekdaysMin}function Vi(t,s,r){var a,i,n,l=t.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],a=0;a<7;++a)n=it([2e3,1]).day(a),this._minWeekdaysParse[a]=this.weekdaysMin(n,"").toLocaleLowerCase(),this._shortWeekdaysParse[a]=this.weekdaysShort(n,"").toLocaleLowerCase(),this._weekdaysParse[a]=this.weekdays(n,"").toLocaleLowerCase();return r?s==="dddd"?(i=Le.call(this._weekdaysParse,l),i!==-1?i:null):s==="ddd"?(i=Le.call(this._shortWeekdaysParse,l),i!==-1?i:null):(i=Le.call(this._minWeekdaysParse,l),i!==-1?i:null):s==="dddd"?(i=Le.call(this._weekdaysParse,l),i!==-1||(i=Le.call(this._shortWeekdaysParse,l),i!==-1)?i:(i=Le.call(this._minWeekdaysParse,l),i!==-1?i:null)):s==="ddd"?(i=Le.call(this._shortWeekdaysParse,l),i!==-1||(i=Le.call(this._weekdaysParse,l),i!==-1)?i:(i=Le.call(this._minWeekdaysParse,l),i!==-1?i:null)):(i=Le.call(this._minWeekdaysParse,l),i!==-1||(i=Le.call(this._weekdaysParse,l),i!==-1)?i:(i=Le.call(this._shortWeekdaysParse,l),i!==-1?i:null))}function Gi(t,s,r){var a,i,n;if(this._weekdaysParseExact)return Vi.call(this,t,s,r);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),a=0;a<7;a++){if(i=it([2e3,1]).day(a),r&&!this._fullWeekdaysParse[a]&&(this._fullWeekdaysParse[a]=new RegExp("^"+this.weekdays(i,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[a]=new RegExp("^"+this.weekdaysShort(i,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[a]=new RegExp("^"+this.weekdaysMin(i,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[a]||(n="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[a]=new RegExp(n.replace(".",""),"i")),r&&s==="dddd"&&this._fullWeekdaysParse[a].test(t))return a;if(r&&s==="ddd"&&this._shortWeekdaysParse[a].test(t))return a;if(r&&s==="dd"&&this._minWeekdaysParse[a].test(t))return a;if(!r&&this._weekdaysParse[a].test(t))return a}}function qi(t){if(!this.isValid())return t!=null?this:NaN;var s=Ot(this,"Day");return t!=null?(t=Ri(t,this.localeData()),this.add(t-s,"d")):s}function Ji(t){if(!this.isValid())return t!=null?this:NaN;var s=(this.day()+7-this.localeData()._week.dow)%7;return t==null?s:this.add(t-s,"d")}function Xi(t){if(!this.isValid())return t!=null?this:NaN;if(t!=null){var s=Oi(t,this.localeData());return this.day(this.day()%7?s:s-7)}else return this.day()||7}function Zi(t){return this._weekdaysParseExact?(Pe(this,"_weekdaysRegex")||Vs.call(this),t?this._weekdaysStrictRegex:this._weekdaysRegex):(Pe(this,"_weekdaysRegex")||(this._weekdaysRegex=Fi),this._weekdaysStrictRegex&&t?this._weekdaysStrictRegex:this._weekdaysRegex)}function Ki(t){return this._weekdaysParseExact?(Pe(this,"_weekdaysRegex")||Vs.call(this),t?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(Pe(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=$i),this._weekdaysShortStrictRegex&&t?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function Qi(t){return this._weekdaysParseExact?(Pe(this,"_weekdaysRegex")||Vs.call(this),t?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(Pe(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=zi),this._weekdaysMinStrictRegex&&t?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function Vs(){function t(b,_){return _.length-b.length}var s=[],r=[],a=[],i=[],n,l,h,v,S;for(n=0;n<7;n++)l=it([2e3,1]).day(n),h=ht(this.weekdaysMin(l,"")),v=ht(this.weekdaysShort(l,"")),S=ht(this.weekdays(l,"")),s.push(h),r.push(v),a.push(S),i.push(h),i.push(v),i.push(S);s.sort(t),r.sort(t),a.sort(t),i.sort(t),this._weekdaysRegex=new RegExp("^("+i.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+a.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+s.join("|")+")","i")}function Gs(){return this.hours()%12||12}function en(){return this.hours()||24}he("H",["HH",2],0,"hour");he("h",["hh",2],0,Gs);he("k",["kk",2],0,en);he("hmm",0,0,function(){return""+Gs.apply(this)+at(this.minutes(),2)});he("hmmss",0,0,function(){return""+Gs.apply(this)+at(this.minutes(),2)+at(this.seconds(),2)});he("Hmm",0,0,function(){return""+this.hours()+at(this.minutes(),2)});he("Hmmss",0,0,function(){return""+this.hours()+at(this.minutes(),2)+at(this.seconds(),2)});function Yr(t,s){he(t,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),s)})}Yr("a",!0);Yr("A",!1);function Fr(t,s){return s._meridiemParse}ie("a",Fr);ie("A",Fr);ie("H",De,Bs);ie("h",De,Et);ie("k",De,Et);ie("HH",De,Ge);ie("hh",De,Ge);ie("kk",De,Ge);ie("hmm",Pr);ie("hmmss",Tr);ie("Hmm",Pr);ie("Hmmss",Tr);Ee(["H","HH"],Ye);Ee(["k","kk"],function(t,s,r){var a=Ne(t);s[Ye]=a===24?0:a});Ee(["a","A"],function(t,s,r){r._isPm=r._locale.isPM(t),r._meridiem=t});Ee(["h","hh"],function(t,s,r){s[Ye]=Ne(t),ye(r).bigHour=!0});Ee("hmm",function(t,s,r){var a=t.length-2;s[Ye]=Ne(t.substr(0,a)),s[Ke]=Ne(t.substr(a)),ye(r).bigHour=!0});Ee("hmmss",function(t,s,r){var a=t.length-4,i=t.length-2;s[Ye]=Ne(t.substr(0,a)),s[Ke]=Ne(t.substr(a,2)),s[dt]=Ne(t.substr(i)),ye(r).bigHour=!0});Ee("Hmm",function(t,s,r){var a=t.length-2;s[Ye]=Ne(t.substr(0,a)),s[Ke]=Ne(t.substr(a))});Ee("Hmmss",function(t,s,r){var a=t.length-4,i=t.length-2;s[Ye]=Ne(t.substr(0,a)),s[Ke]=Ne(t.substr(a,2)),s[dt]=Ne(t.substr(i))});function tn(t){return(t+"").toLowerCase().charAt(0)==="p"}var sn=/[ap]\.?m?\.?/i,rn=It("Hours",!0);function an(t,s,r){return t>11?r?"pm":"PM":r?"am":"AM"}var $r={calendar:Va,longDateFormat:Xa,invalidDate:Ka,ordinal:ei,dayOfMonthOrdinalParse:ti,relativeTime:ri,months:yi,monthsShort:Ir,week:Ei,weekdays:Li,weekdaysMin:Yi,weekdaysShort:Lr,meridiemParse:sn},Re={},Ut={},Ft;function nn(t,s){var r,a=Math.min(t.length,s.length);for(r=0;r<a;r+=1)if(t[r]!==s[r])return r;return a}function mr(t){return t&&t.toLowerCase().replace("_","-")}function on(t){for(var s=0,r,a,i,n;s<t.length;){for(n=mr(t[s]).split("-"),r=n.length,a=mr(t[s+1]),a=a?a.split("-"):null;r>0;){if(i=ms(n.slice(0,r).join("-")),i)return i;if(a&&a.length>=r&&nn(n,a)>=r-1)break;r--}s++}return Ft}function ln(t){return!!(t&&t.match("^[^/\\\\]*$"))}function ms(t){var s=null,r;if(Re[t]===void 0&&typeof module<"u"&&module&&module.exports&&ln(t))try{s=Ft._abbr,r=require,r("./locale/"+t),vt(s)}catch{Re[t]=null}return Re[t]}function vt(t,s){var r;return t&&(We(s)?r=pt(t):r=qs(t,s),r?Ft=r:typeof console<"u"&&console.warn&&console.warn("Locale "+t+" not found. Did you forget to load it?")),Ft._abbr}function qs(t,s){if(s!==null){var r,a=$r;if(s.abbr=t,Re[t]!=null)_r("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),a=Re[t]._config;else if(s.parentLocale!=null)if(Re[s.parentLocale]!=null)a=Re[s.parentLocale]._config;else if(r=ms(s.parentLocale),r!=null)a=r._config;else return Ut[s.parentLocale]||(Ut[s.parentLocale]=[]),Ut[s.parentLocale].push({name:t,config:s}),null;return Re[t]=new Ls(Ts(a,s)),Ut[t]&&Ut[t].forEach(function(i){qs(i.name,i.config)}),vt(t),Re[t]}else return delete Re[t],null}function cn(t,s){if(s!=null){var r,a,i=$r;Re[t]!=null&&Re[t].parentLocale!=null?Re[t].set(Ts(Re[t]._config,s)):(a=ms(t),a!=null&&(i=a._config),s=Ts(i,s),a==null&&(s.abbr=t),r=new Ls(s),r.parentLocale=Re[t],Re[t]=r),vt(t)}else Re[t]!=null&&(Re[t].parentLocale!=null?(Re[t]=Re[t].parentLocale,t===vt()&&vt(t)):Re[t]!=null&&delete Re[t]);return Re[t]}function pt(t){var s;if(t&&t._locale&&t._locale._abbr&&(t=t._locale._abbr),!t)return Ft;if(!Qe(t)){if(s=ms(t),s)return s;t=[t]}return on(t)}function dn(){return As(Re)}function Js(t){var s,r=t._a;return r&&ye(t).overflow===-2&&(s=r[ct]<0||r[ct]>11?ct:r[rt]<1||r[rt]>Ws(r[Be],r[ct])?rt:r[Ye]<0||r[Ye]>24||r[Ye]===24&&(r[Ke]!==0||r[dt]!==0||r[jt]!==0)?Ye:r[Ke]<0||r[Ke]>59?Ke:r[dt]<0||r[dt]>59?dt:r[jt]<0||r[jt]>999?jt:-1,ye(t)._overflowDayOfYear&&(s<Be||s>rt)&&(s=rt),ye(t)._overflowWeeks&&s===-1&&(s=mi),ye(t)._overflowWeekday&&s===-1&&(s=pi),ye(t).overflow=s),t}var hn=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,un=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,mn=/Z|[+-]\d\d(?::?\d\d)?/,qt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],bs=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],pn=/^\/?Date\((-?\d+)/i,gn=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,fn={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function zr(t){var s,r,a=t._i,i=hn.exec(a)||un.exec(a),n,l,h,v,S=qt.length,b=bs.length;if(i){for(ye(t).iso=!0,s=0,r=S;s<r;s++)if(qt[s][1].exec(i[1])){l=qt[s][0],n=qt[s][2]!==!1;break}if(l==null){t._isValid=!1;return}if(i[3]){for(s=0,r=b;s<r;s++)if(bs[s][1].exec(i[3])){h=(i[2]||" ")+bs[s][0];break}if(h==null){t._isValid=!1;return}}if(!n&&h!=null){t._isValid=!1;return}if(i[4])if(mn.exec(i[4]))v="Z";else{t._isValid=!1;return}t._f=l+(h||"")+(v||""),Zs(t)}else t._isValid=!1}function xn(t,s,r,a,i,n){var l=[vn(t),Ir.indexOf(s),parseInt(r,10),parseInt(a,10),parseInt(i,10)];return n&&l.push(parseInt(n,10)),l}function vn(t){var s=parseInt(t,10);return s<=49?2e3+s:s<=999?1900+s:s}function yn(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function wn(t,s,r){if(t){var a=Lr.indexOf(t),i=new Date(s[0],s[1],s[2]).getDay();if(a!==i)return ye(r).weekdayMismatch=!0,r._isValid=!1,!1}return!0}function jn(t,s,r){if(t)return fn[t];if(s)return 0;var a=parseInt(r,10),i=a%100,n=(a-i)/100;return n*60+i}function Br(t){var s=gn.exec(yn(t._i)),r;if(s){if(r=xn(s[4],s[3],s[2],s[5],s[6],s[7]),!wn(s[1],r,t))return;t._a=r,t._tzm=jn(s[8],s[9],s[10]),t._d=Lt.apply(null,t._a),t._d.setUTCMinutes(t._d.getUTCMinutes()-t._tzm),ye(t).rfc2822=!0}else t._isValid=!1}function Sn(t){var s=pn.exec(t._i);if(s!==null){t._d=new Date(+s[1]);return}if(zr(t),t._isValid===!1)delete t._isValid;else return;if(Br(t),t._isValid===!1)delete t._isValid;else return;t._strict?t._isValid=!1:ee.createFromInputFallback(t)}ee.createFromInputFallback=Je("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(t){t._d=new Date(t._i+(t._useUTC?" UTC":""))});function Nt(t,s,r){return t??s??r}function bn(t){var s=new Date(ee.now());return t._useUTC?[s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()]:[s.getFullYear(),s.getMonth(),s.getDate()]}function Xs(t){var s,r,a=[],i,n,l;if(!t._d){for(i=bn(t),t._w&&t._a[rt]==null&&t._a[ct]==null&&_n(t),t._dayOfYear!=null&&(l=Nt(t._a[Be],i[Be]),(t._dayOfYear>Rt(l)||t._dayOfYear===0)&&(ye(t)._overflowDayOfYear=!0),r=Lt(l,0,t._dayOfYear),t._a[ct]=r.getUTCMonth(),t._a[rt]=r.getUTCDate()),s=0;s<3&&t._a[s]==null;++s)t._a[s]=a[s]=i[s];for(;s<7;s++)t._a[s]=a[s]=t._a[s]==null?s===2?1:0:t._a[s];t._a[Ye]===24&&t._a[Ke]===0&&t._a[dt]===0&&t._a[jt]===0&&(t._nextDay=!0,t._a[Ye]=0),t._d=(t._useUTC?Lt:Ti).apply(null,a),n=t._useUTC?t._d.getUTCDay():t._d.getDay(),t._tzm!=null&&t._d.setUTCMinutes(t._d.getUTCMinutes()-t._tzm),t._nextDay&&(t._a[Ye]=24),t._w&&typeof t._w.d<"u"&&t._w.d!==n&&(ye(t).weekdayMismatch=!0)}}function _n(t){var s,r,a,i,n,l,h,v,S;s=t._w,s.GG!=null||s.W!=null||s.E!=null?(n=1,l=4,r=Nt(s.GG,t._a[Be],Yt(Ue(),1,4).year),a=Nt(s.W,1),i=Nt(s.E,1),(i<1||i>7)&&(v=!0)):(n=t._locale._week.dow,l=t._locale._week.doy,S=Yt(Ue(),n,l),r=Nt(s.gg,t._a[Be],S.year),a=Nt(s.w,S.week),s.d!=null?(i=s.d,(i<0||i>6)&&(v=!0)):s.e!=null?(i=s.e+n,(s.e<0||s.e>6)&&(v=!0)):i=n),a<1||a>ut(r,n,l)?ye(t)._overflowWeeks=!0:v!=null?ye(t)._overflowWeekday=!0:(h=Or(r,a,i,n,l),t._a[Be]=h.year,t._dayOfYear=h.dayOfYear)}ee.ISO_8601=function(){};ee.RFC_2822=function(){};function Zs(t){if(t._f===ee.ISO_8601){zr(t);return}if(t._f===ee.RFC_2822){Br(t);return}t._a=[],ye(t).empty=!0;var s=""+t._i,r,a,i,n,l,h=s.length,v=0,S,b;for(i=Nr(t._f,t._locale).match(Ys)||[],b=i.length,r=0;r<b;r++)n=i[r],a=(s.match(di(n,t))||[])[0],a&&(l=s.substr(0,s.indexOf(a)),l.length>0&&ye(t).unusedInput.push(l),s=s.slice(s.indexOf(a)+a.length),v+=a.length),kt[n]?(a?ye(t).empty=!1:ye(t).unusedTokens.push(n),ui(n,a,t)):t._strict&&!a&&ye(t).unusedTokens.push(n);ye(t).charsLeftOver=h-v,s.length>0&&ye(t).unusedInput.push(s),t._a[Ye]<=12&&ye(t).bigHour===!0&&t._a[Ye]>0&&(ye(t).bigHour=void 0),ye(t).parsedDateParts=t._a.slice(0),ye(t).meridiem=t._meridiem,t._a[Ye]=Nn(t._locale,t._a[Ye],t._meridiem),S=ye(t).era,S!==null&&(t._a[Be]=t._locale.erasConvertYear(S,t._a[Be])),Xs(t),Js(t)}function Nn(t,s,r){var a;return r==null?s:t.meridiemHour!=null?t.meridiemHour(s,r):(t.isPM!=null&&(a=t.isPM(r),a&&s<12&&(s+=12),!a&&s===12&&(s=0)),s)}function Cn(t){var s,r,a,i,n,l,h=!1,v=t._f.length;if(v===0){ye(t).invalidFormat=!0,t._d=new Date(NaN);return}for(i=0;i<v;i++)n=0,l=!1,s=Os({},t),t._useUTC!=null&&(s._useUTC=t._useUTC),s._f=t._f[i],Zs(s),Rs(s)&&(l=!0),n+=ye(s).charsLeftOver,n+=ye(s).unusedTokens.length*10,ye(s).score=n,h?n<a&&(a=n,r=s):(a==null||n<a||l)&&(a=n,r=s,l&&(h=!0));ft(t,r||s)}function kn(t){if(!t._d){var s=Fs(t._i),r=s.day===void 0?s.date:s.day;t._a=Sr([s.year,s.month,r,s.hour,s.minute,s.second,s.millisecond],function(a){return a&&parseInt(a,10)}),Xs(t)}}function Pn(t){var s=new Wt(Js(Wr(t)));return s._nextDay&&(s.add(1,"d"),s._nextDay=void 0),s}function Wr(t){var s=t._i,r=t._f;return t._locale=t._locale||pt(t._l),s===null||r===void 0&&s===""?ns({nullInput:!0}):(typeof s=="string"&&(t._i=s=t._locale.preparse(s)),et(s)?new Wt(Js(s)):(Bt(s)?t._d=s:Qe(r)?Cn(t):r?Zs(t):Tn(t),Rs(t)||(t._d=null),t))}function Tn(t){var s=t._i;We(s)?t._d=new Date(ee.now()):Bt(s)?t._d=new Date(s.valueOf()):typeof s=="string"?Sn(t):Qe(s)?(t._a=Sr(s.slice(0),function(r){return parseInt(r,10)}),Xs(t)):St(s)?kn(t):mt(s)?t._d=new Date(s):ee.createFromInputFallback(t)}function Hr(t,s,r,a,i){var n={};return(s===!0||s===!1)&&(a=s,s=void 0),(r===!0||r===!1)&&(a=r,r=void 0),(St(t)&&Ds(t)||Qe(t)&&t.length===0)&&(t=void 0),n._isAMomentObject=!0,n._useUTC=n._isUTC=i,n._l=r,n._i=t,n._f=s,n._strict=a,Pn(n)}function Ue(t,s,r,a){return Hr(t,s,r,a,!1)}var An=Je("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var t=Ue.apply(null,arguments);return this.isValid()&&t.isValid()?t<this?this:t:ns()}),En=Je("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var t=Ue.apply(null,arguments);return this.isValid()&&t.isValid()?t>this?this:t:ns()});function Vr(t,s){var r,a;if(s.length===1&&Qe(s[0])&&(s=s[0]),!s.length)return Ue();for(r=s[0],a=1;a<s.length;++a)(!s[a].isValid()||s[a][t](r))&&(r=s[a]);return r}function In(){var t=[].slice.call(arguments,0);return Vr("isBefore",t)}function Mn(){var t=[].slice.call(arguments,0);return Vr("isAfter",t)}var Un=function(){return Date.now?Date.now():+new Date},Dt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Dn(t){var s,r=!1,a,i=Dt.length;for(s in t)if(Pe(t,s)&&!(Le.call(Dt,s)!==-1&&(t[s]==null||!isNaN(t[s]))))return!1;for(a=0;a<i;++a)if(t[Dt[a]]){if(r)return!1;parseFloat(t[Dt[a]])!==Ne(t[Dt[a]])&&(r=!0)}return!0}function Rn(){return this._isValid}function On(){return tt(NaN)}function ps(t){var s=Fs(t),r=s.year||0,a=s.quarter||0,i=s.month||0,n=s.week||s.isoWeek||0,l=s.day||0,h=s.hour||0,v=s.minute||0,S=s.second||0,b=s.millisecond||0;this._isValid=Dn(s),this._milliseconds=+b+S*1e3+v*6e4+h*1e3*60*60,this._days=+l+n*7,this._months=+i+a*3+r*12,this._data={},this._locale=pt(),this._bubble()}function Xt(t){return t instanceof ps}function Is(t){return t<0?Math.round(-1*t)*-1:Math.round(t)}function Ln(t,s,r){var a=Math.min(t.length,s.length),i=Math.abs(t.length-s.length),n=0,l;for(l=0;l<a;l++)(r&&t[l]!==s[l]||!r&&Ne(t[l])!==Ne(s[l]))&&n++;return n+i}function Gr(t,s){he(t,0,0,function(){var r=this.utcOffset(),a="+";return r<0&&(r=-r,a="-"),a+at(~~(r/60),2)+s+at(~~r%60,2)})}Gr("Z",":");Gr("ZZ","");ie("Z",hs);ie("ZZ",hs);Ee(["Z","ZZ"],function(t,s,r){r._useUTC=!0,r._tzm=Ks(hs,t)});var Yn=/([\+\-]|\d\d)/gi;function Ks(t,s){var r=(s||"").match(t),a,i,n;return r===null?null:(a=r[r.length-1]||[],i=(a+"").match(Yn)||["-",0,0],n=+(i[1]*60)+Ne(i[2]),n===0?0:i[0]==="+"?n:-n)}function Qs(t,s){var r,a;return s._isUTC?(r=s.clone(),a=(et(t)||Bt(t)?t.valueOf():Ue(t).valueOf())-r.valueOf(),r._d.setTime(r._d.valueOf()+a),ee.updateOffset(r,!1),r):Ue(t).local()}function Ms(t){return-Math.round(t._d.getTimezoneOffset())}ee.updateOffset=function(){};function Fn(t,s,r){var a=this._offset||0,i;if(!this.isValid())return t!=null?this:NaN;if(t!=null){if(typeof t=="string"){if(t=Ks(hs,t),t===null)return this}else Math.abs(t)<16&&!r&&(t=t*60);return!this._isUTC&&s&&(i=Ms(this)),this._offset=t,this._isUTC=!0,i!=null&&this.add(i,"m"),a!==t&&(!s||this._changeInProgress?Xr(this,tt(t-a,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,ee.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?a:Ms(this)}function $n(t,s){return t!=null?(typeof t!="string"&&(t=-t),this.utcOffset(t,s),this):-this.utcOffset()}function zn(t){return this.utcOffset(0,t)}function Bn(t){return this._isUTC&&(this.utcOffset(0,t),this._isUTC=!1,t&&this.subtract(Ms(this),"m")),this}function Wn(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var t=Ks(li,this._i);t!=null?this.utcOffset(t):this.utcOffset(0,!0)}return this}function Hn(t){return this.isValid()?(t=t?Ue(t).utcOffset():0,(this.utcOffset()-t)%60===0):!1}function Vn(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Gn(){if(!We(this._isDSTShifted))return this._isDSTShifted;var t={},s;return Os(t,this),t=Wr(t),t._a?(s=t._isUTC?it(t._a):Ue(t._a),this._isDSTShifted=this.isValid()&&Ln(t._a,s.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function qn(){return this.isValid()?!this._isUTC:!1}function Jn(){return this.isValid()?this._isUTC:!1}function qr(){return this.isValid()?this._isUTC&&this._offset===0:!1}var Xn=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,Zn=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function tt(t,s){var r=t,a=null,i,n,l;return Xt(t)?r={ms:t._milliseconds,d:t._days,M:t._months}:mt(t)||!isNaN(+t)?(r={},s?r[s]=+t:r.milliseconds=+t):(a=Xn.exec(t))?(i=a[1]==="-"?-1:1,r={y:0,d:Ne(a[rt])*i,h:Ne(a[Ye])*i,m:Ne(a[Ke])*i,s:Ne(a[dt])*i,ms:Ne(Is(a[jt]*1e3))*i}):(a=Zn.exec(t))?(i=a[1]==="-"?-1:1,r={y:wt(a[2],i),M:wt(a[3],i),w:wt(a[4],i),d:wt(a[5],i),h:wt(a[6],i),m:wt(a[7],i),s:wt(a[8],i)}):r==null?r={}:typeof r=="object"&&("from"in r||"to"in r)&&(l=Kn(Ue(r.from),Ue(r.to)),r={},r.ms=l.milliseconds,r.M=l.months),n=new ps(r),Xt(t)&&Pe(t,"_locale")&&(n._locale=t._locale),Xt(t)&&Pe(t,"_isValid")&&(n._isValid=t._isValid),n}tt.fn=ps.prototype;tt.invalid=On;function wt(t,s){var r=t&&parseFloat(t.replace(",","."));return(isNaN(r)?0:r)*s}function pr(t,s){var r={};return r.months=s.month()-t.month()+(s.year()-t.year())*12,t.clone().add(r.months,"M").isAfter(s)&&--r.months,r.milliseconds=+s-+t.clone().add(r.months,"M"),r}function Kn(t,s){var r;return t.isValid()&&s.isValid()?(s=Qs(s,t),t.isBefore(s)?r=pr(t,s):(r=pr(s,t),r.milliseconds=-r.milliseconds,r.months=-r.months),r):{milliseconds:0,months:0}}function Jr(t,s){return function(r,a){var i,n;return a!==null&&!isNaN(+a)&&(_r(s,"moment()."+s+"(period, number) is deprecated. Please use moment()."+s+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),n=r,r=a,a=n),i=tt(r,a),Xr(this,i,t),this}}function Xr(t,s,r,a){var i=s._milliseconds,n=Is(s._days),l=Is(s._months);t.isValid()&&(a=a??!0,l&&Ur(t,Ot(t,"Month")+l*r),n&&Er(t,"Date",Ot(t,"Date")+n*r),i&&t._d.setTime(t._d.valueOf()+i*r),a&&ee.updateOffset(t,n||l))}var Qn=Jr(1,"add"),eo=Jr(-1,"subtract");function Zr(t){return typeof t=="string"||t instanceof String}function to(t){return et(t)||Bt(t)||Zr(t)||mt(t)||ro(t)||so(t)||t===null||t===void 0}function so(t){var s=St(t)&&!Ds(t),r=!1,a=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],i,n,l=a.length;for(i=0;i<l;i+=1)n=a[i],r=r||Pe(t,n);return s&&r}function ro(t){var s=Qe(t),r=!1;return s&&(r=t.filter(function(a){return!mt(a)&&Zr(t)}).length===0),s&&r}function ao(t){var s=St(t)&&!Ds(t),r=!1,a=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],i,n;for(i=0;i<a.length;i+=1)n=a[i],r=r||Pe(t,n);return s&&r}function io(t,s){var r=t.diff(s,"days",!0);return r<-6?"sameElse":r<-1?"lastWeek":r<0?"lastDay":r<1?"sameDay":r<2?"nextDay":r<7?"nextWeek":"sameElse"}function no(t,s){arguments.length===1&&(arguments[0]?to(arguments[0])?(t=arguments[0],s=void 0):ao(arguments[0])&&(s=arguments[0],t=void 0):(t=void 0,s=void 0));var r=t||Ue(),a=Qs(r,this).startOf("day"),i=ee.calendarFormat(this,a)||"sameElse",n=s&&(nt(s[i])?s[i].call(this,r):s[i]);return this.format(n||this.localeData().calendar(i,this,Ue(r)))}function oo(){return new Wt(this)}function lo(t,s){var r=et(t)?t:Ue(t);return this.isValid()&&r.isValid()?(s=Xe(s)||"millisecond",s==="millisecond"?this.valueOf()>r.valueOf():r.valueOf()<this.clone().startOf(s).valueOf()):!1}function co(t,s){var r=et(t)?t:Ue(t);return this.isValid()&&r.isValid()?(s=Xe(s)||"millisecond",s==="millisecond"?this.valueOf()<r.valueOf():this.clone().endOf(s).valueOf()<r.valueOf()):!1}function ho(t,s,r,a){var i=et(t)?t:Ue(t),n=et(s)?s:Ue(s);return this.isValid()&&i.isValid()&&n.isValid()?(a=a||"()",(a[0]==="("?this.isAfter(i,r):!this.isBefore(i,r))&&(a[1]===")"?this.isBefore(n,r):!this.isAfter(n,r))):!1}function uo(t,s){var r=et(t)?t:Ue(t),a;return this.isValid()&&r.isValid()?(s=Xe(s)||"millisecond",s==="millisecond"?this.valueOf()===r.valueOf():(a=r.valueOf(),this.clone().startOf(s).valueOf()<=a&&a<=this.clone().endOf(s).valueOf())):!1}function mo(t,s){return this.isSame(t,s)||this.isAfter(t,s)}function po(t,s){return this.isSame(t,s)||this.isBefore(t,s)}function go(t,s,r){var a,i,n;if(!this.isValid())return NaN;if(a=Qs(t,this),!a.isValid())return NaN;switch(i=(a.utcOffset()-this.utcOffset())*6e4,s=Xe(s),s){case"year":n=Zt(this,a)/12;break;case"month":n=Zt(this,a);break;case"quarter":n=Zt(this,a)/3;break;case"second":n=(this-a)/1e3;break;case"minute":n=(this-a)/6e4;break;case"hour":n=(this-a)/36e5;break;case"day":n=(this-a-i)/864e5;break;case"week":n=(this-a-i)/6048e5;break;default:n=this-a}return r?n:qe(n)}function Zt(t,s){if(t.date()<s.date())return-Zt(s,t);var r=(s.year()-t.year())*12+(s.month()-t.month()),a=t.clone().add(r,"months"),i,n;return s-a<0?(i=t.clone().add(r-1,"months"),n=(s-a)/(a-i)):(i=t.clone().add(r+1,"months"),n=(s-a)/(i-a)),-(r+n)||0}ee.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";ee.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function fo(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function xo(t){if(!this.isValid())return null;var s=t!==!0,r=s?this.clone().utc():this;return r.year()<0||r.year()>9999?Jt(r,s?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):nt(Date.prototype.toISOString)?s?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",Jt(r,"Z")):Jt(r,s?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function vo(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var t="moment",s="",r,a,i,n;return this.isLocal()||(t=this.utcOffset()===0?"moment.utc":"moment.parseZone",s="Z"),r="["+t+'("]',a=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",i="-MM-DD[T]HH:mm:ss.SSS",n=s+'[")]',this.format(r+a+i+n)}function yo(t){t||(t=this.isUtc()?ee.defaultFormatUtc:ee.defaultFormat);var s=Jt(this,t);return this.localeData().postformat(s)}function wo(t,s){return this.isValid()&&(et(t)&&t.isValid()||Ue(t).isValid())?tt({to:this,from:t}).locale(this.locale()).humanize(!s):this.localeData().invalidDate()}function jo(t){return this.from(Ue(),t)}function So(t,s){return this.isValid()&&(et(t)&&t.isValid()||Ue(t).isValid())?tt({from:this,to:t}).locale(this.locale()).humanize(!s):this.localeData().invalidDate()}function bo(t){return this.to(Ue(),t)}function Kr(t){var s;return t===void 0?this._locale._abbr:(s=pt(t),s!=null&&(this._locale=s),this)}var Qr=Je("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(t){return t===void 0?this.localeData():this.locale(t)});function ea(){return this._locale}var es=1e3,Pt=60*es,ts=60*Pt,ta=(365*400+97)*24*ts;function Tt(t,s){return(t%s+s)%s}function sa(t,s,r){return t<100&&t>=0?new Date(t+400,s,r)-ta:new Date(t,s,r).valueOf()}function ra(t,s,r){return t<100&&t>=0?Date.UTC(t+400,s,r)-ta:Date.UTC(t,s,r)}function _o(t){var s,r;if(t=Xe(t),t===void 0||t==="millisecond"||!this.isValid())return this;switch(r=this._isUTC?ra:sa,t){case"year":s=r(this.year(),0,1);break;case"quarter":s=r(this.year(),this.month()-this.month()%3,1);break;case"month":s=r(this.year(),this.month(),1);break;case"week":s=r(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":s=r(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":s=r(this.year(),this.month(),this.date());break;case"hour":s=this._d.valueOf(),s-=Tt(s+(this._isUTC?0:this.utcOffset()*Pt),ts);break;case"minute":s=this._d.valueOf(),s-=Tt(s,Pt);break;case"second":s=this._d.valueOf(),s-=Tt(s,es);break}return this._d.setTime(s),ee.updateOffset(this,!0),this}function No(t){var s,r;if(t=Xe(t),t===void 0||t==="millisecond"||!this.isValid())return this;switch(r=this._isUTC?ra:sa,t){case"year":s=r(this.year()+1,0,1)-1;break;case"quarter":s=r(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":s=r(this.year(),this.month()+1,1)-1;break;case"week":s=r(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":s=r(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":s=r(this.year(),this.month(),this.date()+1)-1;break;case"hour":s=this._d.valueOf(),s+=ts-Tt(s+(this._isUTC?0:this.utcOffset()*Pt),ts)-1;break;case"minute":s=this._d.valueOf(),s+=Pt-Tt(s,Pt)-1;break;case"second":s=this._d.valueOf(),s+=es-Tt(s,es)-1;break}return this._d.setTime(s),ee.updateOffset(this,!0),this}function Co(){return this._d.valueOf()-(this._offset||0)*6e4}function ko(){return Math.floor(this.valueOf()/1e3)}function Po(){return new Date(this.valueOf())}function To(){var t=this;return[t.year(),t.month(),t.date(),t.hour(),t.minute(),t.second(),t.millisecond()]}function Ao(){var t=this;return{years:t.year(),months:t.month(),date:t.date(),hours:t.hours(),minutes:t.minutes(),seconds:t.seconds(),milliseconds:t.milliseconds()}}function Eo(){return this.isValid()?this.toISOString():null}function Io(){return Rs(this)}function Mo(){return ft({},ye(this))}function Uo(){return ye(this).overflow}function Do(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}he("N",0,0,"eraAbbr");he("NN",0,0,"eraAbbr");he("NNN",0,0,"eraAbbr");he("NNNN",0,0,"eraName");he("NNNNN",0,0,"eraNarrow");he("y",["y",1],"yo","eraYear");he("y",["yy",2],0,"eraYear");he("y",["yyy",3],0,"eraYear");he("y",["yyyy",4],0,"eraYear");ie("N",er);ie("NN",er);ie("NNN",er);ie("NNNN",Vo);ie("NNNNN",Go);Ee(["N","NN","NNN","NNNN","NNNNN"],function(t,s,r,a){var i=r._locale.erasParse(t,a,r._strict);i?ye(r).era=i:ye(r).invalidEra=t});ie("y",At);ie("yy",At);ie("yyy",At);ie("yyyy",At);ie("yo",qo);Ee(["y","yy","yyy","yyyy"],Be);Ee(["yo"],function(t,s,r,a){var i;r._locale._eraYearOrdinalRegex&&(i=t.match(r._locale._eraYearOrdinalRegex)),r._locale.eraYearOrdinalParse?s[Be]=r._locale.eraYearOrdinalParse(t,i):s[Be]=parseInt(t,10)});function Ro(t,s){var r,a,i,n=this._eras||pt("en")._eras;for(r=0,a=n.length;r<a;++r){switch(typeof n[r].since){case"string":i=ee(n[r].since).startOf("day"),n[r].since=i.valueOf();break}switch(typeof n[r].until){case"undefined":n[r].until=1/0;break;case"string":i=ee(n[r].until).startOf("day").valueOf(),n[r].until=i.valueOf();break}}return n}function Oo(t,s,r){var a,i,n=this.eras(),l,h,v;for(t=t.toUpperCase(),a=0,i=n.length;a<i;++a)if(l=n[a].name.toUpperCase(),h=n[a].abbr.toUpperCase(),v=n[a].narrow.toUpperCase(),r)switch(s){case"N":case"NN":case"NNN":if(h===t)return n[a];break;case"NNNN":if(l===t)return n[a];break;case"NNNNN":if(v===t)return n[a];break}else if([l,h,v].indexOf(t)>=0)return n[a]}function Lo(t,s){var r=t.since<=t.until?1:-1;return s===void 0?ee(t.since).year():ee(t.since).year()+(s-t.offset)*r}function Yo(){var t,s,r,a=this.localeData().eras();for(t=0,s=a.length;t<s;++t)if(r=this.clone().startOf("day").valueOf(),a[t].since<=r&&r<=a[t].until||a[t].until<=r&&r<=a[t].since)return a[t].name;return""}function Fo(){var t,s,r,a=this.localeData().eras();for(t=0,s=a.length;t<s;++t)if(r=this.clone().startOf("day").valueOf(),a[t].since<=r&&r<=a[t].until||a[t].until<=r&&r<=a[t].since)return a[t].narrow;return""}function $o(){var t,s,r,a=this.localeData().eras();for(t=0,s=a.length;t<s;++t)if(r=this.clone().startOf("day").valueOf(),a[t].since<=r&&r<=a[t].until||a[t].until<=r&&r<=a[t].since)return a[t].abbr;return""}function zo(){var t,s,r,a,i=this.localeData().eras();for(t=0,s=i.length;t<s;++t)if(r=i[t].since<=i[t].until?1:-1,a=this.clone().startOf("day").valueOf(),i[t].since<=a&&a<=i[t].until||i[t].until<=a&&a<=i[t].since)return(this.year()-ee(i[t].since).year())*r+i[t].offset;return this.year()}function Bo(t){return Pe(this,"_erasNameRegex")||tr.call(this),t?this._erasNameRegex:this._erasRegex}function Wo(t){return Pe(this,"_erasAbbrRegex")||tr.call(this),t?this._erasAbbrRegex:this._erasRegex}function Ho(t){return Pe(this,"_erasNarrowRegex")||tr.call(this),t?this._erasNarrowRegex:this._erasRegex}function er(t,s){return s.erasAbbrRegex(t)}function Vo(t,s){return s.erasNameRegex(t)}function Go(t,s){return s.erasNarrowRegex(t)}function qo(t,s){return s._eraYearOrdinalRegex||At}function tr(){var t=[],s=[],r=[],a=[],i,n,l,h,v,S=this.eras();for(i=0,n=S.length;i<n;++i)l=ht(S[i].name),h=ht(S[i].abbr),v=ht(S[i].narrow),s.push(l),t.push(h),r.push(v),a.push(l),a.push(h),a.push(v);this._erasRegex=new RegExp("^("+a.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+s.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+t.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+r.join("|")+")","i")}he(0,["gg",2],0,function(){return this.weekYear()%100});he(0,["GG",2],0,function(){return this.isoWeekYear()%100});function gs(t,s){he(0,[t,t.length],0,s)}gs("gggg","weekYear");gs("ggggg","weekYear");gs("GGGG","isoWeekYear");gs("GGGGG","isoWeekYear");ie("G",ds);ie("g",ds);ie("GG",De,Ge);ie("gg",De,Ge);ie("GGGG",zs,$s);ie("gggg",zs,$s);ie("GGGGG",cs,os);ie("ggggg",cs,os);Vt(["gggg","ggggg","GGGG","GGGGG"],function(t,s,r,a){s[a.substr(0,2)]=Ne(t)});Vt(["gg","GG"],function(t,s,r,a){s[a]=ee.parseTwoDigitYear(t)});function Jo(t){return aa.call(this,t,this.week(),this.weekday()+this.localeData()._week.dow,this.localeData()._week.dow,this.localeData()._week.doy)}function Xo(t){return aa.call(this,t,this.isoWeek(),this.isoWeekday(),1,4)}function Zo(){return ut(this.year(),1,4)}function Ko(){return ut(this.isoWeekYear(),1,4)}function Qo(){var t=this.localeData()._week;return ut(this.year(),t.dow,t.doy)}function el(){var t=this.localeData()._week;return ut(this.weekYear(),t.dow,t.doy)}function aa(t,s,r,a,i){var n;return t==null?Yt(this,a,i).year:(n=ut(t,a,i),s>n&&(s=n),tl.call(this,t,s,r,a,i))}function tl(t,s,r,a,i){var n=Or(t,s,r,a,i),l=Lt(n.year,0,n.dayOfYear);return this.year(l.getUTCFullYear()),this.month(l.getUTCMonth()),this.date(l.getUTCDate()),this}he("Q",0,"Qo","quarter");ie("Q",Cr);Ee("Q",function(t,s){s[ct]=(Ne(t)-1)*3});function sl(t){return t==null?Math.ceil((this.month()+1)/3):this.month((t-1)*3+this.month()%3)}he("D",["DD",2],"Do","date");ie("D",De,Et);ie("DD",De,Ge);ie("Do",function(t,s){return t?s._dayOfMonthOrdinalParse||s._ordinalParse:s._dayOfMonthOrdinalParseLenient});Ee(["D","DD"],rt);Ee("Do",function(t,s){s[rt]=Ne(t.match(De)[0])});var ia=It("Date",!0);he("DDD",["DDDD",3],"DDDo","dayOfYear");ie("DDD",ls);ie("DDDD",kr);Ee(["DDD","DDDD"],function(t,s,r){r._dayOfYear=Ne(t)});function rl(t){var s=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return t==null?s:this.add(t-s,"d")}he("m",["mm",2],0,"minute");ie("m",De,Bs);ie("mm",De,Ge);Ee(["m","mm"],Ke);var al=It("Minutes",!1);he("s",["ss",2],0,"second");ie("s",De,Bs);ie("ss",De,Ge);Ee(["s","ss"],dt);var il=It("Seconds",!1);he("S",0,0,function(){return~~(this.millisecond()/100)});he(0,["SS",2],0,function(){return~~(this.millisecond()/10)});he(0,["SSS",3],0,"millisecond");he(0,["SSSS",4],0,function(){return this.millisecond()*10});he(0,["SSSSS",5],0,function(){return this.millisecond()*100});he(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});he(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});he(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});he(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});ie("S",ls,Cr);ie("SS",ls,Ge);ie("SSS",ls,kr);var xt,na;for(xt="SSSS";xt.length<=9;xt+="S")ie(xt,At);function nl(t,s){s[jt]=Ne(("0."+t)*1e3)}for(xt="S";xt.length<=9;xt+="S")Ee(xt,nl);na=It("Milliseconds",!1);he("z",0,0,"zoneAbbr");he("zz",0,0,"zoneName");function ol(){return this._isUTC?"UTC":""}function ll(){return this._isUTC?"Coordinated Universal Time":""}var G=Wt.prototype;G.add=Qn;G.calendar=no;G.clone=oo;G.diff=go;G.endOf=No;G.format=yo;G.from=wo;G.fromNow=jo;G.to=So;G.toNow=bo;G.get=fi;G.invalidAt=Uo;G.isAfter=lo;G.isBefore=co;G.isBetween=ho;G.isSame=uo;G.isSameOrAfter=mo;G.isSameOrBefore=po;G.isValid=Io;G.lang=Qr;G.locale=Kr;G.localeData=ea;G.max=En;G.min=An;G.parsingFlags=Mo;G.set=xi;G.startOf=_o;G.subtract=eo;G.toArray=To;G.toObject=Ao;G.toDate=Po;G.toISOString=xo;G.inspect=vo;typeof Symbol<"u"&&Symbol.for!=null&&(G[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"});G.toJSON=Eo;G.toString=fo;G.unix=ko;G.valueOf=Co;G.creationData=Do;G.eraName=Yo;G.eraNarrow=Fo;G.eraAbbr=$o;G.eraYear=zo;G.year=Ar;G.isLeapYear=gi;G.weekYear=Jo;G.isoWeekYear=Xo;G.quarter=G.quarters=sl;G.month=Dr;G.daysInMonth=Ci;G.week=G.weeks=Ui;G.isoWeek=G.isoWeeks=Di;G.weeksInYear=Qo;G.weeksInWeekYear=el;G.isoWeeksInYear=Zo;G.isoWeeksInISOWeekYear=Ko;G.date=ia;G.day=G.days=qi;G.weekday=Ji;G.isoWeekday=Xi;G.dayOfYear=rl;G.hour=G.hours=rn;G.minute=G.minutes=al;G.second=G.seconds=il;G.millisecond=G.milliseconds=na;G.utcOffset=Fn;G.utc=zn;G.local=Bn;G.parseZone=Wn;G.hasAlignedHourOffset=Hn;G.isDST=Vn;G.isLocal=qn;G.isUtcOffset=Jn;G.isUtc=qr;G.isUTC=qr;G.zoneAbbr=ol;G.zoneName=ll;G.dates=Je("dates accessor is deprecated. Use date instead.",ia);G.months=Je("months accessor is deprecated. Use month instead",Dr);G.years=Je("years accessor is deprecated. Use year instead",Ar);G.zone=Je("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",$n);G.isDSTShifted=Je("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",Gn);function cl(t){return Ue(t*1e3)}function dl(){return Ue.apply(null,arguments).parseZone()}function oa(t){return t}var Te=Ls.prototype;Te.calendar=Ga;Te.longDateFormat=Za;Te.invalidDate=Qa;Te.ordinal=si;Te.preparse=oa;Te.postformat=oa;Te.relativeTime=ai;Te.pastFuture=ii;Te.set=Ha;Te.eras=Ro;Te.erasParse=Oo;Te.erasConvertYear=Lo;Te.erasAbbrRegex=Wo;Te.erasNameRegex=Bo;Te.erasNarrowRegex=Ho;Te.months=Si;Te.monthsShort=bi;Te.monthsParse=Ni;Te.monthsRegex=Pi;Te.monthsShortRegex=ki;Te.week=Ai;Te.firstDayOfYear=Mi;Te.firstDayOfWeek=Ii;Te.weekdays=Bi;Te.weekdaysMin=Hi;Te.weekdaysShort=Wi;Te.weekdaysParse=Gi;Te.weekdaysRegex=Zi;Te.weekdaysShortRegex=Ki;Te.weekdaysMinRegex=Qi;Te.isPM=tn;Te.meridiem=an;function ss(t,s,r,a){var i=pt(),n=it().set(a,s);return i[r](n,t)}function la(t,s,r){if(mt(t)&&(s=t,t=void 0),t=t||"",s!=null)return ss(t,s,r,"month");var a,i=[];for(a=0;a<12;a++)i[a]=ss(t,a,r,"month");return i}function sr(t,s,r,a){typeof t=="boolean"?(mt(s)&&(r=s,s=void 0),s=s||""):(s=t,r=s,t=!1,mt(s)&&(r=s,s=void 0),s=s||"");var i=pt(),n=t?i._week.dow:0,l,h=[];if(r!=null)return ss(s,(r+n)%7,a,"day");for(l=0;l<7;l++)h[l]=ss(s,(l+n)%7,a,"day");return h}function hl(t,s){return la(t,s,"months")}function ul(t,s){return la(t,s,"monthsShort")}function ml(t,s,r){return sr(t,s,r,"weekdays")}function pl(t,s,r){return sr(t,s,r,"weekdaysShort")}function gl(t,s,r){return sr(t,s,r,"weekdaysMin")}vt("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(t){var s=t%10,r=Ne(t%100/10)===1?"th":s===1?"st":s===2?"nd":s===3?"rd":"th";return t+r}});ee.lang=Je("moment.lang is deprecated. Use moment.locale instead.",vt);ee.langData=Je("moment.langData is deprecated. Use moment.localeData instead.",pt);var ot=Math.abs;function fl(){var t=this._data;return this._milliseconds=ot(this._milliseconds),this._days=ot(this._days),this._months=ot(this._months),t.milliseconds=ot(t.milliseconds),t.seconds=ot(t.seconds),t.minutes=ot(t.minutes),t.hours=ot(t.hours),t.months=ot(t.months),t.years=ot(t.years),this}function ca(t,s,r,a){var i=tt(s,r);return t._milliseconds+=a*i._milliseconds,t._days+=a*i._days,t._months+=a*i._months,t._bubble()}function xl(t,s){return ca(this,t,s,1)}function vl(t,s){return ca(this,t,s,-1)}function gr(t){return t<0?Math.floor(t):Math.ceil(t)}function yl(){var t=this._milliseconds,s=this._days,r=this._months,a=this._data,i,n,l,h,v;return t>=0&&s>=0&&r>=0||t<=0&&s<=0&&r<=0||(t+=gr(Us(r)+s)*864e5,s=0,r=0),a.milliseconds=t%1e3,i=qe(t/1e3),a.seconds=i%60,n=qe(i/60),a.minutes=n%60,l=qe(n/60),a.hours=l%24,s+=qe(l/24),v=qe(da(s)),r+=v,s-=gr(Us(v)),h=qe(r/12),r%=12,a.days=s,a.months=r,a.years=h,this}function da(t){return t*4800/146097}function Us(t){return t*146097/4800}function wl(t){if(!this.isValid())return NaN;var s,r,a=this._milliseconds;if(t=Xe(t),t==="month"||t==="quarter"||t==="year")switch(s=this._days+a/864e5,r=this._months+da(s),t){case"month":return r;case"quarter":return r/3;case"year":return r/12}else switch(s=this._days+Math.round(Us(this._months)),t){case"week":return s/7+a/6048e5;case"day":return s+a/864e5;case"hour":return s*24+a/36e5;case"minute":return s*1440+a/6e4;case"second":return s*86400+a/1e3;case"millisecond":return Math.floor(s*864e5)+a;default:throw new Error("Unknown unit "+t)}}function gt(t){return function(){return this.as(t)}}var ha=gt("ms"),jl=gt("s"),Sl=gt("m"),bl=gt("h"),_l=gt("d"),Nl=gt("w"),Cl=gt("M"),kl=gt("Q"),Pl=gt("y"),Tl=ha;function Al(){return tt(this)}function El(t){return t=Xe(t),this.isValid()?this[t+"s"]():NaN}function bt(t){return function(){return this.isValid()?this._data[t]:NaN}}var Il=bt("milliseconds"),Ml=bt("seconds"),Ul=bt("minutes"),Dl=bt("hours"),Rl=bt("days"),Ol=bt("months"),Ll=bt("years");function Yl(){return qe(this.days()/7)}var lt=Math.round,Ct={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function Fl(t,s,r,a,i){return i.relativeTime(s||1,!!r,t,a)}function $l(t,s,r,a){var i=tt(t).abs(),n=lt(i.as("s")),l=lt(i.as("m")),h=lt(i.as("h")),v=lt(i.as("d")),S=lt(i.as("M")),b=lt(i.as("w")),_=lt(i.as("y")),m=n<=r.ss&&["s",n]||n<r.s&&["ss",n]||l<=1&&["m"]||l<r.m&&["mm",l]||h<=1&&["h"]||h<r.h&&["hh",h]||v<=1&&["d"]||v<r.d&&["dd",v];return r.w!=null&&(m=m||b<=1&&["w"]||b<r.w&&["ww",b]),m=m||S<=1&&["M"]||S<r.M&&["MM",S]||_<=1&&["y"]||["yy",_],m[2]=s,m[3]=+t>0,m[4]=a,Fl.apply(null,m)}function zl(t){return t===void 0?lt:typeof t=="function"?(lt=t,!0):!1}function Bl(t,s){return Ct[t]===void 0?!1:s===void 0?Ct[t]:(Ct[t]=s,t==="s"&&(Ct.ss=s-1),!0)}function Wl(t,s){if(!this.isValid())return this.localeData().invalidDate();var r=!1,a=Ct,i,n;return typeof t=="object"&&(s=t,t=!1),typeof t=="boolean"&&(r=t),typeof s=="object"&&(a=Object.assign({},Ct,s),s.s!=null&&s.ss==null&&(a.ss=s.s-1)),i=this.localeData(),n=$l(this,!r,a,i),r&&(n=i.pastFuture(+this,n)),i.postformat(n)}var _s=Math.abs;function _t(t){return(t>0)-(t<0)||+t}function fs(){if(!this.isValid())return this.localeData().invalidDate();var t=_s(this._milliseconds)/1e3,s=_s(this._days),r=_s(this._months),a,i,n,l,h=this.asSeconds(),v,S,b,_;return h?(a=qe(t/60),i=qe(a/60),t%=60,a%=60,n=qe(r/12),r%=12,l=t?t.toFixed(3).replace(/\.?0+$/,""):"",v=h<0?"-":"",S=_t(this._months)!==_t(h)?"-":"",b=_t(this._days)!==_t(h)?"-":"",_=_t(this._milliseconds)!==_t(h)?"-":"",v+"P"+(n?S+n+"Y":"")+(r?S+r+"M":"")+(s?b+s+"D":"")+(i||a||t?"T":"")+(i?_+i+"H":"")+(a?_+a+"M":"")+(t?_+l+"S":"")):"P0D"}var ke=ps.prototype;ke.isValid=Rn;ke.abs=fl;ke.add=xl;ke.subtract=vl;ke.as=wl;ke.asMilliseconds=ha;ke.asSeconds=jl;ke.asMinutes=Sl;ke.asHours=bl;ke.asDays=_l;ke.asWeeks=Nl;ke.asMonths=Cl;ke.asQuarters=kl;ke.asYears=Pl;ke.valueOf=Tl;ke._bubble=yl;ke.clone=Al;ke.get=El;ke.milliseconds=Il;ke.seconds=Ml;ke.minutes=Ul;ke.hours=Dl;ke.days=Rl;ke.weeks=Yl;ke.months=Ol;ke.years=Ll;ke.humanize=Wl;ke.toISOString=fs;ke.toString=fs;ke.toJSON=fs;ke.locale=Kr;ke.localeData=ea;ke.toIsoString=Je("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",fs);ke.lang=Qr;he("X",0,0,"unix");he("x",0,0,"valueOf");ie("x",ds);ie("X",ci);Ee("X",function(t,s,r){r._d=new Date(parseFloat(t)*1e3)});Ee("x",function(t,s,r){r._d=new Date(Ne(t))});//! moment.js
ee.version="2.30.1";Ba(Ue);ee.fn=G;ee.min=In;ee.max=Mn;ee.now=Un;ee.utc=it;ee.unix=cl;ee.months=hl;ee.isDate=Bt;ee.locale=vt;ee.invalid=ns;ee.duration=tt;ee.isMoment=et;ee.weekdays=ml;ee.parseZone=dl;ee.localeData=pt;ee.isDuration=Xt;ee.monthsShort=ul;ee.weekdaysMin=gl;ee.defineLocale=qs;ee.updateLocale=cn;ee.locales=dn;ee.weekdaysShort=pl;ee.normalizeUnits=Xe;ee.relativeTimeRounding=zl;ee.relativeTimeThreshold=Bl;ee.calendarFormat=io;ee.prototype=G;ee.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};const ua=({videos:t})=>{const s=Oe();return e.jsx("div",{className:"feed",children:t.map(r=>e.jsxs("div",{className:"card",style:{cursor:"pointer"},onClick:()=>{console.log("Clicked item:",r),s(`/video/${r.categoryId||0}/${r.id}`)},children:[e.jsx("img",{src:r.thumbnail||"https://via.placeholder.com/320x180?text=No+Thumbnail",alt:""}),e.jsx("h2",{children:r.title}),e.jsx("h3",{children:r.channelTitle||"Creator"}),e.jsxs("p",{children:[za(r.viewCount||0)," Views ‚Ä¢ "," "+ee(r.created_at).fromNow()]})]},r.id))})};const Hl=({sidebar:t,category:s,selectedCategory:r,setSelectedCategory:a})=>{const[i,n]=c.useState([]),[l,h]=c.useState(!0),[v,S]=c.useState("");return Oe(),c.useEffect(()=>{(async()=>{h(!0),S("");let _=R.from("videos2").select("*").order("created_at",{ascending:!1});s&&s!=="All"&&(_=_.eq("category",s));let{data:m,error:x}=await _;x?(S("Failed to fetch videos."),n([])):n(m||[]),h(!1)})()},[s]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:`container ${t?"":" large-container"}`,children:[e.jsx("div",{className:"user-flow-section",children:e.jsxs("div",{className:"flow-steps",children:[e.jsxs("div",{className:"flow-step",children:[e.jsx("div",{className:"step-number",children:"1"}),e.jsxs("div",{className:"step-content",children:[e.jsx("h3",{children:"Choose Video"}),e.jsx("p",{children:"Browse and select your favorite video content"})]})]}),e.jsx("div",{className:"flow-arrow",children:"‚Üí"}),e.jsxs("div",{className:"flow-step",children:[e.jsx("div",{className:"step-number",children:"2"}),e.jsxs("div",{className:"step-content",children:[e.jsx("h3",{children:"Select Screenshot"}),e.jsx("p",{children:"Select the perfect moment to capture"})]})]}),e.jsx("div",{className:"flow-arrow",children:"‚Üí"}),e.jsxs("div",{className:"flow-step",children:[e.jsx("div",{className:"step-number",children:"3"}),e.jsxs("div",{className:"step-content",children:[e.jsx("h3",{children:"Make Merch"}),e.jsx("p",{children:"Create custom products with your screenshot"})]})]})]})}),l&&e.jsx("div",{style:{padding:24},children:"Loading videos..."}),v&&e.jsx("div",{style:{padding:24,color:"red"},children:v}),!l&&!v&&i.length>0&&e.jsx(ua,{videos:i})]})})};const rr=({isOpen:t,onClose:s,onSuccess:r})=>{const[a,i]=c.useState(!0),[n,l]=c.useState(""),[h,v]=c.useState(""),[S,b]=c.useState(!1),[_,m]=c.useState(""),[x,C]=c.useState(null),M=async L=>{var J,F,H,K,O,re;L.preventDefault(),b(!0),m("");const Y=!a;if(!n.trim()){m({type:"error",text:"Please enter your email."}),b(!1);return}if(a&&!h){m({type:"error",text:"Please enter your password."}),b(!1);return}try{const Z=a?"/api/auth/login":"/api/auth/signup/email-only",X=`${Me.BASE_URL}${Z}`,z={baseUrl:Me.BASE_URL,fullUrl:X,endpoint:Z,email:n.trim(),mode:a?"login":"signup"};console.log("üîç AuthModal - API_CONFIG.BASE_URL:",Me.BASE_URL),console.log("üîç AuthModal - Full URL:",X),console.log("üîç AuthModal - Email:",n.trim()),console.log("üîç AuthModal - Mode:",a?"login":"signup"),C(z);const B=Y?{email:n.trim()}:{email:n.trim(),password:h},u=new AbortController,p=setTimeout(()=>u.abort(),15e3),N=await fetch(X,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(B),credentials:"include",mode:"cors",signal:u.signal});clearTimeout(p),console.log("Response status:",N.status),console.log("Response ok:",N.ok),C(g=>({...g,responseStatus:N.status,responseOk:N.ok}));const o=(N.headers.get("content-type")||"").includes("application/json");if(!N.ok){const g=await N.text();console.error("Server error response:",g),C(T=>({...T,errorText:g}));try{const T=JSON.parse(g);throw N.status===409&&((J=T.error)!=null&&J.includes("already exists"))?new Error("This email is already registered. Please sign in instead."):T.error?new Error(T.error):new Error(`Server error: ${N.status} - ${g}`)}catch{throw new Error(`Server error: ${N.status} - ${g}`)}}const f=await N.json();if(Y&&f.success){m({type:"success",text:"Please check your email to verify your account and set your password."}),l(""),v("");return}f.success?(localStorage.setItem("user_authenticated","true"),localStorage.setItem("user_email",n.trim()),localStorage.setItem("customer_authenticated","true"),localStorage.setItem("customer_user",JSON.stringify({display_name:n.trim(),email:n.trim(),user_type:"customer"})),m({type:"success",text:f.message||"Login successful! Redirecting..."}),setTimeout(()=>{r&&r(),s()},1500)):m({type:"error",text:f.error||"Authentication failed"})}catch(Z){console.error("Auth error caught:",Z),console.error("Error message:",Z.message),console.error("Error stack:",Z.stack),console.error("Error name:",Z.name);let X=Z.message||Z.toString()||"Unknown error",z="Authentication error";Z.name==="AbortError"||(F=Z.message)!=null&&F.includes("aborted")?(z="Request timed out. Please check your connection and try again.",X="Request timeout - network may be slow or unstable"):(H=Z.message)!=null&&H.includes("Failed to fetch")||(K=Z.message)!=null&&K.includes("Load failed")||(O=Z.message)!=null&&O.includes("NetworkError")?(z="Network error. Please check your internet connection and try again.",X="Network connection failed - unable to reach server"):(re=Z.message)!=null&&re.includes("CORS")&&(z="CORS error. Please try refreshing the page.",X="CORS policy blocked the request");const B=(x==null?void 0:x.baseUrl)||Me.BASE_URL,u=(x==null?void 0:x.fullUrl)||`${B}${a?"/api/auth/login":"/api/auth/signup"}`;m({type:"error",text:`${z}: ${X}`}),C(p=>({...p,errorMessage:X,errorName:Z.name,baseUrl:B,fullUrl:u,networkError:!0}))}finally{b(!1)}},y=()=>{i(!a),m(""),C(null),a||v("")};return t?e.jsx("div",{className:"auth-modal-overlay",onClick:s,children:e.jsxs("div",{className:"auth-modal",onClick:L=>L.stopPropagation(),children:[e.jsxs("div",{className:"auth-modal-header",children:[e.jsx("div",{className:"auth-logo",children:"üéØ"}),e.jsx("h2",{children:"ScreenMerch Login"}),e.jsx("button",{className:"auth-close-btn",onClick:s,children:"√ó"})]}),e.jsxs("div",{className:"auth-message",children:[e.jsx("strong",{children:"Login Required"}),e.jsx("br",{}),"To create merchandise, please log in or create an account with your email address."]}),e.jsxs("form",{onSubmit:M,className:"auth-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email Address"}),e.jsx("input",{type:"email",id:"email",value:n,onChange:L=>l(L.target.value),required:!0,placeholder:"Enter your email"})]}),a&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",id:"password",value:h,onChange:L=>v(L.target.value),required:!0,placeholder:"Enter your password"})]}),e.jsx("button",{type:"submit",className:"auth-submit-btn",disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),"Processing..."]}):a?"Login":"Sign Up"})]}),e.jsxs("div",{className:"auth-toggle",children:[e.jsx("span",{children:a?"Don't have an account?":"Already have an account?"}),e.jsx("button",{type:"button",onClick:y,className:"auth-toggle-btn",children:a?"Sign Up":"Login"})]}),_&&e.jsxs("div",{className:`auth-message-display ${_.type}`,children:[_.text,x&&_.type==="error"&&e.jsxs("div",{style:{marginTop:"10px",padding:"10px",background:"rgba(0,0,0,0.1)",borderRadius:"4px",fontSize:"12px",wordBreak:"break-all",color:"#333"},children:[e.jsx("strong",{children:"Debug Info:"}),e.jsx("br",{}),"Base URL: ",x.baseUrl||"N/A",e.jsx("br",{}),"Full URL: ",x.fullUrl||"N/A",e.jsx("br",{}),x.responseStatus&&`Response Status: ${x.responseStatus}`,x.responseStatus&&e.jsx("br",{}),x.errorText&&e.jsxs("div",{style:{marginTop:"5px"},children:[e.jsx("strong",{children:"Error Response:"}),e.jsx("br",{}),x.errorText.substring(0,300)]}),x.errorMessage&&!x.errorText&&e.jsxs("div",{style:{marginTop:"5px"},children:[e.jsx("strong",{children:"Error:"})," ",x.errorMessage]})]})]})]})}):null},Vl=()=>{const[t,s]=c.useState(!1),[r,a]=c.useState(!1);return c.useEffect(()=>{const i=()=>{const n=window.innerWidth<=768,l=n&&window.innerHeight>window.innerWidth;s(n),a(l)};return i(),window.addEventListener("resize",i),window.addEventListener("orientationchange",i),()=>{window.removeEventListener("resize",i),window.removeEventListener("orientationchange",i)}},[]),{isMobile:t,isMobilePortrait:r}},Gl=({videoId:t,thumbnail:s,setThumbnail:r,screenshots:a,setScreenshots:i,videoRef:n,onVideoData:l,onScreenshotFunction:h})=>{const v=$t(),S=t||v.videoId,{isMobile:b,isMobilePortrait:_}=Vl(),[m,x]=c.useState(null),[C,M]=c.useState(!0),[y,L]=c.useState(""),Y=n||c.useRef(null),[J]=c.useState(c.useRef(null)),[F,H]=c.useState(!1);c.useEffect(()=>{const k=localStorage.getItem("user_authenticated"),I=localStorage.getItem("isAuthenticated"),$=k==="true"||I==="true";console.log("üîÑ PlayVideo mounted - Auth check:",{user_authenticated:k,isAuthenticated:I,isLoggedIn:$,allLocalStorage:Object.keys(localStorage).filter(W=>W.includes("auth")||W.includes("user"))}),$&&F&&(console.log("‚úÖ User is authenticated, closing auth modal"),H(!1))},[F]);const K=c.useRef(!1),[O,re]=c.useState(!1),[Z,X]=c.useState(0),[z,B]=c.useState(!1),[u,p]=c.useState({x:0,y:0,width:200,height:200}),[N,j]=c.useState(!1),[o,f]=c.useState(!1),[g,T]=c.useState(null),[d,w]=c.useState({x:0,y:0}),[P,Q]=c.useState([]),me=c.useCallback(k=>{},[]);c.useEffect(()=>{if(Y.current&&b){const k=Y.current;k.setAttribute("playsinline","true"),k.setAttribute("webkit-playsinline","true"),k.setAttribute("x-webkit-airplay","allow"),k.setAttribute("preload","metadata"),k.addEventListener("webkitbeginfullscreen",$=>{$.preventDefault(),k.webkitExitFullscreen()}),k.addEventListener("webkitendfullscreen",$=>{$.preventDefault()});const I=$=>{k.webkitPresentationMode==="fullscreen"&&k.webkitSetPresentationMode("inline")};return k.addEventListener("webkitpresentationmodechanged",I),()=>{k.removeEventListener("webkitbeginfullscreen",I),k.removeEventListener("webkitendfullscreen",I),k.removeEventListener("webkitpresentationmodechanged",I)}}},[b,Y.current]),c.useEffect(()=>{if(!S){L("No video selected."),M(!1);return}(async()=>{M(!0),L("");let{data:I,error:$}=await R.from("videos2").select("*").eq("id",S).single();if($)console.error("Supabase error:",$),L("Video not found."),x(null);else{if(!I.video_url){console.error("No video URL found in data"),L("Video URL is missing."),x(null),M(!1);return}try{const W=await fetch(I.video_url,{method:"HEAD"});W.ok||console.warn("Video URL may not be accessible:",W.status)}catch(W){console.warn("Could not test video URL accessibility:",W)}if(x(I),I.thumbnail||I.poster){const W=I.thumbnail||I.poster;r(W),i&&a.length===0&&i([W])}l&&l(I)}M(!1)})()},[S,r,i]),c.useEffect(()=>{Y.current&&Y.current.load(),i([]),Q([]),re(!1),X(0),K.current=!1},[S,i]);const ae=c.useCallback(async()=>{if(a.length>=6){me("Maximum 6 screenshots allowed. Please delete some screenshots first.");return}const I=Y.current;if(!I){me("Video not loaded yet. Please wait for the video to load.");return}const $=I.currentTime||0,W=(m==null?void 0:m.video_url)||I.src,de=await fe();if(de){const _e=a.length;if(i(xe=>{const ue=xe.length<6?[...xe,de]:xe;return ne(xe.length),ue}),Q(xe=>{const ue=xe.length<6?[...xe,$]:ue;return ue}),W){try{const oe=localStorage.getItem("pending_merch_data");if(oe){const ge=JSON.parse(oe);ge.print_quality_upgrade_timestamp=Date.now(),delete ge.print_quality_upgrade_failed,localStorage.setItem("pending_merch_data",JSON.stringify(ge)),window.dispatchEvent(new Event("localStorageUpdated"))}}catch(oe){console.warn("Failed to mark upgrade as starting:",oe)}const xe=new AbortController,ue=setTimeout(()=>{xe.abort(),console.warn("‚ö†Ô∏è Print quality upgrade timed out after 60 seconds");try{const oe=localStorage.getItem("pending_merch_data");if(oe){const ge=JSON.parse(oe);ge.print_quality_upgrade_failed=!0,localStorage.setItem("pending_merch_data",JSON.stringify(ge)),window.dispatchEvent(new Event("localStorageUpdated"))}}catch(oe){console.warn("Failed to mark upgrade as failed:",oe)}},6e4);fetch(Me.ENDPOINTS.CAPTURE_PRINT_QUALITY,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({video_url:W,timestamp:$,print_dpi:300}),signal:xe.signal}).then(oe=>{if(clearTimeout(ue),!oe.ok)throw new Error(`Server responded with status: ${oe.status}`);return oe.json()}).then(oe=>{if(oe.success&&oe.screenshot){i(ge=>{const je=[...ge];return je[_e]&&(je[_e]=oe.screenshot),je});try{const ge=localStorage.getItem("pending_merch_data");if(ge){const je=JSON.parse(ge);je.screenshots&&Array.isArray(je.screenshots)&&je.screenshots[_e]&&(je.screenshots[_e]=oe.screenshot,je.selected_screenshot===de&&(je.selected_screenshot=oe.screenshot),delete je.print_quality_upgrade_failed,delete je.print_quality_upgrade_timestamp,localStorage.setItem("pending_merch_data",JSON.stringify(je)),window.dispatchEvent(new Event("localStorageUpdated")))}}catch(ge){console.warn("Failed to update localStorage with print quality screenshot:",ge)}console.log("‚úÖ Screenshot upgraded to print quality and saved to localStorage")}else throw new Error(oe.error||"Server failed to capture print quality screenshot")}).catch(oe=>{clearTimeout(ue),oe.name==="AbortError"?console.warn("‚ö†Ô∏è Print quality upgrade aborted (timeout)"):console.warn("‚ö†Ô∏è Print quality upgrade failed, keeping client-side capture:",oe);try{const ge=localStorage.getItem("pending_merch_data");if(ge){const je=JSON.parse(ge);je.print_quality_upgrade_failed=!0,je.print_quality_upgrade_timestamp=Date.now(),localStorage.setItem("pending_merch_data",JSON.stringify(je)),window.dispatchEvent(new Event("localStorageUpdated"))}}catch(ge){console.warn("Failed to mark upgrade as failed:",ge)}})}return}if(!W){me("No video URL available for screenshot capture.");return}try{const _e=new AbortController,xe=setTimeout(()=>_e.abort(),15e3),ue=await fetch(Me.ENDPOINTS.CAPTURE_PRINT_QUALITY,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({video_url:W,timestamp:$,print_dpi:300}),signal:_e.signal});if(clearTimeout(xe),!ue.ok)throw new Error(`Server responded with status: ${ue.status}`);const oe=await ue.json();if(oe.success&&oe.screenshot){i(ge=>{const je=ge.length<6?[...ge,oe.screenshot]:ge;return ne(ge.length),je}),Q(ge=>{const je=ge.length<6?[...ge,$]:je;return je});return}else throw new Error(oe.error||"Server failed to capture print quality screenshot")}catch(_e){console.error("‚ùå Print quality capture failed, trying regular screenshot endpoint:",_e);try{const ue=new AbortController,oe=setTimeout(()=>ue.abort(),1e4),ge=await fetch(Me.ENDPOINTS.CAPTURE_SCREENSHOT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({video_url:W,timestamp:$,quality:95}),signal:ue.signal});if(clearTimeout(oe),ge.ok){const je=await ge.json();if(je.success&&je.screenshot){i(Ze=>{const st=Ze.length<6?[...Ze,je.screenshot]:Ze;return ne(Ze.length),st}),Q(Ze=>{const st=Ze.length<6?[...Ze,$]:st;return st});return}}}catch(ue){console.error("‚ùå Fallback screenshot capture also failed:",ue)}const xe=(m==null?void 0:m.thumbnail)||(m==null?void 0:m.poster)||I.poster;if(xe)console.warn("‚ö†Ô∏è Using thumbnail as last resort - screenshot capture failed"),i(ue=>{const oe=ue.length<6?[...ue,xe]:ue;return ne(ue.length),oe});else{const ue=document.createElement("div");ue.style.cssText=`
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #f44336;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 10000;
                    animation: slideIn 0.3s ease-out;
                    max-width: 300px;
                    font-size: 14px;
                    font-weight: 500;
                `,ue.textContent="Failed to capture screenshot. Please try again.",document.body.appendChild(ue),setTimeout(()=>document.body.removeChild(ue),3e3)}}},[m,Y,i]);c.useEffect(()=>{h&&m&&!C&&!K.current&&(h(ae),K.current=!0)},[h,m,C]);const we=async()=>{if(!(O||Date.now()-Z<100)){if(a.length>=6){me("Maximum 6 screenshots allowed. Please delete some screenshots first.");return}re(!0);try{await ae()}finally{re(!1)}}},fe=c.useCallback(async()=>{const k=Y.current;if(!k)return console.error("Video element not found"),null;try{if(!(k.readyState>=2&&k.videoWidth>0&&k.videoHeight>0))return null;const I=document.createElement("canvas"),$=I.getContext("2d"),W=k.getBoundingClientRect();return I.width=W.width,I.height=W.height,$.drawImage(k,0,0,I.width,I.height),I.toDataURL("image/jpeg",.9)}catch(I){return console.error("Error capturing video frame:",I),null}},[b]),Se=async()=>{const k=localStorage.getItem("user_authenticated"),I=localStorage.getItem("isAuthenticated"),$=k==="true"||I==="true";if(console.log("üõçÔ∏è Make Merch - Auth check after login:",{user_authenticated:k,isAuthenticated:I,isLoggedIn:$,allLocalStorage:Object.keys(localStorage).filter(de=>de.includes("auth")||de.includes("user"))}),console.log("üõçÔ∏è Make Merch - Auth check:",{user_authenticated:k,isAuthenticated:I,isLoggedIn:$}),!$){const de={thumbnail:s,videoUrl:(m==null?void 0:m.video_url)||window.location.href,screenshots:a.slice(0,6),videoTitle:(m==null?void 0:m.title)||"Unknown Video",creatorName:(m==null?void 0:m.channelTitle)||"Unknown Creator"};localStorage.setItem("pending_merch_data",JSON.stringify(de)),H(!0);return}const W={thumbnail:s,videoUrl:(m==null?void 0:m.video_url)||window.location.href,screenshots:a.slice(0,6),videoTitle:(m==null?void 0:m.title)||"Unknown Video",creatorName:(m==null?void 0:m.channelTitle)||"Unknown Creator"};localStorage.setItem("pending_merch_data",JSON.stringify(W)),await ce()},Ce=()=>{if(B(!z),!z){const k=Y.current;if(k){const I=k.getBoundingClientRect(),$=I.width/2-100,W=I.height/2-100;p({x:$,y:W,width:200,height:200})}}},V=k=>{if(!z)return;const I=Y.current;if(!I)return;const $=I.getBoundingClientRect(),W=k.clientX-$.left,de=k.clientY-$.top;W>=u.x&&W<=u.x+u.width&&de>=u.y&&de<=u.y+u.height&&(j(!0),w({x:W-u.x,y:de-u.y}))},le=k=>{if(!z||!N&&!o)return;const I=Y.current;if(!I)return;const $=I.getBoundingClientRect(),W=k.clientX-$.left,de=k.clientY-$.top;if(N){const _e=Math.max(0,Math.min($.width-u.width,W-d.x)),xe=Math.max(0,Math.min($.height-u.height,de-d.y));p(ue=>({...ue,x:_e,y:xe}))}else if(o){let _e=u.width,xe=u.height,ue=u.x,oe=u.y;if(g.includes("right")&&(_e=Math.max(50,W-u.x)),g.includes("left")){const ge=u.x+u.width-50;ue=Math.min(ge,W),_e=u.x+u.width-ue}if(g.includes("bottom")&&(xe=Math.max(50,de-u.y)),g.includes("top")){const ge=u.y+u.height-50;oe=Math.min(ge,de),xe=u.y+u.height-oe}p({x:ue,y:oe,width:_e,height:xe})}},pe=()=>{j(!1),f(!1),T(null)},E=k=>{if(!z)return;k.preventDefault(),k.stopPropagation();const I=Y.current;if(!I)return;const $=k.touches[0],W=I.getBoundingClientRect(),de=$.clientX-W.left,_e=$.clientY-W.top;de>=u.x&&de<=u.x+u.width&&_e>=u.y&&_e<=u.y+u.height&&(j(!0),w({x:de-u.x,y:_e-u.y}))},U=k=>{if(!z||!N&&!o)return;k.preventDefault(),k.stopPropagation();const I=Y.current;if(!I)return;const $=k.touches[0],W=I.getBoundingClientRect(),de=$.clientX-W.left,_e=$.clientY-W.top;if(N){const xe=Math.max(0,Math.min(W.width-u.width,de-d.x)),ue=Math.max(0,Math.min(W.height-u.height,_e-d.y));p(oe=>({...oe,x:xe,y:ue}))}else if(o){let xe=u.width,ue=u.height,oe=u.x,ge=u.y;if(g.includes("right")&&(xe=Math.max(50,de-u.x)),g.includes("left")){const je=u.x+u.width-50;oe=Math.min(je,de),xe=u.x+u.width-oe}if(g.includes("bottom")&&(ue=Math.max(50,_e-u.y)),g.includes("top")){const je=u.y+u.height-50;ge=Math.min(je,_e),ue=u.y+u.height-ge}p({x:oe,y:ge,width:xe,height:ue})}},A=k=>{k&&(k.preventDefault(),k.stopPropagation()),j(!1),f(!1),T(null)},q=(k,I)=>{I.stopPropagation(),I.preventDefault(),f(!0),T(k)},ve=(k,I)=>{I.stopPropagation(),I.preventDefault(),f(!0),T(k)},Ae=k=>{if(!o)return;k.preventDefault(),k.stopPropagation();const I=Y.current;if(!I)return;const $=k.touches[0],W=I.getBoundingClientRect(),de=$.clientX-W.left,_e=$.clientY-W.top;let xe=u.width,ue=u.height,oe=u.x,ge=u.y;if(g.includes("right")&&(xe=Math.max(50,de-u.x)),g.includes("left")){const je=u.x+u.width-50;oe=Math.min(je,de),xe=u.x+u.width-oe}if(g.includes("bottom")&&(ue=Math.max(50,_e-u.y)),g.includes("top")){const je=u.y+u.height-50;ge=Math.min(je,_e),ue=u.y+u.height-ge}p({x:oe,y:ge,width:xe,height:ue})},be=k=>{k&&(k.preventDefault(),k.stopPropagation()),f(!1),T(null)},D=async()=>{if(!z)return;const k=Y.current;if(k)try{if(!(m!=null&&m.video_url)){alert("Video URL not available. Please try again.");return}const I=k.currentTime||0,$=m.video_url,W=await fetch(Me.ENDPOINTS.CAPTURE_PRINT_QUALITY,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({video_url:$,timestamp:I,print_dpi:300})});if(!W.ok)throw new Error(`Server error: ${W.status}`);const de=await W.json();if(!de.success||!de.screenshot)throw new Error(de.error||"Server failed to capture screenshot");const _e=de.screenshot,xe=document.createElement("canvas"),ue=xe.getContext("2d"),oe=new Image;oe.onload=()=>{try{const ge=k.getBoundingClientRect(),je=ge.width,Ze=ge.height,st=oe.width/je,Mt=oe.height/Ze,xs=Math.round(u.x*st),xa=Math.round(u.y*Mt),ar=Math.round(u.width*st),ir=Math.round(u.height*Mt),nr=Math.max(0,Math.min(oe.width-ar,xs)),or=Math.max(0,Math.min(oe.height-ir,xa)),vs=Math.min(ar,oe.width-nr),ys=Math.min(ir,oe.height-or);xe.width=vs,xe.height=ys,ue.clearRect(0,0,xe.width,xe.height),ue.drawImage(oe,nr,or,vs,ys,0,0,vs,ys);const va=xe.toDataURL("image/jpeg",.9);i(ws=>ws.length<6?[...ws,va]:ws),B(!1)}catch(ge){console.error("Error cropping screenshot:",ge),alert("Failed to crop image. Please try again.")}},oe.onerror=()=>{console.error("Failed to load screenshot for cropping"),alert("Failed to load screenshot for cropping. Please try again.")},oe.src=_e}catch(I){console.error("Error applying crop:",I),console.error("Error details:",{videoElement:!!k,videoReadyState:k==null?void 0:k.readyState,cropArea:u}),alert("Failed to crop image. Please try again.")}},te=()=>{B(!1),j(!1),f(!1),T(null)},ce=async()=>{try{const k={thumbnail:s,videoUrl:(m==null?void 0:m.video_url)||window.location.href,screenshots:a.slice(0,6),screenshot_timestamp:P[0]||0,videoTitle:(m==null?void 0:m.title)||"Unknown Video",creatorName:(m==null?void 0:m.channelTitle)||"Unknown Creator"},I=await fetch(Me.ENDPOINTS.CREATE_PRODUCT,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(k)});if(!I.ok){const W=await I.text();throw console.error("Server error response:",W),new Error(`Server error: ${I.status} - ${W}`)}const $=await I.json();$.success?b?setTimeout(()=>{window.location.href="/merchandise"},1e3):window.location.href="/merchandise":(console.error("Failed to create product:",$),alert(`Failed to create merch product page: ${$.error||"Unknown error"}`))}catch(k){console.error("Make Merch error:",k),alert(`Error connecting to merch server: ${k.message}. Please check the console for more details.`)}},se=()=>{H(!1),setTimeout(()=>{ce()},1e3)},ne=c.useCallback(k=>{},[]);return C?e.jsxs("div",{style:{padding:24,textAlign:"center",background:"#f8f9fa",borderRadius:"8px",border:"1px solid #dee2e6"},children:[e.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #007bff",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 16px auto"}}),e.jsx("p",{children:"Loading video..."}),m&&e.jsxs("p",{style:{fontSize:"14px",color:"#6c757d"},children:["URL: ",m.video_url]})]}):y||!m?e.jsxs("div",{style:{padding:24,color:"red",background:"#f8d7da",borderRadius:"8px",border:"1px solid #f5c6cb"},children:[e.jsx("h3",{children:"Video Error"}),e.jsx("p",{children:y||"Video not found."}),m&&e.jsxs("div",{style:{marginTop:"12px",fontSize:"14px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Video URL:"})," ",m.video_url]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Video ID:"})," ",S]})]})]}):e.jsxs("div",{className:`play-video ${z?"crop-mode-active":""}`,children:[e.jsx("div",{className:"video-container",ref:J,style:{position:"relative",display:"inline-block",marginBottom:b?"0px":"15px"},children:e.jsxs("div",{style:{position:"relative",display:"inline-block",width:"100%",maxWidth:"100%"},children:[e.jsx("video",{ref:Y,controls:!0,poster:m.thumbnail||"",width:"100%",height:b?"320":"360",style:{background:"#000",width:"100%",height:b?"320px":"360px",outline:"none"},src:m.video_url,crossOrigin:"anonymous",playsInline:!0,"webkit-playsinline":"true","x-webkit-airplay":"allow",preload:"metadata",disablePictureInPicture:!0,onCanPlay:()=>{M(!1)},onLoadedData:()=>{M(!1)}},S),e.jsx("button",{onClick:Ce,style:{position:"absolute",top:"10px",left:"10px",background:z?"rgba(0, 123, 255, 0.9)":"rgba(0, 0, 0, 0.7)",border:"none",borderRadius:"50%",width:"40px",height:"40px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,transition:"all 0.2s ease"},onMouseEnter:k=>{k.target.style.background=z?"rgba(0, 123, 255, 1)":"rgba(0, 0, 0, 0.9)",k.target.style.transform="scale(1.1)"},onMouseLeave:k=>{k.target.style.background=z?"rgba(0, 123, 255, 0.9)":"rgba(0, 0, 0, 0.7)",k.target.style.transform="scale(1)"},title:z?"Exit Crop Mode":"Crop Screenshot",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"white",children:e.jsx("path",{d:"M6 2L8 4L10 2L12 4L14 2L16 4L18 2V6L16 8L18 10L16 12L18 14L16 16L18 18H14L12 16L10 18L8 16L6 18H2V14L4 12L2 10L4 8L2 6V2H6Z"})})}),z&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:5,cursor:N?"move":"default"},onMouseDown:V,onMouseMove:le,onMouseUp:pe,onMouseLeave:pe,onTouchStart:E,onTouchMove:U,onTouchEnd:A,children:[e.jsxs("div",{className:"crop-area",style:{position:"absolute",left:u.x,top:u.y,width:u.width,height:u.height,border:"2px dashed #007bff",backgroundColor:"rgba(0, 123, 255, 0.1)",cursor:N?"move":"default"},children:[e.jsx("div",{className:"resize-handle",style:{position:"absolute",top:b?-10:-5,left:b?-10:-5,width:b?20:10,height:b?20:10,backgroundColor:"#007bff",borderRadius:"50%",cursor:"nw-resize",border:b?"2px solid white":"none",boxShadow:b?"0 2px 4px rgba(0,0,0,0.3)":"none",zIndex:10},onMouseDown:k=>q("top-left",k),onTouchStart:k=>ve("top-left",k),onTouchMove:Ae,onTouchEnd:be}),e.jsx("div",{className:"resize-handle",style:{position:"absolute",top:b?-10:-5,right:b?-10:-5,width:b?20:10,height:b?20:10,backgroundColor:"#007bff",borderRadius:"50%",cursor:"ne-resize",border:b?"2px solid white":"none",boxShadow:b?"0 2px 4px rgba(0,0,0,0.3)":"none",zIndex:10},onMouseDown:k=>q("top-right",k),onTouchStart:k=>ve("top-right",k),onTouchMove:Ae,onTouchEnd:be}),e.jsx("div",{className:"resize-handle",style:{position:"absolute",bottom:b?-10:-5,left:b?-10:-5,width:b?20:10,height:b?20:10,backgroundColor:"#007bff",borderRadius:"50%",cursor:"sw-resize",border:b?"2px solid white":"none",boxShadow:b?"0 2px 4px rgba(0,0,0,0.3)":"none",zIndex:10},onMouseDown:k=>q("bottom-left",k),onTouchStart:k=>ve("bottom-left",k),onTouchMove:Ae,onTouchEnd:be}),e.jsx("div",{className:"resize-handle",style:{position:"absolute",bottom:b?-10:-5,right:b?-10:-5,width:b?20:10,height:b?20:10,backgroundColor:"#007bff",borderRadius:"50%",cursor:"se-resize",border:b?"2px solid white":"none",boxShadow:b?"0 2px 4px rgba(0,0,0,0.3)":"none",zIndex:10},onMouseDown:k=>q("bottom-right",k),onTouchStart:k=>ve("bottom-right",k),onTouchMove:Ae,onTouchEnd:be})]}),e.jsxs("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",display:"flex",gap:"10px",zIndex:6},children:[e.jsx("button",{onClick:te,onTouchStart:k=>k.stopPropagation(),onTouchEnd:k=>k.stopPropagation(),style:{padding:b?"12px 20px":"8px 16px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:b?"16px":"14px",minHeight:b?"44px":"auto",minWidth:b?"80px":"auto",touchAction:"manipulation",zIndex:20},children:"Cancel"}),e.jsx("button",{onClick:D,onTouchStart:k=>k.stopPropagation(),onTouchEnd:k=>k.stopPropagation(),style:{padding:b?"12px 20px":"8px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:b?"16px":"14px",minHeight:b?"44px":"auto",minWidth:b?"80px":"auto",touchAction:"manipulation",zIndex:20},children:"Apply Crop"})]})]})]})}),e.jsxs("div",{className:"screenmerch-actions",style:{display:"flex",gap:"10px",marginBottom:"0px",marginTop:b?"5px":"0px",flexWrap:"wrap"},children:[e.jsx("button",{className:"screenmerch-btn",onClick:we,disabled:O||a.length>=6,style:{padding:"14px 24px",backgroundColor:O||a.length>=6?"#6c757d":"#007bff",color:"white",border:"none",borderRadius:"5px",cursor:O||a.length>=6?"not-allowed":"pointer",fontWeight:"bold",opacity:O||a.length>=6?.7:1,textAlign:"center",lineHeight:"1.2"},children:O?"Capturing...":a.length>=6?"Max Screenshots":"Select Screenshot"}),e.jsx("button",{className:"screenmerch-btn",onClick:Se,style:{padding:"10px 20px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",touchAction:"manipulation"},children:"Make Merch"})]}),e.jsx("h3",{style:{marginTop:"15px",marginBottom:b?"5px":"15px",fontWeight:"600",fontSize:"22px",textAlign:"center"},children:m.title}),e.jsx("div",{className:"publisher",children:e.jsx("div",{})}),e.jsx(rr,{isOpen:F,onClose:()=>H(!1),onSuccess:se})]})},ql=({thumbnail:t,screenshots:s,onDeleteScreenshot:r})=>e.jsx("div",{className:"screenmerch-images-grid",children:[0,1,2,3,4,5].map(a=>e.jsx("div",{className:"screenmerch-image-box",children:s[a]?e.jsxs("div",{className:"screenmerch-img-wrapper",children:[e.jsx("img",{src:s[a],alt:`Screenshot ${a+1}`,className:"screenmerch-preview",style:{maxWidth:"100%",maxHeight:"100%",width:"auto",height:"auto",objectFit:"contain"},onError:i=>console.error(`Failed to load screenshot ${a+1}:`,i.target.src),onLoad:()=>{}}),e.jsx("div",{className:"screenmerch-buttons",children:e.jsx("button",{className:"screenmerch-delete-btn",onClick:()=>r(a),title:"Delete screenshot",children:"√ó"})})]}):e.jsx("div",{className:"screenmerch-placeholder",children:"No screenshot"})},a))});const Jl=({sidebar:t})=>{const{videoId:s,categoryId:r}=$t(),[a,i]=c.useState(null),[n,l]=c.useState([]),[h,v]=c.useState(!1),[S,b]=c.useState(!1),[_,m]=c.useState(!1),[x,C]=c.useState(null),M=c.useRef(null),[y,L]=c.useState(0),[Y,J]=c.useState(!0),[F,H]=c.useState(!1),[K,O]=c.useState(!1);c.useEffect(()=>{const p=()=>{const N=window.innerWidth<=768,j=N&&window.innerHeight>window.innerWidth;v(N),b(j)};return p(),window.addEventListener("resize",p),window.addEventListener("orientationchange",p),()=>{window.removeEventListener("resize",p),window.removeEventListener("orientationchange",p)}},[]),c.useEffect(()=>{if(s){const p=setTimeout(()=>{if(h){const N=document.querySelector(".video-container"),j=document.querySelector("nav");if(N&&j){const o=j.offsetHeight,g=N.getBoundingClientRect().top+window.scrollY-o-10;window.scrollTo({top:g,behavior:"smooth"})}else if(N){const f=N.getBoundingClientRect().top+window.scrollY-70;window.scrollTo({top:f,behavior:"smooth"})}else window.scrollTo({top:0,behavior:"smooth"})}else{const N=document.querySelector(".video-container"),j=document.querySelector("nav");if(N&&j){const o=j.offsetHeight,g=N.getBoundingClientRect().top+window.scrollY-o;window.scrollTo({top:g,behavior:"smooth"})}else if(N){const f=N.getBoundingClientRect().top+window.scrollY-80;window.scrollTo({top:f,behavior:"smooth"})}else window.scrollTo({top:0,behavior:"smooth"})}},500);return()=>clearTimeout(p)}},[h,s]),c.useEffect(()=>{a&&n.length===0&&l([a])},[a,n.length]),c.useEffect(()=>{L(n.length),K||n.length>1?(J(!1),H(!0)):(J(!0),H(!1))},[n,K]),c.useEffect(()=>{s&&a&&(l([a]),O(!1))},[s,a]);const re=p=>{l(N=>N.filter((j,o)=>o!==p))},Z=(p,N)=>{l(j=>{const o=[...j];return o[p]=N,o})},X=async()=>{console.log("Step 2 clicked - attempting screenshot capture");const p=n.length,N=document.querySelector(".screenmerch-btn");N&&N.textContent.includes("Select Screenshot")?(console.log("Clicking working screenshot button..."),N.click(),O(!0),console.log("Screenshot function completed"),setTimeout(()=>{n.length>p&&console.log("Screenshot successfully added, switching pulse states")},500)):console.log("Screenshot button not found or not ready yet")},z=async()=>{const p=localStorage.getItem("user_authenticated"),N=localStorage.getItem("isAuthenticated"),j=p==="true"||N==="true";console.log("üõçÔ∏è Make Merch - Auth check:",{user_authenticated:p,isAuthenticated:N,isLoggedIn:j});try{const o={thumbnail:a,videoUrl:window.location.href,screenshots:n.slice(0,6),videoTitle:(x==null?void 0:x.title)||"Unknown Video",creatorName:(x==null?void 0:x.channelTitle)||"Unknown Creator"};localStorage.setItem("pending_merch_data",JSON.stringify(o))}catch(o){console.warn("Failed saving pending_merch_data:",o)}if(!j){m(!0);return}await B()},B=async()=>{try{const p=localStorage.getItem("user_authenticated"),N=localStorage.getItem("user_email"),j=window.location.href,o=(x==null?void 0:x.title)||"Unknown Video",f=(x==null?void 0:x.channelTitle)||"Unknown Creator",g={thumbnail:a,videoUrl:j,videoTitle:o,creatorName:f,screenshots:n.slice(0,6),isAuthenticated:p==="true",userEmail:N||""},T=await fetch(Me.ENDPOINTS.CREATE_PRODUCT,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(g)});if(!T.ok){const w=await T.text();throw console.error("Server error response:",w),new Error(`Server error: ${T.status} - ${w}`)}const d=await T.json();if(d.success&&d.product_url)if(window.innerWidth<=768)try{window.location.href=d.product_url}catch{const P=document.createElement("div");P.style.cssText=`
             position: fixed;
             top: 20px;
             right: 20px;
             background: #4CAF50;
             color: white;
             padding: 12px 20px;
             border-radius: 8px;
             box-shadow: 0 4px 12px rgba(0,0,0,0.15);
             z-index: 10000;
             animation: slideIn 0.3s ease-out;
             max-width: 300px;
             font-size: 14px;
             font-weight: 500;
           `,P.textContent=`Your merch page is ready! Please visit: ${d.product_url}`,document.body.appendChild(P),setTimeout(()=>document.body.removeChild(P),5e3)}else window.open(d.product_url,"_blank");else{console.error("Failed to create product:",d);const w=document.createElement("div");w.style.cssText=`
           position: fixed;
           top: 20px;
           right: 20px;
           background: #f44336;
           color: white;
           padding: 12px 20px;
           border-radius: 8px;
           box-shadow: 0 4px 12px rgba(0,0,0,0.15);
           z-index: 10000;
           animation: slideIn 0.3s ease-out;
           max-width: 300px;
           font-size: 14px;
           font-weight: 500;
         `,w.textContent=`Failed to create merch product page: ${d.error||"Unknown error"}`,document.body.appendChild(w),setTimeout(()=>document.body.removeChild(w),5e3)}}catch(p){console.error("Make Merch error:",p);const N=document.createElement("div");N.style.cssText=`
         position: fixed;
         top: 20px;
         right: 20px;
         background: #f44336;
         color: white;
         padding: 12px 20px;
         border-radius: 8px;
         box-shadow: 0 4px 12px rgba(0,0,0,0.15);
         z-index: 10000;
         animation: slideIn 0.3s ease-out;
         max-width: 300px;
         font-size: 14px;
         font-weight: 500;
       `,N.textContent=`Error connecting to merch server: ${p.message}`,document.body.appendChild(N),setTimeout(()=>document.body.removeChild(N),5e3)}},u=()=>{z()};return e.jsxs("div",{className:"video-page-container",children:[e.jsx("div",{className:"user-flow-section",children:e.jsxs("div",{className:"flow-steps",children:[e.jsxs("div",{className:"flow-step clickable-step",onClick:X,style:{cursor:"pointer",userSelect:"none",WebkitTapHighlightColor:"transparent"},children:[e.jsx("div",{className:`step-number ${Y?"pulse":""}`,children:"2"}),e.jsxs("div",{className:"step-content",children:[e.jsx("h3",{children:"Select Screenshot"}),e.jsx("p",{children:"Select the perfect screenshot to capture"})]})]}),e.jsx("div",{className:"flow-arrow",children:"‚Üí"}),e.jsxs("div",{className:"flow-step",onClick:u,style:{cursor:"pointer",userSelect:"none",WebkitTapHighlightColor:"transparent"},children:[e.jsx("div",{className:`step-number ${F?"pulse":""}`,children:"3"}),e.jsxs("div",{className:"step-content",children:[e.jsx("h3",{children:"Make Merchandise"}),e.jsx("p",{children:"Create custom products with your screenshot"})]})]})]})}),e.jsxs("div",{className:"main-container",children:[e.jsx("div",{className:"video-viewer",children:s?e.jsx(Gl,{videoId:s,thumbnail:a,setThumbnail:i,screenshots:n,setScreenshots:l,videoRef:M,onVideoData:C}):e.jsx("div",{style:{padding:24,color:"red"},children:"No video selected."})}),e.jsxs("div",{className:"screenshots-section",id:"screenshotsSection",style:{position:"relative"},children:[h&&s&&e.jsx("div",{id:"screenshotCounter",style:{position:"absolute",top:"10px",right:"10px",background:y>=6?"#ff4444":"#fff",border:`2px solid ${y>=6?"#ff4444":"#ddd"}`,borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"16px",color:y>=6?"#fff":"#333",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",zIndex:100},children:y}),e.jsx(ql,{thumbnail:a,screenshots:n,onDeleteScreenshot:re,onCropScreenshot:Z})]})]}),e.jsx(rr,{isOpen:_,onClose:()=>m(!1),onSuccess:B})]})};const Xl=({sidebar:t})=>{var X,z,B;const[s,r]=c.useState(null),[a,i]=c.useState(null),[n,l]=c.useState(!0),h=Oe(),[v,S]=c.useState(""),[b,_]=c.useState(""),[m,x]=c.useState(null),[C,M]=c.useState(null),[y,L]=c.useState(!1),[Y,J]=c.useState(""),[F,H]=c.useState(0);c.useEffect(()=>{(async()=>{var p,N,j;try{const o=localStorage.getItem("isAuthenticated"),f=localStorage.getItem("user");let g=null;if(o==="true"&&f)g=JSON.parse(f),console.log("üîê Upload: Found Google OAuth user:",g);else{const{data:{user:w}}=await R.auth.getUser();w&&(g=w,console.log("üîê Upload: Found Supabase user:",g))}if(!g){console.log("üîê Upload: No authenticated user found"),J("‚ùå Please log in to upload videos"),l(!1);return}r(g);const{data:T,error:d}=await R.from("users").select("*").eq("id",g.id).single();if(T)i(T);else if(d&&d.code==="PGRST116"){const{data:w,error:P}=await R.from("users").upsert({id:g.id,email:g.email,username:((p=g.email)==null?void 0:p.split("@")[0])||"user",display_name:((N=g.user_metadata)==null?void 0:N.name)||((j=g.email)==null?void 0:j.split("@")[0])||"User",role:"creator",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{onConflict:"id",ignoreDuplicates:!1}).select().single();if(P&&P.message.includes("duplicate key")){console.log("Duplicate key detected, fetching existing user");const{data:Q,error:me}=await R.from("users").select("*").eq("id",g.id).single();Q&&i(Q)}else w&&i(w)}}catch(o){console.error("Error fetching user:",o),J("‚ùå Authentication error. Please log in again.")}finally{l(!1)}})()},[]);const K=(u,p)=>{if(!u)return"No file selected";if(p==="video"){if(!u.type.startsWith("video/"))return"Please select a valid video file";if(u.size>100*1024*1024)return"Video file size must be less than 100MB"}else if(p==="image"){if(!u.type.startsWith("image/"))return"Please select a valid image file";if(u.size>10*1024*1024)return"Image file size must be less than 10MB"}return null},O=u=>{const p=u.target.files[0],N=K(p,"video");N?(J(`‚ùå ${N}`),x(null)):(x(p),J(""))},re=u=>{const p=u.target.files[0],N=K(p,"image");N?(J(`‚ùå ${N}`),M(null)):(M(p),J(""))},Z=async u=>{var p,N,j;if(u.preventDefault(),J(""),H(0),!v.trim()){J("‚ùå Please enter a video title");return}if(!b.trim()){J("‚ùå Please enter a video description");return}if(!m){J("‚ùå Please select a video file");return}if(!C){J("‚ùå Please select a thumbnail image");return}if(!s||!s.id){J("‚ùå Please log in to upload videos");return}L(!0);try{console.log("Starting upload process..."),console.log("User ID:",s.id);const o=await fetch("https://screenmerch.fly.dev/api/users/ensure-exists",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:s.id,email:s.email,display_name:(a==null?void 0:a.display_name)||((p=s.user_metadata)==null?void 0:p.name)})});if(!o.ok)throw new Error("Failed to ensure user exists in database");const f=await o.json();console.log("User ensured:",f),H(10);const g=m.name.split(".").pop(),T=`${s.id}/${Date.now()}.${g}`;console.log("Uploading video to:",T);const{error:d,data:w}=await R.storage.from("videos2").upload(T,m,{cacheControl:"3600",upsert:!1});if(d)throw console.error("Video upload error:",d),new Error(`Video upload failed: ${d.message}`);H(50);const{data:P}=R.storage.from("videos2").getPublicUrl(T);console.log("Video uploaded successfully:",P.publicUrl),H(60);const Q=C.name.split(".").pop(),me=`${s.id}/${Date.now()}_thumb.${Q}`;console.log("Uploading thumbnail to:",me);const{error:ae,data:we}=await R.storage.from("thumbnails").upload(me,C,{cacheControl:"3600",upsert:!1});if(ae)throw console.error("Thumbnail upload error:",ae),new Error(`Thumbnail upload failed: ${ae.message}`);H(80);const{data:fe}=R.storage.from("thumbnails").getPublicUrl(me);console.log("Thumbnail uploaded successfully:",fe.publicUrl),H(90),console.log("Inserting video metadata into database...");const Se={title:v.trim(),description:b.trim(),video_url:P.publicUrl,thumbnail:fe.publicUrl,channelTitle:(a==null?void 0:a.display_name)||((N=s.user_metadata)==null?void 0:N.name)||((j=s.email)==null?void 0:j.split("@")[0])||"Unknown Creator",user_id:s.id,verification_status:"verified_via_supabase_auth",created_at:new Date().toISOString()};console.log("Video metadata:",Se);const{error:Ce,data:V}=await R.from("videos2").insert([Se]).select();if(Ce)throw console.error("Database insert error:",Ce),new Error(`Database error: ${Ce.message}`);H(100),console.log("Video uploaded and saved successfully:",V),J("‚úÖ Video uploaded successfully! Redirecting you to the homepage..."),S(""),_(""),x(null),M(null),setTimeout(()=>{h("/")},2e3)}catch(o){if(console.error("Upload error:",o),J(`‚ùå Upload failed: ${o.message}`),o.message.includes("Database error")&&m)try{const f=m.name.split(".").pop(),g=`${s.id}/${Date.now()}.${f}`;await R.storage.from("videos2").remove([g]),console.log("Cleaned up uploaded video file")}catch(f){console.error("Failed to cleanup video file:",f)}}finally{L(!1),H(0)}};return n?e.jsx("div",{className:`container ${t?"":" large-container"}`,children:e.jsx("h2",{children:"Loading..."})}):s?e.jsx("div",{className:`container ${t?"":" large-container"}`,children:e.jsxs("div",{style:{maxWidth:700,margin:"20px auto",background:"#fff",padding:24,borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h2",{children:"Upload a New Video"}),e.jsxs("div",{className:"uploader-info",children:[e.jsx("img",{src:(a==null?void 0:a.profile_image_url)||((X=s.user_metadata)==null?void 0:X.picture)||"/default-avatar.jpg",alt:"Your avatar"}),e.jsxs("p",{children:["You are uploading as: ",e.jsx("strong",{children:(a==null?void 0:a.display_name)||((z=s.user_metadata)==null?void 0:z.name)||((B=s.email)==null?void 0:B.split("@")[0])||"Your Channel"})]})]}),e.jsxs("form",{onSubmit:Z,children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{children:"Title *"}),e.jsx("input",{type:"text",value:v,onChange:u=>S(u.target.value),required:!0,style:{width:"100%",padding:8,marginTop:4},placeholder:"Enter video title"})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{children:"Description *"}),e.jsx("textarea",{value:b,onChange:u=>_(u.target.value),required:!0,style:{width:"100%",padding:8,marginTop:4},rows:4,placeholder:"Enter video description"})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{children:"Video File * (Max 100MB)"}),e.jsx("input",{type:"file",accept:"video/*",onChange:O,required:!0,style:{display:"block",marginTop:4}}),m&&e.jsxs("small",{style:{color:"#666",marginTop:4,display:"block"},children:["Selected: ",m.name," (",(m.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{children:"Thumbnail Image * (Max 10MB)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:re,required:!0,style:{display:"block",marginTop:4}}),C&&e.jsxs("small",{style:{color:"#666",marginTop:4,display:"block"},children:["Selected: ",C.name," (",(C.size/1024/1024).toFixed(2)," MB)"]})]}),F>0&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{width:"100%",backgroundColor:"#f0f0f0",borderRadius:4,overflow:"hidden",marginTop:8},children:e.jsx("div",{style:{width:`${F}%`,height:20,backgroundColor:"#4CAF50",transition:"width 0.3s ease"}})}),e.jsxs("small",{style:{color:"#666"},children:["Upload Progress: ",F,"%"]})]}),Y&&e.jsx("div",{className:`upload-message ${Y.includes("‚úÖ")?"success":"error"}`,children:Y}),e.jsx("button",{type:"submit",className:"upload-btn",disabled:y,children:y?"Uploading...":"Upload Video"})]})]})}):e.jsxs("div",{className:`container ${t?"":" large-container"}`,style:{textAlign:"center",paddingTop:"5rem"},children:[e.jsx("h2",{children:"Please Log In to Upload"}),e.jsx("p",{children:"You must sign in with Google to upload videos."}),e.jsx("button",{className:"sign-in-btn",onClick:()=>{alert("Upload page Google button clicked!");const u=`https://screenmerch.fly.dev/api/auth/google/login?return_url=${encodeURIComponent(window.location.href)}`;console.log("Upload page redirecting to:",u),window.location.href=u},children:"Sign In with Google"})]})};const Zl=()=>{const{username:t}=$t(),s=Oe(),[r,a]=c.useState(null),[i,n]=c.useState([]),[l,h]=c.useState(!0),[v,S]=c.useState(null),[b,_]=c.useState(null);return c.useEffect(()=>{t&&(async()=>{h(!0),S(null);const{data:x,error:C}=await R.from("users").select("*").eq("username",t).single();if(C||!x){S("User not found"),h(!1);return}a(x);const{data:M}=await R.from("videos2").select("*").eq("channelTitle",x.display_name||x.username).order("created_at",{ascending:!1});n(M||[]),h(!1)})()},[t]),c.useEffect(()=>{(async()=>{const{data:{user:x}}=await R.auth.getUser();if(x){const{data:C}=await R.from("users").select("role").eq("id",x.id).single();_({...x,...C})}else _(null)})()},[]),b&&b.role!=="creator"?e.jsx(wa,{to:"/",replace:!0}):l?e.jsx("div",{className:"profile-page",children:e.jsx("div",{children:"Loading profile..."})}):v?e.jsx("div",{className:"profile-page",children:e.jsx("div",{children:v})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"channel-header",children:e.jsxs("div",{className:"channel-cover-container",children:[e.jsx("div",{className:"cover-image-container",children:e.jsx("img",{className:"channel-cover-photo",src:r.cover_image_url||"https://images.unsplash.com/photo-1557683316-973673baf926?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80",alt:"Channel Cover"})}),e.jsxs("div",{className:"channel-info-overlay",children:[e.jsx("div",{className:"channel-avatar-container",children:e.jsx("img",{className:"channel-avatar",src:r.profile_image_url||"/default-avatar.jpg",alt:"Channel Avatar"})}),e.jsxs("div",{className:"channel-details",children:[e.jsx("h1",{className:"channel-name",children:r.display_name||r.username}),e.jsxs("p",{className:"channel-username",children:["@",r.username]}),r.bio&&e.jsx("p",{className:"channel-bio",children:r.bio})]})]})]})}),e.jsxs("div",{className:"profile-page",children:[e.jsx("div",{className:"profile-tabs",children:e.jsx("span",{className:"active",children:"Videos"})}),e.jsx("div",{className:"profile-videos",children:i.length===0?e.jsx("div",{children:"No videos yet."}):e.jsx("div",{className:"profile-video-grid",children:i.map(m=>e.jsxs("div",{className:"profile-video-card",style:{cursor:"pointer"},onClick:()=>{console.log("Clicked video:",m),s(`/video/${m.categoryId||0}/${m.id}`)},children:[e.jsx("img",{src:m.thumbnail||"https://via.placeholder.com/320x180?text=No+Thumbnail",alt:m.title}),e.jsx("h3",{children:m.title}),e.jsx("p",{children:m.description})]},m.id))})})]})]})};const Kl=()=>{const[t]=yt(),[s,r]=c.useState("verifying"),[a,i]=c.useState("");c.useEffect(()=>{const l=t.get("email"),h=t.get("token");if(!l||!h){r("error");return}i(l),setTimeout(()=>{r("success")},2e3)},[t]);const n=()=>{switch(s){case"verifying":return e.jsxs("div",{className:"approval-content",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("h2",{children:"Verifying your subscription..."}),e.jsx("p",{children:"Please wait while we process your request."})]});case"success":return e.jsxs("div",{className:"approval-content success",children:[e.jsx("div",{className:"success-icon",children:"‚úì"}),e.jsx("h2",{children:"Subscription Approved!"}),e.jsxs("p",{children:["Welcome to ScreenMerch, ",e.jsx("strong",{children:a}),"!"]}),e.jsx("p",{children:"Your subscription has been successfully activated. You can now enjoy all our premium features."}),e.jsx(Ve,{to:"/",className:"home-btn",children:"Go to Home"})]});case"error":return e.jsxs("div",{className:"approval-content error",children:[e.jsx("div",{className:"error-icon",children:"‚úó"}),e.jsx("h2",{children:"Invalid Link"}),e.jsx("p",{children:"This approval link is invalid or has expired."}),e.jsx("p",{children:"Please try subscribing again or contact support if you continue to have issues."}),e.jsx(Ve,{to:"/",className:"home-btn",children:"Go to Home"})]});default:return null}};return e.jsx("div",{className:"approval-page",children:e.jsxs("div",{className:"approval-container",children:[e.jsx("div",{className:"logo-section",children:e.jsx("h1",{children:"ScreenMerch"})}),n()]})})};class rs{static async getCurrentUserSubscription(){try{const{data:{user:s}}=await R.auth.getUser();if(!s)return null;const{data:r,error:a}=await R.from("user_subscriptions").select("*").eq("user_id",s.id).single();if(a&&a.code!=="PGRST116")throw a;return r||{tier:"free",status:"active"}}catch(s){return console.error("Error fetching subscription:",s),{tier:"free",status:"active"}}}static async subscribeToFreeTier(){try{const{data:{user:s}}=await R.auth.getUser();if(!s)throw new Error("User not authenticated");const r=new Date,{data:a,error:i}=await R.from("user_subscriptions").upsert({user_id:s.id,tier:"free",status:"active",current_period_start:r.toISOString(),current_period_end:null,updated_at:r.toISOString()},{onConflict:"user_id"}).select().single();if(i)throw i;return{success:!0,subscription:a}}catch(s){return console.error("Error subscribing to free tier:",s),{success:!1,error:s.message}}}static async subscribeToProTier(){try{const{data:{user:s}}=await R.auth.getUser();return s?(window.location.href="/payment-setup",{success:!0,redirecting:!0}):(window.location.href="/payment-setup?flow=new_user",{success:!0,redirecting:!0})}catch(s){return console.error("Error starting PayPal setup flow:",s),{success:!1,error:s.message}}}static async hasMinimumTier(s){try{const r=await this.getCurrentUserSubscription(),a={free:0,pro:1},i=a[(r==null?void 0:r.tier)||"free"],n=a[s];return i>=n}catch(r){return console.error("Error checking tier requirement:",r),!1}}static getTierConfig(s){const r={free:{name:"Free Trial",price:"Free",serviceFee:.3,features:["Upload videos (up to 100MB, 10 minutes)","Basic analytics","Standard features","Community access","Grab screenshots","Preview merch","Buy merchandise","7-day free trial period"],maxUploadSize:"100MB",maxVideoLength:"10 minutes"},pro:{name:"Free Plan",price:"Free",serviceFee:.3,trialDays:0,features:["Everything in Free Trial","Priority support","Custom branding","Enhanced upload limits (2GB, 60 minutes)","Ad-free experience","Early access to new features","Monetization tools","Revenue tracking","Custom channel colors","Branded merchandise","Advanced analytics"],maxUploadSize:"2GB",maxVideoLength:"60 minutes"}};return r[s]||r.free}static async isInTrialPeriod(){try{const s=await this.getCurrentUserSubscription();if(!s||s.tier!=="pro"||!s.trial_end)return!1;const r=new Date(s.trial_end);return new Date<r}catch(s){return console.error("Error checking trial period:",s),!1}}static async getTrialDaysRemaining(){try{const s=await this.getCurrentUserSubscription();if(!s||s.tier!=="pro"||!s.trial_end)return 0;const i=new Date(s.trial_end)-new Date,n=Math.ceil(i/(1e3*60*60*24));return Math.max(0,n)}catch(s){return console.error("Error getting trial days remaining:",s),0}}static async activateProSubscription(s,r){try{const a=localStorage.getItem("user_authenticated")==="true",i=localStorage.getItem("user_email");if(!a||!i)throw new Error("User not authenticated");console.log("üîç User authenticated via localStorage:",i),console.log("üîç Ensuring user exists in database...");const n=await fetch("https://screenmerch.fly.dev/api/users/ensure-exists",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i,display_name:i.split("@")[0]})});if(!n.ok)throw console.error("‚ùå Failed to ensure user exists:",await n.text()),new Error("Failed to ensure user exists in database");const l=await n.json();console.log("‚úÖ User ensured in database:",l);const h=l.user.id;console.log("‚úÖ Using user ID from ensure-exists response:",h);const v=new Date;v.setDate(v.getDate()+7);const S=await fetch("https://screenmerch.fly.dev/api/subscriptions/activate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:h,tier:"pro",status:"active",stripe_subscription_id:s,stripe_customer_id:r,trial_end:v.toISOString()})});if(!S.ok)throw console.error("‚ùå Failed to activate subscription:",await S.text()),new Error("Failed to activate subscription in database");const b=await S.json();console.log("‚úÖ Subscription activated:",b);try{const _=i.split("@")[0].toLowerCase().replace(/[^a-z0-9]/g,""),m=`https://screenmerch.com/channel/${_}`,x=await fetch("https://screenmerch.fly.dev/api/users/update-channel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:h,channel_slug:_,channel_url:m})});x.ok?console.log("‚úÖ Channel URL generated:",m):console.error("Error updating channel URL:",await x.text())}catch(_){console.error("Error generating channel URL:",_)}return{success:!0,subscription:b.subscription||b}}catch(a){return console.error("Error activating pro subscription:",a),{success:!1,error:a.message}}}static async sendWelcomeEmail(s){try{return await(await fetch("https://screenmerch.fly.dev/api/send-welcome-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})})).json()}catch(r){throw console.error("Error sending welcome email:",r),r}}}class ze{static async isAdmin(){try{const s=localStorage.getItem("isAuthenticated"),r=localStorage.getItem("user");let a=null;if(s==="true"&&r)a=JSON.parse(r),console.log("üîê AdminService: Found Google OAuth user:",a);else{const{data:{user:l}}=await R.auth.getUser();l&&(a=l,console.log("üîê AdminService: Found Supabase user:",a))}if(!a)return console.log("üîê AdminService: No authenticated user found"),!1;const{data:i,error:n}=await R.from("users").select("is_admin").eq("id",a.id).single();return n?(console.error("Error checking admin status:",n),!1):(console.log("üîê AdminService: Admin check result:",i==null?void 0:i.is_admin),(i==null?void 0:i.is_admin)||!1)}catch(s){return console.error("Error in isAdmin:",s),!1}}static async getDashboardStats(){try{const s=localStorage.getItem("isAuthenticated"),r=localStorage.getItem("user");let a=null;if(s==="true"&&r)a=JSON.parse(r);else{const{data:{user:l}}=await R.auth.getUser();a=l}if(!a)throw new Error("No authenticated user");const i=await fetch(`https://screenmerch.fly.dev/api/admin/dashboard-stats?user_id=${a.id}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const n=await i.json();return console.log("üìä Admin dashboard stats from backend:",n),n}catch(s){return console.error("Error fetching dashboard stats:",s),{total_users:0,active_users:0,suspended_users:0,total_videos:0,pending_videos:0,approved_videos:0,total_subscriptions:0,active_subscriptions:0,premium_subscriptions:0,creator_network_subscriptions:0}}}static async getUsers(s=0,r=20,a="",i="all",n="all"){try{console.log("üë• Fetching users from database...");let l=R.from("users").select("*",{count:"exact"});a&&(l=l.or(`display_name.ilike.%${a}%,email.ilike.%${a}%`)),i!=="all"&&(l=l.eq("status",i)),n!=="all"&&(l=l.eq("role",n));const{data:h,error:v,count:S}=await l.order("created_at",{ascending:!1}).range(s*r,(s+1)*r-1);if(v)throw console.error("üë• Error fetching users:",v),v;return console.log("üë• Users fetched:",(h==null?void 0:h.length)||0,"users"),console.log("üë• Total count:",S),{users:h||[],total:S||0,page:s,limit:r,totalPages:Math.ceil((S||0)/r)}}catch(l){return console.error("Error fetching users:",l),{users:[],total:0,page:s,limit:r,totalPages:0}}}static async getVideos(s=0,r=20,a="",i="all"){try{let n=R.from("videos2").select("*, users(display_name, email)",{count:"exact"});a&&(n=n.or(`title.ilike.%${a}%,description.ilike.%${a}%`)),i!=="all"&&(n=n.eq("verification_status",i));const{data:l,error:h,count:v}=await n.order("created_at",{ascending:!1}).range(s*r,(s+1)*r-1);if(h)throw h;return{videos:l||[],total:v||0,page:s,limit:r,totalPages:Math.ceil((v||0)/r)}}catch(n){return console.error("Error fetching videos:",n),{videos:[],total:0,page:s,limit:r,totalPages:0}}}static async getSubscriptions(s="active"){try{let r=R.from("user_subscriptions").select("*, users(display_name, email)").order("created_at",{ascending:!1});s==="all"||(r=r.eq("status",s));const{data:a,error:i}=await r;if(i)throw i;return a||[]}catch(r){return console.error("Error fetching subscriptions:",r),[]}}static async deleteSubscription(s){try{const{data:r,error:a}=await R.from("user_subscriptions").update({status:"canceled",updated_at:new Date().toISOString()}).eq("id",s).select().single();if(a)throw a;return await this.logAdminAction("delete_subscription","subscription",s,{target_subscription_id:s}),{success:!0,data:r}}catch(r){return console.error("Error deleting subscription:",r),{success:!1,error:r.message}}}static async reactivateSubscription(s){try{const{data:r,error:a}=await R.from("user_subscriptions").update({status:"active",updated_at:new Date().toISOString()}).eq("id",s).select().single();if(a)throw a;return await this.logAdminAction("reactivate_subscription","subscription",s,{target_subscription_id:s}),{success:!0,data:r}}catch(r){return console.error("Error reactivating subscription:",r),{success:!1,error:r.message}}}static async updateUserStatus(s,r){try{console.log(`Updating user ${s} status to ${r}`);const{data:{user:a}}=await R.auth.getUser();if(!a)return{success:!1,error:"Not authenticated"};const{data:i,error:n}=await R.from("users").update({status:r}).eq("id",s).select().single();if(n)throw console.error("Database update error:",n),n;return console.log("Database update successful:",i),await this.logAdminAction("update_user_status","user",s,{new_status:r,target_user_id:s}),{success:!0,data:i}}catch(a){return console.error("Error updating user status:",a),{success:!1,error:a.message}}}static async approveUser(s){return this.updateUserStatus(s,"active")}static async deleteUser(s){try{console.log("üóëÔ∏è Deleting user:",s),console.log("üóëÔ∏è API URL:",`${Me.SUBSCRIPTION_API_URL}/api/users/${s}/delete-account`);const r=await fetch(`${Me.SUBSCRIPTION_API_URL}/api/users/${s}/delete-account`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("üóëÔ∏è Delete response status:",r.status),console.log("üóëÔ∏è Delete response ok:",r.ok),!r.ok){const i=await r.json();return console.error("üóëÔ∏è Delete error response:",i),{success:!1,error:i.error||"Failed to delete user"}}const a=await r.json();return console.log("üóëÔ∏è Delete success response:",a),await this.logAdminAction("delete_user","user",s,{target_user_id:s}),{success:!0}}catch(r){return console.error("Error deleting user:",r),{success:!1,error:r.message}}}static async updateVideoStatus(s,r){try{const{data:a,error:i}=await R.from("videos2").update({verification_status:r}).eq("id",s).select().single();if(i)throw i;return await this.logAdminAction("update_video_status","video",s,{new_status:r,target_video_id:s}),{success:!0,data:a}}catch(a){return console.error("Error updating video status:",a),{success:!1,error:a.message}}}static async updateVideo(s,r){try{const a=localStorage.getItem("isAuthenticated"),i=localStorage.getItem("user");let n=null;if(a==="true"&&i)n=JSON.parse(i);else{const{data:{user:_}}=await R.auth.getUser();n=_}if(!n)return{success:!1,error:"Not authenticated"};const{data:l,error:h}=await R.from("videos2").select("user_id").eq("id",s).single();if(h)throw h;if(l.user_id!==n.id)return{success:!1,error:"You can only edit your own videos"};const v={};r.title!==void 0&&(v.title=r.title),r.thumbnail!==void 0&&(v.thumbnail=r.thumbnail),r.video_url!==void 0&&(v.video_url=r.video_url);const{data:S,error:b}=await R.from("videos2").update(v).eq("id",s).select().single();if(b)throw b;return await this.logAdminAction("update_video","video",s,{updates:v,target_video_id:s}),{success:!0,data:S}}catch(a){return console.error("Error updating video:",a),{success:!1,error:a.message}}}static async deleteVideo(s){try{const{data:r,error:a}=await R.from("videos2").select("*").eq("id",s).single();if(a)throw a;const{error:i}=await R.from("videos2").delete().eq("id",s);if(i)throw i;if(r&&r.video_url&&!r.video_url.includes("youtube.com"))try{const n=r.video_url.split("/storage/v1/object/public/")[1];n&&await R.storage.from("videos2").remove([n])}catch(n){console.warn("Could not delete video file from storage:",n)}if(r&&r.thumbnail&&!r.thumbnail.includes("ytimg.com"))try{const n=r.thumbnail.split("/storage/v1/object/public/")[1];n&&await R.storage.from("thumbnails").remove([n])}catch(n){console.warn("Could not delete thumbnail from storage:",n)}return await this.logAdminAction("delete_video","video",s,{target_video_id:s}),{success:!0}}catch(r){return console.error("Error deleting video:",r),{success:!1,error:r.message}}}static async getAdminSettings(){try{const{data:s,error:r}=await R.from("admin_settings").select("*").order("setting_key");if(r)throw r;const a={};return s.forEach(i=>{a[i.setting_key]=i.setting_value}),a}catch(s){return console.error("Error fetching admin settings:",s),{}}}static async updateAdminSetting(s,r){try{const{data:{user:a}}=await R.auth.getUser();if(!a)return{success:!1,error:"Not authenticated"};const{data:i,error:n}=await R.rpc("update_admin_setting",{p_setting_key:s,p_setting_value:r,p_admin_user_id:a.id});if(n)throw n;return{success:!0,data:i}}catch(a){return console.error("Error updating admin setting:",a),{success:!1,error:a.message}}}static async getAdminLogs(s=0,r=50){try{const{data:a,error:i,count:n}=await R.from("admin_logs").select("*, admin_user:users(display_name, email)",{count:"exact"}).order("created_at",{ascending:!1}).range(s*r,(s+1)*r-1);if(i)throw i;return{logs:a||[],total:n||0,page:s,limit:r,totalPages:Math.ceil((n||0)/r)}}catch(a){return console.error("Error fetching admin logs:",a),{logs:[],total:0,page:s,limit:r,totalPages:0}}}static async logAdminAction(s,r,a=null,i=null){try{const{data:{user:n}}=await R.auth.getUser();if(!n)return;await R.rpc("log_admin_action",{p_admin_user_id:n.id,p_action_type:s,p_target_type:r,p_target_id:a,p_details:i})}catch(n){console.error("Error logging admin action:",n)}}static async getRecentActivity(s=10){try{const{data:r,error:a}=await R.from("admin_logs").select("*, admin_user:users(display_name, email)").order("created_at",{ascending:!1}).limit(s);if(a)throw a;return r||[]}catch(r){return console.error("Error fetching recent activity:",r),[]}}}const Ql=({sidebar:t})=>{var ve,Ae,be;const[s,r]=c.useState(null),[a,i]=c.useState(null),[n,l]=c.useState(null),[h,v]=c.useState([]),[S,b]=c.useState(!0),[_,m]=c.useState(!1),[x,C]=c.useState({display_name:"",bio:"",cover_image_url:"",profile_image_url:""}),[M,y]=c.useState(!1),[L,Y]=c.useState({cover:null,profile:null}),[J,F]=c.useState(!1),[H,K]=c.useState(!1),[O,re]=c.useState("videos"),[Z,X]=c.useState(null),[z,B]=c.useState({total_sales:0,total_revenue:0,products_sold_count:0,videos_with_sales_count:0,avg_order_value:0,products_sold:[]}),[u,p]=c.useState(!1),[N,j]=c.useState(null),[o,f]=c.useState({title:"",thumbnail:"",video_url:""}),[g,T]=c.useState(!1),[d,w]=c.useState(!1),[P,Q]=c.useState(null),me=c.useRef(null),ae=Oe();c.useEffect(()=>{(async()=>{try{const te=localStorage.getItem("isAuthenticated"),ce=localStorage.getItem("user");let se=null;if(te==="true"&&ce)se=JSON.parse(ce),console.log("üîê Dashboard: Found Google OAuth user:",se);else{const{data:{user:I},error:$}=await R.auth.getUser();I&&(se=I,console.log("üîê Dashboard: Found Supabase user:",se))}if(!se){console.log("üîê Dashboard: No authenticated user found, redirecting to home"),ae("/");return}r(se);let ne=null;if(se.id){const{data:I,error:$}=await R.from("users").select("*").eq("id",se.id).single();ne=I}ne?(i(ne),C({display_name:ne.display_name||"",bio:ne.bio||"",cover_image_url:ne.cover_image_url||"",profile_image_url:ne.profile_image_url||""})):(i(se),C({display_name:se.display_name||"",bio:se.bio||"",cover_image_url:se.cover_image_url||"",profile_image_url:se.picture||""}));const k=await rs.getCurrentUserSubscription();if(l(k),se.id){const{data:I,error:$}=await R.from("videos2").select("*").eq("user_id",se.id).order("created_at",{ascending:!1});I&&v(I)}else v([])}catch(te){console.error("Error fetching data:",te),ae("/")}finally{b(!1)}})()},[ae]),c.useEffect(()=>{(async()=>{const te=localStorage.getItem("isAuthenticated"),ce=localStorage.getItem("user");if(te==="true"&&ce){const se=JSON.parse(ce);X({...se,role:"creator"})}else{const{data:{user:se}}=await R.auth.getUser();if(se){const{data:ne}=await R.from("users").select("role").eq("id",se.id).single();X({...se,...ne})}else X(null)}})()},[]);const we=async(D,te)=>{try{y(!0);const ce=D.name.split(".").pop(),se=`${s.id}/${te}-${Date.now()}.${ce}`,{data:ne,error:k}=await R.storage.from("profile-images").upload(se,D,{cacheControl:"3600",upsert:!0});if(k)return console.error("Error uploading image:",k),alert("Failed to upload image. Please try again."),null;const{data:{publicUrl:I}}=R.storage.from("profile-images").getPublicUrl(se);return I}catch(ce){return console.error("Error in uploadImageToSupabase:",ce),alert("Failed to upload image. Please try again."),null}finally{y(!1)}},fe=async(D,te)=>{if(!D.type.startsWith("image/")){alert("Please select a valid image file.");return}if(D.size>5*1024*1024){alert("File size must be less than 5MB.");return}const ce=new FileReader;ce.onload=ne=>{Y(k=>({...k,[te]:ne.target.result}))},ce.readAsDataURL(D);const se=await we(D,te);se&&C(ne=>({...ne,[`${te}_image_url`]:se}))},Se=async()=>{try{const{data:D,error:te}=await R.from("users").update({display_name:x.display_name,bio:x.bio,cover_image_url:x.cover_image_url,profile_image_url:x.profile_image_url,updated_at:new Date().toISOString()}).eq("id",s.id);te?console.error("Error updating profile:",te):(i({...a,...x}),m(!1),Y({cover:null,profile:null}))}catch(D){console.error("Error saving profile:",D)}},Ce=async(D,te,ce)=>{if(ce.stopPropagation(),!!window.confirm(`Are you sure you want to delete "${te}"? This action cannot be undone.`))try{const ne=await ze.deleteVideo(D);ne.success?(v(k=>k.filter(I=>I.id!==D)),alert("Video deleted successfully!")):alert(`Failed to delete video: ${ne.error}`)}catch(ne){console.error("Error deleting video:",ne),alert("Failed to delete video. Please try again.")}},V=(D,te)=>{te.stopPropagation(),j(D),f({title:D.title||"",thumbnail:D.thumbnail||"",video_url:D.video_url||""}),Q(null)};c.useEffect(()=>{N&&me.current&&(me.current.scrollTop=0,me.current.offsetHeight)},[N]);const le=()=>{j(null),f({title:"",thumbnail:"",video_url:""}),Q(null)},pe=async D=>{try{w(!0);const te=D.name.split(".").pop(),ce=`${s.id}/thumbnails/${Date.now()}.${te}`,{data:se,error:ne}=await R.storage.from("thumbnails").upload(ce,D,{cacheControl:"3600",upsert:!0});if(ne)return console.error("Error uploading thumbnail:",ne),alert("Failed to upload thumbnail. Please try again."),null;const{data:{publicUrl:k}}=R.storage.from("thumbnails").getPublicUrl(ce);return k}catch(te){return console.error("Error in uploadThumbnailToSupabase:",te),alert("Failed to upload thumbnail. Please try again."),null}finally{w(!1)}},E=async D=>{try{if(T(!0),!s||!s.id)return alert("User not found. Please sign in again."),null;const te=D.name.split(".").pop(),ce=`${s.id}/videos/${Date.now()}.${te}`;console.log("Attempting to upload video:",ce),console.log("User ID:",s.id);const{data:se,error:ne}=await R.storage.from("videos2").upload(ce,D,{cacheControl:"3600",upsert:!0});if(ne)return console.error("Error uploading video:",ne),console.error("Error details:",JSON.stringify(ne,null,2)),ne.message&&ne.message.includes("row-level security")?alert("Upload failed: Permission denied. The storage policies may not allow uploads for your account. Please use the Video URL field instead, or ensure you are authenticated through Supabase Auth."):ne.message&&ne.message.includes("new row violates")?alert("Upload failed: Storage policy error. Please check your Supabase storage policies or use the Video URL field instead."):alert(`Failed to upload video: ${ne.message||"Unknown error. Please try using the Video URL field instead."}`),null;const{data:{publicUrl:k}}=R.storage.from("videos2").getPublicUrl(ce);return console.log("Video uploaded successfully:",k),k}catch(te){return console.error("Error in uploadVideoToSupabase:",te),console.error("Error stack:",te.stack),alert(`Failed to upload video: ${te.message||"Please try again or use the Video URL field instead."}`),null}finally{T(!1)}},U=async D=>{const te=D.target.files[0];if(!te)return;if(!te.type.startsWith("image/")){alert("Please select a valid image file.");return}if(te.size>5*1024*1024){alert("File size must be less than 5MB.");return}const ce=new FileReader;ce.onload=ne=>{Q(ne.target.result)},ce.readAsDataURL(te);const se=await pe(te);se&&f(ne=>({...ne,thumbnail:se}))},A=async D=>{const te=D.target.files[0];if(!te)return;if(!te.type.startsWith("video/")){alert("Please select a valid video file.");return}const ce=await E(te);ce&&f(se=>({...se,video_url:ce}))},q=async()=>{if(N)try{const D={};if(o.title.trim()&&(D.title=o.title.trim()),o.thumbnail&&(D.thumbnail=o.thumbnail),o.video_url&&(D.video_url=o.video_url),Object.keys(D).length===0){alert("No changes to save.");return}const te=await ze.updateVideo(N.id,D);te.success?(v(ce=>ce.map(se=>se.id===N.id?{...se,...D}:se)),alert("Video updated successfully!"),le()):alert(`Failed to update video: ${te.error}`)}catch(D){console.error("Error updating video:",D),alert("Failed to update video. Please try again.")}};return Z&&(!Z.role||Z.role!=="creator")?(console.log("User role issue:",Z.role,"User:",Z),e.jsxs("div",{className:"dashboard-error",children:["Access denied. Only creators can view this page.",e.jsx("br",{}),e.jsx("button",{onClick:async()=>{var D,te,ce;try{console.log("Fixing role for user:",Z.id);const{data:se,error:ne}=await R.from("users").select("*").eq("id",Z.id).single();if(ne&&ne.code==="PGRST116"){console.log("User not found, creating new user record");const{data:k,error:I}=await R.from("users").upsert({id:Z.id,email:Z.email,username:((D=Z.email)==null?void 0:D.split("@")[0])||"user",display_name:((te=Z.user_metadata)==null?void 0:te.name)||((ce=Z.email)==null?void 0:ce.split("@")[0])||"User",role:"creator",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{onConflict:"id",ignoreDuplicates:!1}).select();if(I)if(console.error("Error creating user:",I),I.message.includes("duplicate key")){console.log("Duplicate key detected, updating existing user");const{data:$,error:W}=await R.from("users").update({role:"creator",updated_at:new Date().toISOString()}).eq("id",Z.id).select();W?(console.error("Error updating user:",W),alert("Failed to update user: "+W.message)):(console.log("User updated successfully:",$),alert("User updated! Reloading page..."),window.location.reload())}else alert("Failed to create user: "+I.message);else console.log("User created successfully:",k),alert("User created! Reloading page..."),window.location.reload()}else if(se){const{data:k,error:I}=await R.from("users").update({role:"creator"}).eq("id",Z.id).select();I?(console.error("Error updating role:",I),alert("Failed to update role: "+I.message)):(console.log("Role updated successfully:",k),alert("Role updated! Reloading page..."),window.location.reload())}else console.error("Unexpected error checking user:",ne),alert("Error checking user: "+ne.message)}catch(se){console.error("Error in role fix:",se),alert("Error fixing role: "+se.message)}},style:{marginTop:"10px",padding:"8px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Fix Role & Reload"})]})):S?e.jsx("div",{className:"dashboard-loading",children:"Loading your dashboard..."}):s?e.jsxs("div",{className:`dashboard-container ${t?"":" large-container"}`,children:[e.jsx("div",{className:"channel-header",children:e.jsxs("div",{className:"channel-cover-container",children:[J?e.jsxs("div",{className:"edit-cover-section",children:[e.jsx("div",{className:"cover-edit-backdrop",onClick:()=>{F(!1),Y(D=>({...D,cover:null}))}}),e.jsx("div",{className:"cover-edit-overlay",onClick:D=>D.stopPropagation(),children:e.jsxs("div",{className:"cover-edit-controls",children:[e.jsx("button",{className:"cover-edit-close-btn",onClick:()=>{F(!1),Y(D=>({...D,cover:null}))},title:"Close",children:"√ó"}),e.jsx("h3",{children:"üì∏ Update Cover Image"}),e.jsxs("div",{className:"file-upload-section",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:D=>D.target.files[0]&&fe(D.target.files[0],"cover"),id:"cover-upload",className:"file-input",disabled:M}),e.jsx("label",{htmlFor:"cover-upload",className:"file-upload-btn",children:M?"‚è≥ Uploading...":"üìÅ Choose Cover Image"})]}),e.jsx("p",{className:"edit-tip",children:"üí° Tip: Max 5MB, high-quality image (1920x1080 recommended)"})]})}),(L.cover||x.cover_image_url)&&e.jsx("img",{src:L.cover||x.cover_image_url||(a==null?void 0:a.cover_image_url)||"https://images.unsplash.com/photo-1557683316-973673baf926?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80",alt:"Cover preview",className:"channel-cover-photo"})]}):e.jsxs("div",{className:"cover-image-container",children:[e.jsx("img",{className:"channel-cover-photo",src:x.cover_image_url||(a==null?void 0:a.cover_image_url)||"https://images.unsplash.com/photo-1557683316-973673baf926?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80",alt:"Channel Cover"}),e.jsx("button",{className:"corner-edit-icon cover-edit",onClick:()=>F(!0),title:"Edit cover image",children:"‚úèÔ∏è"})]}),e.jsxs("div",{className:"channel-info-overlay",children:[e.jsx("div",{className:"channel-avatar-container",children:H?e.jsxs("div",{className:"edit-avatar-section",children:[e.jsx("img",{className:"channel-avatar editing",src:L.profile||x.profile_image_url||(a==null?void 0:a.profile_image_url)||((ve=s.user_metadata)==null?void 0:ve.picture)||"/default-avatar.jpg",alt:"Channel Avatar"}),e.jsxs("div",{className:"avatar-upload-section",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:D=>D.target.files[0]&&fe(D.target.files[0],"profile"),id:"avatar-upload",className:"file-input",disabled:M}),e.jsx("label",{htmlFor:"avatar-upload",className:"avatar-upload-btn",children:M?"‚è≥ Uploading...":"üì∑ Change Avatar"})]})]}):e.jsxs("div",{className:"avatar-with-edit",children:[e.jsx("img",{className:"channel-avatar",src:(a==null?void 0:a.profile_image_url)||((Ae=s.user_metadata)==null?void 0:Ae.picture)||"/default-avatar.jpg",alt:"Channel Avatar"}),e.jsx("button",{className:"corner-edit-icon avatar-edit",onClick:()=>K(!0),title:"Edit avatar",children:"‚úèÔ∏è"})]})}),e.jsx("div",{className:"channel-details",children:_?e.jsxs("div",{className:"edit-details-section",children:[e.jsx("input",{type:"text",placeholder:"Display name",value:x.display_name,onChange:D=>C({...x,display_name:D.target.value}),className:"edit-input edit-title"}),e.jsx("textarea",{placeholder:"Bio/Description",value:x.bio,onChange:D=>C({...x,bio:D.target.value}),className:"edit-textarea",rows:"2"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"channel-name",children:(a==null?void 0:a.display_name)||((be=s.user_metadata)==null?void 0:be.name)||"Your Channel"}),e.jsxs("p",{className:"channel-username",children:["@",(a==null?void 0:a.username)||"username"]}),(a==null?void 0:a.bio)&&e.jsx("p",{className:"channel-bio",children:a.bio})]})}),e.jsx("div",{className:"edit-controls",children:_?e.jsxs("div",{className:"edit-buttons",children:[e.jsx("button",{onClick:Se,className:"save-btn",children:"Save Changes"}),e.jsx("button",{onClick:()=>m(!1),className:"cancel-btn",children:"Cancel"})]}):null})]})]})}),e.jsxs("div",{className:"dashboard-tabs",children:[e.jsxs("button",{className:`tab-button ${O==="videos"?"active":""}`,onClick:()=>re("videos"),children:["üìπ Videos (",h.length,")"]}),e.jsx("button",{className:`tab-button ${O==="analytics"?"active":""}`,onClick:()=>re("analytics"),children:"üìä Analytics"})]}),e.jsxs("div",{className:"tab-content",children:[O==="videos"&&e.jsxs("div",{className:"videos-tab",children:[e.jsxs("div",{className:"getting-started-section",children:[e.jsx("h2",{children:"Getting Started"}),e.jsxs("div",{className:"tips-grid",children:[e.jsxs("div",{className:"tip-card",children:[e.jsx("h4",{children:"üé® Customize Your Channel"}),e.jsx("p",{children:"Add a cover image, profile picture, and bio to make your channel unique."})]}),e.jsxs("div",{className:"tip-card clickable",onClick:()=>ae("/upload"),children:[e.jsx("h4",{children:"üìπ Upload Content"}),e.jsx("p",{children:"Start sharing your videos and build your audience."}),e.jsx("div",{className:"card-action",children:"Click to upload ‚Üí"})]}),e.jsxs("div",{className:"tip-card",children:[e.jsx("h4",{children:"üìä Check Your Analytics"}),e.jsx("p",{children:"Monitor your sales and track your performance."})]})]})]}),e.jsxs("div",{className:"user-videos-section",children:[e.jsx("div",{className:"section-header",children:e.jsxs("h2",{children:["Your Videos (",h.length,")"]})}),h.length>0?e.jsx("div",{className:"dashboard-video-grid",children:h.map(D=>e.jsxs("div",{className:"dashboard-video-card",onClick:()=>ae(`/video/${D.categoryId||0}/${D.id}`),children:[e.jsx("img",{src:D.thumbnail,alt:D.title,className:"dashboard-video-thumbnail"}),e.jsxs("div",{className:"dashboard-video-info",children:[e.jsx("h4",{children:D.title}),e.jsx("p",{children:new Date(D.created_at).toLocaleDateString()}),e.jsx("span",{className:"video-views",children:"0 views"})]}),e.jsx("button",{className:"edit-video-btn",onClick:te=>V(D,te),title:"Edit Video",children:"‚úèÔ∏è"}),e.jsx("button",{className:"delete-video-btn",onClick:te=>Ce(D.id,D.title,te),title:"Delete Video",children:"üóëÔ∏è"})]},D.id))}):e.jsx("div",{className:"no-videos-placeholder",children:e.jsxs("div",{className:"placeholder-content",children:[e.jsx("h3",{children:"No videos yet"}),e.jsx("p",{children:"Start building your content library by uploading your first video!"})]})})]})]}),O==="analytics"&&e.jsx("div",{className:"analytics-tab",children:e.jsxs("div",{className:"sales-analytics-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"üìä Sales Analytics"}),e.jsxs("div",{className:"analytics-summary",children:[e.jsxs("span",{className:"total-sales",children:["Total Sales: ",u?"Loading...":z.total_sales]}),e.jsxs("span",{className:"total-revenue",children:["Total Revenue: $",u?"0.00":z.total_revenue.toFixed(2)]})]})]}),e.jsxs("div",{className:"analytics-dashboard",children:[e.jsxs("div",{className:"analytics-overview-cards",children:[e.jsxs("div",{className:"analytics-card",children:[e.jsx("h4",{children:"üìà Sales Per Day"}),e.jsx("div",{className:"analytics-amount",children:u?"...":z.total_sales}),e.jsx("div",{className:"analytics-change",children:u?"Loading...":z.total_sales>0?"Active sales":"No data yet"})]}),e.jsxs("div",{className:"analytics-card",children:[e.jsx("h4",{children:"üõçÔ∏è Products Sold"}),e.jsx("div",{className:"analytics-amount",children:u?"...":z.products_sold_count}),e.jsx("div",{className:"analytics-change",children:u?"Loading...":z.products_sold_count>0?"Products selling":"No data yet"})]}),e.jsxs("div",{className:"analytics-card",children:[e.jsx("h4",{children:"üé¨ Videos with Sales"}),e.jsx("div",{className:"analytics-amount",children:u?"...":z.videos_with_sales_count}),e.jsx("div",{className:"analytics-change",children:u?"Loading...":z.videos_with_sales_count>0?"Videos performing":"No data yet"})]}),e.jsxs("div",{className:"analytics-card",children:[e.jsx("h4",{children:"üí∞ Avg Order Value"}),e.jsxs("div",{className:"analytics-amount",children:["$",u?"0.00":z.avg_order_value.toFixed(2)]}),e.jsx("div",{className:"analytics-change",children:u?"Loading...":z.avg_order_value>0?"Good average":"No data yet"})]})]}),e.jsxs("div",{className:"sales-chart-section",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{children:"üìä Sales Analytics Dashboard"}),e.jsxs("div",{className:"service-fee-info",children:[e.jsx("span",{className:"fee-badge",children:"30% Service Fee"}),e.jsx("span",{className:"fee-explanation",children:"Net revenue shown after fees"})]})]}),e.jsxs("div",{className:"chart-section",children:[e.jsx("h4",{children:"üìÖ Daily Sales (Last 7 Days)"}),e.jsx("div",{className:"daily-chart-container",children:e.jsx("div",{className:"daily-chart-bars",children:Array.from({length:7},(D,te)=>{const ce=new Date;ce.setDate(ce.getDate()-(6-te));const se=ce.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),ne=te===6,k=ne?1:te===5?2:0,I=k*z.avg_order_value,$=I*.7;return e.jsxs("div",{className:"daily-bar-container",children:[e.jsx("div",{className:`daily-bar ${k>0?"has-sales":"no-sales"} ${ne?"today":""}`,style:{height:`${k>0?Math.max(k*40,20):0}px`},title:`${se}: ${k} sales | Gross: $${I.toFixed(2)} | Net: $${$.toFixed(2)}`,children:e.jsx("span",{className:"daily-bar-value",children:k})}),e.jsx("div",{className:"daily-bar-label",children:se}),k>0&&e.jsxs("div",{className:"daily-bar-revenue",children:["$",$.toFixed(2)]})]},te)})})})]}),e.jsxs("div",{className:"weekly-summary",children:[e.jsx("h4",{children:"üìä Weekly Summary"}),e.jsxs("div",{className:"summary-grid",children:[e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"summary-label",children:"This Week"}),e.jsx("div",{className:"summary-value",children:z.total_sales}),e.jsx("div",{className:"summary-subtitle",children:"Total Sales"})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"summary-label",children:"Gross Revenue"}),e.jsxs("div",{className:"summary-value",children:["$",z.total_revenue.toFixed(2)]}),e.jsx("div",{className:"summary-subtitle",children:"Before fees"})]}),e.jsxs("div",{className:"summary-card highlight",children:[e.jsx("div",{className:"summary-label",children:"Net Revenue"}),e.jsxs("div",{className:"summary-value",children:["$",(z.total_revenue*.7).toFixed(2)]}),e.jsx("div",{className:"summary-subtitle",children:"After 30% fee"})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"summary-label",children:"Service Fee"}),e.jsxs("div",{className:"summary-value",children:["$",(z.total_revenue*.3).toFixed(2)]}),e.jsx("div",{className:"summary-subtitle",children:"Platform fee"})]})]})]}),e.jsxs("div",{className:"recent-activity",children:[e.jsx("h4",{children:"üïí Recent Sales Activity"}),e.jsxs("div",{className:"activity-list",children:[e.jsxs("div",{className:"activity-item",children:[e.jsx("div",{className:"activity-icon",children:"üí∞"}),e.jsxs("div",{className:"activity-details",children:[e.jsx("div",{className:"activity-title",children:"New sale today!"}),e.jsx("div",{className:"activity-subtitle",children:"Product: Custom T-Shirt | Net: $17.77"})]}),e.jsx("div",{className:"activity-time",children:"Just now"})]}),e.jsxs("div",{className:"activity-item",children:[e.jsx("div",{className:"activity-icon",children:"üí∞"}),e.jsxs("div",{className:"activity-details",children:[e.jsx("div",{className:"activity-title",children:"Sale completed"}),e.jsx("div",{className:"activity-subtitle",children:"Product: Coffee Mug | Net: $14.00"})]}),e.jsx("div",{className:"activity-time",children:"2 hours ago"})]}),e.jsxs("div",{className:"activity-item",children:[e.jsx("div",{className:"activity-icon",children:"üìä"}),e.jsxs("div",{className:"activity-details",children:[e.jsx("div",{className:"activity-title",children:"Weekly summary"}),e.jsx("div",{className:"activity-subtitle",children:"Total: 31 sales | Net: $551.04"})]}),e.jsx("div",{className:"activity-time",children:"Yesterday"})]})]})]})]}),e.jsxs("div",{className:"products-sold-chart",children:[e.jsx("h3",{children:"üõçÔ∏è Products Sold"}),z.products_sold&&z.products_sold.length>0?e.jsx("div",{className:"products-chart-container",children:z.products_sold.map((D,te)=>{const ce=Math.max(...z.products_sold.map(ne=>ne.quantity)),se=ce>0?D.quantity/ce*100:0;return e.jsxs("div",{className:"product-chart-item",children:[e.jsxs("div",{className:"product-chart-header",children:[e.jsx("div",{className:"product-name",children:D.product}),e.jsxs("div",{className:"product-stats",children:[e.jsxs("span",{className:"quantity",children:[D.quantity," sold"]}),e.jsxs("span",{className:"revenue",children:["$",D.revenue.toFixed(2)]})]})]}),e.jsx("div",{className:"product-chart-bar-container",children:e.jsx("div",{className:"product-chart-bar",style:{width:`${se}%`},title:`${D.quantity} units sold - $${D.revenue.toFixed(2)} revenue`,children:e.jsx("span",{className:"bar-label",children:D.quantity})})}),e.jsx("div",{className:"product-source",children:e.jsxs("small",{children:["From: ",D.video_source]})})]},te)})}):e.jsxs("div",{className:"products-chart-empty",children:[e.jsx("div",{className:"empty-icon",children:"üì¶"}),e.jsx("h4",{children:"No products sold yet"}),e.jsx("p",{children:"Start creating content to see your sales data here!"})]})]})]})]})})]}),N&&e.jsx("div",{className:"edit-video-modal-overlay",onClick:le,children:e.jsxs("div",{className:"edit-video-modal",onClick:D=>D.stopPropagation(),children:[e.jsxs("div",{className:"edit-video-modal-header",children:[e.jsx("h2",{children:"Edit Video"}),e.jsx("button",{className:"edit-video-modal-close",onClick:le,children:"√ó"})]}),e.jsxs("div",{className:"edit-video-modal-content",ref:me,children:[e.jsxs("div",{className:"edit-video-form-group",children:[e.jsx("label",{htmlFor:"edit-video-title",children:"Video Name"}),e.jsx("input",{type:"text",id:"edit-video-title",value:o.title,onChange:D=>f({...o,title:D.target.value}),placeholder:"Enter video name",className:"edit-video-input"})]}),e.jsxs("div",{className:"edit-video-form-group",children:[e.jsx("label",{htmlFor:"edit-video-thumbnail",children:"Thumbnail"}),e.jsx("div",{className:"edit-video-thumbnail-preview",children:(P||o.thumbnail)&&e.jsx("img",{src:P||o.thumbnail,alt:"Thumbnail preview",className:"thumbnail-preview-img"})}),e.jsx("input",{type:"file",id:"edit-video-thumbnail",accept:"image/*",onChange:U,disabled:d,className:"edit-video-file-input"}),e.jsx("label",{htmlFor:"edit-video-thumbnail",className:"edit-video-file-label",children:d?"‚è≥ Uploading...":"üì∑ Choose Thumbnail Image"}),e.jsx("p",{className:"edit-video-tip",children:"Max 5MB, recommended: 1280x720"})]}),e.jsxs("div",{className:"edit-video-form-group",children:[e.jsx("label",{htmlFor:"edit-video-url",children:"Video URL"}),e.jsx("input",{type:"text",id:"edit-video-url",value:o.video_url,onChange:D=>f({...o,video_url:D.target.value}),placeholder:"Enter video URL (YouTube or direct link)",className:"edit-video-input"}),e.jsx("p",{className:"edit-video-tip",children:"Or upload a video file below"})]}),e.jsxs("div",{className:"edit-video-form-group",children:[e.jsx("label",{htmlFor:"edit-video-file",children:"Upload Video File"}),e.jsx("input",{type:"file",id:"edit-video-file",accept:"video/*",onChange:A,disabled:g,className:"edit-video-file-input"}),e.jsx("label",{htmlFor:"edit-video-file",className:"edit-video-file-label",children:g?"‚è≥ Uploading...":"üé¨ Choose Video File"}),e.jsx("p",{className:"edit-video-tip",children:"Max file size depends on your plan"})]})]}),e.jsxs("div",{className:"edit-video-modal-footer",children:[e.jsx("button",{className:"edit-video-cancel-btn",onClick:le,children:"Cancel"}),e.jsx("button",{className:"edit-video-save-btn",onClick:q,disabled:d||g,children:d||g?"Saving...":"Save Changes"})]})]})})]}):e.jsx("div",{className:"dashboard-error",children:"Please log in to see your dashboard."})};const ec=()=>{const t=Oe();zt();const s={totalRevenue:56388,monthlyRevenue:4699,totalProductsSold:2600,monthlyProductsSold:217,averageProductPrice:21.69,productOverheadCost:11.69,houseCommission:3,yourProfitPerItem:7},a=(()=>{const M=s.totalProductsSold*(s.averageProductPrice-s.productOverheadCost),y=s.totalProductsSold*s.houseCommission,L=M-y;return{grossEarnings:Math.round(M),netEarnings:Math.round(L)}})(),[i,n]=c.useState(null),[l,h]=c.useState(null),[v,S]=c.useState(!0),[b,_]=c.useState(!1),[m,x]=c.useState("");c.useEffect(()=>{(async()=>{try{const{data:{user:y}}=await R.auth.getUser();if(n(y),y){const L=await rs.getCurrentUserSubscription();h(L)}}catch(y){console.error("Error fetching user data:",y)}finally{S(!1)}})()},[]);const C=async()=>{_(!0),x("");try{if(!i){x("Redirecting to PayPal setup..."),setTimeout(()=>{t("/payment-setup?flow=new_user")},1500);return}const M=await rs.subscribeToProTier();M.success?x("Redirecting to PayPal setup..."):x(M.error||"An error occurred. Please try again.")}catch(M){console.error("Error starting PayPal setup:",M),x("An error occurred. Please try again.")}finally{_(!1)}};return v?e.jsx("div",{className:"subscription-tiers",children:e.jsx("div",{className:"loading",children:"Loading..."})}):e.jsxs("div",{className:"subscription-tiers",children:[e.jsxs("div",{className:"tiers-header",children:[e.jsx("h1",{children:"üí∞ Creator Earnings Calculator"}),e.jsx("p",{children:"See how much you could earn with ScreenMerch's completely free merch system - No monthly fees!"})]}),m&&e.jsx("div",{className:`message ${m.includes("error")||m.includes("Failed")?"error":"success"}`,children:m}),e.jsxs("div",{className:"performance-metrics",children:[e.jsxs("div",{className:"metrics-header",children:[e.jsx("h3",{children:"üìä Example Creator Performance"}),e.jsx("p",{children:"Based on successful creators with engaged audiences"})]}),e.jsxs("div",{className:"metrics-grid",children:[e.jsxs("div",{className:"metric-card",children:[e.jsxs("div",{className:"metric-value",children:["$",s.totalRevenue.toLocaleString()]}),e.jsx("div",{className:"metric-label",children:"Total Revenue (Annual)"})]}),e.jsxs("div",{className:"metric-card",children:[e.jsxs("div",{className:"metric-value",children:["$",s.monthlyRevenue.toLocaleString()]}),e.jsx("div",{className:"metric-label",children:"Monthly Revenue"})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-value",children:s.totalProductsSold.toLocaleString()}),e.jsx("div",{className:"metric-label",children:"Products Sold (Annual)"})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-value",children:s.monthlyProductsSold}),e.jsx("div",{className:"metric-label",children:"Monthly Products Sold"})]})]})]}),e.jsxs("div",{className:"tier-calculator-section",children:[e.jsxs("div",{className:"calculator-header",children:[e.jsx("h4",{children:"üéØ ScreenMerch Free Plan"}),e.jsx("p",{children:"It's completely free to use ScreenMerch! No monthly fees, no recurring charges. You earn 70% of all sales, 30% house commission."}),e.jsx("div",{className:"pricing-note",children:e.jsx("small",{children:"üí° Based on actual product overhead costs and 30% house commission structure"})})]}),e.jsxs("div",{className:"tier-comparison-grid",children:[e.jsxs("div",{className:"tier-card current",children:[e.jsxs("div",{className:"tier-header",children:[e.jsx("h5",{children:"üéØ Free Plan"}),e.jsx("span",{className:"tier-fee",children:"30% House Commission"})]}),e.jsxs("div",{className:"tier-revenue",children:[e.jsxs("span",{className:"revenue-amount",children:["$",a.netEarnings.toLocaleString()]}),e.jsx("span",{className:"revenue-label",children:"You Keep (70% of Sales)"})]}),e.jsxs("div",{className:"tier-cost",children:[e.jsx("span",{className:"cost-amount",children:"Free"}),e.jsx("span",{className:"cost-label",children:"Always Free"})]}),e.jsxs("div",{className:"tier-savings",children:[e.jsxs("span",{className:"savings-amount",children:["$",a.netEarnings.toLocaleString()]}),e.jsx("span",{className:"savings-label",children:"Net Annual Earnings üí∞"})]})]}),e.jsxs("div",{className:"tier-card breakdown-card",children:[e.jsxs("div",{className:"tier-header",children:[e.jsx("h5",{children:"üí∞ Per Item Example"}),e.jsx("span",{className:"tier-fee",children:"$21.69 T-Shirt"})]}),e.jsxs("div",{className:"item-breakdown-container",children:[e.jsxs("div",{className:"product-visual",children:[e.jsx("img",{src:"/calculatorimage.png",alt:"Calculator Example",className:"product-image"}),e.jsx("p",{className:"product-caption",children:"Just one T-Shirt 50 sales a week!"})]}),e.jsxs("div",{className:"item-breakdown",children:[e.jsxs("div",{className:"breakdown-row",children:[e.jsx("span",{className:"breakdown-label",children:"Your Selling Price:"}),e.jsxs("span",{className:"breakdown-value",children:["$",s.averageProductPrice]})]}),e.jsxs("div",{className:"breakdown-row",children:[e.jsx("span",{className:"breakdown-label",children:"Product Overhead:"}),e.jsxs("span",{className:"breakdown-value cost",children:["-$",s.productOverheadCost]})]}),e.jsxs("div",{className:"breakdown-row",children:[e.jsx("span",{className:"breakdown-label",children:"House Commission (30%):"}),e.jsxs("span",{className:"breakdown-value cost",children:["-$",s.houseCommission]})]}),e.jsxs("div",{className:"breakdown-row final-profit",children:[e.jsx("span",{className:"breakdown-label",children:"Your Profit:"}),e.jsxs("span",{className:"breakdown-value profit",children:["$",s.yourProfitPerItem]})]})]})]})]})]}),e.jsx("div",{className:"calculator-footer",children:e.jsx("button",{className:"upgrade-btn",onClick:()=>C(),disabled:b,children:b?"Processing...":i?"üöÄ Set Up PayPal & Start Earning":"üöÄ Sign Up & Set Up PayPal"})}),e.jsxs("div",{className:"calculation-breakdown",children:[e.jsx("h5",{children:"üìä How We Calculate Your Earnings"}),e.jsxs("div",{className:"breakdown-grid",children:[e.jsxs("div",{className:"breakdown-item",children:[e.jsx("strong",{children:"Total Revenue:"})," $",s.totalRevenue.toLocaleString()]}),e.jsxs("div",{className:"breakdown-item",children:[e.jsx("strong",{children:"Product Overhead Costs:"})," $",(s.totalProductsSold*s.productOverheadCost).toLocaleString()]}),e.jsxs("div",{className:"breakdown-item",children:[e.jsx("strong",{children:"House Commission (30% of Gross Profit):"})," $",(s.totalProductsSold*s.houseCommission).toLocaleString()]}),e.jsxs("div",{className:"breakdown-item highlight creator-earnings",children:[e.jsx("strong",{children:"üéØ Your Total Net Earnings:"})," $",(s.totalProductsSold*s.yourProfitPerItem).toLocaleString()]})]}),e.jsx("div",{style:{textAlign:"center",marginTop:"20px",fontSize:"1.1rem",fontWeight:"600",color:"#1565c0"},children:"Just One T-Shirt 50 Sales a Week!"})]})]}),e.jsxs("div",{className:"value-proposition",children:[e.jsx("h3",{children:"üéØ Why Choose ScreenMerch?"}),e.jsxs("div",{className:"value-grid",children:[e.jsxs("div",{className:"value-item",children:[e.jsx("div",{className:"value-icon",children:"üí∞"}),e.jsx("h4",{children:"Great Rates"}),e.jsx("p",{children:"Keep 70% of your earnings with our competitive 30% service fee"})]}),e.jsxs("div",{className:"value-item",children:[e.jsx("div",{className:"value-icon",children:"üìà"}),e.jsx("h4",{children:"Analytics"}),e.jsx("p",{children:"Track your sales, understand your audience, and optimize for growth"})]}),e.jsxs("div",{className:"value-item",children:[e.jsx("div",{className:"value-icon",children:"üé®"}),e.jsx("h4",{children:"Easy Setup"}),e.jsx("p",{children:"Simple and intuitive platform to create and sell your merchandise"})]}),e.jsxs("div",{className:"value-item",children:[e.jsx("div",{className:"value-icon",children:"üöÄ"}),e.jsx("h4",{children:"Completely Free"}),e.jsx("p",{children:"No monthly fees, no recurring charges, no hidden costs - just start earning immediately"})]})]})]})]})};const tc=()=>{const[t]=yt(),s=Oe(),[r,a]=c.useState(!0),[i,n]=c.useState(!1),[l,h]=c.useState(null),[v,S]=c.useState(!1),[b,_]=c.useState(null);return c.useEffect(()=>{window.scrollTo(0,0),(()=>{try{const C=JSON.parse(localStorage.getItem("processedSessions")||"[]");if(C.length>10){const M=C.slice(-10);localStorage.setItem("processedSessions",JSON.stringify(M)),console.log("üßπ Cleaned up old processed sessions")}}catch(C){console.error("Error cleaning up sessions:",C)}})(),(async()=>{const C=t.get("session_id"),M=localStorage.getItem("pendingSubscriptionSession"),y=JSON.parse(localStorage.getItem("processedSessions")||"[]"),L=parseInt(localStorage.getItem("loginAttempts")||"0");console.log("üîç Session ID Debug:",{sessionIdFromURL:C,pendingSessionFromStorage:M,processedSessions:y,loginAttempts:L,searchParams:Object.fromEntries(t.entries())});const Y=C||M;if(console.log("üéØ Session to use:",Y),!Y){console.log("üìã No session ID - checking if user is logged in for instructions");const{data:{user:F}}=await R.auth.getUser();if(F){console.log("‚úÖ User is logged in, showing instructions"),_(F.email),n(!0),a(!1);return}else{console.error("‚ùå No session ID and user not logged in"),h("Please sign in to view your instructions and personal link"),a(!1);return}}if(y.includes(Y)){console.log("‚ö†Ô∏è Session already processed, redirecting to dashboard"),n(!0);return}if(L>=3){console.error("‚ùå Too many login attempts, showing error"),h("Unable to verify subscription. Please contact support."),localStorage.removeItem("loginAttempts"),a(!1);return}C&&!M&&(localStorage.setItem("pendingSubscriptionSession",C),console.log("üíæ Stored session ID from URL:",C)),localStorage.getItem("justLoggedIn")&&(console.log("üîÑ User just logged in, waiting for auth state to settle..."),localStorage.removeItem("justLoggedIn"),await new Promise(F=>setTimeout(F,3e3)));try{let F=null,H=null,K=0;const O=3;for(;K<O;)try{const X=localStorage.getItem("user_authenticated")==="true",z=localStorage.getItem("user_email");if(X&&z)try{const B=await fetch("https://screenmerch.fly.dev/api/users/ensure-exists",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:z,display_name:z.split("@")[0]})});if(B.ok){const u=await B.json();F={id:u.user.id,email:u.user.email},_(u.user.email),H=null,console.log("‚úÖ User authenticated via localStorage:",z);break}else console.error("Error ensuring user exists:",await B.text()),H="Failed to ensure user exists in database"}catch(B){console.error("Error calling ensure-exists API:",B),H="Failed to verify user in database"}else F=null,H="Not authenticated in localStorage",console.log(`‚ùå Auth attempt ${K+1} failed:`,H);K<O-1&&(console.log(`‚è≥ Auth not ready, retrying in ${1e3/1e3} seconds... (${K+1}/${O})`),await new Promise(u=>setTimeout(u,1e3))),K++}catch(X){console.error(`‚ùå Auth check error on attempt ${K+1}:`,X),K++,K<O&&await new Promise(z=>setTimeout(z,1e3))}if(H||!F){console.log("‚ö†Ô∏è User not authenticated after retries, redirecting to login...");const X=L+1;localStorage.setItem("loginAttempts",X.toString()),S(!0),a(!1),setTimeout(()=>{s("/login?returnTo=/subscription-success")},3e3);return}console.log("‚úÖ User authenticated successfully:",F.email),localStorage.removeItem("loginAttempts"),M&&(localStorage.removeItem("pendingSubscriptionSession"),console.log("üßπ Cleared pending session from localStorage")),console.log("üîç Verifying subscription with session:",Y);const Z=await(await fetch(`${Me.ENDPOINTS.VERIFY_SUBSCRIPTION}/${Y}`)).json();if(console.log("üì° Verification response:",Z),Z.success){const X=await rs.activateProSubscription(Z.subscription_id,Z.customer_id);if(X.success){const z=[...y,Y];localStorage.setItem("processedSessions",JSON.stringify(z)),n(!0),localStorage.removeItem("pendingSubscriptionSession")}else h(X.error||"Failed to activate subscription")}else h(Z.message||"Payment verification failed")}catch(F){console.error("‚ùå Error verifying subscription:",F),h("Failed to verify payment")}finally{a(!1)}})()},[t,s]),r?e.jsx("div",{className:"subscription-success-page",children:e.jsxs("div",{className:"success-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("h2",{children:"Verifying your subscription..."}),e.jsx("p",{children:"Please wait while we confirm your payment."})]})}):v?e.jsx("div",{className:"subscription-success-page",children:e.jsxs("div",{className:"success-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("h2",{children:"Payment Successful! üéâ"}),e.jsx("p",{children:"Your payment has been processed successfully."}),e.jsx("p",{children:e.jsx("strong",{children:"Please sign in to complete your subscription activation."})}),e.jsx("p",{children:"You will be redirected to the login page in a few seconds..."}),e.jsx("button",{onClick:()=>s("/login?returnTo=/subscription-success"),className:"retry-btn",style:{marginTop:"20px"},children:"Sign In Now"})]})}):l?e.jsx("div",{className:"subscription-success-page",children:e.jsxs("div",{className:"success-container error",children:[e.jsx("div",{className:"error-icon",children:"‚ùå"}),e.jsx("h2",{children:"Access Required"}),e.jsx("p",{children:l}),l.includes("sign in")?e.jsx("button",{onClick:()=>s("/login"),className:"retry-btn",children:"Sign In"}):e.jsx("button",{onClick:()=>s("/subscription-tiers"),className:"retry-btn",children:"Get Started"})]})}):e.jsx("div",{className:"subscription-success-page",children:e.jsxs("div",{className:"success-container",children:[e.jsx("div",{className:"success-icon",children:"üéâ"}),e.jsxs("p",{className:"welcome-message",children:["üéâ ",e.jsx("strong",{children:"Welcome to ScreenMerch!"})," You're all set to start sharing amazing content and earning from your merchandise.",e.jsx("div",{className:"trial-notice-simple",children:"‚úÖ Your account is ready to start earning!"})]}),e.jsxs("div",{className:"next-steps",children:[e.jsx("h3",{children:"üöÄ Your Next Steps:"}),e.jsxs("ol",{children:[e.jsx("li",{children:e.jsx("strong",{children:"Go to dashboard"})}),e.jsx("li",{children:e.jsx("strong",{children:"Personalize your page and post content"})}),e.jsx("li",{children:e.jsx("strong",{children:"Promote with your personal link"})}),e.jsx("li",{children:e.jsx("strong",{children:"Track your sales in Analytics"})}),e.jsx("li",{children:e.jsx("strong",{children:"Start earning from your merch sales!"})})]}),e.jsx("p",{className:"monthly-payouts",children:"Monthly Payouts"})]}),e.jsxs("div",{className:"channel-link-section",children:[e.jsx("h3",{children:"üõçÔ∏è Your ScreenMerch Channel"}),e.jsx("p",{children:e.jsx("strong",{children:"Share this link with your audience to sell merch:"})}),e.jsxs("div",{className:"channel-link-container",children:[e.jsx("code",{className:"channel-link",children:b?`https://screenmerch.com/channel/${b.split("@")[0]}`:"https://screenmerch.com/channel/your-name"}),e.jsx("button",{onClick:()=>{const m=b?`https://screenmerch.com/channel/${b.split("@")[0]}`:"https://screenmerch.com/channel/your-name";navigator.clipboard.writeText(m),alert("Channel link copied to clipboard!")},className:"copy-link-btn",children:"üìã Copy Link"})]}),e.jsxs("p",{className:"channel-tip",children:["üí° ",e.jsx("strong",{children:"Pro Tip:"})," Add this link to your YouTube descriptions, social media bios, and website to start selling merch to your audience!"]})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:()=>s("/dashboard"),className:"dashboard-btn primary",children:"üöÄ Go to Dashboard"}),e.jsx("button",{onClick:()=>s("/"),className:"dashboard-btn secondary",children:"üè† Go to Homepage"})]})]})})};const sc=()=>{const t=Oe(),[s,r]=c.useState(null);return c.useEffect(()=>{(function(){try{localStorage.removeItem("cart"),localStorage.removeItem("cart_items"),localStorage.removeItem("cartData"),localStorage.removeItem("persistent_cart"),sessionStorage.removeItem("cartData"),sessionStorage.removeItem("cart"),Object.keys(localStorage).forEach(l=>{l.toLowerCase().includes("cart")&&localStorage.removeItem(l)}),Object.keys(sessionStorage).forEach(l=>{l.toLowerCase().includes("cart")&&sessionStorage.removeItem(l)}),console.log("üõí Cart cleared after successful purchase")}catch(l){console.error("Error clearing cart:",l)}})();const a=localStorage.getItem("order_tracking");if(a)try{const n=JSON.parse(a);r(n),localStorage.removeItem("order_tracking")}catch(n){console.error("Error parsing tracking data:",n)}const i=document.querySelector(".order-success-container");i&&(i.style.opacity="0",i.style.transform="translateY(20px)",setTimeout(()=>{i.style.transition="all 0.5s ease",i.style.opacity="1",i.style.transform="translateY(0)"},100))},[]),e.jsx("div",{className:"order-success-page",children:e.jsxs("div",{className:"order-success-container",children:[e.jsx("div",{className:"success-icon",children:"‚úÖ"}),e.jsx("h1",{className:"success-title",children:"Order Successful!"}),e.jsx("div",{className:"thank-you-message",children:e.jsx("p",{children:"Thank you for your order! Your custom merchandise is being created."})}),e.jsxs("div",{className:"next-steps",children:[e.jsx("h3",{children:"What happens next:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"‚úÖ Your order is being processed automatically"}),e.jsx("li",{children:"‚úÖ Products will be created and fulfilled by Printful"}),e.jsx("li",{children:"‚úÖ You'll receive email updates with tracking information"}),e.jsx("li",{children:"‚úÖ Your order will ship within 3-5 business days"})]})]}),s&&e.jsxs("div",{className:"order-details",children:[e.jsx("h3",{children:"üì¶ Order Details"}),e.jsxs("div",{className:"order-info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Order ID:"})," ",s.order_id]}),s.tracking_url&&e.jsxs("p",{children:[e.jsx("strong",{children:"Track your order:"})," ",e.jsx("a",{href:s.tracking_url,target:"_blank",rel:"noopener noreferrer",children:"View Order Status ‚Üí"})]})]})]}),e.jsx("div",{className:"support-info",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Need help?"})," Contact us at"," ",e.jsx("a",{href:"mailto:support@screenmerch.com",children:"support@screenmerch.com"})]})}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:()=>t("/"),className:"home-button",children:"Return to Home"}),e.jsx("button",{onClick:()=>t("/dashboard"),className:"dashboard-button",children:"Go to Dashboard"})]})]})})};const rc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA10lEQVR4nO3QPQrCQBQE4NVCbAVrsbEUC72Cnaews02TmRB4XsE72HkIQbG0tdFKRGuxE2ElkJCwaGJ+wCJ5MLDF7veSUao0Y9t2B8Dei3cuGu8DOJPUXgBcAQwLwUmOAdwDPLLkAWCS98unJJ8mHsmL5CyLXSM5j4HNLESk/pMsIg2SyxS49itbiUgzFgfQIrlOizNcsrMsq/2t7y7JQ1acYY6u6/ZMfADgUgCu/dwcxxlFqzkViOvgTz5WlRdWSfO3BSrjvWqBLmdFW/MRgE3We9WopHkDXTJU7bkaB10AAAAASUVORK5CYII=",ac=({sidebar:t,category:s,setCategory:r})=>{const[a,i]=c.useState(!0),[n,l]=c.useState([]),[h,v]=c.useState(!0);return c.useState("platform"),zt(),c.useEffect(()=>{(async()=>{v(!0);try{const{data:b,error:_}=await R.from("users").select(`
            id,
            username,
            display_name,
            profile_image_url,
            created_at
          `).not("username","is",null).order("created_at",{ascending:!1}).limit(10);if(_)console.error("Error fetching platform creators:",_),l([]);else{const m=b.filter(x=>x.username).map(x=>({id:x.id,username:x.username,name:x.display_name||x.username,avatar:x.profile_image_url,joinedAt:x.created_at,type:"platform"}));l(m)}}catch(b){console.error("Error fetching subscribers:",b),l([])}v(!1)})()},[]),e.jsxs("div",{className:`sidebar ${t?"":"small-sidebar"}`,children:[e.jsxs("div",{className:"shortcut-links",children:[e.jsxs(Ve,{to:"/",className:`side-link ${s===0?"active":""}`,onClick:()=>r(0),children:[e.jsx("img",{src:rc,alt:""}),e.jsx("p",{children:"Home"})]}),e.jsx("hr",{})]}),e.jsxs("div",{className:"subscribed-list",children:[e.jsxs("h3",{style:{cursor:"pointer"},onClick:()=>i(S=>!S),children:["CREATORS ",a?"‚ñ≤":"‚ñº"]}),a&&e.jsx("div",{children:h?e.jsx("div",{className:"loading-subs",children:"Loading creators..."}):n.length===0?e.jsx("div",{className:"no-subs",children:"No creators yet."}):e.jsx("div",{className:"subscribers-list",children:n.map(S=>e.jsx("div",{className:"subscriber-item-container",children:e.jsxs(Ve,{to:`/profile/${S.username}`,className:"side-link subscriber-item",children:[e.jsx("img",{src:S.avatar||"/default-avatar.jpg",alt:S.name,className:"subscriber-avatar"}),e.jsx("div",{className:"subscriber-info",children:e.jsx("p",{className:"subscriber-name",children:S.name})})]})},S.id))})})]})]})},ic=()=>{const t=Oe();return e.jsxs("div",{style:{minHeight:"60vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("h1",{style:{fontSize:"3rem",marginBottom:16},children:"üöß Coming Soon!"}),e.jsx("p",{style:{fontSize:"1.2rem",color:"#555",marginBottom:32},children:"This category or feature is not available yet. Check back soon for updates!"}),e.jsx("button",{onClick:()=>t("/"),style:{padding:"12px 32px",fontSize:"1rem",borderRadius:8,background:"#222",color:"#fff",border:"none",cursor:"pointer"},children:"Back to Home"})]})};const nc=()=>{var T;const[t,s]=c.useState(null),[r,a]=c.useState(!0),[i,n]=c.useState(!1),[l,h]=c.useState("dashboard"),[v,S]=c.useState([]),[b,_]=c.useState([]),[m,x]=c.useState([]),[C,M]=c.useState({}),[y,L]=c.useState(""),[Y,J]=c.useState("all"),[F,H]=c.useState("creator"),[K,O]=c.useState("active"),re=Oe();c.useEffect(()=>{Z()},[]),c.useEffect(()=>{i&&l==="users"&&z()},[y,Y,F,i,l]),c.useEffect(()=>{i&&l==="subscriptions"&&u()},[K,i,l]);const Z=async()=>{try{const d=localStorage.getItem("isAuthenticated"),w=localStorage.getItem("user");let P=null;if(d==="true"&&w)P=JSON.parse(w),console.log("üîê Admin: Found Google OAuth user:",P);else{const{data:{user:me}}=await R.auth.getUser();me&&(P=me,console.log("üîê Admin: Found Supabase user:",P))}if(!P){console.log("üîê Admin: No authenticated user found, redirecting to home"),re("/");return}if(s(P),!await ze.isAdmin()){alert("Access denied. Admin privileges required."),re("/");return}n(!0),X()}catch(d){console.error("Error checking admin status:",d),re("/")}finally{a(!1)}},X=async()=>{await Promise.all([z(),B(),u(),p()])},z=async()=>{try{const d=await ze.getUsers(0,100,y,Y,F);console.log("Loaded users:",d.users),S(d.users)}catch(d){console.error("Error loading users:",d)}},B=async()=>{try{const d=await ze.getVideos(0,100,y,Y);_(d.videos)}catch(d){console.error("Error loading videos:",d)}},u=async()=>{try{const d=await ze.getSubscriptions(K);x(d)}catch(d){console.error("Error loading subscriptions:",d)}},p=async()=>{try{const d=await ze.getDashboardStats();M({totalUsers:d.total_users||0,totalVideos:d.total_videos||0,totalSubscriptions:d.total_subscriptions||0,pendingVideos:d.pending_videos||0,activeUsers:d.active_users||0,suspendedUsers:d.suspended_users||0})}catch(d){console.error("Error loading stats:",d)}},N=async(d,w)=>{if(console.log("üéØ handleUserAction called with:",{userId:d,action:w}),!confirm(`Are you sure you want to ${w} this user?`)){console.log("‚ùå User cancelled the action");return}console.log("‚úÖ User confirmed the action, proceeding...");try{let P;w==="delete"?(console.log("üóëÔ∏è Calling AdminService.deleteUser..."),P=await ze.deleteUser(d),console.log("üóëÔ∏è Delete result:",P)):w==="suspend"?(console.log(`Suspending user ${d}...`),P=await ze.updateUserStatus(d,"suspended"),console.log("Suspend result:",P)):w==="activate"?(console.log(`Activating user ${d}...`),P=await ze.updateUserStatus(d,"active"),console.log("Activate result:",P)):w==="approve"&&(console.log(`Approving user ${d}...`),P=await ze.approveUser(d),console.log("Approve result:",P)),P.success?(alert(`User ${w}d successfully`),console.log("Reloading users..."),await z(),console.log("Users reloaded")):alert(`Failed to ${w} user: ${P.error}`)}catch(P){console.error(`Error ${w}ing user:`,P),alert(`Failed to ${w} user`)}},j=async(d,w)=>{if(confirm(`Are you sure you want to ${w} this video?`))try{let P;w==="delete"?P=await ze.deleteVideo(d):w==="approve"?P=await ze.updateVideoStatus(d,"approved"):w==="reject"&&(P=await ze.updateVideoStatus(d,"rejected")),P.success?(alert(`Video ${w}d successfully`),B()):alert(`Failed to ${w} video: ${P.error}`)}catch(P){console.error(`Error ${w}ing video:`,P),alert(`Failed to ${w} video`)}},o=async(d,w)=>{if(confirm(`Are you sure you want to ${w==="delete"?"delete (cancel)":w} this subscription? All data will be preserved.`))try{let Q;w==="delete"?Q=await ze.deleteSubscription(d):w==="reactivate"&&(Q=await ze.reactivateSubscription(d)),Q.success?(alert(`Subscription ${w==="delete"?"canceled":"reactivated"} successfully`),u()):alert(`Failed to ${w} subscription: ${Q.error}`)}catch(Q){console.error(`Error ${w}ing subscription:`,Q),alert(`Failed to ${w} subscription`)}},f=v.filter(d=>{var me,ae;const w=((me=d.display_name)==null?void 0:me.toLowerCase().includes(y.toLowerCase()))||((ae=d.email)==null?void 0:ae.toLowerCase().includes(y.toLowerCase())),P=Y==="all"||d.status===Y,Q=F==="all"||d.role===F;return w&&P&&Q}),g=b.filter(d=>{var Q,me;const w=((Q=d.title)==null?void 0:Q.toLowerCase().includes(y.toLowerCase()))||((me=d.description)==null?void 0:me.toLowerCase().includes(y.toLowerCase())),P=Y==="all"||d.verification_status===Y;return w&&P});return r?e.jsxs("div",{className:"admin-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading admin panel..."})]}):t?i?e.jsxs("div",{className:"admin-container",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{children:"Admin Portal - UPDATED VERSION 2025"}),e.jsxs("div",{className:"admin-user-info",children:[e.jsxs("span",{children:["Welcome, ",((T=t==null?void 0:t.user_metadata)==null?void 0:T.name)||(t==null?void 0:t.email)]}),e.jsx("button",{onClick:()=>re("/"),className:"admin-logout-btn",children:"Back to Site"})]})]}),e.jsxs("div",{className:"admin-content",children:[e.jsxs("div",{className:"admin-sidebar",children:[e.jsx("button",{className:`admin-tab ${l==="dashboard"?"active":""}`,onClick:()=>h("dashboard"),children:"Dashboard"}),e.jsx("button",{className:`admin-tab ${l==="users"?"active":""}`,onClick:()=>h("users"),children:"User Management"}),e.jsx("button",{className:`admin-tab ${l==="videos"?"active":""}`,onClick:()=>h("videos"),children:"Content Moderation"}),e.jsx("button",{className:`admin-tab ${l==="subscriptions"?"active":""}`,onClick:()=>h("subscriptions"),children:"Subscriptions"}),e.jsx("button",{className:`admin-tab ${l==="settings"?"active":""}`,onClick:()=>h("settings"),children:"System Settings"})]}),e.jsxs("div",{className:"admin-main",children:[l==="dashboard"&&e.jsxs("div",{className:"admin-dashboard",children:[e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Users"}),e.jsx("p",{className:"stat-number",children:C.totalUsers})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Active Users"}),e.jsx("p",{className:"stat-number",children:C.activeUsers})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Suspended Users"}),e.jsx("p",{className:"stat-number",children:C.suspendedUsers})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Videos"}),e.jsx("p",{className:"stat-number",children:C.totalVideos})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Pending Approvals"}),e.jsx("p",{className:"stat-number",children:C.pendingVideos})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Active Subscriptions"}),e.jsx("p",{className:"stat-number",children:C.totalSubscriptions})]})]}),e.jsxs("div",{className:"recent-activity",children:[e.jsx("h3",{children:"Recent Activity"}),e.jsx("div",{className:"activity-list",children:v.slice(0,5).map(d=>e.jsxs("div",{className:"activity-item",children:[e.jsxs("span",{children:["New user: ",d.display_name||d.email]}),e.jsx("span",{children:new Date(d.created_at).toLocaleDateString()})]},d.id))})]})]}),l==="users"&&e.jsxs("div",{className:"admin-users",children:[e.jsxs("div",{className:"admin-filters",children:[e.jsx("input",{type:"text",placeholder:"Search users...",value:y,onChange:d=>L(d.target.value),className:"admin-search"}),e.jsxs("select",{value:F,onChange:d=>H(d.target.value),className:"admin-filter",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"creator",children:"Creators"}),e.jsx("option",{value:"customer",children:"Customers"})]}),e.jsxs("select",{value:Y,onChange:d=>J(d.target.value),className:"admin-filter",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"suspended",children:"Suspended"})]})]}),e.jsx("div",{className:"users-table",style:{overflowX:"auto",width:"100%"},children:e.jsxs("table",{style:{minWidth:"1200px",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Joined"}),e.jsx("th",{children:"Status"}),e.jsx("th",{style:{backgroundColor:"#ffeb3b",color:"#000",minWidth:"200px",position:"sticky",right:"0"},children:"Actions"})]})}),e.jsxs("tbody",{children:[console.log("üîç Rendering users table with",f.length,"users"),f.map(d=>{var w;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"user-info",children:[e.jsx("img",{src:d.profile_image_url||((w=d.user_metadata)==null?void 0:w.picture)||d.picture||"/default-avatar.jpg",alt:d.display_name,className:"user-avatar",onError:P=>{P.target.dataset.fallbackUsed||(console.log("üñºÔ∏è Admin user image failed to load, using default"),P.target.dataset.fallbackUsed="true",P.target.src="/default-avatar.jpg")}}),e.jsx("span",{children:d.display_name||"No name"})]})}),e.jsx("td",{children:d.email}),e.jsx("td",{children:e.jsx("span",{style:{padding:"4px 8px",borderRadius:"4px",backgroundColor:d.role==="creator"?"#e3f2fd":"#f5f5f5",color:d.role==="creator"?"#1976d2":"#666",textTransform:"capitalize",fontSize:"12px",fontWeight:"500"},children:d.role||"customer"})}),e.jsx("td",{children:new Date(d.created_at).toLocaleDateString()}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${d.status||"active"}`,children:d.status?d.status.toUpperCase():"ACTIVE"})}),e.jsx("td",{style:{minWidth:"200px",position:"sticky",right:"0",backgroundColor:"#fff",zIndex:10},children:e.jsxs("div",{className:"action-buttons",children:[d.status==="pending"&&e.jsx("button",{onClick:()=>N(d.id,"approve"),className:"action-btn approve",style:{backgroundColor:"#28a745",color:"white"},children:"Approve"}),e.jsx("button",{onClick:()=>N(d.id,"suspend"),className:"action-btn suspend",disabled:d.status==="suspended",children:"Suspend"}),e.jsx("button",{onClick:()=>N(d.id,"activate"),className:"action-btn activate",disabled:d.status==="active"||d.status==="pending",children:"Activate"}),e.jsx("button",{onClick:P=>{P.preventDefault(),P.stopPropagation(),alert("Delete button clicked!"),console.log("üóëÔ∏è DELETE BUTTON CLICKED!"),console.log("üóëÔ∏è User ID:",d.id),console.log("üóëÔ∏è User email:",d.email),console.log("üóëÔ∏è Event:",P),N(d.id,"delete")},className:"action-btn delete",style:{backgroundColor:"#dc3545",color:"white",padding:"8px 16px",fontSize:"14px",cursor:"pointer"},children:"Delete"})]})})]},d.id)})]})]})})]}),l==="videos"&&e.jsxs("div",{className:"admin-videos",children:[e.jsxs("div",{className:"admin-filters",children:[e.jsx("input",{type:"text",placeholder:"Search videos...",value:y,onChange:d=>L(d.target.value),className:"admin-search"}),e.jsxs("select",{value:Y,onChange:d=>J(d.target.value),className:"admin-filter",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),e.jsx("div",{className:"videos-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Video"}),e.jsx("th",{children:"Creator"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Uploaded"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:g.map(d=>{var w,P,Q;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"video-info",children:[e.jsx("img",{src:d.thumbnail||"/default-thumbnail.jpg",alt:d.title,className:"video-thumbnail"}),e.jsxs("div",{children:[e.jsx("h4",{children:d.title}),e.jsxs("p",{children:[(w=d.description)==null?void 0:w.substring(0,100),"..."]})]})]})}),e.jsx("td",{children:((P=d.users)==null?void 0:P.display_name)||((Q=d.users)==null?void 0:Q.email)}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${d.verification_status}`,children:d.verification_status})}),e.jsx("td",{children:new Date(d.created_at).toLocaleDateString()}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:()=>j(d.id,"approve"),className:"action-btn approve",disabled:d.verification_status==="approved",children:"Approve"}),e.jsx("button",{onClick:()=>j(d.id,"reject"),className:"action-btn reject",disabled:d.verification_status==="rejected",children:"Reject"}),e.jsx("button",{onClick:()=>j(d.id,"delete"),className:"action-btn delete",children:"Delete"})]})})]},d.id)})})]})})]}),l==="subscriptions"&&e.jsxs("div",{className:"admin-subscriptions",children:[e.jsx("h3",{children:"Subscription Management"}),e.jsx("div",{className:"admin-filters",children:e.jsxs("select",{value:K,onChange:d=>O(d.target.value),className:"admin-filter",children:[e.jsx("option",{value:"active",children:"Active Subscriptions"}),e.jsx("option",{value:"canceled",children:"Canceled Subscriptions"}),e.jsx("option",{value:"all",children:"All Subscriptions"})]})}),e.jsx("div",{className:"subscriptions-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Tier"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Start Date"}),e.jsx("th",{children:"End Date"}),e.jsx("th",{style:{backgroundColor:"#ffeb3b",color:"#000",minWidth:"150px",position:"sticky",right:"0"},children:"Actions"})]})}),e.jsx("tbody",{children:m.map(d=>{var w,P;return e.jsxs("tr",{children:[e.jsx("td",{children:((w=d.users)==null?void 0:w.display_name)||((P=d.users)==null?void 0:P.email)}),e.jsx("td",{children:e.jsx("span",{className:`tier-badge ${d.tier}`,children:d.tier})}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${d.status}`,children:d.status})}),e.jsx("td",{children:d.current_period_start?new Date(d.current_period_start).toLocaleDateString():"N/A"}),e.jsx("td",{children:d.current_period_end?new Date(d.current_period_end).toLocaleDateString():"N/A"}),e.jsx("td",{style:{minWidth:"150px",position:"sticky",right:"0",backgroundColor:"#fff",zIndex:10},children:e.jsx("div",{className:"action-buttons",children:d.status==="canceled"?e.jsx("button",{onClick:()=>o(d.id,"reactivate"),className:"action-btn activate",style:{backgroundColor:"#28a745",color:"white"},children:"Reactivate"}):e.jsx("button",{onClick:()=>o(d.id,"delete"),className:"action-btn delete",style:{backgroundColor:"#dc3545",color:"white"},children:"Delete"})})})]},d.id)})})]})})]}),l==="settings"&&e.jsxs("div",{className:"admin-settings",children:[e.jsx("h3",{children:"System Settings"}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h4",{children:"Admin Configuration"}),e.jsx("p",{children:"Configure admin emails and system settings here."}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Admin Emails (comma-separated):"}),e.jsx("input",{type:"text",placeholder:"admin@example.com, admin2@example.com",className:"setting-input"})]}),e.jsx("button",{className:"save-settings-btn",children:"Save Settings"})]})]})]})]})]}):e.jsxs("div",{className:"admin-access-denied",children:[e.jsx("h2",{children:"Access Denied"}),e.jsx("p",{children:"You don't have admin privileges to access this panel."}),e.jsx("button",{onClick:()=>re("/"),className:"admin-back-btn",children:"Back to Home"})]}):e.jsx("div",{className:"admin-login-container",children:e.jsxs("div",{className:"admin-login-form",children:[e.jsx("h2",{children:"Admin Portal Login"}),e.jsx("p",{children:"Please sign in with your admin account to access the admin panel."}),e.jsx("button",{onClick:()=>{window.location.href=`https://screenmerch.fly.dev/api/auth/google/login?return_url=${encodeURIComponent(window.location.href)}`},className:"admin-login-btn",children:"Sign in with Google"}),e.jsx("p",{className:"admin-login-note",children:"Only users with admin privileges can access this panel."})]})})},oc=()=>{const[t,s]=c.useState(""),[r,a]=c.useState(""),[i,n]=c.useState(!0),[l,h]=c.useState(""),v=Oe(),[S]=yt(),b=S.get("returnTo")||"/",_=async m=>{if(m.preventDefault(),h(""),i){const{error:x}=await R.auth.signInWithPassword({email:t,password:r});x?h(x.message):(h("Logged in! Redirecting..."),setTimeout(()=>{v(b)},1e3))}else{const{error:x}=await R.auth.signUp({email:t,password:r});h(x?x.message:"Signup successful! Check your email for a confirmation link.")}};return e.jsxs("div",{style:{maxWidth:400,margin:"2rem auto",padding:20,border:"1px solid #ccc",borderRadius:8},children:[e.jsx("h2",{children:i?"Login":"Sign Up"}),e.jsxs("form",{onSubmit:_,children:[e.jsx("input",{type:"email",placeholder:"Email",value:t,required:!0,onChange:m=>s(m.target.value),style:{width:"100%",marginBottom:10,padding:8}}),e.jsx("input",{type:"password",placeholder:"Password",value:r,required:!0,onChange:m=>a(m.target.value),style:{width:"100%",marginBottom:10,padding:8}}),e.jsx("button",{type:"submit",style:{width:"100%",padding:10},children:i?"Login":"Sign Up"})]}),e.jsx("button",{onClick:()=>{n(!i),h("")},style:{marginTop:10,width:"100%",background:"none",border:"none",color:"#007bff",cursor:"pointer"},children:i?"Don't have an account? Sign Up":"Already have an account? Login"}),l&&e.jsx("div",{style:{marginTop:15,color:"red"},children:l})]})};const fr=typeof import.meta<"u"&&{VITE_API_BASE_URL:"https://screenmerch.fly.dev",VITE_SUPABASE_URL:"https://sojxbydpcdcdzfdtbypd.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no",VITE_API_URL:"https://screenmerch.fly.dev",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&{}.VITE_BACKEND_URL||typeof process<"u"&&process.env&&{}.REACT_APP_BACKEND_URL||"https://screenmerch.fly.dev",xr=()=>{const t=Oe(),[s]=yt(),r=zt(),[a,i]=c.useState(""),[n,l]=c.useState(""),[h,v]=c.useState(!0),[S,b]=c.useState(!1),[_,m]=c.useState(null),[x,C]=c.useState(!1);c.useEffect(()=>{var J,F;if(r.pathname==="/signup"){v(!1);const H=localStorage.getItem("pending_paypal_email"),K=localStorage.getItem("pending_payment_method"),O=((F=(J=r.state)==null?void 0:J.from)==null?void 0:F.includes("/payment-setup"))||document.referrer.includes("/payment-setup");C(!!(H||K||O))}else C(!1)},[r.pathname,r.state]),c.useEffect(()=>{s.get("status")==="session_expired"&&m({type:"error",text:"Your session expired. Please sign in again."})},[s]);const M=J=>`${fr}${J}`,y=async J=>{var O,re;if(J.preventDefault(),m(null),!a.trim()){m({type:"error",text:"Please enter your email."});return}const F=!h&&!x;if(!F&&!n){m({type:"error",text:"Please enter your password."});return}const K=M(h?"/api/auth/login":F?"/api/auth/signup/email-only":"/api/auth/signup");try{b(!0);const Z=F?{email:a.trim()}:{email:a.trim(),password:n,is_creator:!h&&x},X=await fetch(K,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(Z)}),B=(X.headers.get("content-type")||"").includes("application/json");if(!X.ok){const N=await X.text();if(B){let j;try{j=JSON.parse(N)}catch{throw new Error(`Server error ${X.status}`)}const o=X.status===409&&((O=j==null?void 0:j.error)!=null&&O.includes("already exists"))?"This email is already registered. Please sign in instead.":(j==null?void 0:j.error)||`Server error: ${X.status}`;throw new Error(o)}else throw new Error(`Could not reach auth API (HTTP ${X.status}). Check BACKEND_URL.`)}if(!B)throw new Error("Unexpected response from server (not JSON).");const u=await X.json();if(F){m({type:"success",text:"Please check your email to verify your account and set your password."}),i("");return}u!=null&&u.token&&localStorage.setItem("auth_token",u.token),u!=null&&u.user&&localStorage.setItem("user",JSON.stringify(u.user)),localStorage.setItem("isAuthenticated","true");const p=s.get("returnTo");if(p==="subscription-success"&&localStorage.setItem("justLoggedIn","true"),m({type:"success",text:u.message||"Login successful! Redirecting‚Ä¶"}),h)setTimeout(()=>{var j;const N=((j=u==null?void 0:u.user)==null?void 0:j.role)||"customer";t(p==="merch"?"/merchandise":p==="subscription-success"?"/subscription-success":N==="customer"?"/product/browse":"/dashboard")},700);else{const N=localStorage.getItem("pending_paypal_email"),j=localStorage.getItem("pending_tax_id");x&&((re=u==null?void 0:u.user)==null?void 0:re.status)==="pending"?setTimeout(()=>{t("/dashboard",{state:{message:"Your account is pending approval. You will receive an email once approved."}})},2e3):setTimeout(()=>{t(N||j?"/subscription-success":"/payment-setup?ref=new_user")},1e3)}}catch(Z){m({type:"error",text:(Z==null?void 0:Z.message)||"Authentication error: Load failed"})}finally{b(!1)}},L=()=>{v(J=>!J),m(null),r.pathname!=="/signup"&&C(!1)},Y=()=>{window.location.href=`${fr}/api/auth/google/login`};return e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-card",children:[e.jsx("h2",{className:"login-title",children:h?"Welcome back":"Create your account"}),e.jsx("p",{className:"login-subtitle",children:h?"Sign in to continue to ScreenMerch":"Join ScreenMerch and start creating merch from your content"}),_&&e.jsx("div",{className:`login-alert ${_.type==="error"?"login-alert-error":"login-alert-success"}`,role:"alert",children:_.text}),e.jsxs("form",{className:"login-form",onSubmit:y,noValidate:!0,children:[e.jsxs("div",{className:"login-field",children:[e.jsx("label",{htmlFor:"email",className:"login-label",children:"Email"}),e.jsx("input",{id:"email",type:"email",className:"login-input",placeholder:"you@example.com",autoComplete:"email",value:a,onChange:J=>i(J.target.value),disabled:S,required:!0})]}),(()=>h||x?e.jsxs("div",{className:"login-field",children:[e.jsx("label",{htmlFor:"password",className:"login-label",children:"Password"}),e.jsx("input",{id:"password",type:"password",className:"login-input",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",autoComplete:h?"current-password":"new-password",value:n,onChange:F=>l(F.target.value),disabled:S,required:!0})]}):null)(),e.jsx("button",{type:"submit",className:"login-submit-btn",disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),"Processing..."]}):h?"Sign In":"Create Account"})]}),e.jsxs("div",{className:"login-toggle",children:[e.jsx("span",{children:h?"Don't have an account?":"Already have an account?"}),e.jsx("button",{className:"login-toggle-btn",onClick:L,disabled:S,children:h?"Create one":"Sign in"})]}),e.jsx("div",{className:"login-divider",children:e.jsx("span",{children:"or"})}),e.jsx("div",{className:"login-social",children:e.jsxs("button",{type:"button",className:"google-btn",onClick:Y,disabled:S,style:{display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx("span",{role:"img","aria-label":"google",children:"üîç"}),"Sign in with Google"]})})]})})};const lc=()=>e.jsx("div",{className:"privacy-policy-container",children:e.jsxs("div",{className:"privacy-policy-content",children:[e.jsx("div",{className:"logo",children:e.jsx("img",{src:is,alt:"ScreenMerch Logo",className:"logo-img"})}),e.jsx("h1",{children:"Privacy Policy"}),e.jsx("div",{className:"last-updated",children:"Last Updated: January 2025"}),e.jsxs("section",{children:[e.jsx("h2",{children:"Company Information"}),e.jsxs("p",{children:[e.jsx("strong",{children:"ScreenMerch"})," is committed to protecting your privacy and ensuring the security of your personal information. This Privacy Policy explains how we collect, use, protect, and handle your information when you use our custom merchandise platform and services."]}),e.jsxs("div",{className:"highlight-box",children:[e.jsx("strong",{children:"Contact Information:"}),e.jsx("br",{}),"Company: ScreenMerch",e.jsx("br",{}),"Website: screenmerch.com",e.jsx("br",{}),"Email: support@screenmerch.com",e.jsx("br",{}),"Privacy Officer: support@screenmerch.com"]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"Information We Collect"}),e.jsx("h3",{children:"Personal Information"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Account Information:"})," Name, email address, username, password (encrypted)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Contact Details:"})," Phone number (for order notifications), mailing address"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Billing Information:"})," Shipping and billing addresses, payment method details (processed securely through Stripe)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Profile Data:"})," Profile pictures, preferences, customization settings"]})]}),e.jsx("h3",{children:"Content and Usage Information"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Video Content:"})," Video files, screenshots, thumbnails, and images you upload"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Custom Designs:"})," Product customizations, text overlays, design modifications"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Order History:"})," Products ordered, preferences, purchase patterns"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Platform Usage:"})," Navigation patterns, feature usage, time spent on platform"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Technical Data:"})," IP address, browser type, device information, operating system"]})]})]}),e.jsxs("section",{className:"security-box",children:[e.jsx("h2",{children:"Content Processing and Protection"}),e.jsx("h3",{children:"Video Content Handling"}),e.jsx("p",{children:e.jsx("strong",{children:"How We Process Your Content:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Video content is processed through secure, encrypted servers"}),e.jsx("li",{children:"We extract screenshots and thumbnails for merchandise creation"}),e.jsx("li",{children:"All processing occurs within our protected infrastructure"}),e.jsx("li",{children:"Content is never shared with unauthorized third parties"}),e.jsx("li",{children:"We maintain strict access controls for all uploaded content"})]}),e.jsx("h3",{children:"Content Rights and Usage"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Your Content Ownership:"})," You retain ownership of your original content"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Platform License:"})," You grant us limited rights to process content for merchandise creation"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Exclusivity Protection:"})," We ensure your processed content remains exclusive to ScreenMerch"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"No Unauthorized Sharing:"})," Your content is never provided to competing platforms"]})]}),e.jsx("h3",{children:"Data Retention"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Active account content: Retained while account is active"}),e.jsx("li",{children:"Order-related content: Retained for 7 years for legal/tax purposes"}),e.jsx("li",{children:"Backup content: Securely destroyed after 90 days in backups"}),e.jsx("li",{children:"Deleted account content: Permanently removed within 30 days"})]})]}),e.jsxs("section",{className:"sms-section",children:[e.jsx("h2",{children:"SMS Messaging and Communications"}),e.jsx("h3",{children:"SMS Consent and Usage"}),e.jsx("p",{children:"By providing your phone number and checking the SMS consent box during checkout, you explicitly consent to receive SMS text messages from ScreenMerch for the following purposes:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Order Notifications:"})," Updates about your order status, processing, and shipping"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Customer Service:"})," Support communications and order assistance"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Account Security:"})," Two-factor authentication and security alerts"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Important Updates:"})," Critical account or service notifications"]})]}),e.jsxs("div",{className:"highlight-box",children:[e.jsx("strong",{children:"Program Name:"})," ScreenMerch Notifications",e.jsx("br",{}),e.jsx("strong",{children:"Provider:"})," ScreenMerch",e.jsx("br",{}),e.jsx("strong",{children:"Purpose:"})," Order notifications and customer service communications",e.jsx("br",{}),e.jsx("strong",{children:"Frequency:"})," 1-3 messages per order, occasional service messages",e.jsx("br",{}),e.jsx("strong",{children:"Opt-Out:"})," Reply STOP to any SMS to unsubscribe immediately",e.jsx("br",{}),e.jsx("strong",{children:"Help:"})," Reply HELP to any SMS for assistance or contact support@screenmerch.com",e.jsx("br",{}),e.jsx("strong",{children:"Cost:"})," Message and data rates may apply based on your mobile carrier plan"]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"How We Use Your Information"}),e.jsx("h3",{children:"Primary Uses"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Service Delivery:"})," Process and fulfill your custom merchandise orders"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Content Processing:"})," Transform your video content into printable merchandise designs"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Communication:"})," Send order notifications via SMS and email (with consent)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Customer Support:"})," Provide assistance and resolve issues"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Platform Improvement:"})," Enhance our services and user experience"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Security:"})," Protect against fraud and unauthorized access"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Legal Compliance:"})," Meet regulatory and legal obligations"]})]}),e.jsx("h3",{children:"Platform Exclusivity Protection"}),e.jsxs("ul",{children:[e.jsx("li",{children:"We ensure your content remains exclusive to ScreenMerch platform"}),e.jsx("li",{children:"We monitor and prevent unauthorized use of your processed content"}),e.jsx("li",{children:"We maintain audit trails for content usage and access"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"Data Security and Protection"}),e.jsx("h3",{children:"Technical Safeguards"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Encryption:"})," End-to-end encryption for data transmission and storage"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Access Controls:"})," Multi-factor authentication and role-based access"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Monitoring:"})," 24/7 security monitoring and intrusion detection"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Backups:"})," Secure, encrypted backups with restricted access"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Infrastructure:"})," SOC 2 compliant cloud infrastructure"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"Your Privacy Rights"}),e.jsx("p",{children:"You have the right to:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Access:"})," Request a copy of your personal information"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Correction:"})," Update or correct inaccurate information"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Deletion:"})," Request deletion of your information (subject to legal requirements)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Portability:"})," Receive your data in a structured, machine-readable format"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Opt-Out:"})," Withdraw consent for SMS communications"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Restriction:"})," Request limitations on how we process your data"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"Contact Us"}),e.jsx("p",{children:"For privacy-related questions, concerns, or requests, please contact us:"}),e.jsxs("div",{className:"highlight-box",children:[e.jsx("strong",{children:"Privacy Officer:"})," support@screenmerch.com",e.jsx("br",{}),e.jsx("strong",{children:"General Support:"})," support@screenmerch.com",e.jsx("br",{}),e.jsx("strong",{children:"Website:"})," screenmerch.com",e.jsx("br",{}),e.jsx("strong",{children:"SMS Opt-Out:"})," Reply STOP to any message",e.jsx("br",{}),e.jsx("strong",{children:"Data Requests:"})," support@screenmerch.com"]})]}),e.jsxs("div",{className:"navigation-links",children:[e.jsx(Ve,{to:"/",className:"nav-link",children:"‚Üê Back to ScreenMerch"})," |",e.jsx(Ve,{to:"/terms-of-service",className:"nav-link",children:"Terms of Service ‚Üí"})]})]})});const cc=()=>e.jsx("div",{className:"terms-container",children:e.jsxs("div",{className:"terms-content",children:[e.jsx("div",{className:"logo",children:e.jsx("img",{src:is,alt:"ScreenMerch Logo",className:"logo-img"})}),e.jsx("h1",{children:"Terms of Service"}),e.jsx("div",{className:"last-updated",children:"Last Updated: January 2025"}),e.jsxs("section",{children:[e.jsx("h2",{children:"1. Acceptance of Terms"}),e.jsx("p",{children:'By accessing and using ScreenMerch ("the Service"), you accept and agree to be bound by the terms and provision of this agreement. These Terms of Service ("Terms") govern your use of the ScreenMerch website and services. If you do not agree to these terms, you must not use the Service.'})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"2. Description of Service"}),e.jsx("p",{children:"ScreenMerch is a platform that allows users to create custom merchandise from video content, including screenshots and thumbnails. We facilitate the creation and ordering of custom products through third-party providers. Our platform is designed exclusively for creating merchandise through ScreenMerch services."})]}),e.jsxs("section",{className:"critical-box",children:[e.jsx("h2",{children:"3. CRITICAL: Intellectual Property Protection & Platform Exclusivity"}),e.jsx("h3",{children:"3.1 Reverse Engineering Prohibition"}),e.jsx("p",{children:e.jsx("strong",{children:"YOU EXPRESSLY AGREE AND ACKNOWLEDGE THAT:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"You will NOT reverse engineer, decompile, disassemble, or attempt to derive the source code of ScreenMerch platform"}),e.jsx("li",{children:"You will NOT attempt to discover underlying algorithms, methods, or processes used by ScreenMerch"}),e.jsx("li",{children:"You will NOT use any automated tools, bots, or scrapers to extract data or functionality from ScreenMerch"}),e.jsx("li",{children:"You will NOT create competing services based on ScreenMerch's functionality or design"}),e.jsx("li",{children:"You will NOT copy, reproduce, or replicate ScreenMerch's user interface, workflows, or business processes"})]}),e.jsx("h3",{children:"3.2 Platform Exclusivity Agreement"}),e.jsx("p",{children:e.jsx("strong",{children:"EXCLUSIVE USE COMMITMENT:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("strong",{children:"You agree that any video images, screenshots, thumbnails, or content processed through ScreenMerch may ONLY be used to create products through ScreenMerch platform"})}),e.jsx("li",{children:"You will NOT use video content processed on ScreenMerch to create merchandise on any other platform (including but not limited to Printful, Teespring, Redbubble, Etsy, Amazon Merch, etc.)"}),e.jsx("li",{children:"You will NOT download, export, or transfer video images from ScreenMerch to create products elsewhere"}),e.jsx("li",{children:"You will NOT share, distribute, or provide ScreenMerch-processed content to third parties for merchandise creation"}),e.jsx("li",{children:"Any custom designs, layouts, or modifications created through ScreenMerch remain exclusive to ScreenMerch platform"})]}),e.jsx("h3",{children:"3.3 Enforcement and Penalties"}),e.jsx("p",{children:"Violation of these exclusivity and protection terms will result in:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Immediate account termination without refund"}),e.jsx("li",{children:"Legal action for breach of contract and intellectual property infringement"}),e.jsx("li",{children:"Monetary damages including lost profits and legal fees"}),e.jsx("li",{children:"Permanent ban from all ScreenMerch services"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"4. User Accounts"}),e.jsx("h3",{children:"Account Creation"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You may be required to create an account to access certain features"}),e.jsx("li",{children:"You are responsible for maintaining the confidentiality of your account"}),e.jsx("li",{children:"You are responsible for all activities that occur under your account"}),e.jsx("li",{children:"You must provide accurate and complete information when creating an account"}),e.jsx("li",{children:"Each user may only maintain one active account"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"5. Content and Intellectual Property Rights"}),e.jsx("h3",{children:"5.1 User Content Ownership"}),e.jsxs("ul",{children:[e.jsx("li",{children:"You retain ownership of original content you upload to ScreenMerch"}),e.jsx("li",{children:"You grant ScreenMerch a limited, non-exclusive license to process your content for merchandise creation"}),e.jsx("li",{children:"You are responsible for ensuring you have rights to any content you upload"}),e.jsx("li",{children:"You must not upload copyrighted content without proper authorization"})]}),e.jsx("h3",{children:"5.2 ScreenMerch Intellectual Property"}),e.jsxs("ul",{children:[e.jsx("li",{children:"ScreenMerch platform, technology, algorithms, and processes are proprietary and protected"}),e.jsx("li",{children:"All ScreenMerch branding, logos, and design elements are owned by ScreenMerch"}),e.jsx("li",{children:"Product templates, layouts, and customization tools are ScreenMerch intellectual property"}),e.jsx("li",{children:"You may not use ScreenMerch IP for any purpose outside the intended service"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"6. Platform Usage Restrictions"}),e.jsx("h3",{children:"6.1 Prohibited Content"}),e.jsx("p",{children:"You may not upload or create products containing:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Copyrighted material without authorization"}),e.jsx("li",{children:"Illegal, harmful, threatening, or offensive content"}),e.jsx("li",{children:"Content that violates privacy or publicity rights"}),e.jsx("li",{children:"Trademarked material without permission"}),e.jsx("li",{children:"Adult or explicit content"}),e.jsx("li",{children:"Content promoting violence, hate, or discrimination"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"7. Orders and Payment"}),e.jsx("h3",{children:"7.1 Product Orders"}),e.jsxs("ul",{children:[e.jsx("li",{children:"All orders are subject to acceptance and product availability"}),e.jsx("li",{children:"Prices are displayed in USD and may change without notice"}),e.jsx("li",{children:"Payment is processed securely through Stripe"}),e.jsx("li",{children:"You agree to provide accurate billing information"}),e.jsx("li",{children:"Orders cannot be transferred to other platforms"})]}),e.jsx("h3",{children:"7.2 Refunds and Returns"}),e.jsxs("ul",{children:[e.jsx("li",{children:"All items are customized and cannot be returned or refunded"}),e.jsx("li",{children:"Refunds are only available in cases of producer error or manufacturing defects"}),e.jsx("li",{children:"Refund requests for producer errors must be submitted within 30 days of delivery"}),e.jsx("li",{children:"No refunds for violation of exclusivity terms"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"8. Prohibited Uses"}),e.jsx("p",{children:"You may not use ScreenMerch to:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Upload illegal, harmful, or offensive content"}),e.jsx("li",{children:"Infringe on intellectual property rights"}),e.jsx("li",{children:"Engage in fraudulent or deceptive practices"}),e.jsx("li",{children:"Attempt to circumvent security measures"}),e.jsx("li",{children:"Use automated systems to access the service"}),e.jsx("li",{children:"Reverse engineer or replicate our platform"}),e.jsx("li",{children:"Export content for use on competing platforms"}),e.jsx("li",{children:"Violate platform exclusivity agreements"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"9. Termination"}),e.jsx("h3",{children:"9.1 Termination by ScreenMerch"}),e.jsxs("ul",{children:[e.jsx("li",{children:"We may terminate accounts for violation of these terms"}),e.jsx("li",{children:"Immediate termination for reverse engineering or exclusivity violations"}),e.jsx("li",{children:"We reserve the right to refuse service to anyone"})]}),e.jsx("h3",{children:"9.2 Effect of Termination"}),e.jsxs("ul",{children:[e.jsx("li",{children:"All licenses granted to you terminate immediately"}),e.jsx("li",{children:"You must cease all use of ScreenMerch services"}),e.jsx("li",{children:"Outstanding orders may be cancelled"}),e.jsx("li",{children:"Exclusivity obligations survive termination"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"10. Contact Information"}),e.jsxs("div",{className:"highlight-box",children:[e.jsx("strong",{children:"ScreenMerch Support"}),e.jsx("br",{}),"Email: support@screenmerch.com",e.jsx("br",{}),"Website: screenmerch.com",e.jsx("br",{}),"Legal Issues: support@screenmerch.com"]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"11. Entire Agreement"}),e.jsx("p",{children:"These Terms of Service, together with our Privacy Policy, constitute the entire agreement between you and ScreenMerch regarding the use of our services."})]}),e.jsxs("div",{className:"navigation-links",children:[e.jsx(Ve,{to:"/",className:"nav-link",children:"‚Üê Back to ScreenMerch"})," |",e.jsx(Ve,{to:"/privacy-policy",className:"nav-link",children:"‚Üê Privacy Policy"})]})]})});const dc=()=>{const[t]=yt(),s=Oe(),[r,a]=c.useState([]),[i,n]=c.useState(!1),[l,h]=c.useState(""),[v,S]=c.useState("");c.useEffect(()=>{const x=t.get("q");x&&(S(x),b(x))},[t]);const b=async x=>{if(!x||x.trim().length<2){h("Please enter at least 2 characters to search");return}n(!0),h(""),a([]);try{const C=x.trim();console.log("Searching for channel:",C),s(`/channel/${encodeURIComponent(C)}`)}catch(C){console.error("Search error:",C),h(`Search error: ${C.message}`)}finally{n(!1)}},_=x=>{s(`/profile/${x.username}`)},m=x=>x?new Date(x).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Unknown";return e.jsx("div",{className:"search-page",children:e.jsxs("div",{className:"search-container",children:[e.jsxs("div",{className:"search-header",children:[e.jsx("h1",{children:"Search Results"}),v&&e.jsxs("p",{className:"search-query",children:["Results for: ",e.jsxs("span",{className:"query-text",children:['"',v,'"']})]})]}),i&&e.jsxs("div",{className:"search-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Searching creators..."})]}),l&&e.jsx("div",{className:"search-error",children:e.jsx("p",{children:l})}),!i&&!l&&r.length===0&&v&&e.jsxs("div",{className:"search-no-results",children:[e.jsx("h3",{children:"No creators found"}),e.jsx("p",{children:"Try searching with different keywords or check the spelling."}),e.jsxs("div",{className:"search-suggestions",children:[e.jsx("p",{children:e.jsx("strong",{children:"Tips:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Use shorter keywords"}),e.jsx("li",{children:"Try searching by username or display name"}),e.jsx("li",{children:"Check for typos"})]})]})]}),!i&&r.length>0&&e.jsxs("div",{className:"search-results",children:[e.jsx("div",{className:"results-header",children:e.jsxs("p",{className:"results-count",children:["Found ",r.length," creator",r.length!==1?"s":""]})}),e.jsx("div",{className:"creators-grid",children:r.map(x=>{var C,M;return e.jsxs("div",{className:"creator-card",onClick:()=>_(x),children:[e.jsxs("div",{className:"creator-avatar",children:[x.profile_image_url?e.jsx("img",{src:x.profile_image_url,alt:x.display_name,onError:y=>{y.target.style.display="none",y.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"avatar-placeholder",style:{display:x.profile_image_url?"none":"flex"},children:((M=(C=x.display_name)==null?void 0:C.charAt(0))==null?void 0:M.toUpperCase())||"?"})]}),e.jsxs("div",{className:"creator-info",children:[e.jsx("h3",{className:"creator-name",children:x.display_name}),e.jsxs("p",{className:"creator-username",children:["@",x.username]}),x.bio&&e.jsx("p",{className:"creator-bio",children:x.bio}),e.jsxs("div",{className:"creator-stats",children:[e.jsxs("span",{className:"video-count",children:[x.video_count||0," video",(x.video_count||0)!==1?"s":""]}),e.jsxs("span",{className:"joined-date",children:["Joined ",m(x.created_at)]})]})]}),e.jsx("div",{className:"creator-action",children:e.jsx("button",{className:"view-profile-btn",children:"View Profile"})})]},x.id)})})]})]})})};const hc=()=>{var b,_;const{channelName:t}=$t(),s=Oe(),[r,a]=c.useState([]),[i,n]=c.useState(!0),[l,h]=c.useState(null),[v,S]=c.useState(null);return c.useEffect(()=>{t&&(async()=>{n(!0),h(null);try{const x=decodeURIComponent(t);console.log("Looking for channel:",x);const{data:C,error:M}=await R.from("videos2").select("channelTitle").limit(10);C&&console.log("Available channels in database:",C.map(O=>O.channelTitle));let y=null,L=null,{data:Y,error:J}=await R.from("videos2").select("*").eq("channelTitle",x).order("created_at",{ascending:!1});if(Y&&Y.length>0)y=Y;else{const{data:O,error:re}=await R.from("users").select("id, username, display_name").or(`username.ilike.%${x}%,display_name.ilike.%${x}%`).limit(1);if(O&&O.length>0){const Z=O[0];console.log("Found user:",Z);const{data:X,error:z}=await R.from("videos2").select("*").eq("user_id",Z.id).order("created_at",{ascending:!1});X&&(y=X),L=z}else L=re}if(L){console.error("Error fetching channel videos:",L),h("Failed to load channel videos"),n(!1);return}if(!y||y.length===0){h("No videos found for this channel"),n(!1);return}a(y);const F=y[0].user_id;let H=null;if(console.log("Channel videos user_id:",F),F){const{data:O,error:re}=await R.from("users").select("display_name, username, profile_image_url, cover_image_url").eq("id",F).single();console.log("User profile data:",O),console.log("Profile error:",re),!re&&O&&(H=O)}const K={channelTitle:y[0].channelTitle,videoCount:y.length,username:(H==null?void 0:H.username)||x,profileImageUrl:(H==null?void 0:H.profile_image_url)||null,coverImageUrl:(H==null?void 0:H.cover_image_url)||null};console.log("Channel data being set:",K),console.log("Profile image URL:",K.profileImageUrl),console.log("Cover image URL:",K.coverImageUrl),S(K)}catch(x){console.error("Error:",x),h("Failed to load channel")}finally{n(!1)}})()},[t]),i?e.jsx("div",{className:"channel-page",children:e.jsx("div",{className:"channel-loading",children:"Loading channel..."})}):l?e.jsx("div",{className:"channel-page",children:e.jsxs("div",{className:"channel-error",children:[e.jsx("h2",{children:l}),e.jsx("button",{onClick:()=>s("/"),children:"Back to Home"})]})}):e.jsxs("div",{className:"channel-page",children:[v&&e.jsxs("div",{className:"channel-header-container",children:[e.jsx("div",{className:"channel-cover-container",children:e.jsx("img",{className:"channel-cover-photo",src:v.coverImageUrl||"https://images.unsplash.com/photo-1557683316-973673baf926?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80",alt:"Channel Cover"})}),e.jsxs("div",{className:"channel-info-overlay",children:[e.jsx("div",{className:"channel-avatar-container",children:v.profileImageUrl?e.jsx("img",{className:"channel-avatar",src:v.profileImageUrl,alt:v.channelTitle}):e.jsx("div",{className:"channel-avatar-placeholder",children:((_=(b=v.channelTitle)==null?void 0:b.charAt(0))==null?void 0:_.toUpperCase())||"?"})}),e.jsxs("div",{className:"channel-details",children:[e.jsx("h1",{className:"channel-name",children:v.channelTitle}),v.bio&&e.jsx("p",{className:"channel-bio",children:v.bio}),e.jsxs("p",{className:"channel-stats",children:[v.videoCount," video",v.videoCount!==1?"s":""]})]})]})]}),e.jsx("div",{className:"channel-content",children:r.length>0?e.jsx(ua,{videos:r}):e.jsx("div",{className:"no-videos",children:e.jsx("p",{children:"No videos available"})})})]})};const uc=({sidebar:t})=>{new URLSearchParams(location.search).has("debug")&&(window.__DEBUG__=!0),Oe();const[s,r]=c.useState(!1),[a,i]=c.useState(!1),[n,l]=c.useState(null),h=c.useRef(!1),v=(()=>{try{const y=localStorage.getItem("pending_merch_data");return y?JSON.parse(y):{}}catch{return console.warn("Invalid pending_merch_data. Clearing‚Ä¶"),localStorage.removeItem("pending_merch_data"),{}}})(),S=v.screenshots||[],b=v.thumbnail||"",_={title:v.videoTitle||"Unknown Video",channelTitle:v.creatorName||"Unknown Creator",url:v.videoUrl||""};window.__DEBUG__&&(console.log("üéØ MerchandiseCategories render - sidebar:",!!t),console.log("üì∏ screenshots:",S.length,"thumbnail?",!!b),console.log("üîß API_CONFIG.BASE_URL:",Me==null?void 0:Me.BASE_URL));const m=[{name:"Women's",emoji:"üë©",category:"womens"},{name:"Men's",emoji:"üë®",category:"mens"},{name:"Kids",emoji:"üë∂",category:"kids"},{name:"Mugs",emoji:"‚òï",category:"mugs"},{name:"Hats",emoji:"üß¢",category:"hats"},{name:"Bags",emoji:"üëú",category:"bags"},{name:"Pets",emoji:"üêï",category:"pets"},{name:"Miscellaneous",emoji:"üì¶",category:"misc"},{name:"Product Info",emoji:"üõçÔ∏è",category:"all-products"},{name:"Image Tools",emoji:"üõ†Ô∏è",category:"thumbnails"}],x=y=>{window.__DEBUG__&&console.log("üñ±Ô∏è Category selected:",y);const L=localStorage.getItem("user_authenticated")==="true",Y=localStorage.getItem("user_email")||"";if(window.__DEBUG__&&(console.log("üîê Auth check:",{isAuthenticated:L,userEmail:Y}),console.log("üì± User Agent:",navigator.userAgent)),!L){window.__DEBUG__&&console.log("üîí Not authenticated, showing auth modal"),l(y),i(!0);return}localStorage.setItem("last_selected_category",y);const J=`/product/browse?category=${encodeURIComponent(y)}&authenticated=${L}&email=${encodeURIComponent(Y)}`;window.__DEBUG__&&console.log("üõçÔ∏è Navigating to product page:",J);const F=window.location.origin+J;window.__DEBUG__&&console.log("üåê Full URL:",F),window.location.href=F},C=async y=>{r(!0),h.current=!0;const L=new AbortController,Y=setTimeout(()=>L.abort(),2e4);try{const J=localStorage.getItem("user_authenticated")==="true",F=localStorage.getItem("user_email")||"",H=document.referrer||window.location.origin,K=(_==null?void 0:_.title)||"Unknown Video",O=(_==null?void 0:_.channelTitle)||"Unknown Creator",re={thumbnail:b,videoUrl:H,videoTitle:K,creatorName:O,screenshots:S.slice(0,6),isAuthenticated:J,userEmail:F,category:y},Z=`${Me.BASE_URL}/api/create-product`;window.__DEBUG__&&(console.log("üöÄ POST",Z),console.log("üì¶ payload:",re));const X=await fetch(Z,{method:"POST",headers:{"Content-Type":"application/json"},signal:L.signal,body:JSON.stringify(re)});if(window.__DEBUG__&&console.log("üîç status:",X.status,"ok:",X.ok),!X.ok){const B=await X.text().catch(()=>"(no body)");throw new Error(`HTTP ${X.status}: ${B}`)}const z=await X.json();if(window.__DEBUG__&&console.log("‚úÖ result:",z),z!=null&&z.success&&(z!=null&&z.product_url))window.location.assign(z.product_url);else throw new Error((z==null?void 0:z.error)||"Unknown create-product failure")}catch(J){console.error("‚ùå createProduct error:",J),alert("Error creating product. Please try again.")}finally{clearTimeout(Y),r(!1),h.current=!1}},M=async()=>{window.__DEBUG__&&console.log("üîì Auth success"),n&&(await C(n),l(null))};return e.jsxs("div",{className:`container ${t?"":" large-container"}`,children:[e.jsx("div",{className:"user-flow-section",children:e.jsx("div",{className:"flow-steps",children:e.jsxs("div",{className:"flow-step",children:[e.jsx("div",{className:"step-number",children:"3"}),e.jsxs("div",{className:"step-content",children:[e.jsx("h3",{children:"Make Merchandise"}),e.jsx("p",{children:"Create custom products with your screenshot"})]})]})})}),e.jsxs("div",{className:"merchandise-categories",children:[e.jsxs("div",{className:"categories-container",children:[e.jsx("h1",{className:"categories-title",children:"Choose a Product Category"}),e.jsx("p",{className:"categories-subtitle",children:"Select a category to browse products for your custom merchandise"}),e.jsx("div",{className:"categories-grid",children:m.map((y,L)=>e.jsxs("button",{type:"button",className:`category-box ${s?"disabled":""}`,"aria-label":`Open ${y.name}`,onClick:()=>x(y.category),onTouchStart:()=>window.__DEBUG__&&console.log("üëÜ touchstart:",y.category),disabled:s,children:[e.jsx("div",{className:"category-emoji","aria-hidden":"true",children:y.emoji}),e.jsx("div",{className:"category-name",children:y.name}),s&&e.jsx("div",{className:"loading-overlay","aria-hidden":"true",children:"Creating..."})]},y.category||L))}),e.jsx("div",{className:"back-button-container",children:e.jsx("button",{type:"button",className:"back-button",onClick:()=>window.history.back(),children:"‚Üê Back to Video"})})]}),e.jsx(rr,{isOpen:a,onClose:()=>{i(!1),l(null)},onSuccess:M})]})]})},ma={"Kids Long Sleeve":{front:{default:{width:10,height:12}},back:{default:{width:10,height:12}},dpi:300,description:"Youth Long Sleeve Tee"},"Kids Shirt":{front:{sizes:{"S-M":{width:10,height:12},"L-XL":{width:12,height:16}},default:{width:10,height:12}},back:{sizes:{"S-M":{width:10,height:12},"L-XL":{width:12,height:16}},default:{width:10,height:12}},dpi:300,description:"Kids T-Shirt"},"Kids Hoodie":{width:12,height:14,dpi:300,description:"Kids Hoodie"},"Youth Heavy Blend Hoodie":{front:{sizes:{XS:{width:10,height:7},S:{width:10,height:8},M:{width:10,height:9},L:{width:11.5,height:11},XL:{width:11.5,height:12}},default:{width:10,height:9}},back:{default:{width:11.5,height:13.8}},dpi:300,description:"Youth Heavy Blend Hoodie"},"Toddler Short Sleeve T-Shirt":{width:8,height:10,dpi:300,description:"Toddler T-Shirt"},"Toddler Jersey T-Shirt":{front:{default:{width:7,height:8}},back:{default:{width:7,height:8}},dpi:300,description:"Toddler Jersey"},"Kids Sweatshirt":{front:{sizes:{"XS-M":{width:10,height:12},"L-XL":{width:12,height:16}},default:{width:10,height:12}},back:{sizes:{"XS-M":{width:10,height:12},"L-XL":{width:12,height:16}},default:{width:10,height:12}},dpi:300,description:"Kids Sweatshirt"},"Baby Staple Tee":{front:{default:{width:7,height:8}},back:{default:{width:7,height:8}},dpi:300,description:"Baby Tee"},"Baby Jersey T-Shirt":{front:{default:{width:7,height:8}},back:{default:{width:7,height:8}},dpi:300,description:"Baby Jersey"},"Baby Body Suit":{front:{default:{width:7,height:8}},back:{default:{width:7,height:8}},dpi:300,description:"Baby Body Suit"},"Unisex Classic Tee":{width:12,height:15,dpi:300,description:"Standard T-Shirt"},"Unisex T-Shirt":{front:{sizes:{"XS-M":{width:11.5,height:13.8},"L-3XL":{width:15,height:18}},default:{width:11.5,height:13.8}},back:{default:{width:12,height:16}},dpi:300,description:"Unisex T-Shirt"},"Men's Tank Top":{front:{default:{width:12,height:16}},back:{default:{width:12,height:16}},dpi:300,description:"Tank Top"},"Men's Fitted Long Sleeve":{front:{default:{width:12,height:16}},back:{default:{width:12,height:16}},dpi:300,description:"Long Sleeve Shirt"},"Men's Long Sleeve Shirt":{front:{default:{width:12,height:16}},back:{default:{width:12,height:16}},dpi:300,description:"Long Sleeve Shirt"},"Unisex Hoodie":{front:{default:{width:13,height:13}},back:{default:{width:12,height:16}},dpi:300,description:"Hoodie"},"Unisex Champion Hoodie":{front:{sizes:{"S-M":{width:11.5,height:11.5},"L-XL":{width:13,height:13},"2XL-3XL":{width:14,height:14}},default:{width:11.5,height:11.5}},back:{default:{width:12,height:16}},dpi:300,description:"Champion Hoodie"},"Unisex Pullover Hoodie":{front:{default:{width:13,height:13}},back:{default:{width:12,height:16}},dpi:300,description:"Pullover Hoodie"},"Unisex Heavyweight T-Shirt":{front:{default:{width:12,height:16}},back:{default:{width:12,height:16}},dpi:300,description:"Heavyweight T-Shirt"},"Unisex Oversized T-Shirt":{front:{default:{width:11.5,height:15.3}},back:{default:{width:11.5,height:15.3}},dpi:300,description:"Oversized T-Shirt"},"Mens Fitted T-Shirt":{front:{default:{width:12,height:16}},back:{default:{width:12,height:16}},dpi:300,description:"Fitted T-Shirt"},"Women's Ribbed Neck":{front:{default:{width:12,height:16}},back:{default:{width:12,height:16}},dpi:300,description:"Women's Ribbed Neck"},"Women's Shirt":{front:{sizes:{"S-M":{width:10,height:12},"L-3XL":{width:12,height:16}},default:{width:10,height:12}},back:{sizes:{"S-M":{width:10,height:12},"L-3XL":{width:12,height:16}},default:{width:10,height:12}},dpi:300,description:"Women's Shirt"},"Women's HD Shirt":{width:10,height:13,dpi:300,description:"Women's HD Shirt"},"Women's Crop Top":{front:{default:{width:10,height:10}},back:{default:{width:10,height:10}},dpi:300,description:"Crop Top"},"Cropped Hoodie":{front:{default:{width:10,height:10}},back:{default:{width:10,height:10}},dpi:300,description:"Cropped Hoodie"},"Fitted Racerback Tank":{front:{sizes:{"XS-S":{width:10,height:12},"M-2XL":{width:12,height:16}},default:{width:10,height:12}},back:{sizes:{"XS-S":{width:10,height:12},"M-2XL":{width:12,height:16}},default:{width:10,height:12}},dpi:300,description:"Racerback Tank"},"Micro-Rib Tank Top":{front:{sizes:{"XS-S":{width:10,height:12},"M-2XL":{width:12,height:16}},default:{width:10,height:12}},back:{sizes:{"XS-S":{width:10,height:12},"M-2XL":{width:12,height:16}},default:{width:10,height:12}},dpi:300,description:"Micro-Rib Tank"},"Distressed Dad Hat":{width:5,height:2,dpi:300,description:'Dad Hat Front (5" √ó 2")'},"Closed Back Cap":{width:5,height:2,dpi:300,description:'Closed Back Cap Front (5" √ó 2")'},"Five Panel Trucker Hat":{width:5.5,height:2.5,dpi:300,description:'Trucker Hat Front (5.5" √ó 2.5")'},"Five Panel Baseball Cap":{width:5,height:2,dpi:300,description:'Baseball Cap Front (5" √ó 2")'},"White Glossy Mug":{width:4,height:4,dpi:300,description:"Mug (Square)"},"Travel Mug":{width:4,height:4,dpi:300,description:"Travel Mug (Square)"},"Enamel Mug":{width:4,height:4,dpi:300,description:"Enamel Mug (Square)"},"Colored Mug":{width:4,height:4,dpi:300,description:"Colored Mug (Square)"},"Canvas Tote":{width:12,height:14,dpi:300,description:"Tote Bag"},"Tote Bag":{width:12,height:14,dpi:300,description:"Tote Bag"},"Large Canvas Bag":{width:14,height:16,dpi:300,description:"Large Canvas Bag"},"Laptop Sleeve":{width:14,height:10,dpi:300,description:"Laptop Sleeve (Horizontal)"},"All-Over Print Drawstring":{width:12,height:14,dpi:300,description:"Drawstring Bag"},"All Over Print Tote Pocket":{width:12,height:14,dpi:300,description:"Tote with Pocket"},"All-Over Print Crossbody Bag":{width:10,height:12,dpi:300,description:"Crossbody Bag"},"All-Over Print Utility Bag":{width:12,height:14,dpi:300,description:"Utility Bag"},"Pet Bowl All-Over Print":{width:6,height:6,dpi:300,description:"Pet Bowl (Square)"},"Pet Bandana Collar":{width:12,height:12,dpi:300,description:"Bandana (Square)"},"All Over Print Leash":{width:1,height:48,dpi:300,description:"Leash (Vertical)"},"All Over Print Collar":{width:1,height:12,dpi:300,description:"Collar (Vertical)"},"Hardcover Bound Notebook":{width:3,height:5,dpi:300,description:'Hardcover Bound Notebook (3" √ó 5")'},Coasters:{width:3.97,height:3.97,dpi:300,description:'Coasters (3.97" √ó 3.97")'},Apron:{width:12,height:14,dpi:300,description:"Apron (All-Over Print - Tools Not Available)"},'Kiss Cut Stickers - 3" √ó 3"':{width:3,height:3,dpi:300,description:'Kiss Cut Stickers (3" √ó 3" - Print 3" √ó 3")'},'Kiss Cut Stickers - 4" √ó 4"':{width:4,height:4,dpi:300,description:'Kiss Cut Stickers (4" √ó 4" - Print 4" √ó 4")'},'Kiss Cut Stickers - 5.5" √ó 5.5"':{width:5.5,height:5.5,dpi:300,description:'Kiss Cut Stickers (5.5" √ó 5.5" - Print 5.5" √ó 5.5")'},'Kiss Cut Stickers - 3.75" √ó 15"':{width:3.75,height:15,dpi:300,description:'Kiss Cut Stickers (3.75" √ó 15" - Print 3.75" √ó 15")'},Bandana:{width:27.5,height:27.5,dpi:300,description:'Bandana (27.5" √ó 27.5")'},'Jigsaw Puzzle with Tin - 10" √ó 18" (110 pcs)':{width:9.84,height:7.83,dpi:300,description:'Jigsaw Puzzle with Tin (10" √ó 18" - 110 pcs - Print 9.84" √ó 7.83")'},'Jigsaw Puzzle with Tin - 10" √ó 18" (30 pcs)':{width:9.84,height:7.83,dpi:300,description:'Jigsaw Puzzle with Tin (10" √ó 18" - 30 pcs - Print 9.84" √ó 7.83")'},'Jigsaw Puzzle with Tin - 14" √ó 11" (252 pcs)':{width:14,height:11,dpi:300,description:'Jigsaw Puzzle with Tin (14" √ó 11" - 252 pcs - Print 14" √ó 11")'},'Jigsaw Puzzle with Tin - 21" √ó 15.5" (500 pcs)':{width:21,height:15.5,dpi:300,description:'Jigsaw Puzzle with Tin (21" √ó 15.5" - 500 pcs - Print 21" √ó 15.50")'},'Jigsaw Puzzle with Tin - 30" √ó 20" (1000 pcs)':{width:30.25,height:20.5,dpi:300,description:'Jigsaw Puzzle with Tin (30" √ó 20" - 1000 pcs - Print 30.25" √ó 20.50")'},'Die-Cut Magnets - 3" √ó 3"':{width:3,height:3,dpi:300,description:'Die-Cut Magnets (3" √ó 3" - Print 3" √ó 3")'},'Die-Cut Magnets - 4" √ó 4"':{width:4,height:4,dpi:300,description:'Die-Cut Magnets (4" √ó 4" - Print 4" √ó 4")'},'Die-Cut Magnets - 6" √ó 6"':{width:6,height:6,dpi:300,description:'Die-Cut Magnets (6" √ó 6" - Print 6" √ó 6")'},'Greeting Card - 4" √ó 6"':{width:4.15,height:6.15,dpi:300,description:'Greeting Card (4" √ó 6" - Print Size 4.15" √ó 6.15")'},'Greeting Card - 5" √ó 7"':{width:5.15,height:7.15,dpi:300,description:'Greeting Card (5" √ó 7" - Print Size 5.15" √ó 7.15")'},'Greeting Card - 5.83" √ó 8.27"':{width:5.98,height:8.42,dpi:300,description:'Greeting Card (5.83" √ó 8.27" - Print Size 5.98" √ó 8.42")'}},pa=(t,s=null,r="front")=>{const a=ma[t];if(!a)return null;if(a.front||a.back){const i=a[r]||a.front;if(s&&i.sizes){const n=s.toUpperCase();for(const[l,h]of Object.entries(i.sizes)){const v=l.split("-").map(S=>S.trim().toUpperCase());if(v.length===1){if(n===v[0])return h}else{const S=["XS","S","M","L","XL","2XL","3XL"],b=S.indexOf(v[0]),_=S.indexOf(v[1]),m=S.indexOf(n);if(b!==-1&&_!==-1&&m!==-1&&m>=b&&m<=_)return h}}}return i.default||{width:12,height:16}}return{width:a.width,height:a.height}},mc=(t,s)=>t/s;const Ns=({productImage:t,screenshot:s,productName:r,productSize:a,offsetX:i,offsetY:n,onOffsetChange:l,featherEdge:h,cornerRadius:v,printAreaFit:S,selectedProductName:b,screenshotScale:_=100})=>{const m=c.useRef(null),x=c.useRef(null),[C,M]=c.useState(!1),[y,L]=c.useState({x:0,y:0}),Y=c.useRef({x:0,y:0}),[J,F]=c.useState(s),[H,K]=c.useState({width:150,height:150}),[O,re]=c.useState({width:0,height:0});c.useEffect(()=>{const B=S==="product"&&b?b:r;if(!B)return;(()=>{const p=x.current&&O.width>0,j=p?O:{width:400,height:400};!p&&x.current;try{const o=pa(B,a||null,"front");if(console.log(`üîç [SIZE_CALC] Product: "${B}" (from ${S==="product"&&b?"dropdown":"cart"}), Size: "${a||"default"}", Print Area:`,o),o&&j.width>0){const f=j.width,g=j.height,T=o.width/o.height,d=B.toLowerCase(),w=d.includes("cropped")&&d.includes("hoodie"),P=Math.abs(T-1)<.01||w;let Q=18;const me=d.includes("hat")||d.includes("cap");me?Q=6.5:w?Q=18:d.includes("cropped")?Q=15:d.includes("tank")?Q=17:d.includes("hoodie")?Q=20:d.includes("shirt")||d.includes("tee")?Q=18:d.includes("kids")||d.includes("youth")?Q=14:(d.includes("toddler")||d.includes("baby"))&&(Q=10);const ae=d.includes("shirt")||d.includes("tee"),we=d.includes("women")&&ae,fe=d.includes("men")&&ae,Se=d.includes("kids")&&ae;let Ce,V;if(me){Ce=.6,V=.75;const ve=o.width,Ae=ve<=5?.6:.6+(ve-5)/.5*(.75-.6);let be=f*Ae,D=be/T;const te=f*.8,ce=g*.5;be>te&&(be=te,D=be/T),D>ce&&(D=ce,be=D*T);const se=f*.4,ne=g*.2;be<se&&(be=se,D=be/T),D<ne&&(D=ne,be=D*T),K({width:be,height:D}),console.log(`üìê [PRINT_AREA] ${B} (${a||"default"}): Print ${o.width}"x${o.height}" (AR: ${T.toFixed(2)}) ‚Üí ${be.toFixed(0)}x${D.toFixed(0)}px (${(be/f*100).toFixed(1)}% x ${(D/g*100).toFixed(1)}% of product)`);return}const le=7,pe=15;we||fe||Se?(Ce=.5,V=.7):(Ce=.47,V=.65);const E=Math.max(le,Math.min(pe,o.width)),U=Ce+(E-le)/(pe-le)*(V-Ce);let A=f*U,q=A/T;if(P){const ve=Math.min(f,g);A=ve*U,q=A;const Ae=ae?.75:.7,be=.35,D=ve*Ae,te=ve*be;A>D&&(A=D,q=D),A<te&&(A=te,q=te)}else{const ve=ae?f*.75:f*.7,Ae=ae?g*.7:g*.65;A>ve&&(A=ve,q=A/T),q>Ae&&(q=Ae,A=q*T);const be=f*.35,D=g*.3;A<be&&(A=be,q=A/T),q<D&&(q=D,A=q*T)}K({width:A,height:q}),console.log(`üìê [PRINT_AREA] ${B} (${a||"default"}): Print ${o.width}"x${o.height}" (AR: ${T.toFixed(2)}) ‚Üí ${A.toFixed(0)}x${q.toFixed(0)}px (${(A/f*100).toFixed(1)}% x ${(q/g*100).toFixed(1)}% of product)`)}else{const f=B.toLowerCase().includes("cropped")?.25:.3,g=Math.min(O.width,O.height)*f;K({width:g,height:g})}}catch(o){console.warn("Could not calculate print area size:",o);const f=Math.min(O.width,O.height)*.25;K({width:f,height:f})}})()},[r,a,O,b,S,t]);const Z=B=>{const u=B.target,p={width:u.offsetWidth||u.naturalWidth,height:u.offsetHeight||u.naturalHeight};re(p)};c.useEffect(()=>{(async()=>{if(!s)return;const u=new Image;u.crossOrigin="anonymous",u.onload=()=>{const p=document.createElement("canvas"),N=p.getContext("2d");if(p.width=u.width,p.height=u.height,N.drawImage(u,0,0),v>0){const j=Math.min(p.width,p.height)/2,o=v>=100?j:v,f=document.createElement("canvas"),g=f.getContext("2d");f.width=p.width,f.height=p.height,g.fillStyle="white",g.fillRect(0,0,f.width,f.height),v>=100?(g.beginPath(),g.arc(p.width/2,p.height/2,o,0,Math.PI*2),g.fill()):(g.beginPath(),g.moveTo(o,0),g.lineTo(p.width-o,0),g.quadraticCurveTo(p.width,0,p.width,o),g.lineTo(p.width,p.height-o),g.quadraticCurveTo(p.width,p.height,p.width-o,p.height),g.lineTo(o,p.height),g.quadraticCurveTo(0,p.height,0,p.height-o),g.lineTo(0,o),g.quadraticCurveTo(0,0,o,0),g.closePath(),g.fill()),N.globalCompositeOperation="destination-in",N.drawImage(f,0,0),N.globalCompositeOperation="source-over"}if(h>0){const j=document.createElement("canvas"),o=j.getContext("2d");j.width=p.width,j.height=p.height,o.fillStyle="white",o.fillRect(0,0,j.width,j.height);const f=o.createRadialGradient(p.width/2,p.height/2,Math.min(p.width,p.height)/2-h,p.width/2,p.height/2,Math.min(p.width,p.height)/2);f.addColorStop(0,"white"),f.addColorStop(1,"transparent"),o.fillStyle=f,o.fillRect(0,0,j.width,j.height),N.globalCompositeOperation="destination-in",N.drawImage(j,0,0),N.globalCompositeOperation="source-over"}F(p.toDataURL("image/png"))},u.src=s})()},[s,h,v]);const X=B=>{B.preventDefault(),M(!0);const u={x:B.clientX,y:B.clientY};L(u),Y.current=u},z=B=>{B.preventDefault();const u=B.touches[0];M(!0);const p={x:u.clientX,y:u.clientY};L(p),Y.current=p};return c.useEffect(()=>{if(C){const B=p=>{var Q,me;p.touches&&p.preventDefault();const N=p.clientX||p.touches&&((Q=p.touches[0])==null?void 0:Q.clientX),j=p.clientY||p.touches&&((me=p.touches[0])==null?void 0:me.clientY);if(N===void 0||j===void 0)return;const o=.5,f=(N-Y.current.x)*o,g=(j-Y.current.y)*o;Y.current={x:N,y:j};const T=i+f,d=n+g,w=H.width*(_/100),P=H.height*(_/100);if(O.width>0&&O.height>0){const ae=O.width*.4,we=O.height*.6,fe=O.height*.4;let Se=Math.max(-ae,Math.min(ae,T)),Ce=Math.max(-we,Math.min(fe,d));const V=5;Math.abs(Se)<V&&(Se=0),Math.abs(Ce)<V&&(Ce=0),l(Se,Ce)}else{const ae=Math.max(w,P)*.5,we=Math.max(w,P)*1.2,fe=Math.max(w,P)*.5,Se=Math.max(-ae,Math.min(ae,T)),Ce=Math.max(-we,Math.min(fe,d));l(Se,Ce)}},u=()=>{M(!1)};return document.addEventListener("mousemove",B),document.addEventListener("mouseup",u),document.addEventListener("touchmove",B,{passive:!1}),document.addEventListener("touchend",u),document.addEventListener("touchcancel",u),()=>{document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",u),document.removeEventListener("touchmove",B),document.removeEventListener("touchend",u),document.removeEventListener("touchcancel",u)}}},[C,y,l,H,O,_,i,n]),e.jsxs("div",{ref:m,style:{position:"relative",width:"100%",maxWidth:"200px",margin:"0 auto",cursor:C?"grabbing":"grab",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"none"},children:[e.jsx("img",{ref:x,src:t,alt:r,onLoad:Z,style:{width:"100%",height:"auto",display:"block",borderRadius:"4px"}}),(()=>{const B=(r||"").toLowerCase();if((B.includes("hat")||B.includes("cap"))&&O.width>0&&H.width>0){const p=H.width,N=H.height,j=(O.width-p)/2,o=(O.height-N)/2-O.height*.08;return e.jsxs("div",{style:{position:"absolute",left:`${j/O.width*100}%`,top:`${o/O.height*100}%`,width:`${p/O.width*100}%`,height:`${N/O.height*100}%`,border:"2px dashed #007bff",borderRadius:"4px",pointerEvents:"none",boxSizing:"border-box",opacity:.7,zIndex:1},children:[e.jsx("div",{style:{position:"absolute",top:"-2px",left:"-2px",width:"8px",height:"8px",border:"2px solid #007bff",borderRadius:"2px",backgroundColor:"rgba(0, 123, 255, 0.2)"}}),e.jsx("div",{style:{position:"absolute",top:"-2px",right:"-2px",width:"8px",height:"8px",border:"2px solid #007bff",borderRadius:"2px",backgroundColor:"rgba(0, 123, 255, 0.2)"}}),e.jsx("div",{style:{position:"absolute",bottom:"-2px",left:"-2px",width:"8px",height:"8px",border:"2px solid #007bff",borderRadius:"2px",backgroundColor:"rgba(0, 123, 255, 0.2)"}}),e.jsx("div",{style:{position:"absolute",bottom:"-2px",right:"-2px",width:"8px",height:"8px",border:"2px solid #007bff",borderRadius:"2px",backgroundColor:"rgba(0, 123, 255, 0.2)"}})]})}return null})(),J&&e.jsx("div",{style:{position:"absolute",top:(()=>{const B=(r||"").toLowerCase();return(B.includes("hat")||B.includes("cap"))&&O.height>0?`${50-8}%`:"50%"})(),left:"50%",transform:`translate(calc(-50% + ${i}px), calc(-50% + ${n}px))`,cursor:C?"grabbing":"grab",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"none",pointerEvents:"auto"},onMouseDown:X,onTouchStart:z,children:(()=>{const B=(r||"").toLowerCase(),u=B.includes("hat")||B.includes("cap"),p=_/100,N=H.width/H.height,j=Math.abs(N-1)<.01;let o,f;return j?(o=H.width*p,f=o):u||H.width<=H.height?(o=H.width*p,f=o/N):(f=H.height*p,o=f*N),e.jsx("img",{src:J,alt:"Screenshot overlay",style:{width:`${o}px`,height:`${f}px`,objectFit:"contain",display:"block",pointerEvents:"none",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"none"},draggable:!1})})()})]})},pc=t=>t?["White Glossy Mug","Travel Mug","Enamel Mug","Colored Mug"].some(r=>t.includes(r)||r.includes(t)):!1,gc=t=>{if(!t)return!1;const s=t.toLowerCase().trim(),a=["distressed dad hat","closed back cap","five panel trucker hat","five panel baseball cap","5 panel baseball cap","snapback hat"].some(i=>{const n=i.toLowerCase().trim();return s.includes(n)||n.includes(s)||s===n});return a&&console.log("üé© [HAT CHECK] Matched:",t,"as hat product"),a},Cs=t=>{if(!t)return!1;const s=["All-Over Print Drawstring","All Over Print Tote Pocket","All-Over Print Crossbody Bag","All-Over Print Utility Bag"],r=["Pet Bowl All-Over Print","All Over Print Leash","All Over Print Collar"],a=["Apron"];return[...s,...r,...a].some(n=>t.includes(n)||n.includes(t)||t.toLowerCase().includes("all over print")||t.toLowerCase().includes("all-over print"))},fc=t=>t?["Greeting Card","Hardcover Bound Notebook","Coasters","Kiss-Cut Stickers","Kiss Cut Stickers","Bandana"].some(r=>t.includes(r)||r.includes(t)):!1,xc=()=>"https://screenmerch.fly.dev/static/images/hatflatfront.png",ga=()=>{const t=Oe(),[s]=yt();c.useRef(null),c.useRef(null);const r=c.useRef(null),a=c.useRef(null),[i,n]=c.useState(null),[l,h]=c.useState(""),[v,S]=c.useState(0),[b,_]=c.useState(0),[m,x]=c.useState(!1),[C,M]=c.useState("#FF0000"),[y,L]=c.useState(10),[Y,J]=c.useState(!1),[F,H]=c.useState("none"),[K,O]=c.useState(0),[re,Z]=c.useState(0),[X,z]=c.useState(""),[B,u]=c.useState(""),[p,N]=c.useState({width:0,height:0}),[j,o]=c.useState(!1),[f,g]=c.useState(!1),T=c.useRef(!1),[d,w]=c.useState([]),[P,Q]=c.useState(null),[me,ae]=c.useState({}),[we,fe]=c.useState(100);c.useEffect(()=>{const V=()=>{if(r.current&&a.current){const pe=a.current.getBoundingClientRect().left+100;r.current.style.left=`${pe}px`}};return V(),window.addEventListener("resize",V),window.addEventListener("scroll",V),()=>{window.removeEventListener("resize",V),window.removeEventListener("scroll",V)}},[]),c.useEffect(()=>{try{const V=localStorage.getItem("tools_page_state");if(V){const le=JSON.parse(V);le.screenshotScale!==void 0&&fe(le.screenshotScale),le.productImageOffsets&&ae(le.productImageOffsets),le.selectedCartProductIndex!==void 0&&Q(le.selectedCartProductIndex),console.log("üì¶ Restored tool page state from localStorage")}}catch(V){console.warn("Could not load tool page state:",V)}},[]),c.useEffect(()=>{try{const V={screenshotScale:we,productImageOffsets:me,selectedCartProductIndex:P};localStorage.setItem("tools_page_state",JSON.stringify(V))}catch(V){console.warn("Could not save tool page state:",V)}},[we,me,P]),c.useEffect(()=>{B&&F==="product"&&fe(100)},[B,F]),c.useEffect(()=>{const V=()=>{try{const E=JSON.parse(localStorage.getItem("cart_items")||"[]");if(E&&E.length>0){const U=E.map((A,q)=>({originalCartIndex:q,name:A.name||"Product",color:A.color||"N/A",size:A.size||"N/A",screenshot:A.screenshot||"",productImage:A.image||"",toolSettings:A.toolSettings||null})).filter(A=>A.screenshot&&A.screenshot.trim()!=="").map((A,q)=>({...A,filteredIndex:q}));if(U.length>0){const A=U[0];if(A.toolSettings){const q=A.toolSettings;q.screenshotScale!==void 0&&fe(q.screenshotScale),q.offsetX!==void 0&&q.offsetY!==void 0&&ae(ve=>({...ve,[A.originalCartIndex]:{x:q.offsetX,y:q.offsetY}}))}}w(U),U.length>0&&((P===null||P>=U.length)&&Q(0),U.length>1&&console.log(`üõçÔ∏è Found ${U.length} products in cart`))}else w([]),Q(null)}catch(E){console.warn("Could not load cart items:",E),w([]),Q(null)}};V();const le=E=>{E.key==="cart_items"&&V()};window.addEventListener("storage",le);const pe=setInterval(V,2e3);return()=>{window.removeEventListener("storage",le),clearInterval(pe)}},[P]),c.useEffect(()=>{(()=>{var le,pe;try{if(P!==null&&d.length>0&&d[P]){const A=d[P];if(A.screenshot&&A.screenshot.trim()!==""){const q=A.screenshot;q!==l&&(T.current=!1),h(q),n(q),o(!1),console.log(`üì∏ Loaded screenshot from cart product ${P+1}: ${A.name}`);return}}const E=localStorage.getItem("pending_merch_data");if(E){const A=JSON.parse(E),q=A.edited_screenshot||A.selected_screenshot||((le=A.screenshots)==null?void 0:le[0])||A.thumbnail||"";if(q&&(q!==l&&(T.current=!1),h(q),n(q),o(!1)),A.print_quality_upgrade_failed){console.log("üîç [UPGRADE] Found failure flag in localStorage, checking if image is actually upgraded...");const ve=A.edited_screenshot||A.selected_screenshot||((pe=A.screenshots)==null?void 0:pe[0])||A.thumbnail||"";if(A.print_quality_screenshot&&ve===A.print_quality_screenshot){console.log("‚úÖ [UPGRADE] Current image matches print_quality_screenshot - clearing failure flag"),g(!1);try{delete A.print_quality_upgrade_failed,localStorage.setItem("pending_merch_data",JSON.stringify(A))}catch(Ae){console.warn("Could not clear failure flag:",Ae)}}else if(p.width&&p.height&&p.width>=2e3&&p.height>=2e3){console.log("‚úÖ [UPGRADE] Image dimensions indicate print quality - clearing failure flag",{width:p.width,height:p.height}),g(!1);try{delete A.print_quality_upgrade_failed,localStorage.setItem("pending_merch_data",JSON.stringify(A))}catch(Ae){console.warn("Could not clear failure flag:",Ae)}}else console.log("‚ö†Ô∏è [UPGRADE] Failure flag found and image appears to be small - will check again when image loads"),g(!0),o(!1)}else g(!1);A.selected_product_name&&u(A.selected_product_name)}const U=s.get("screenshot");U&&(U!==l&&(T.current=!1),h(U),n(U))}catch(E){console.warn("Could not load screenshot from localStorage:",E)}})()},[P,d]),c.useEffect(()=>{const V=E=>{var U;if(E.key==="pending_merch_data"&&E.newValue){const A=localStorage.getItem("pending_merch_data");if(A)try{const q=JSON.parse(A),ve=q.edited_screenshot||q.selected_screenshot||((U=q.screenshots)==null?void 0:U[0])||q.thumbnail||"";ve&&ve!==l&&(h(ve),n(ve))}catch(q){console.warn("Could not parse storage data:",q)}}},le=()=>{var U;const E=localStorage.getItem("pending_merch_data");if(E)try{const A=JSON.parse(E),q=A.edited_screenshot||A.selected_screenshot||((U=A.screenshots)==null?void 0:U[0])||A.thumbnail||"";q&&q!==l&&(h(q),n(q))}catch(A){console.warn("Could not parse storage data:",A)}};window.addEventListener("storage",V),window.addEventListener("localStorageUpdated",le);const pe=setInterval(()=>{try{const E=localStorage.getItem("pending_merch_data");if(E){const U=JSON.parse(E);U.print_quality_upgrade_timestamp&&Date.now()-U.print_quality_upgrade_timestamp>6e4&&!U.print_quality_upgrade_failed&&(U.print_quality_upgrade_failed=!0,localStorage.setItem("pending_merch_data",JSON.stringify(U)))}}catch(E){console.warn("Could not check upgrade status:",E)}},2e3);return setTimeout(()=>clearInterval(pe),7e4),()=>{window.removeEventListener("storage",V),window.removeEventListener("localStorageUpdated",le),clearInterval(pe)}},[s,l]);const Se=(V,le,pe,E,U,A)=>{V.beginPath(),V.moveTo(le+A,pe),V.lineTo(le+E-A,pe),V.quadraticCurveTo(le+E,pe,le+E,pe+A),V.lineTo(le+E,pe+U-A),V.quadraticCurveTo(le+E,pe+U,le+E-A,pe+U),V.lineTo(le+A,pe+U),V.quadraticCurveTo(le,pe+U,le,pe+U-A),V.lineTo(le,pe+A),V.quadraticCurveTo(le,pe,le+A,pe),V.closePath()};c.useEffect(()=>{if(!l)return;const V=new Image;V.crossOrigin="anonymous",V.onload=()=>{const le={width:V.width,height:V.height};if(N(le),console.log("üñºÔ∏è [IMAGE] Image loaded with dimensions:",le),V.width>=2e3&&V.height>=2e3){console.log("‚úÖ [UPGRADE] Image loaded with print quality dimensions:",{width:V.width,height:V.height}),g(!1);try{const I=localStorage.getItem("pending_merch_data");if(I){const $=JSON.parse(I);if($.print_quality_upgrade_failed){console.log("‚úÖ [UPGRADE] Clearing failure flag because image is at print quality"),delete $.print_quality_upgrade_failed;try{localStorage.setItem("pending_merch_data",JSON.stringify($)),console.log("‚úÖ [UPGRADE] Failure flag cleared in localStorage")}catch{console.warn("‚ö†Ô∏è [UPGRADE] Could not save cleared flag to localStorage, but image is upgraded")}}}}catch(I){console.warn("Could not clear failure flag:",I)}}else console.log("üîç [UPGRADE] Image dimensions are small:",{width:V.width,height:V.height});const E=V.width<2e3||V.height<2e3;E&&!T.current&&o(E);const U=document.createElement("canvas"),A=U.getContext("2d",{alpha:!0});U.width=V.width,U.height=V.height;const q=document.createElement("canvas"),ve=q.getContext("2d",{alpha:!0});q.width=V.width,q.height=V.height;let Ae=V.width,be=V.height,D=0,te=0;if(F!=="none"){const I=V.width/V.height;let $;if(F==="product"&&B){const W=pa(B,null,"front");W?$=mc(W.width,W.height):$=.67}else switch(F){case"horizontal":$=1.5;break;case"square":$=1;break;case"vertical":$=.67;break;default:$=I}if(I>$){Ae=V.height*$;const W=V.width-Ae;D=(V.width-Ae)/2+K/100*(W/2),D=Math.max(0,Math.min(D,W))}else if(I<$){be=V.width/$;const W=V.height-be;te=(V.height-be)/2-re/100*(W/2),te=Math.max(0,Math.min(te,W))}}U.width=Ae,U.height=be,q.width=Ae,q.height=be,A.clearRect(0,0,U.width,U.height),ve.clearRect(0,0,q.width,q.height),ve.drawImage(V,D,te,Ae,be,0,0,Ae,be);const ce=Math.min(U.width,U.height)/2,se=b>=100,ne=se?ce:b;if(ne>0){const I=document.createElement("canvas"),$=I.getContext("2d",{alpha:!0});I.width=U.width,I.height=U.height,$.clearRect(0,0,I.width,I.height),$.fillStyle="white",se?($.beginPath(),$.arc(I.width/2,I.height/2,ce,0,Math.PI*2),$.fill()):(Se($,0,0,I.width,I.height,ne),$.fill());const W=document.createElement("canvas"),de=W.getContext("2d",{alpha:!0});W.width=U.width,W.height=U.height,de.drawImage(q,0,0),de.globalCompositeOperation="destination-in",de.drawImage(I,0,0),de.globalCompositeOperation="source-over",U.width=W.width,U.height=W.height,A.clearRect(0,0,U.width,U.height),A.drawImage(W,0,0)}else A.drawImage(q,0,0);if(v>0){const I=Math.min(v,Math.min(U.width,U.height)/4),$=document.createElement("canvas"),W=$.getContext("2d");if($.width=U.width,$.height=U.height,W.fillStyle="white",se?(W.beginPath(),W.arc(U.width/2,U.height/2,ce,0,Math.PI*2),W.fill()):W.fillRect(0,0,U.width,U.height),se){const de=U.width/2,_e=U.height/2,xe=Math.max(0,ce-I),ue=ce,oe=W.createRadialGradient(de,_e,xe,de,_e,ue);oe.addColorStop(0,"rgba(0, 0, 0, 0)"),oe.addColorStop(1,"rgba(0, 0, 0, 1)"),W.globalCompositeOperation="destination-out",W.fillStyle=oe,W.beginPath(),W.arc(de,_e,ue,0,Math.PI*2),W.fill()}else{const de=W.getImageData(0,0,$.width,$.height),_e=de.data;for(let xe=0;xe<$.height;xe++)for(let ue=0;ue<$.width;ue++){const oe=xe,ge=$.height-xe,je=ue,Ze=$.width-ue,st=Math.min(oe,ge,je,Ze);let Mt=255;st<I&&(Mt=Math.floor(st/I*255));const xs=(xe*$.width+ue)*4;_e[xs+3]=Mt}W.putImageData(de,0,0)}W.globalCompositeOperation="source-over",A.globalCompositeOperation="destination-in",A.drawImage($,0,0),A.globalCompositeOperation="source-over"}if(m){A.strokeStyle=C,A.lineWidth=y,A.lineJoin="round",A.lineCap="round";const I=Math.min(U.width,U.height)/2,$=b>=100,W=$?I:b;if($?(A.beginPath(),A.arc(U.width/2,U.height/2,I-y/2,0,Math.PI*2)):W>0?Se(A,y/2,y/2,U.width-y,U.height-y,Math.max(0,W-y/2)):(A.beginPath(),A.rect(y/2,y/2,U.width-y,U.height-y)),A.stroke(),Y){const de=y*1.5,_e=y*.7;A.lineWidth=_e,$?(A.beginPath(),A.arc(U.width/2,U.height/2,I-y-de,0,Math.PI*2)):W>0?Se(A,y+de,y+de,U.width-(y+de)*2,U.height-(y+de)*2,Math.max(0,W-y-de)):(A.beginPath(),A.rect(y+de,y+de,U.width-(y+de)*2,U.height-(y+de)*2)),A.stroke()}}const k=U.toDataURL("image/png");z(k)},V.onerror=()=>{console.error("Failed to load image")},V.src=l},[l,v,b,m,C,y,Y,F,K,re,B]);const Ce=()=>{if(!X){alert("Please wait for the image to process, or select a screenshot first.");return}try{const V=localStorage.getItem("pending_merch_data"),le=V?JSON.parse(V):{};le.edited_screenshot=X,le.tools_used={featherEdge:v,cornerRadius:b,frameEnabled:m,frameColor:C,frameWidth:y,doubleFrame:Y,printAreaFit:F,imageOffsetX:K,imageOffsetY:re},localStorage.setItem("pending_merch_data",JSON.stringify(le));const pe=JSON.parse(localStorage.getItem("cart_items")||"[]");let E;if(P!==null&&d.length>0&&d[P]){const U=d[P],A=U.originalCartIndex,q=me[A]||{x:0,y:0};E=pe.map((ve,Ae)=>Ae===A?{...ve,screenshot:X,edited:!0,tools_acknowledged:!0,toolSettings:{screenshotScale:we,offsetX:q.x,offsetY:q.y,featherEdge:v,cornerRadius:b,frameEnabled:m,frameColor:C,frameWidth:y,doubleFrame:Y,printAreaFit:F}}:ve),console.log(`üíæ Updated screenshot for selected cart product: ${U.name} (cart index: ${U.originalCartIndex})`)}else E=pe.map(U=>({...U,screenshot:X,edited:!0,tools_acknowledged:!0})),console.log("üíæ Updated screenshot for all cart items");localStorage.setItem("cart_items",JSON.stringify(E))}catch(V){console.error("Failed to save edited image:",V)}t("/checkout")};return e.jsxs("div",{className:"tools-page-container",ref:a,children:[e.jsxs("div",{className:"tools-page-header",children:[e.jsx("h1",{children:"Edit Tools"}),e.jsx("p",{className:"tools-subtitle",children:"Edit your screenshot with professional tools"})]}),(()=>{const V=l||X,le=d.length>0&&P!==null,pe=V&&le;return e.jsxs(e.Fragment,{children:[!pe&&e.jsxs("div",{style:{textAlign:"center",padding:"2rem",background:"#fff3cd",border:"2px solid #ffc107",borderRadius:"8px",margin:"2rem 0",color:"#856404"},children:[e.jsx("div",{style:{fontSize:"24px",marginBottom:"10px"},children:"‚ö†Ô∏è"}),e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",fontSize:"1.2rem"},children:"Tools Unavailable"}),e.jsx("div",{style:{fontSize:"14px"},children:"Please select a screenshot and product from your cart to use the editing tools."})]}),e.jsxs("div",{className:`tools-content-reorganized ${pe?"":"tools-disabled"}`,style:pe?{}:{opacity:.5,pointerEvents:"none"},children:[e.jsxs("div",{className:"tools-left-column",ref:r,children:[e.jsx("div",{className:"cart-products-preview-fixed",children:d.length>0&&P!==null&&d[P]&&e.jsxs("div",{className:"cart-products-preview-section-compact",children:[e.jsxs("h3",{style:{marginTop:"10px",marginBottom:"15px",fontSize:"18px",fontWeight:"bold"},children:["Product Preview (",P+1," of ",d.length,")"]}),(()=>{const E=d[P],U=E.originalCartIndex,A=me[U]||{x:0,y:0},q=X||l;return e.jsxs("div",{style:{background:"white",padding:"15px",borderRadius:"8px",border:"2px solid #dee2e6",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",gap:"8px",justifyContent:"center"},children:[e.jsx("span",{style:{background:"#007bff",color:"white",borderRadius:"50%",width:"30px",height:"30px",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"14px",flexShrink:0},children:P+1}),e.jsxs("div",{style:{textAlign:"center",flex:1,minWidth:0},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"14px",wordBreak:"break-word"},children:E.name}),e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:[E.color," ‚Ä¢ ",E.size]})]})]}),(()=>{const ve=E.name||"",Ae=pc(ve),be=gc(ve),D=Cs(ve),te=fc(ve);if(be&&console.log("üé© [HAT DETECTED] Product:",ve,"Will use generic hat image"),D)return e.jsxs("div",{style:{padding:"20px",textAlign:"center",background:"#fff3cd",border:"2px solid #ffc107",borderRadius:"8px",color:"#856404"},children:[e.jsx("div",{style:{fontSize:"24px",marginBottom:"10px"},children:"‚ö†Ô∏è"}),e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"No Tools for All-Over Print"}),e.jsx("div",{style:{fontSize:"14px"},children:"Editing tools (feather, corner radius, frame) are not available for all-over print products."})]});if(Ae)return e.jsxs("div",{style:{padding:"20px",textAlign:"center",background:"#e7f3ff",border:"2px solid #b3d9ff",borderRadius:"8px",color:"#004085",minHeight:"150px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:"24px",marginBottom:"10px"},children:"‚òï"}),e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Preview Not Available"}),e.jsx("div",{style:{fontSize:"14px"},children:"Mug preview is not available due to the curved surface, but you can still use the editing tools to customize your screenshot."})]});if(te)if(q){const se=document.createElement("canvas");se.width=400,se.height=400;const ne=se.getContext("2d");ne.fillStyle="#f8f9fa",ne.fillRect(0,0,400,400);const k=se.toDataURL();return e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Ns,{productImage:k,screenshot:q,productName:ve,productSize:E.size,offsetX:A.x,offsetY:A.y,onOffsetChange:(I,$)=>{ae(W=>({...W,[U]:{x:I,y:$}}))},featherEdge:v,cornerRadius:b,printAreaFit:F,selectedProductName:B,screenshotScale:we}),e.jsxs("div",{style:{position:"absolute",top:"10px",left:"10px",right:"10px",background:"rgba(255, 255, 255, 0.9)",padding:"8px",borderRadius:"4px",fontSize:"12px",textAlign:"center",border:"1px solid #dee2e6"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Product Preview Not Available"}),e.jsx("div",{style:{fontSize:"11px",color:"#666"},children:"Screenshot size reflects selected product print area"})]})]})}else return e.jsxs("div",{style:{padding:"20px",textAlign:"center",background:"#f8f9fa",border:"2px solid #dee2e6",borderRadius:"8px",color:"#495057",minHeight:"150px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:"24px",marginBottom:"10px"},children:"‚úèÔ∏è"}),e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Product Preview Not Available"}),e.jsx("div",{style:{fontSize:"14px"},children:"You can use the editing tools to customize your screenshot for this product."})]});if(be){const ce=xc();return console.log("üé© [HAT DETECTED] Product:",ve),console.log("üé© [HAT IMAGE] Using generic hat image:",ce),console.log("üé© [HAT IMAGE] Original product image from cart:",E.productImage),console.log("üé© [HAT IMAGE] Will override with:",ce),q?e.jsx(Ns,{productImage:ce,screenshot:q,productName:ve,productSize:E.size,offsetX:A.x,offsetY:A.y,onOffsetChange:(se,ne)=>{ae(k=>({...k,[U]:{x:se,y:ne}}))},featherEdge:v,cornerRadius:b,printAreaFit:F,selectedProductName:B,screenshotScale:we}):e.jsxs("div",{style:{padding:"20px",textAlign:"center",background:"#f8f9fa",border:"2px solid #dee2e6",borderRadius:"8px",color:"#495057",minHeight:"150px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[e.jsx("img",{src:ce,alt:ve,style:{maxWidth:"200px",maxHeight:"150px",marginBottom:"10px"}}),e.jsx("div",{style:{fontSize:"14px",color:"#666"},children:"Add a screenshot to see preview"})]})}return E.productImage&&q?e.jsx(Ns,{productImage:E.productImage,screenshot:q,productName:ve,productSize:E.size,offsetX:A.x,offsetY:A.y,onOffsetChange:(ce,se)=>{ae(ne=>({...ne,[U]:{x:ce,y:se}}))},featherEdge:v,cornerRadius:b,printAreaFit:F,selectedProductName:B,screenshotScale:we}):null})()]})})()]})}),e.jsx("div",{className:"tools-left-column-scrollable",children:e.jsxs("div",{className:"tool-control-group",style:{marginTop:"20px"},children:[e.jsx("h3",{style:{textAlign:"center"},children:"Screenshot Size"}),e.jsx("p",{className:"tool-description",style:{textAlign:"center"},children:"Adjust the size of your screenshot to fit the print area perfectly"}),e.jsx("div",{className:"slider-control",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("input",{type:"range",min:"50",max:"150",value:we,onChange:E=>fe(parseInt(E.target.value)),onContextMenu:E=>E.preventDefault(),onSelectStart:E=>E.preventDefault(),className:"slider",style:{flex:1,userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"manipulation"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[e.jsx("button",{type:"button",onClick:()=>fe(Math.min(150,we+1)),onContextMenu:E=>E.preventDefault(),onSelectStart:E=>E.preventDefault(),style:{background:"#667eea",color:"white",border:"none",borderRadius:"4px",width:"28px",height:"20px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",padding:0,lineHeight:1,userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"manipulation"},title:"Increase size",children:"‚ñ≤"}),e.jsx("button",{type:"button",onClick:()=>fe(Math.max(50,we-1)),onContextMenu:E=>E.preventDefault(),onSelectStart:E=>E.preventDefault(),style:{background:"#667eea",color:"white",border:"none",borderRadius:"4px",width:"28px",height:"20px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",padding:0,lineHeight:1,userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"manipulation"},title:"Decrease size",children:"‚ñº"})]}),e.jsxs("span",{className:"slider-value",style:{minWidth:"50px",textAlign:"right",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none"},onContextMenu:E=>E.preventDefault(),onSelectStart:E=>E.preventDefault(),children:[we,"%"]})]})})]})})]}),e.jsx("div",{style:{width:"100px",flexShrink:0},className:"tools-left-column-spacer"}),e.jsx("div",{style:{width:"350px",flexShrink:0},className:"tools-left-column-spacer"}),e.jsxs("div",{className:"tools-controls-section",children:[d.length>1&&e.jsxs("div",{className:"tool-control-group",style:{marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.5rem",fontWeight:"bold"},children:"Select Product From Cart:"}),e.jsxs("select",{value:P!==null?P:"",onChange:E=>{const U=parseInt(E.target.value);isNaN(U)||(Q(U),console.log(`üîÑ Product changed to index ${U}`))},className:"print-area-select",style:{width:"100%"},children:[e.jsx("option",{value:"",children:"-- Select Product --"}),d.map((E,U)=>e.jsxs("option",{value:U,children:[E.name,E.color&&E.color!=="N/A"?` - ${E.color}`:"",E.size&&E.size!=="N/A"?` (${E.size})`:""]},U))]})]}),e.jsxs("div",{className:"tool-control-group",children:[e.jsx("h3",{children:"Fit to Print Area"}),e.jsx("p",{className:"tool-description",children:"Crop image to fit product print areas"}),e.jsxs("div",{className:"select-control",style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem"},children:"Select Product:"}),e.jsxs("select",{value:B,onChange:E=>{u(E.target.value),E.target.value&&H("product")},className:"print-area-select",children:[e.jsx("option",{value:"",children:"-- Select Product --"}),Object.keys(ma).sort().map(E=>e.jsx("option",{value:E,children:E},E))]})]}),e.jsxs("div",{className:"select-control",children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem"},children:"Fit Type:"}),e.jsxs("select",{value:F,onChange:E=>{H(E.target.value),O(0),Z(0)},className:"print-area-select",children:[e.jsx("option",{value:"none",children:"Original (No Fit)"}),B&&e.jsxs("option",{value:"product",children:["Product Specific (",B,")"]}),e.jsx("option",{value:"horizontal",children:"Horizontal (Wide - for standard shirts)"}),e.jsx("option",{value:"square",children:"Square (1:1 - for mugs, square items)"}),e.jsx("option",{value:"vertical",children:"Vertical (Tall - for tank tops, vertical shirts)"})]})]}),F!=="none"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"slider-control",style:{marginTop:"1rem"},children:[e.jsx("label",{children:"Move Horizontal:"}),e.jsx("input",{type:"range",min:"-100",max:"100",value:K,onChange:E=>O(parseInt(E.target.value)),className:"slider"}),e.jsx("span",{className:"slider-value",children:K>0?`Right ${K}%`:K<0?`Left ${Math.abs(K)}%`:"Center"})]}),e.jsxs("div",{className:"slider-control",children:[e.jsx("label",{children:"Move Vertical:"}),e.jsx("input",{type:"range",min:"-100",max:"100",value:re,onChange:E=>Z(parseInt(E.target.value)),className:"slider"}),e.jsx("span",{className:"slider-value",children:re>0?`Down ${re}%`:re<0?`Up ${Math.abs(re)}%`:"Center"})]})]})]}),(()=>{const E=d.length>0&&P!==null?d[P]:null,U=(E==null?void 0:E.name)||"";return Cs(U)?e.jsx("div",{className:"tool-control-group",children:e.jsxs("div",{style:{padding:"20px",textAlign:"center",background:"#fff3cd",border:"2px solid #ffc107",borderRadius:"8px",color:"#856404"},children:[e.jsx("div",{style:{fontSize:"24px",marginBottom:"10px"},children:"‚ö†Ô∏è"}),e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Tools Not Available"}),e.jsx("div",{style:{fontSize:"14px"},children:"Editing tools (feather, corner radius, frame) are not available for all-over print products."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"tool-control-group",children:[e.jsx("h3",{children:"Feather Edge"}),e.jsx("p",{className:"tool-description",children:"Softens the edges of your screenshot"}),e.jsxs("div",{className:"slider-control",children:[e.jsx("input",{type:"range",min:"0",max:"50",value:v,onChange:q=>S(parseInt(q.target.value)),className:"slider"}),e.jsxs("span",{className:"slider-value",children:[v,"px"]})]})]}),e.jsxs("div",{className:"tool-control-group",children:[e.jsx("h3",{children:"Corner Radius"}),e.jsx("p",{className:"tool-description",children:"Round the corners of your screenshot (max = perfect circle)"}),e.jsxs("div",{className:"slider-control",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:b,onChange:q=>_(parseInt(q.target.value)),className:"slider"}),e.jsx("span",{className:"slider-value",children:b===100?"Circle":`${b}px`})]})]}),e.jsx("div",{className:"tool-control-group",children:e.jsxs("div",{className:"framed-border-container",style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{style:{width:"100%"},children:[e.jsx("h3",{children:"Framed Border"}),e.jsx("p",{className:"tool-description",children:"Add a colored frame around your screenshot"}),e.jsx("div",{className:"checkbox-control",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:m,onChange:q=>x(q.target.checked)}),"Enable Frame"]})}),m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"checkbox-control",style:{marginTop:"0.5rem"},children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Y,onChange:q=>J(q.target.checked)}),"Double Frame (3D Look)"]})}),e.jsxs("div",{className:"color-control",style:{flexWrap:"wrap",gap:"0.5rem"},children:[e.jsx("label",{style:{minWidth:"100px"},children:"Frame Color:"}),e.jsx("input",{type:"color",value:C,onChange:q=>M(q.target.value),className:"color-picker"}),e.jsx("span",{className:"color-value",style:{wordBreak:"break-all"},children:C})]}),e.jsxs("div",{className:"slider-control",children:[e.jsx("label",{children:"Frame Width:"}),e.jsx("input",{type:"range",min:"1",max:"50",value:y,onChange:q=>L(parseInt(q.target.value)),className:"slider"}),e.jsxs("span",{className:"slider-value",children:[y,"px"]})]})]})]}),e.jsxs("div",{style:{flexShrink:0,width:"200px",background:"white",borderRadius:"8px",padding:"12px",border:"2px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h4",{className:"screenshot-preview-title",style:{margin:"0 0 8px 0",fontSize:"14px",fontWeight:"bold"},children:"Screenshot Preview"}),e.jsx("div",{style:{width:"100%",minHeight:"120px",maxHeight:"150px",display:"flex",alignItems:"center",justifyContent:"center",background:"#f8f9fa",borderRadius:"6px",overflow:"hidden",border:"1px solid #dee2e6"},children:X?e.jsx("img",{src:X,alt:"Screenshot Preview",style:{maxWidth:"100%",maxHeight:"150px",objectFit:"contain",display:"block"}}):l?e.jsx("img",{src:l,alt:"Screenshot Preview",style:{maxWidth:"100%",maxHeight:"150px",objectFit:"contain",display:"block"}}):e.jsx("p",{style:{color:"#999",fontSize:"0.85rem",margin:0,textAlign:"center",padding:"10px"},children:"No screenshot loaded"})})]})]})})]})})(),(()=>{const E=d.length>0&&P!==null?d[P]:null,U=(E==null?void 0:E.name)||"";return Cs(U),null})(),e.jsxs("div",{className:"tools-actions",children:[e.jsx("button",{className:"apply-edits-btn",onClick:Ce,disabled:!X&&!l,children:"Apply Edits"}),e.jsx("button",{className:"reset-btn",onClick:()=>{S(0),_(0),x(!1),L(10),M("#FF0000"),J(!1),H("none"),O(0),Z(0)},children:"Reset"})]})]})]})]})})()]})};const He="https://screenmerch.fly.dev/static/images",$e=()=>`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,vr=({sidebar:t})=>{const{productId:s}=$t(),[r]=yt(),a=Oe(),[i,n]=c.useState(null),[l,h]=c.useState(!0),[v,S]=c.useState(null),[b,_]=c.useState(null),[m,x]=c.useState({}),[C,M]=c.useState({}),[y,L]=c.useState(()=>{try{const o=localStorage.getItem("cart_items");return o?JSON.parse(o):[]}catch{return[]}}),[Y,J]=c.useState(!1),[F,H]=c.useState({screenshots:[],thumbnail:""}),K=r.get("category"),O=c.useMemo(()=>(K||localStorage.getItem("last_selected_category")||"").trim()||"mens",[K]),re=r.get("authenticated")==="true",Z=r.get("email")||"";c.useEffect(()=>{window.__DEBUG__&&(console.log("üîé browse: qsCategory=",K,"resolved category=",O),console.log("üîó full url:",window.location.href)),O&&localStorage.setItem("last_selected_category",O)},[K,O]);const X=[{name:"Women's",emoji:"üë©",category:"womens"},{name:"Men's",emoji:"üë®",category:"mens"},{name:"Kids",emoji:"üë∂",category:"kids"},{name:"Mugs",emoji:"‚òï",category:"mugs"},{name:"Hats",emoji:"üß¢",category:"hats"},{name:"Bags",emoji:"üëú",category:"bags"},{name:"Pets",emoji:"üêï",category:"pets"},{name:"Misc",emoji:"üì¶",category:"misc"},{name:"Product Info",emoji:"üõçÔ∏è",category:"all-products"},{name:"Image Tools",emoji:"üõ†Ô∏è",category:"thumbnails"}],z=o=>{window.__DEBUG__&&(console.log("üîÑ Category clicked:",o),console.log("üîÑ Current category:",O),console.log("üîÑ Product ID:",s),console.log("üîÑ Authenticated:",re),console.log("üîÑ Email:",Z));const T=`${!s||s==="browse"||s==="undefined"||s==="null"?"/product/browse":`/product/${s}`}?category=${encodeURIComponent(o)}&authenticated=${re}&email=${encodeURIComponent(Z||"")}`;try{localStorage.setItem("last_selected_category",o)}catch{}try{a(T),window.__DEBUG__&&console.log("‚úÖ Navigate called successfully to",T)}catch(d){console.error("‚ùå Navigate failed, falling back:",d),window.location.assign(T)}},B=o=>{const g={mens:["Unisex Hoodie","Men's Tank Top","Mens Fitted T-Shirt","Men's Fitted Long Sleeve","Unisex T-Shirt","Unisex Oversized T-Shirt","Men's Long Sleeve Shirt","Unisex Champion Hoodie"],womens:["Cropped Hoodie","Fitted Racerback Tank","Micro-Rib Tank Top","Women's Ribbed Neck","Women's Shirt","Unisex Heavyweight T-Shirt","Unisex Pullover Hoodie","Women's Crop Top"],kids:["Youth Heavy Blend Hoodie","Kids Shirt","Kids Long Sleeve","Toddler Short Sleeve T-Shirt","Toddler Jersey T-Shirt","Kids Sweatshirt","Youth All Over Print Swimsuit","Girls Leggings","Baby Staple Tee","Baby Jersey T-Shirt","Baby Body Suit"],bags:["Laptop Sleeve","All-Over Print Drawstring","All Over Print Tote Pocket","All-Over Print Crossbody Bag","All-Over Print Utility Bag"],hats:["Distressed Dad Hat","Closed Back Cap","Five Panel Trucker Hat","Five Panel Baseball Cap"],mugs:["White Glossy Mug","Travel Mug","Enamel Mug","Colored Mug"],pets:["Pet Bowl All-Over Print","Pet Bandana Collar","All Over Print Leash","All Over Print Collar"],misc:["Bandana","Hardcover Bound Notebook","Coasters","Apron","Jigsaw Puzzle with Tin","Greeting Card","Kiss-Cut Stickers","Die-Cut Magnets"],"all-products":[],thumbnails:[]}[o]||[];if(!o||o==="all"||o==="all-products")return[];const T={"Unisex Hoodie":{filename:"tested.png",preview:"testedpreview.png",price:36.95},"Men's Tank Top":{filename:"random.png",preview:"randompreview.png",price:24.23},"Mens Fitted T-Shirt":{filename:"mensfittedtshirt.png",preview:"mensfittedtshirtpreview.png",price:26.58},"Men's Fitted Long Sleeve":{filename:"mensfittedlongsleeve.png",preview:"mensfittedlongsleevepreview.png",price:29.33},"Unisex T-Shirt":{filename:"guidontee.png",preview:"guidonteepreview.png",price:21.69},"Unisex Oversized T-Shirt":{filename:"unisexoversizedtshirt.png",preview:"unisexoversizedtshirtpreview.png",price:26.49},"Men's Long Sleeve Shirt":{filename:"menslongsleeve.png",preview:"menslongsleevepreview.png",price:24.79},"Unisex Champion Hoodie":{filename:"hoodiechampion.png",preview:"hoodiechampionpreview.png",price:45},"Cropped Hoodie":{filename:"womenscroppedhoodiepreview.png",preview:"womenscroppedhoodiepreview.png",price:43.15},"Fitted Racerback Tank":{filename:"womenstankpreview.png",preview:"womenstankpreview.png",price:20.95},"Micro-Rib Tank Top":{filename:"womensmicroribtanktoppreview.png",preview:"womensmicroribtanktoppreview.png",price:25.81},"Women's Ribbed Neck":{filename:"womensribbedneckpreview.png",preview:"womensribbedneckpreview.png",price:25.6},"Women's Shirt":{filename:"womenshirtpreview.png",preview:"womenshirtpreview.png",price:23.69},"Unisex Heavyweight T-Shirt":{filename:"womenshdshirtpreview.png",preview:"womenshdshirtpreview.png",price:25.29},"Unisex Pullover Hoodie":{filename:"womensunisexpulloverhoodiepreview.png",preview:"womensunisexpulloverhoodiepreview.png",price:41.06},"Women's Crop Top":{filename:"womenscroptoppreview.png",preview:"womenscroptoppreview.png",price:28.55},"Youth Heavy Blend Hoodie":{filename:"kidhoodie.png",preview:"kidhoodiepreview.png",price:29.33},"Kids Shirt":{filename:"kidshirt.png",preview:"kidshirtpreview.png",price:23.49},"Kids Long Sleeve":{filename:"kidlongsleeve.png",preview:"kidlongsleevepreview.png",price:26.49},"Toddler Short Sleeve T-Shirt":{filename:"toddlershortsleevet.png",preview:"toddlershortsleevetpreview.png",price:22.75},"Toddler Jersey T-Shirt":{filename:"toddlerjerseytshirt.png",preview:"toddlerjerseytshirtpreview.png",price:20.29},"Baby Staple Tee":{filename:"babystapletshirt.png",preview:"babystapletshirtpreview.png",price:22.19},"Baby Jersey T-Shirt":{filename:"toddlershortsleevet.png",preview:"toddlershortsleevetpreview.png",price:20.29},"Baby Body Suit":{filename:"youthalloverprintswimsuit.png",preview:"youthalloverprintswimsuitpreview.png",price:20.9},"Kids Sweatshirt":{filename:"kidssweatshirt.png",preview:"kidssweatshirtpreview.png",price:27.29},"Youth All Over Print Swimsuit":{filename:"youthalloverprintswimsuit.png",preview:"youthalloverprintswimsuitpreview.png",price:33.95},"Girls Leggings":{filename:"girlsleggings.png",preview:"girlsleggingspreview.png",price:28.31},"Laptop Sleeve":{filename:"laptopsleeve.png",preview:"laptopsleevepreview.png",price:31.16},"All-Over Print Drawstring":{filename:"drawstringbag.png",preview:"drawstringbagpreview.png",price:25.25},"All-Over Print Utility Bag":{filename:"crossbodybag.png",preview:"crossbodybagpreview.png",price:31.79},"All Over Print Tote Pocket":{filename:"largecanvasbag.png",preview:"largecanvasbagpreview.png",price:33.41},"All-Over Print Crossbody Bag":{filename:"crossbodybag.png",preview:"crossbodybagpreview.png",price:28.95},"Distressed Dad Hat":{filename:"distresseddadhat.png",preview:"distresseddadhatpreview.png",price:24.95},"Closed Back Cap":{filename:"closedbackcap.png",preview:"hatsclosedbackcappreview.png",price:25.19},"Five Panel Trucker Hat":{filename:"fivepaneltruckerhat.png",preview:"fivepaneltruckerhatpreview.png",price:24.95},"Five Panel Baseball Cap":{filename:"youthbaseballcap.png",preview:"youthbaseballcappreview.png",price:24.95},"White Glossy Mug":{filename:"mug1.png",preview:"mug1preview.png",price:15.95},"Travel Mug":{filename:"travelmug.png",preview:"travelmugpreview.png",price:19.95},"Enamel Mug":{filename:"enamalmug.png",preview:"enamalmugpreview.png",price:18.95},"Colored Mug":{filename:"coloredmug.png",preview:"coloredmugpreview.png",price:17.95},"Pet Bowl All-Over Print":{filename:"dogbowl.png",preview:"dogbowlpreview.png",price:31.49},"Pet Bandana Collar":{filename:"scarfcollar.png",preview:"scarfcollarpreview.png",price:19.95},"All Over Print Leash":{filename:"leash.png",preview:"leashpreview.png",price:24.95},"All Over Print Collar":{filename:"collar.png",preview:"collarpreview.png",price:23.08},"Kiss-Cut Stickers":{filename:"stickers.png",preview:"stickerspreview.png",price:4.29},"Die-Cut Magnets":{filename:"magnet.png",preview:"magnetpreview.png",price:5.32},"Greeting Card":{filename:"greetingcard.png",preview:"greetingcardpreview.png",price:5},"Hardcover Bound Notebook":{filename:"hardcovernotebook.png",preview:"hardcovernotebookpreview.png",price:23.21},Coasters:{filename:"coaster.png",preview:"coasterpreview.png",price:33.99},Apron:{filename:"apron.png",preview:"apronpreview.png",price:19.99},Bandana:{filename:"bandana.png",preview:"bandanapreview.png",price:19.95},"Jigsaw Puzzle with Tin":{filename:"jigsawpuzzle.png",preview:"jigsawpuzzlepreview.png",price:27.65}};return g.map(d=>{const w=T[d]||{filename:"placeholder.png",preview:"placeholder.png",price:25};return{name:d,price:w.price,main_image:`${He}/${w.filename}`,preview_image:`${He}/${w.preview}`,options:{color:["Black","White","Hazy Pink","Pale Pink","Orchid","Ecru","White","Bubblegum","Bone","Mineral","Natural"],size:["XS","S","M","L","XL"]}}})},u=()=>{var f,g;const o=(f=i==null?void 0:i.product)!=null&&f.screenshots&&i.product.screenshots.length>0?i.product.screenshots:F.screenshots;return b==="thumbnail"?((g=i==null?void 0:i.product)==null?void 0:g.thumbnail_url)||F.thumbnail||"":typeof b=="number"&&o&&o[b]?o[b]:""},p=(o,f)=>{var d,w;const g=o.price||0,T=C[f]||((w=(d=o==null?void 0:o.options)==null?void 0:d.size)==null?void 0:w[0]);return o.size_pricing&&o.size_pricing[T]!==void 0?g+o.size_pricing[T]:g},N=o=>{L(o);try{localStorage.setItem("cart_items",JSON.stringify(o))}catch{}},j=(o,f)=>{var me,ae,we,fe;const g=m[f]||((ae=(me=o==null?void 0:o.options)==null?void 0:me.color)==null?void 0:ae[0])||"Default",T=C[f]||((fe=(we=o==null?void 0:o.options)==null?void 0:we.size)==null?void 0:fe[0])||"One Size",d=u();let w={};try{const Se=localStorage.getItem("pending_merch_data");if(console.log("üîç Raw localStorage data:",Se),Se){const Ce=JSON.parse(Se);console.log("üîç Parsed merch data:",Ce),w={video_url:Ce.videoUrl,video_title:Ce.videoTitle,creator_name:Ce.creatorName,thumbnail:Ce.thumbnail},console.log("üîç Video metadata extracted:",w)}}catch(Se){console.warn("Could not load video metadata from localStorage:",Se)}const P={name:(o==null?void 0:o.name)||"Product",price:p(o,f),image:o!=null&&o.preview_image?o.preview_image.startsWith("http")?o.preview_image:`${He}/${o.preview_image}`:o!=null&&o.main_image?o.main_image.startsWith("http")?o.main_image:`${He}/${o.main_image}`:"",color:g,size:T,screenshot:d,qty:1,...w},Q=[...y,P];N(Q),alert("Added to cart!")};if(c.useEffect(()=>{try{const o=localStorage.getItem("pending_merch_data");if(o){const f=JSON.parse(o);H({screenshots:Array.isArray(f==null?void 0:f.screenshots)?f.screenshots.slice(0,6):[],thumbnail:(f==null?void 0:f.thumbnail)||""})}}catch{console.warn("Invalid pending_merch_data in localStorage, ignoring")}},[s]),c.useEffect(()=>{window.__DEBUG__&&console.log("üîÑ useEffect triggered with:",{productId:s,category:O,authenticated:re,email:Z}),(async()=>{var f,g,T,d,w,P,Q,me,ae,we,fe;try{h(!0),S(null);const Se=s||"browse",Ce=!s||s==="browse"||s==="dynamic",V=Ce?`https://screenmerch.fly.dev/api/product/browse?category=${encodeURIComponent(O)}&authenticated=${re}&email=${encodeURIComponent(Z||"")}&v=${Date.now()}&mobile=${Date.now()}&cache=${Math.random()}`:`https://screenmerch.fly.dev/api/product/${Se}?category=${encodeURIComponent(O)}&authenticated=${re}&email=${encodeURIComponent(Z||"")}&v=${Date.now()}&mobile=${Date.now()}&cache=${Math.random()}`,le=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);(window.__DEBUG__||le)&&(console.log("üåê Fetching product data from:",V),console.log("üì± User Agent:",navigator.userAgent),console.log("üì± Is Mobile:",le),console.log("üîß Debug mode enabled for mobile"),console.log("üîß ProductId:",s),console.log("üîß Category:",O),console.log("üîß IsBrowseMode:",Ce),le&&console.log(`Mobile Debug:
ProductId: ${s}
Category: ${O}
IsBrowseMode: ${Ce}
URL: ${V}`));let pe;try{(window.__DEBUG__||le)&&(console.log("üöÄ Starting fetch request..."),console.log("üì± Mobile detection:",le),console.log("üì± URL:",V)),pe=await fetch(V,{method:"GET",cache:"no-cache",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},signal:AbortSignal.timeout(3e4)}),(window.__DEBUG__||le)&&(console.log("‚úÖ Fetch completed, status:",pe.status),console.log("‚úÖ Response headers:",Object.fromEntries(pe.headers.entries())))}catch(U){if(console.error("‚ùå Fetch failed:",U),console.error("‚ùå Error name:",U.name),console.error("‚ùå Error message:",U.message),le&&console.log(`Fetch Failed!
Error: ${U.message}
URL: ${V}`),le){console.log("üì± API call failed, using mobile fallback with static data"),console.log("üì± This should NOT happen if API call succeeded"),console.log("üì± Error details:",U.message);const A=B(O);console.log("üì± Static products:",A);const q={success:!0,product:{thumbnail_url:"",screenshots:[]},products:A,category:O};console.log("üì± Setting static data:",q),n(q),h(!1),S(null),console.log(`Mobile Fallback Active!
Products: ${A.length}
Category: ${O}`);return}window.__DEBUG__&&console.log("üîÑ Trying fallback fetch...");try{pe=await fetch(V,{method:"GET",cache:"no-cache"}),window.__DEBUG__&&console.log("‚úÖ Fallback fetch succeeded, status:",pe.status)}catch(A){throw console.error("‚ùå Fallback fetch also failed:",A),new Error(`Network error: ${U.message} | Fallback: ${A.message}`)}}if(window.__DEBUG__&&(console.log("üì° Response status:",pe.status),console.log("üì° Response headers:",Object.fromEntries(pe.headers.entries()))),!pe.ok){const U=await pe.text();throw console.error("‚ùå API Error Response:",U),new Error(`Failed to fetch product data: ${pe.status} - ${U}`)}const E=await pe.json();window.__DEBUG__&&(console.log("üì¶ Product Data Received:",E),console.log("üì∏ Thumbnail URL:",(f=E.product)==null?void 0:f.thumbnail_url),console.log("üì∏ Screenshots:",(g=E.product)==null?void 0:g.screenshots),console.log("üì∏ Screenshots Length:",((d=(T=E.product)==null?void 0:T.screenshots)==null?void 0:d.length)||0),console.log("üì¶ Products Count:",((w=E.products)==null?void 0:w.length)||0),console.log("üì¶ Category:",E.category),console.log("üì¶ Success:",E.success)),(window.__DEBUG__||le)&&(console.log("üì¶ Raw API Response:",E),console.log("üì¶ Products array:",E.products),console.log("üì¶ Products length:",(P=E.products)==null?void 0:P.length),console.log("üì¶ Success flag:",E.success));try{localStorage.setItem("cached_products",JSON.stringify(E.products)),window.__DEBUG__&&console.log("üíæ Cached products data for offline use")}catch{console.warn("Could not cache products data")}(window.__DEBUG__||le)&&(console.log("‚úÖ Using real backend data - API call succeeded"),console.log("‚úÖ Products from backend:",((Q=E.products)==null?void 0:Q.length)||0),console.log("‚úÖ First product image:",(ae=(me=E.products)==null?void 0:me[0])==null?void 0:ae.main_image),console.log("‚úÖ First product preview:",(fe=(we=E.products)==null?void 0:we[0])==null?void 0:fe.preview_image),console.log("‚úÖ Mobile fallback should NOT be used - API succeeded")),n(E)}catch(Se){console.error("Error fetching product data:",Se),S(Se.message)}finally{h(!1)}})()},[s,O,re,Z]),l)return e.jsx("div",{className:`container ${t?"":" large-container"}`,children:e.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading product..."})]})});if(v)return e.jsx("div",{className:`container ${t?"":" large-container"}`,children:e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"red"},children:[e.jsx("h2",{children:"Error Loading Product"}),e.jsx("p",{children:v}),e.jsx("button",{onClick:()=>{S(null),h(!0),(async()=>{try{const g=`https://screenmerch.fly.dev/api/product/${s||"browse"}?category=${encodeURIComponent(O)}&authenticated=${re}&email=${encodeURIComponent(Z||"")}`,T=await fetch(g,{method:"GET",signal:AbortSignal.timeout(3e4)});if(!T.ok)throw new Error(`Failed to fetch product data: ${T.status}`);const d=await T.json();n(d)}catch(f){console.error("Retry failed:",f),S(f.message)}finally{h(!1)}})()},children:"Retry"}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("p",{children:"If the error persists, you can still browse products by category:"}),e.jsx("div",{className:"categories-grid",style:{marginTop:"1rem"},children:X.map((o,f)=>e.jsxs("div",{className:`category-box ${o.category===O?"active":""}`,onClick:()=>z(o.category),style:{cursor:"pointer"},children:[e.jsx("div",{className:"category-emoji",children:o.emoji}),e.jsx("div",{className:"category-name",children:o.name})]},f))})]})]})});if(!i){const o=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return(window.__DEBUG__||o)&&(console.log("‚ùå ProductData is falsy:",i),console.log("‚ùå Loading state:",l),console.log("‚ùå Error state:",v)),e.jsx("div",{className:`container ${t?"":" large-container"}`,children:e.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[e.jsx("h2",{children:"Product Not Found"}),e.jsx("p",{children:"The requested product could not be found."}),e.jsxs("p",{children:["Debug: productData = ",JSON.stringify(i)]})]})})}return O==="thumbnails"?e.jsx(ga,{}):e.jsxs("div",{className:`container ${t?"":" large-container"}`,children:[(()=>{const o=(O||"").trim().toLowerCase();return o!=="all"&&o!=="all-products"})()&&e.jsx("div",{className:"user-flow-section",children:e.jsx("div",{className:"flow-steps",children:e.jsxs("div",{className:"flow-step",children:[e.jsx("div",{className:"step-number",children:"3"}),e.jsxs("div",{className:"step-content",children:[e.jsx("h3",{children:"Make Merchandise"}),e.jsx("p",{children:"Create custom products with your screenshot"})]})]})})}),(()=>{var T;const o=(O||"").trim().toLowerCase(),f=o==="all"||o==="all-products",g=(i==null?void 0:i.products)&&i.products.length>0;return console.log("üîç All Products Check:",{category:O,isAllProducts:f,hasProducts:g,productCount:(T=i==null?void 0:i.products)==null?void 0:T.length,productDataExists:!!i}),f&&g?(console.log("‚úÖ Showing All Products informational layout"),!0):(console.log("‚ùå NOT showing All Products layout:",{reason:f?"no products":"category mismatch"}),!1)})()&&e.jsxs("div",{className:"all-products-info-container",children:[e.jsx("h1",{className:"product-information-title",children:"Product Information"}),(()=>{window.__DEBUG__&&console.log("‚úÖ Rendering All Products informational layout");const o={womens:[],mens:[],kids:[],mugs:[],hats:[],bags:[],pets:[],misc:[]},f={womens:["Cropped Hoodie","Fitted Racerback Tank","Micro-Rib Tank Top","Women's Ribbed Neck","Women's Shirt","Unisex Heavyweight T-Shirt","Unisex Pullover Hoodie","Women's Crop Top"],mens:["Unisex Hoodie","Men's Tank Top","Mens Fitted T-Shirt","Men's Fitted Long Sleeve","Unisex T-Shirt","Unisex Oversized T-Shirt","Men's Long Sleeve Shirt","Unisex Champion Hoodie"],kids:["Youth Heavy Blend Hoodie","Kids Shirt","Kids Long Sleeve","Toddler Jersey T-Shirt","Kids Sweatshirt","Baby Staple Tee","Baby Jersey T-Shirt","Baby Body Suit"],mugs:["White Glossy Mug","Travel Mug","Enamel Mug","Colored Mug"],hats:["Distressed Dad Hat","Closed Back Cap","Five Panel Trucker Hat","Five Panel Baseball Cap"],bags:["Laptop Sleeve","All-Over Print Drawstring","All Over Print Tote Pocket","All-Over Print Utility Bag"],pets:["Pet Bowl All-Over Print","Pet Bandana Collar","All Over Print Leash","All Over Print Collar"],misc:["Bandana","Hardcover Bound Notebook","Coasters","Apron","Jigsaw Puzzle with Tin","Greeting Card","Kiss-Cut Stickers","Die-Cut Magnets"]};i.products.forEach(T=>{for(const[d,w]of Object.entries(f))if(w.includes(T.name)){o[d].push(T);break}});const g={womens:"Women's",mens:"Men's",kids:"Kids",mugs:"Mugs",hats:"Hats",bags:"Bags",pets:"Pets",misc:"Miscellaneous"};return["womens","mens","kids","mugs","hats","bags","pets","misc"].map(T=>o[T].length===0?null:e.jsxs("div",{className:"category-section",children:[e.jsx("h2",{className:"category-section-title",children:g[T]}),e.jsxs("div",{className:"products-info-table",children:[e.jsxs("div",{className:"info-table-header",children:[e.jsx("div",{className:"info-col-name",children:"Name"}),e.jsx("div",{className:"info-col-image",children:"Image"}),e.jsx("div",{className:"info-col-description",children:"Description"})]}),o[T].map((d,w)=>e.jsxs("div",{className:"info-table-row",children:[e.jsxs("div",{className:"info-col-name",children:[d.name,d.name&&d.name.includes("Jigsaw Puzzle with Tin")&&e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:"normal",color:"#666",display:"block",marginTop:"4px"},children:"(Ages 4+ only)"})]}),e.jsx("div",{className:"info-col-image",children:e.jsx("img",{src:d.preview_image||d.main_image?(d.preview_image||d.main_image).startsWith("http")?d.preview_image||d.main_image:`${He}/${d.preview_image||d.main_image}`:`${He}/placeholder.png`,alt:d.name,className:"info-product-image",onError:P=>{P.currentTarget.src=`${He}/placeholder.png`}})}),e.jsx("div",{className:"info-col-description",children:d.description||"No description available."})]},w))]})]},T))})()]}),(()=>{const o=(O||"").trim().toLowerCase();return o!=="all"&&o!=="all-products"})()&&i.products&&i.products.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"screenshots-section",children:[e.jsx("h2",{className:"screenshots-title",children:"Select Your Screenshot"}),e.jsx("p",{className:"screenshots-subtitle",children:"Choose which screenshot to use for your custom merchandise"}),e.jsx("div",{className:"screenshots-preview",children:e.jsxs("div",{className:"screenshot-grid",children:[(()=>{var f;const o=((f=i==null?void 0:i.product)==null?void 0:f.thumbnail_url)||F.thumbnail;return o?e.jsxs("div",{className:`screenshot-item ${b==="thumbnail"?"selected":""}`,onClick:()=>_("thumbnail"),children:[e.jsx("img",{src:o,alt:"Thumbnail",className:"screenshot-image"}),e.jsx("div",{className:"screenshot-label",children:"Thumbnail"})]}):null})(),(()=>{var T,d;const o=((T=i==null?void 0:i.product)==null?void 0:T.thumbnail_url)||F.thumbnail,f=(d=i==null?void 0:i.product)!=null&&d.screenshots&&i.product.screenshots.length>0?i.product.screenshots:F.screenshots,g=(f||[]).filter(w=>w&&w!==o);return g&&g.length>0?g.map((w,P)=>{const Q=f.findIndex(me=>me===w);return e.jsxs("div",{className:`screenshot-item ${b===Q?"selected":""}`,onClick:()=>_(Q),children:[e.jsx("img",{src:w,alt:`Screenshot ${P+1}`,className:"screenshot-image"}),e.jsxs("div",{className:"screenshot-label",children:["Screenshot ",P+1]})]},P)}):null})()]})})]}),e.jsx("div",{className:"tools-button-container",children:e.jsx("button",{className:"tools-page-btn",onClick:()=>{const o=u();if(o)try{const f=localStorage.getItem("pending_merch_data"),g=f?JSON.parse(f):{};g.selected_screenshot=o,localStorage.setItem("pending_merch_data",JSON.stringify(g))}catch(f){console.warn("Could not save selected screenshot:",f)}a("/tools")},children:"üõ†Ô∏è Tools Page"})}),e.jsx("div",{className:"product-page-container",children:e.jsxs("div",{className:"product-main",children:[e.jsx("div",{className:"product-image-section",children:i.img_url&&e.jsx("img",{src:i.img_url.includes("?")?`${i.img_url}&v=${$e()}`:`${i.img_url}?v=${$e()}`,alt:"Product Preview",className:"product-preview-image"})}),e.jsxs("div",{className:"product-options-section",children:[e.jsxs("div",{className:"cart-section",children:[e.jsx("button",{className:"view-cart-btn",onClick:()=>J(!0),children:"View Cart"}),e.jsx("button",{className:"checkout-btn",onClick:()=>a("/checkout"),children:"Checkout"})]}),e.jsx("div",{className:"products-grid",children:i.products&&i.products.map((o,f)=>e.jsxs("div",{className:"product-card",children:[(o.preview_image||o.main_image)&&(()=>{const g=O==="womens"||O==="mens"||O==="kids";return e.jsx("div",{className:"product-image",children:e.jsx("div",{className:"product-image-wrapper",children:e.jsx("img",{className:g?"product-image-clear":"product-image-normal",src:o.preview_image?o.preview_image.startsWith("http")?o.preview_image.includes("?")?`${o.preview_image}&v=${$e()}`:`${o.preview_image}?v=${$e()}`:o.preview_image.includes("?")?`${He}/${o.preview_image}&v=${$e()}`:`${He}/${o.preview_image}?v=${$e()}`:o.main_image.startsWith("http")?o.main_image.includes("?")?`${o.main_image}&v=${$e()}`:`${o.main_image}?v=${$e()}`:o.main_image.includes("?")?`${He}/${o.main_image}&v=${$e()}`:`${He}/${o.main_image}?v=${$e()}`,alt:o.name,loading:"lazy",referrerPolicy:"no-referrer",onError:T=>{const d=o.main_image?o.main_image.startsWith("http")?o.main_image.includes("?")?`${o.main_image}&v=${$e()}`:`${o.main_image}?v=${$e()}`:o.main_image.includes("?")?`${He}/${o.main_image}&v=${$e()}`:`${He}/${o.main_image}?v=${$e()}`:"";d&&T.currentTarget.src!==d&&(T.currentTarget.src=d)}})})})})(),e.jsxs("h3",{children:[o.name,o.name&&o.name.includes("Jigsaw Puzzle with Tin")&&e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:"normal",color:"#666",display:"block",marginTop:"4px"},children:"(Ages 4+ only)"})]}),e.jsxs("p",{className:"product-price",children:["$",p(o,f).toFixed(2)]}),e.jsxs("div",{className:"product-options",children:[o.options&&o.options.color&&o.options.color.length>0&&e.jsxs("div",{className:"option-group",children:[e.jsx("label",{children:"Color:"}),e.jsx("select",{className:"color-select",value:m[f]||o.options.color[0],onChange:g=>{const T={...m};T[f]=g.target.value,x(T)},children:o.options.color.map((g,T)=>e.jsx("option",{value:g,children:g},T))})]}),o.options&&o.options.handle_color&&o.options.handle_color.length>0&&e.jsxs("div",{className:"option-group",children:[e.jsx("label",{children:"Handle Color:"}),e.jsx("select",{className:"color-select",value:m[f]||o.options.handle_color[0],onChange:g=>{const T={...m};T[f]=g.target.value,x(T)},children:o.options.handle_color.map((g,T)=>e.jsx("option",{value:g,children:g},T))})]}),o.options&&o.options.size&&o.options.size.length>0&&e.jsxs("div",{className:"option-group",children:[e.jsx("label",{children:"Size:"}),e.jsx("select",{className:"size-select",value:C[f]||o.options.size[0],onChange:g=>{const T={...C};T[f]=g.target.value,x(T)},children:o.options.size.map((g,T)=>e.jsx("option",{value:g,children:g},T))})]})]}),e.jsx("button",{className:"add-to-cart-btn",onClick:()=>j(o,f),children:"Add to Cart"})]},f))}),e.jsxs("div",{className:"cart-section cart-section-bottom",children:[e.jsx("button",{className:"view-cart-btn",onClick:()=>J(!0),children:"View Cart"}),e.jsx("button",{className:"checkout-btn",onClick:()=>a("/checkout"),children:"Checkout"})]})]})]})}),Y&&e.jsx("div",{className:"cart-modal",onClick:()=>J(!1),children:e.jsx("div",{className:"cart-modal-content",onClick:o=>o.stopPropagation(),children:y.length===0?e.jsxs("div",{className:"empty-cart-message",children:[e.jsx("div",{className:"empty-cart-icon",children:"üõí"}),e.jsx("p",{children:"Your cart is empty"})]}):e.jsxs("div",{className:"cart-items-wrapper",children:[e.jsx("h2",{className:"cart-section-title",children:"Cart Items"}),e.jsx("div",{className:"cart-items",children:y.map((o,f)=>e.jsxs("div",{className:"cart-item",children:[e.jsxs("div",{className:"cart-item-image-wrapper",children:[o.image&&e.jsx("img",{src:o.image.includes("?")?`${o.image}&v=${$e()}`:`${o.image}?v=${$e()}`,alt:o.name}),e.jsxs("div",{className:"cart-item-meta",children:[o.color," ‚Ä¢ ",o.size]})]}),e.jsxs("div",{className:"cart-item-info",children:[e.jsx("div",{className:"cart-item-name",children:o.name}),e.jsxs("div",{className:"cart-item-price",children:["$",(o.price||0).toFixed(2)]})]}),o.screenshot&&e.jsx("img",{className:"cart-item-shot",src:o.screenshot,alt:"screenshot"}),e.jsx("button",{className:"cart-item-delete",onClick:()=>{const g=y.filter((T,d)=>d!==f);L(g),localStorage.setItem("cart_items",JSON.stringify(g))},title:"Remove item",children:"üóëÔ∏è"})]},f))}),e.jsxs("div",{className:"cart-actions",children:[e.jsx("button",{className:"view-cart-btn",onClick:()=>J(!1),children:"Continue Shopping"}),e.jsx("button",{className:"checkout-btn",onClick:()=>a("/checkout"),children:"Checkout"}),e.jsx("button",{className:"edit-tools-btn",onClick:()=>a("/tools"),children:"Edit Tools"})]})]})})})]})]})};const vc=({isOpen:t,image:s,onCrop:r,onCancel:a})=>{const[i,n]=c.useState({x:100,y:100,width:200,height:200}),[l,h]=c.useState(!1),[v,S]=c.useState(!1),[b,_]=c.useState(null),[m,x]=c.useState({x:0,y:0}),[C,M]=c.useState({width:0,height:0}),[y,L]=c.useState({width:0,height:0}),Y=c.useRef(null),J={"4x6":{width:1200,height:1800,name:'4" x 6" Photo'},"5x7":{width:1500,height:2100,name:'5" x 7" Photo'},"8x10":{width:2400,height:3e3,name:'8" x 10" Photo'},"11x14":{width:3300,height:4200,name:'11" x 14" Photo'},Mug:{width:800,height:800,name:"Coffee Mug"},"T-Shirt":{width:1200,height:1200,name:"T-Shirt Print"},"Phone Case":{width:600,height:1200,name:"Phone Case"}};c.useEffect(()=>{if(t&&s){const p=new Image;p.crossOrigin="anonymous",p.onload=()=>{const N=p.width,j=p.height;M({width:N,height:j}),setTimeout(()=>{const o=document.querySelector(".crop-image");if(o){const f=o.getBoundingClientRect();console.log("Display image size detected:",f),console.log("Image natural size:",{width:o.naturalWidth,height:o.naturalHeight}),console.log("Image CSS size:",{width:o.offsetWidth,height:o.offsetHeight});const g=f.width,T=f.height;L({width:g,height:T});const d=g/2-150,w=T/2-150,P=Math.min(300,Math.min(g,T)*.8);n({x:Math.max(0,d),y:Math.max(0,w),width:P,height:P})}else console.log("Display image not found, using fallback sizes"),L({width:400,height:300}),n({x:100,y:100,width:200,height:200})},300)},p.src=s}},[t,s]);const F=p=>{var f;const N=(f=document.querySelector(".crop-image"))==null?void 0:f.getBoundingClientRect();if(!N)return;const j=p.clientX-N.left,o=p.clientY-N.top;console.log("Mouse down:",{clientX:p.clientX,clientY:p.clientY,imageRect:N,x:j,y:o,cropArea:i}),j>=i.x&&j<=i.x+i.width&&o>=i.y&&o<=i.y+i.height&&(h(!0),x({x:j-i.x,y:o-i.y}))},H=p=>{var f;if(!l&&!v)return;const N=(f=document.querySelector(".crop-image"))==null?void 0:f.getBoundingClientRect();if(!N)return;const j=p.clientX-N.left,o=p.clientY-N.top;if(l){const g=Math.max(0,Math.min(j-m.x,C.width-i.width)),T=Math.max(0,Math.min(o-m.y,C.height-i.height));n(d=>({...d,x:g,y:T}))}else if(v){let g={...i};switch(b){case"bottom-right":g.width=Math.max(50,j-i.x),g.height=Math.max(50,o-i.y);break;case"bottom-left":g.x=Math.min(j,i.x+i.width-50),g.width=i.x+i.width-g.x,g.height=Math.max(50,o-i.y);break;case"top-right":g.y=Math.min(o,i.y+i.height-50),g.width=Math.max(50,j-i.x),g.height=i.y+i.height-g.y;break;case"top-left":g.x=Math.min(j,i.x+i.width-50),g.y=Math.min(o,i.y+i.height-50),g.width=i.x+i.width-g.x,g.height=i.y+i.height-g.y;break}g.x=Math.max(0,Math.min(g.x,C.width-g.width)),g.y=Math.max(0,Math.min(g.y,C.height-g.height)),g.width=Math.min(g.width,C.width-g.x),g.height=Math.min(g.height,C.height-g.y),n(g)}},K=()=>{h(!1),S(!1),_(null)},O=(p,N)=>{N.stopPropagation(),S(!0),_(p)},re=p=>{if(!y.width||!y.height||!C.width||!C.height)return console.log("Missing size data:",{displaySize:y,imageSize:C}),p;const N=document.querySelector(".crop-image");let j=y.width,o=y.height;if(N){const w=N.getBoundingClientRect();j=w.width,o=w.height,console.log("Current display size:",{width:j,height:o})}const f=C.width/j,g=C.height/o,T=8,d={x:Math.round((p.x-T)*f),y:Math.round(p.y*g),width:Math.round(p.width*f),height:Math.round(p.height*g)};return d.x=Math.max(0,Math.min(d.x,C.width-d.width)),d.y=Math.max(0,Math.min(d.y,C.height-d.height)),console.log("Coordinate conversion:",{displayCrop:p,originalCrop:d,scaleX:f,scaleY:g,offsetAdjustment:T,imageSize:C,actualDisplaySize:{width:j,height:o}}),d},Z=()=>{try{const p=document.createElement("canvas"),N=p.getContext("2d"),j=new Image,o=re(i);console.log("Final crop coordinates:",{display:i,original:o,imageSize:C,displaySize:y}),j.onload=()=>{p.width=o.width,p.height=o.height,console.log("Drawing crop:",{sourceX:o.x,sourceY:o.y,sourceWidth:o.width,sourceHeight:o.height,destX:0,destY:0,destWidth:o.width,destHeight:o.height}),N.clearRect(0,0,p.width,p.height),N.drawImage(j,o.x,o.y,o.width,o.height,0,0,o.width,o.height);const f=p.toDataURL("image/png");r(f)},j.src=s}catch(p){console.error("Error during crop operation:",p),alert("Error cropping image. Please try again.")}},X=async()=>{try{const p=document.createElement("canvas"),N=p.getContext("2d"),j=new Image,o=re(i);j.onload=async()=>{p.width=o.width,p.height=o.height,N.clearRect(0,0,p.width,p.height),N.drawImage(j,o.x,o.y,o.width,o.height,0,0,o.width,o.height);const g={image_data:p.toDataURL("image/png"),feather_radius:12},T=await fetch("https://screenmerch.fly.dev/api/process-shirt-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(T.ok){const d=await T.json(),w={thumbnail_data:d.processed_image,print_dpi:300,soft_corners:!1,edge_feather:!0},P=await fetch("https://screenmerch.fly.dev/api/process-thumbnail-print-quality",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});if(P.ok){const Q=await P.json();r(Q.screenshot),alert("‚ú® Feather effect applied and print quality image generated!")}else r(d.processed_image),alert("‚ú® Feather effect applied!")}else{const d=await T.json();alert("Error applying feather effect: "+(d.error||"Unknown error"))}},j.src=s}catch(p){console.error("Error during feather effect:",p),alert("Error applying feather effect. Please try again.")}},z=()=>{const p={},N=re(i);return Object.entries(J).forEach(([j,o])=>{const f=N.width>=o.width,g=N.height>=o.height,T=f&&g;p[j]={meetsWidth:f,meetsHeight:g,isSuitable:T,requirements:o,currentWidth:N.width,currentHeight:N.height}}),p},B=()=>{const p=z(),N=Object.entries(p).filter(([j,o])=>o.isSuitable).sort((j,o)=>{const f=j[1].currentWidth*j[1].currentHeight;return o[1].currentWidth*o[1].currentHeight-f});return N.length>0?N[0]:null};z();const u=B();return t?e.jsx("div",{className:"simple-crop-overlay",children:e.jsxs("div",{className:"simple-crop-modal",children:[e.jsxs("div",{className:"simple-crop-header",children:[e.jsx("h3",{children:"Simple Print Crop Tool"}),e.jsx("button",{className:"simple-crop-close",onClick:a,children:"√ó"})]}),e.jsxs("div",{className:"simple-crop-content",children:[e.jsx("div",{className:"simple-print-status",children:u?e.jsxs("div",{className:"status-ok",children:[e.jsx("span",{className:"status-icon",children:"‚úì"}),e.jsx("span",{className:"status-text",children:"OK for Print"})]}):e.jsxs("div",{className:"status-warning",children:[e.jsx("span",{className:"status-icon",children:"‚ö†"}),e.jsx("span",{className:"status-text",children:"Too Small for Print"})]})}),e.jsxs("div",{className:"crop-instructions",children:[e.jsx("p",{children:"‚Ä¢ Click and drag inside the blue box to move it"}),e.jsx("p",{children:"‚Ä¢ Drag the corner handles to resize"}),e.jsxs("div",{className:"crop-coordinates",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Display:"})," ",Math.round(i.x),", ",Math.round(i.y)," - ",Math.round(i.width),"√ó",Math.round(i.height)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Original:"})," ",Math.round(re(i).x),", ",Math.round(re(i).y)," - ",Math.round(re(i).width),"√ó",Math.round(re(i).height)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Scale:"})," ",y.width&&C.width?(C.width/y.width).toFixed(2):"N/A","x"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Image Size:"})," ",C.width,"√ó",C.height,"px"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Offset Adjustment:"})," 8px left"]})]})]}),e.jsxs("div",{className:"crop-container",ref:Y,onMouseDown:F,onMouseMove:H,onMouseUp:K,onMouseLeave:K,children:[e.jsx("img",{src:s,alt:"Crop",className:"crop-image"}),e.jsxs("div",{className:"crop-box",style:{left:i.x,top:i.y,width:i.width,height:i.height},children:[e.jsx("div",{className:"resize-handle top-left",onMouseDown:p=>O("top-left",p)}),e.jsx("div",{className:"resize-handle top-right",onMouseDown:p=>O("top-right",p)}),e.jsx("div",{className:"resize-handle bottom-left",onMouseDown:p=>O("bottom-left",p)}),e.jsx("div",{className:"resize-handle bottom-right",onMouseDown:p=>O("bottom-right",p)})]})]})]}),e.jsxs("div",{className:"simple-crop-footer",children:[e.jsx("button",{className:"crop-btn cancel",onClick:a,children:"Cancel"}),e.jsx("button",{className:"crop-btn apply",onClick:Z,children:"Apply Crop"}),e.jsx("button",{className:"crop-btn feather",onClick:X,children:"‚ú® Apply Feather & Generate Print Quality"})]})]})}):null};const yc=()=>{const[t,s]=c.useState(!1),[r,a]=c.useState(null),[i,n]=c.useState(null),l=S=>{const b=S.target.files[0];if(b){const _=new FileReader;_.onload=m=>{a(m.target.result)},_.readAsDataURL(b)}},h=S=>{n(S),s(!1)},v=()=>{s(!1)};return e.jsxs("div",{className:"print-crop-demo",children:[e.jsxs("div",{className:"demo-header",children:[e.jsx("h2",{children:"Print Crop Tool Demo"}),e.jsx("p",{children:"This is a standalone crop tool designed for print-ready screenshots"})]}),e.jsxs("div",{className:"demo-controls",children:[e.jsxs("div",{className:"file-upload",children:[e.jsx("label",{htmlFor:"image-upload",className:"upload-btn",children:"Choose Screenshot Image"}),e.jsx("input",{id:"image-upload",type:"file",accept:"image/*",onChange:l,style:{display:"none"}})]}),r&&e.jsx("button",{className:"crop-btn",onClick:()=>s(!0),children:"Open Crop Tool"})]}),e.jsxs("div",{className:"demo-images",children:[r&&e.jsxs("div",{className:"image-container",children:[e.jsx("h3",{children:"Original Image"}),e.jsx("img",{src:r,alt:"Original"})]}),i&&e.jsxs("div",{className:"image-container",children:[e.jsx("h3",{children:"Cropped Image"}),e.jsx("img",{src:i,alt:"Cropped"}),e.jsxs("div",{className:"image-info",children:[e.jsx("p",{children:"Preview (scaled down for display)"}),e.jsx("p",{children:"Full size available for download"})]}),e.jsx("a",{href:i,download:"cropped-screenshot.png",className:"download-btn",children:"Download Cropped Image"})]})]}),e.jsx(vc,{isOpen:t,image:r,onCrop:h,onCancel:v})]})};const wc=()=>e.jsxs("div",{className:"test-crop-page",children:[e.jsxs("div",{className:"test-header",children:[e.jsx("h1",{children:"üß™ Print Crop Tool Test"}),e.jsx("p",{children:"Testing the new standalone crop tool for print-ready screenshots"}),e.jsxs("div",{className:"test-info",children:[e.jsx("h3",{children:"What to test:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"‚úÖ Upload a screenshot image"}),e.jsx("li",{children:"‚úÖ Drag the crop box to move it"}),e.jsx("li",{children:"‚úÖ Use corner handles (crosshair cursor) to resize"}),e.jsx("li",{children:"‚úÖ Check print size validation (green checkmarks)"}),e.jsx("li",{children:"‚úÖ Apply crop and download result"})]})]})]}),e.jsx(yc,{}),e.jsx("div",{className:"test-footer",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," This is a test page. Remove the route and import when done testing."]})})]});class jc{static async getCreatorEarnings(){try{const{data:{user:s}}=await R.auth.getUser();if(!s)throw new Error("User not authenticated");const{data:r,error:a}=await R.from("users").select(`
          total_earnings,
          pending_payout,
          payout_enabled,
          paypal_email,
          last_payout_date,
          payout_threshold
        `).eq("id",s.id).single();if(a)throw a;const{data:i,error:n}=await R.from("creator_earnings").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(10);if(n)throw n;const{data:l,error:h}=await R.from("payouts").select("*").eq("user_id",s.id).order("payout_date",{ascending:!1}).limit(5);if(h)throw h;return{success:!0,data:{user:r,recentEarnings:i||[],recentPayouts:l||[]}}}catch(s){return console.error("Error getting creator earnings:",s),{success:!1,error:s.message}}}static async updatePaypalEmail(s){try{const{data:{user:r}}=await R.auth.getUser();if(!r)throw new Error("User not authenticated");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))throw new Error("Please enter a valid PayPal email address");const{error:i}=await R.from("users").update({paypal_email:s,payout_enabled:!0,updated_at:new Date().toISOString()}).eq("id",r.id);if(i)throw i;return{success:!0,message:"PayPal email updated successfully"}}catch(r){return console.error("Error updating PayPal email:",r),{success:!1,error:r.message}}}static async updateTaxInfo(s){try{const{data:{user:r}}=await R.auth.getUser();if(!r)throw new Error("User not authenticated");const{error:a}=await R.from("users").update({tax_id:s,tax_info_verified:!0,updated_at:new Date().toISOString()}).eq("id",r.id);if(a)throw a;return{success:!0,message:"Tax information updated successfully"}}catch(r){return console.error("Error updating tax info:",r),{success:!1,error:r.message}}}static getPayoutSchedule(){return{frequency:"monthly",day:1,minimumAmount:50,processingDays:3,fees:{paypal:.029,platform:.3}}}static getNextPayoutDate(){const s=new Date;return new Date(s.getFullYear(),s.getMonth()+1,1)}static isEligibleForPayout(s){const r=this.getPayoutSchedule();return s>=r.minimumAmount}static formatCurrency(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s)}static async getEarningsSummary(){try{const{data:{user:s}}=await R.auth.getUser();if(!s)throw new Error("User not authenticated");const r=new Date;r.setDate(1),r.setHours(0,0,0,0);const{data:a,error:i}=await R.from("creator_earnings").select("creator_share").eq("user_id",s.id).gte("created_at",r.toISOString());if(i)throw i;const n=a.reduce((v,S)=>v+S.creator_share,0),{data:l,error:h}=await R.from("users").select("total_earnings, pending_payout, payout_enabled").eq("id",s.id).single();if(h)throw h;return{success:!0,data:{monthlyEarnings:n,totalEarnings:l.total_earnings||0,pendingPayout:l.pending_payout||0,payoutEnabled:l.payout_enabled||!1,nextPayoutDate:this.getNextPayoutDate(),isEligible:this.isEligibleForPayout(l.pending_payout||0)}}}catch(s){return console.error("Error getting earnings summary:",s),{success:!1,error:s.message}}}}const fa=({onComplete:t,onSkip:s,onClose:r})=>{const[a,i]=c.useState("paypal"),[n,l]=c.useState(""),[h,v]=c.useState(""),[S,b]=c.useState(!1),[_,m]=c.useState(null),[x,C]=c.useState(1),[M,y]=c.useState(""),[L,Y]=c.useState(""),[J,F]=c.useState("checking"),[H,K]=c.useState(""),[O,re]=c.useState(""),[Z,X]=c.useState("US"),[z,B]=c.useState([{method_name:"paypal",display_name:"PayPal Business",description:"Fast, secure PayPal Business payments with low fees",fees_percentage:2.9,fees_fixed:.3,processing_time_days:1,min_payout:50,is_available:!0},{method_name:"stripe",display_name:"Stripe Connect",description:"Professional payment processing with advanced features",fees_percentage:2.9,fees_fixed:.3,processing_time_days:2,min_payout:25,is_available:!0},{method_name:"ach",display_name:"Direct Bank Transfer",description:"Direct deposit to your bank account with minimal fees",fees_percentage:.5,fees_fixed:.25,processing_time_days:3,min_payout:50,is_available:!0}]);c.useEffect(()=>{p(),u()},[]);const u=async()=>{console.log("üîÑ Loading available payment methods...");const w=[{method_name:"paypal",display_name:"PayPal Business",description:"Fast, secure PayPal Business payments with low fees",fees_percentage:2.9,fees_fixed:.3,processing_time_days:1,min_payout:50,is_available:!0},{method_name:"stripe",display_name:"Stripe Connect",description:"Professional payment processing with advanced features",fees_percentage:2.9,fees_fixed:.3,processing_time_days:2,min_payout:25,is_available:!0},{method_name:"ach",display_name:"Direct Bank Transfer",description:"Direct deposit to your bank account with minimal fees",fees_percentage:.5,fees_fixed:.25,processing_time_days:3,min_payout:50,is_available:!0}];console.log("‚úÖ Setting fallback payment methods:",w),B(w),setTimeout(()=>{console.log("üîç State after setting methods:",z)},100);try{const{data:P,error:Q}=await R.rpc("get_user_payment_methods",{user_country:"US"});!Q&&P&&P.length>0?(console.log("‚úÖ Database payment methods loaded:",P),B(P)):console.log("‚ÑπÔ∏è Database function not available, using fallback methods")}catch(P){console.log("‚ÑπÔ∏è Database error, using fallback methods:",P.message)}},p=async()=>{try{const w=localStorage.getItem("user_authenticated")==="true",P=localStorage.getItem("user_email");if(!w||!P){console.log("‚ùå User not authenticated in localStorage");return}const{data:Q,error:me}=await R.from("users").select("id, paypal_email, tax_id, payout_enabled, preferred_payment_method, ach_routing_number, ach_account_type, stripe_connect_account_id").eq("email",P).single();Q&&(l(Q.paypal_email||""),v(Q.tax_id||""),i(Q.preferred_payment_method||"paypal"),y(Q.ach_routing_number||""),F(Q.ach_account_type||"checking"),re(Q.stripe_connect_account_id||""))}catch(w){console.error("Error loading payment info:",w)}},N=w=>{i(w),m(null)},j=()=>{if(a==="paypal"){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n))throw new Error("Please enter a valid PayPal email address")}else if(a==="ach"){if(!M||M.length!==9)throw new Error("Please enter a valid 9-digit routing number");if(!L||L.length<4)throw new Error("Please enter a valid account number");if(!H.trim())throw new Error("Please enter the account holder name")}else if(a==="stripe"&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(O))throw new Error("Please enter a valid email for Stripe Connect")},o=async w=>{w.preventDefault(),b(!0),m(null);try{if(new URLSearchParams(window.location.search).get("flow")==="new_user"){localStorage.setItem("pending_payment_method",a),a==="paypal"?localStorage.setItem("pending_paypal_email",n):a==="ach"?localStorage.setItem("pending_ach_info",JSON.stringify({routing:M,account:L,type:J,name:H})):a==="stripe"&&localStorage.setItem("pending_stripe_email",O),C(2);return}const Q=localStorage.getItem("user_authenticated")==="true",me=localStorage.getItem("user_email");if(!Q||!me)throw new Error("User not authenticated");const{data:ae,error:we}=await R.from("users").select("id").eq("email",me).single();if(we||!ae)throw new Error("User not found in database");j();const fe={preferred_payment_method:a,payout_enabled:!0,updated_at:new Date().toISOString()};a==="paypal"?fe.paypal_email=n:a==="ach"?(fe.ach_routing_number=M,fe.ach_account_type=J,fe.ach_account_number_encrypted=btoa(L),fe.bank_account_verified=!1):a==="stripe"&&(fe.stripe_connect_account_id=O,fe.stripe_connect_status="pending");const{error:Se}=await R.from("users").update(fe).eq("id",ae.id);if(Se)throw Se;C(2)}catch(P){m(P.message)}finally{b(!1)}},f=async w=>{w.preventDefault(),b(!0),m(null);try{const P=localStorage.getItem("user_authenticated")==="true",Q=localStorage.getItem("user_email");if(!P||!Q)throw new Error("User not authenticated");const{data:me,error:ae}=await R.from("users").select("id").eq("email",Q).single();if(ae||!me)throw new Error("User not found in database");const{error:we}=await R.from("users").update({tax_id:h,tax_info_verified:!1,updated_at:new Date().toISOString()}).eq("id",me.id);if(we)throw we;t&&t()}catch(P){m(P.message)}finally{b(!1)}},g=()=>{s&&s()},T=()=>{switch(a){case"paypal":return e.jsx("div",{className:"payment-form",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"paypal-email",children:"PayPal Business Email"}),e.jsx("input",{type:"email",id:"paypal-email",value:n,onChange:w=>l(w.target.value),placeholder:"your-business@paypal.com",required:!0}),e.jsx("small",{children:"Make sure this is a PayPal Business account"})]})});case"ach":return e.jsxs("div",{className:"payment-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ach-account-name",children:"Account Holder Name"}),e.jsx("input",{type:"text",id:"ach-account-name",value:H,onChange:w=>K(w.target.value),placeholder:"John Doe",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ach-routing",children:"Routing Number"}),e.jsx("input",{type:"text",id:"ach-routing",value:M,onChange:w=>y(w.target.value),placeholder:"123456789",maxLength:"9",required:!0}),e.jsx("small",{children:"9-digit routing number from your bank"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ach-account",children:"Account Number"}),e.jsx("input",{type:"text",id:"ach-account",value:L,onChange:w=>Y(w.target.value),placeholder:"1234567890",required:!0}),e.jsx("small",{children:"Your bank account number"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ach-type",children:"Account Type"}),e.jsxs("select",{id:"ach-type",value:J,onChange:w=>F(w.target.value),required:!0,children:[e.jsx("option",{value:"checking",children:"Checking"}),e.jsx("option",{value:"savings",children:"Savings"})]})]})]});case"stripe":return e.jsxs("div",{className:"payment-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"stripe-email",children:"Email for Stripe Connect"}),e.jsx("input",{type:"email",id:"stripe-email",value:O,onChange:w=>re(w.target.value),placeholder:"your-email@example.com",required:!0}),e.jsx("small",{children:"This email will be used to set up your Stripe Connect account"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"stripe-country",children:"Country"}),e.jsxs("select",{id:"stripe-country",value:Z,onChange:w=>X(w.target.value),required:!0,children:[e.jsx("option",{value:"US",children:"United States"}),e.jsx("option",{value:"CA",children:"Canada"}),e.jsx("option",{value:"GB",children:"United Kingdom"}),e.jsx("option",{value:"AU",children:"Australia"}),e.jsx("option",{value:"DE",children:"Germany"}),e.jsx("option",{value:"FR",children:"France"})]})]})]});default:return null}},d=()=>{const w=z.find(P=>P.method_name===a);return w?e.jsxs("div",{className:"payment-benefits",children:[e.jsxs("h4",{children:["Why ",w.display_name,"?"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:["‚úÖ ",w.description]}),e.jsxs("li",{children:["‚úÖ Processing time: ",w.processing_time_days," business day(s)"]}),e.jsxs("li",{children:["‚úÖ Minimum payout: $",w.min_payout]}),e.jsxs("li",{children:["‚úÖ Fees: ",w.fees_percentage,"% + $",w.fees_fixed]})]})]}):null};return console.log("üéØ RENDERING PaymentSetup. availableMethods:",z,"length:",z.length),e.jsx("div",{className:"payment-setup-container",children:e.jsxs("div",{className:"payment-setup-card",children:[e.jsxs("div",{className:"payment-setup-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx("h2",{children:"üí∞ Connect Payment Method"}),e.jsx("p",{children:"Please connect your payment method to receive payouts"})]}),r&&e.jsx("button",{className:"payment-setup-close-btn",onClick:r,"aria-label":"Close payment setup",children:"‚úï"})]}),x===1&&e.jsxs("div",{className:"payment-step",children:[e.jsxs("div",{className:"step-indicator",children:[e.jsx("span",{className:"step active",children:"1"}),e.jsx("span",{className:"step",children:"2"})]}),e.jsx("h3",{children:"Connect Payment Method"}),e.jsx("p",{children:"Please connect your payment method to receive payouts"}),e.jsxs("div",{className:"payment-method-selection",children:[console.log("üîç Rendering payment methods. availableMethods:",z),z.length===0?e.jsx("div",{className:"loading-methods",children:e.jsx("p",{children:"Loading payment methods..."})}):z.map(w=>e.jsxs("div",{className:`payment-method-option ${a===w.method_name?"selected":""} ${w.is_available?"":"unavailable"}`,onClick:()=>w.is_available&&N(w.method_name),children:[e.jsxs("div",{className:"method-header",children:[e.jsx("input",{type:"radio",name:"payment-method",id:w.method_name,value:w.method_name,checked:a===w.method_name,onChange:()=>w.is_available&&N(w.method_name),disabled:!w.is_available}),e.jsxs("label",{htmlFor:w.method_name,children:[e.jsx("span",{className:"method-name",children:w.display_name}),!w.is_available&&e.jsx("span",{className:"unavailable-badge",children:"Not Available"})]})]}),e.jsxs("div",{className:"method-details",children:[e.jsxs("span",{className:"fees",children:[w.fees_percentage,"% + $",w.fees_fixed]}),e.jsxs("span",{className:"processing-time",children:[w.processing_time_days," day(s)"]})]})]},w.method_name))]}),T(),d(),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"submit-btn",onClick:o,disabled:S,children:S?"Processing...":"Connect Payment Method"})}),_&&e.jsx("div",{className:"error-message",children:_})]}),x===2&&e.jsxs("div",{className:"payment-step",children:[e.jsxs("div",{className:"step-indicator",children:[e.jsx("span",{className:"step completed",children:"1"}),e.jsx("span",{className:"step active",children:"2"})]}),e.jsx("h3",{children:"Connect Payment Method"}),e.jsx("p",{children:"Please connect your payment method to receive payouts"}),e.jsxs("form",{onSubmit:f,className:"payment-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payment-email",children:"Payment Email"}),e.jsx("input",{type:"email",id:"payment-email",value:h,onChange:w=>v(w.target.value),placeholder:"your-email@example.com",required:!0}),e.jsx("small",{children:"Enter the email associated with your payment method (PayPal, Stripe, etc.)"}),e.jsxs("div",{className:"security-notice",children:[e.jsx("div",{className:"security-icon",children:"üîí"}),e.jsxs("div",{className:"security-text",children:[e.jsx("strong",{children:"Security Notice:"})," Your payment information is securely handled through trusted third-party processors. We never store sensitive payment details."]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"submit-btn",disabled:S,children:S?"Processing...":"Connect Payment Method"}),e.jsx("button",{type:"button",className:"skip-btn",onClick:g,disabled:S,children:"Skip for Now"})]}),_&&e.jsx("div",{className:"error-message",children:_})]})]})]})})},Sc=()=>{var b,_,m,x,C,M,y,L,Y,J;const[t,s]=c.useState(null),[r,a]=c.useState(null),[i,n]=c.useState(!0),[l,h]=c.useState(!1),v=Oe();c.useEffect(()=>{(async()=>{try{const{data:{user:H},error:K}=await R.auth.getUser();if(!H){v("/");return}s(H),await S()}catch(H){console.error("Error fetching user data:",H),v("/")}finally{n(!1)}})()},[v]);const S=async()=>{try{console.log("üí∞ Starting payment data fetch...");const F=await jc.getCreatorEarnings();F.success?(console.log("üí∞ Payment data received:",F.data),a(F.data)):console.error("‚ùå Failed to fetch payment data:",F.error)}catch(F){console.error("‚ùå Error fetching payment data:",F)}};return i?e.jsx("div",{className:"payment-portal-container",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading payment portal..."})]})}):t?e.jsxs("div",{className:"payment-portal-container",children:[e.jsxs("div",{className:"payment-portal-header",children:[e.jsx("button",{className:"back-button",onClick:()=>v(-1),children:"‚Üê Back"}),e.jsx("h1",{children:"üí∞ Connect Payment Method"}),e.jsx("p",{children:"Please connect your payment method to receive payouts"})]}),e.jsx("div",{className:"payment-status-section",children:e.jsxs("div",{className:"payment-status-cards",children:[e.jsxs("div",{className:"status-card",children:[e.jsx("h4",{children:"üìã Payment Method"}),e.jsx("div",{className:"status-indicator",children:(b=r==null?void 0:r.user)!=null&&b.payout_enabled?e.jsx("span",{className:"status-success",children:"‚úÖ Complete"}):e.jsx("span",{className:"status-warning",children:"‚ö†Ô∏è Not Set Up"})}),((_=r==null?void 0:r.user)==null?void 0:_.paypal_email)&&e.jsxs("p",{className:"status-detail",children:["PayPal: ",r.user.paypal_email]})]}),e.jsxs("div",{className:"status-card",children:[e.jsx("h4",{children:"üí∞ Total Earnings"}),e.jsxs("div",{className:"earnings-amount",children:["$",((x=(m=r==null?void 0:r.user)==null?void 0:m.total_earnings)==null?void 0:x.toFixed(2))||"0.00"]}),e.jsx("p",{className:"status-detail",children:"Lifetime earnings"})]}),e.jsxs("div",{className:"status-card",children:[e.jsx("h4",{children:"üí∏ Pending Payout"}),e.jsxs("div",{className:"pending-amount",children:["$",((M=(C=r==null?void 0:r.user)==null?void 0:C.pending_payout)==null?void 0:M.toFixed(2))||"0.00"]}),e.jsx("p",{className:"status-detail",children:((y=r==null?void 0:r.user)==null?void 0:y.pending_payout)>=50?"Ready for payout":"Min $50 required"})]}),e.jsxs("div",{className:"status-card",children:[e.jsx("h4",{children:"üìÖ Next Payout"}),e.jsx("div",{className:"payout-date",children:(L=r==null?void 0:r.user)!=null&&L.last_payout_date?new Date(r.user.last_payout_date).toLocaleDateString():"Not scheduled"}),e.jsx("p",{className:"status-detail",children:"Monthly on the 1st"})]})]})}),e.jsxs("div",{className:"payment-setup-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"üîß Payment Method Required"}),!((Y=r==null?void 0:r.user)!=null&&Y.payout_enabled)&&e.jsx("button",{className:"setup-payment-btn",onClick:()=>h(!0),children:"Connect Payment Method"})]}),l?e.jsx("div",{className:"payment-setup-modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h4",{children:"Connect Payment Method"}),e.jsx("button",{className:"close-btn",onClick:()=>h(!1),children:"√ó"})]}),e.jsx(fa,{onComplete:()=>{h(!1),S()},onSkip:()=>h(!1),onClose:()=>h(!1)})]})}):e.jsx("div",{className:"setup-info",children:(J=r==null?void 0:r.user)!=null&&J.payout_enabled?e.jsxs("div",{className:"setup-complete",children:[e.jsx("p",{children:"‚úÖ Your payment method is connected and ready to receive payouts."}),e.jsx("button",{className:"edit-payment-btn",onClick:()=>h(!0),children:"Edit Payment Method"})]}):e.jsxs("div",{className:"setup-required",children:[e.jsx("p",{children:"‚ö†Ô∏è Complete your tax information to receive payouts"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Connect your payment method"}),e.jsx("li",{children:"Complete payment setup"}),e.jsx("li",{children:"Set up automatic monthly payouts"})]})]})})]}),(r==null?void 0:r.recentEarnings)&&r.recentEarnings.length>0&&e.jsxs("div",{className:"recent-earnings-section",children:[e.jsx("h3",{children:"üìà Recent Earnings"}),e.jsx("div",{className:"earnings-list",children:r.recentEarnings.map((F,H)=>{var K;return e.jsxs("div",{className:"earning-item",children:[e.jsxs("div",{className:"earning-info",children:[e.jsxs("span",{className:"earning-amount",children:["$",(K=F.amount)==null?void 0:K.toFixed(2)]}),e.jsx("span",{className:"earning-date",children:new Date(F.created_at).toLocaleDateString()})]}),e.jsx("div",{className:"earning-source",children:F.source||"Product Sale"})]},H)})})]}),(r==null?void 0:r.recentPayouts)&&r.recentPayouts.length>0&&e.jsxs("div",{className:"recent-payouts-section",children:[e.jsx("h3",{children:"üí∏ Recent Payouts"}),e.jsx("div",{className:"payouts-list",children:r.recentPayouts.map((F,H)=>{var K;return e.jsxs("div",{className:"payout-item",children:[e.jsxs("div",{className:"payout-info",children:[e.jsxs("span",{className:"payout-amount",children:["$",(K=F.amount)==null?void 0:K.toFixed(2)]}),e.jsx("span",{className:"payout-date",children:new Date(F.payout_date).toLocaleDateString()})]}),e.jsx("div",{className:"payout-status",children:e.jsx("span",{className:`status-badge ${F.status}`,children:F.status})})]},H)})})]}),e.jsxs("div",{className:"payment-info-section",children:[e.jsx("h3",{children:"‚ÑπÔ∏è Payment Method"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-card",children:[e.jsx("h4",{children:"üí∞ Payment Method"}),e.jsx("p",{children:"Connect payment method to receive payouts"})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h4",{children:"üìÖ Payout Schedule"}),e.jsx("p",{children:"Payouts are processed monthly on the 1st of each month for earnings above $50.00."})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h4",{children:"üìä Tax Reporting"}),e.jsx("p",{children:"Complete tax forms to receive payouts"})]}),e.jsxs("div",{className:"info-card",children:[e.jsx("h4",{children:"üîí Security"}),e.jsx("p",{children:"Connect payment method to receive payouts"})]})]})]})]}):e.jsx("div",{className:"payment-portal-container",children:e.jsxs("div",{className:"error-container",children:[e.jsx("p",{children:"Please log in to access the payment portal."}),e.jsx("button",{onClick:()=>v("/"),children:"Go Home"})]})})};const bc=()=>{const t=Oe(),[s,r]=c.useState([]),[a,i]=c.useState(0),[n,l]=c.useState({cost:0,method:"Standard Shipping",loading:!1,error:"",calculated:!1}),[h,v]=c.useState({country_code:"US",zip:""}),S=c.useRef(n);c.useEffect(()=>{S.current=n},[n]),c.useEffect(()=>{try{const _=localStorage.getItem("cart_items"),m=_?JSON.parse(_):[];r(m),i(m.reduce((x,C)=>x+(C.price||0)*(C.qty||1),0))}catch{r([]),i(0)}},[]);const b=c.useCallback(async()=>{if(s.length!==0){l(_=>({..._,loading:!0,error:""}));try{const _=String(h.zip||"").trim(),m=String(h.country_code||"US").trim(),x={shipping_address:{zip:_,country_code:m},cart:s.map(y=>({variant_id:y.printify_variant_id||y.printful_variant_id||1,quantity:y.qty||1}))};console.log("üöÄ Calling shipping API:",Me.ENDPOINTS.CALCULATE_SHIPPING),console.log("üöÄ Payload:",x);const C=await fetch(Me.ENDPOINTS.CALCULATE_SHIPPING,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(console.log("üì¶ Response status:",C.status),console.log("üì¶ Response URL:",C.url),C.status===404)throw new Error(`Shipping API endpoint not found (404). Please verify the backend is deployed and the endpoint exists at: ${Me.ENDPOINTS.CALCULATE_SHIPPING}`);if(!C.ok){const y=await C.text();console.error("‚ùå API Error Response:",y);let L;try{L=JSON.parse(y)}catch{L={error:y||`HTTP ${C.status}: ${C.statusText}`}}throw new Error(L.error||`API returned status ${C.status}`)}const M=await C.json();if(console.log("üì¶ Shipping calculation response:",M),console.log("üì¶ Response success:",M==null?void 0:M.success),console.log("üì¶ Response shipping_cost:",M==null?void 0:M.shipping_cost),console.log("üì¶ Response type:",typeof(M==null?void 0:M.shipping_cost)),M&&M.success===!0){let y=M.shipping_cost;if(y==null&&(y=M.cost||M.price||M.amount),y=parseFloat(y),console.log("üì¶ Parsed shipping cost:",y),console.log("üì¶ Is valid number?",!isNaN(y)),console.log("üì¶ Is greater than 0?",y>0),!isNaN(y)&&y>0){console.log("‚úÖ Shipping calculated successfully:",y);const L={cost:y,method:M.shipping_method||M.method||"Standard Shipping",loading:!1,error:"",calculated:!0};console.log("‚úÖ Setting shipping state:",L),l(L),setTimeout(()=>{S.current=L,console.log("‚úÖ Shipping ref updated:",S.current)},100)}else{const L=(M==null?void 0:M.error)||`Invalid shipping cost received: ${M.shipping_cost}. Please verify your ZIP code and try again.`;console.error("‚ùå Shipping cost invalid:",y),console.error("‚ùå Full response:",M);const Y={cost:0,method:"",loading:!1,error:L,calculated:!1};l(Y),S.current=Y}}else{const y=(M==null?void 0:M.error)||"Unable to calculate shipping. Please verify your ZIP code and try again.";console.error("‚ùå Shipping calculation failed:",y),console.error("‚ùå Response data:",M),console.error("‚ùå Response success field:",M==null?void 0:M.success);const L={cost:0,method:"",loading:!1,error:y,calculated:!1};l(L),S.current=L}}catch(_){const m=_.message.includes("404")||_.message.includes("Not found")?"Shipping API endpoint not found. The backend may not be deployed. Please contact support.":`Network error: ${_.message}. Please check your connection and try again.`;console.error("‚ùå Shipping calculation exception:",_);const x={cost:0,method:"",loading:!1,error:m,calculated:!1};l(x),S.current=x}}},[s,h]);return c.useEffect(()=>{var _;if(h.zip&&h.zip.trim()&&h.zip.length>=5&&!n.calculated&&!n.loading&&s.length>0){console.log("‚è±Ô∏è Auto-calculating shipping in 800ms for ZIP:",h.zip);const m=setTimeout(()=>{console.log("üöÄ Triggering auto-calculate shipping..."),b()},800);return()=>clearTimeout(m)}else console.log("‚è∏Ô∏è Skipping auto-calculate:",{hasZip:!!(h.zip&&h.zip.trim()),zipLength:(_=h.zip)==null?void 0:_.length,calculated:n.calculated,loading:n.loading,itemsCount:s.length})},[h.zip,s.length,n.calculated,n.loading,b]),e.jsxs("div",{className:"checkout-container",children:[e.jsxs("div",{className:"checkout-header",children:[e.jsx("h1",{children:"Checkout"}),e.jsxs("div",{className:"checkout-progress",children:[e.jsx("div",{className:"progress-step active",children:"1. Review"}),e.jsx("div",{className:"progress-step",children:"2. Payment"}),e.jsx("div",{className:"progress-step",children:"3. Complete"})]})]}),s.length===0?e.jsxs("div",{className:"empty-cart",children:[e.jsx("div",{className:"empty-cart-icon",children:"üõí"}),e.jsx("h2",{children:"Your cart is empty"}),e.jsx("p",{children:"Add some items to your cart to continue"}),e.jsx("button",{className:"btn-primary",onClick:()=>t(-1),children:"Continue Shopping"})]}):e.jsxs("div",{className:"checkout-content",children:[e.jsxs("div",{className:"checkout-main",children:[e.jsxs("div",{className:"order-section",children:[e.jsx("h2",{children:"Order Items"}),e.jsx("div",{className:"items-list",children:s.map((_,m)=>{const x=_.screenshot||_.selected_screenshot||_.thumbnail||_.image||_.img;return e.jsxs("div",{className:"item-card",children:[e.jsxs("div",{className:"item-details",children:[e.jsx("h3",{className:"item-name",children:_.name||_.product}),e.jsxs("div",{className:"item-variants",children:[_.color," ‚Ä¢ ",_.size]})]}),e.jsxs("div",{className:"item-price",children:["$",(_.price||0).toFixed(2)]}),x&&e.jsx("div",{className:"item-image",children:e.jsx("img",{src:x,alt:_.name||_.product})})]},m)})})]}),e.jsxs("div",{className:"order-section",children:[e.jsx("h2",{children:"Shipping Information"}),e.jsxs("div",{className:"shipping-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ZIP / Postal Code"}),e.jsx("input",{type:"text",placeholder:"Enter ZIP code",value:h.zip,onChange:_=>v(m=>({...m,zip:_.target.value})),className:"form-input","aria-label":"ZIP or Postal Code","aria-describedby":"zip-help"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Country"}),e.jsxs("select",{value:h.country_code,onChange:_=>v(m=>({...m,country_code:_.target.value})),className:"form-select","aria-label":"Country",children:[e.jsx("option",{value:"US",children:"United States"}),e.jsx("option",{value:"CA",children:"Canada"}),e.jsx("option",{value:"GB",children:"United Kingdom"}),e.jsx("option",{value:"AU",children:"Australia"}),e.jsx("option",{value:"DE",children:"Germany"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"¬†"}),e.jsx("button",{className:"btn-primary",onClick:()=>{if(!h.zip||!h.zip.trim()){alert("‚ö†Ô∏è Please enter your ZIP / Postal Code first.");return}l(_=>({..._,error:"",loading:!0})),b()},id:"calc-shipping-btn",disabled:n.loading||!h.zip||!h.zip.trim(),style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"700",border:"none",fontSize:"1rem",padding:"16px 20px",borderRadius:"12px",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:"0 8px 32px rgba(102, 126, 234, 0.3)",cursor:n.loading||!h.zip||!h.zip.trim()?"not-allowed":"pointer",opacity:n.loading||!h.zip||!h.zip.trim()?.6:1},onMouseEnter:_=>{!n.loading&&h.zip&&h.zip.trim()&&(_.target.style.transform="translateY(-3px)",_.target.style.boxShadow="0 12px 48px rgba(102, 126, 234, 0.4)")},onMouseLeave:_=>{!n.loading&&h.zip&&h.zip.trim()&&(_.target.style.transform="translateY(0)",_.target.style.boxShadow="0 8px 32px rgba(102, 126, 234, 0.3)")},children:n.loading?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),"Calculating‚Ä¶"]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{fontSize:"1rem",marginRight:"6px"},children:"üöö"}),"Calculate Shipping"]})})]})]}),n.error&&e.jsxs("div",{className:"error-message",style:{background:"#f8d7da",color:"#721c24",padding:"12px",borderRadius:"8px",marginTop:"10px",border:"1px solid #f5c6cb"},children:["‚ùå ",n.error]}),n.loading&&e.jsx("div",{style:{background:"#d1ecf1",color:"#0c5460",padding:"12px",borderRadius:"8px",marginTop:"10px",border:"1px solid #bee5eb",textAlign:"center"},children:"‚è≥ Calculating shipping..."}),n.calculated&&n.cost>0&&e.jsxs("div",{className:"shipping-result",style:{background:"#d4edda",color:"#155724",padding:"12px",borderRadius:"8px",marginTop:"10px",border:"1px solid #c3e6cb"},children:[e.jsxs("div",{className:"shipping-method",children:["‚úì ",n.method]}),e.jsxs("div",{className:"shipping-cost",children:["$",n.cost.toFixed(2)]})]}),!n.calculated&&!n.loading&&!n.error&&h.zip&&h.zip.trim()&&e.jsx("div",{style:{color:"#856404",padding:"8px",fontSize:"0.9rem",textAlign:"center"},children:'‚ö†Ô∏è Click "Calculate Shipping" or wait for auto-calculation...'})]})]})]}),e.jsxs("div",{className:"order-summary",children:[e.jsx("h2",{children:"Order Summary"}),e.jsxs("div",{className:"summary-line",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$",a.toFixed(2)]})]}),e.jsxs("div",{className:"summary-line",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:["$",n.cost.toFixed(2)]})]}),e.jsxs("div",{className:"summary-line total",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",(a+(n.cost||0)).toFixed(2)]})]}),e.jsxs("div",{className:"checkout-actions",children:[e.jsx("button",{className:"btn-outline",onClick:()=>t(-1),children:"Continue Shopping"}),e.jsxs("button",{className:"btn-primary btn-large",disabled:!h.zip||!h.zip.trim()||n.loading,style:{opacity:!h.zip||!h.zip.trim()||n.loading?.5:1,cursor:!h.zip||!h.zip.trim()||n.loading?"not-allowed":"pointer"},title:!h.zip||!h.zip.trim()?"Please enter ZIP code":n.loading?"Calculating shipping...":"Ready to checkout",onClick:async _=>{var J,F,H,K,O,re;const m=document.querySelector('input[aria-label="ZIP or Postal Code"]'),x=String((m==null?void 0:m.value)??h.zip??"").trim(),C=String(h.country_code||"US").trim();if(!x){alert("‚ö†Ô∏è Please enter your ZIP / Postal Code before proceeding.");return}if(n.loading){alert("‚ö†Ô∏è Please wait for shipping calculation to complete.");return}const M=S.current,y=M.cost||0;console.log("üîç Proceeding with checkout:",{zip:x,shippingCost:y,shippingCalculated:M.calculated});const L=_.target,Y=L.innerHTML;L.innerHTML='<span className="loading-spinner"></span>Processing Order...',L.disabled=!0;try{if(!x){alert("‚ö†Ô∏è ZIP / Postal Code is required. Please enter your ZIP code."),L.innerHTML=Y,L.disabled=!1;return}const Z={zip:String(x).trim(),country_code:String(C||"US").trim()};let X=null;for(const j of s)if(X=j.screenshot||j.selected_screenshot||j.thumbnail||j.img,X&&X.trim())break;if(!X)try{const j=localStorage.getItem("pending_merch_data");if(j){const o=JSON.parse(j);o.screenshots&&Array.isArray(o.screenshots)&&o.screenshots.length>0?X=o.screenshots[0]:o.thumbnail&&(X=o.thumbnail)}}catch(j){console.warn("Could not load screenshot from localStorage:",j)}console.log("üì∏ Selected screenshot found:",X?"Yes":"No");const z=s.map(j=>{const f=j.screenshot||j.selected_screenshot||j.thumbnail||j.img||X||null;return{product:j.product||j.name,variants:{color:j.color||"Default",size:j.size||"Default"},price:j.price||0,selected_screenshot:f}});console.log("üì∏ Cart items with screenshots:",z.map(j=>({product:j.product,has_screenshot:!!j.selected_screenshot,screenshot_type:j.selected_screenshot?j.selected_screenshot.startsWith("data:image")?"base64":j.selected_screenshot.startsWith("http")?"URL":"other":"none"})));const B={shipping_address:Z,cart:z,product_id:((J=s[0])==null?void 0:J.product_id)||((F=s[0])==null?void 0:F.id)||null,sms_consent:!1,shipping_cost:y,videoUrl:((H=s[0])==null?void 0:H.video_url)||null,videoTitle:((K=s[0])==null?void 0:K.video_title)||null,creatorName:((O=s[0])==null?void 0:O.creator_name)||null};if(X){const j=String(X);j.startsWith("http")||j.startsWith("https")?(B.selected_screenshot=X,console.log("üì∏ Added screenshot URL to payload")):j.startsWith("data:image")?console.warn(`‚ö†Ô∏è Screenshot is base64 (${Math.round(j.length/1024)}KB), excluding from payload. Backend will extract from cart items.`):console.warn(`‚ö†Ô∏è Screenshot format unknown, excluding from payload: ${j.substring(0,50)}...`)}if(!B.shipping_address||!B.shipping_address.zip){console.error("‚ùå CRITICAL: shipping_address missing from payload!",B),alert("‚ö†Ô∏è Error: Shipping address is missing. Please refresh and try again."),L.innerHTML=Y,L.disabled=!1;return}console.log("üîç FINAL checkout payload to /api/create-checkout-session:",B),console.log("üîç ZIP value being sent:",x),console.log("üîç Country value being sent:",C),console.log("üîç Shipping address object:",B.shipping_address),console.log("üîç Shipping address keys:",Object.keys(B.shipping_address||{})),console.log("üîç Shipping address zip check:",(re=B.shipping_address)==null?void 0:re.zip);const u=JSON.stringify(B);console.log("üîç JSON payload length:",u.length),console.log("üîç JSON string includes shipping_address:",u.includes("shipping_address")),console.log("üîç JSON string includes zip:",u.includes("zip")),console.log("üîç JSON string includes zip value:",u.includes(x)),console.log("üîç API Endpoint:",Me.ENDPOINTS.CREATE_CHECKOUT_SESSION),console.log("üîç Sending POST request to backend...");const p=await fetch(Me.ENDPOINTS.CREATE_CHECKOUT_SESSION,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:u});if(console.log("üîç Response status:",p.status),console.log("üîç Response URL:",p.url),!p.ok){const j=await p.text();console.error("‚ùå Backend Error Response:",j),console.error("‚ùå Response Status:",p.status),console.error("‚ùå Response URL:",p.url),console.error("‚ùå Response Headers:",Object.fromEntries(p.headers.entries())),console.error("‚ùå Request Payload Sent:",B),console.error("‚ùå ZIP Code Sent:",x),console.error("‚ùå Shipping Address Sent:",B.shipping_address);let o;try{o=JSON.parse(j),console.error("‚ùå Parsed Error Data:",o)}catch(g){o={error:j||`HTTP ${p.status}: ${p.statusText}`},console.error("‚ùå Could not parse error as JSON:",g)}const f=o.error||o.message||o.details||`API returned status ${p.status}`;throw console.error("‚ùå Final Error Message:",f),alert(`‚ö†Ô∏è Checkout Error: ${f}`),new Error(f)}const N=await p.json();if(N!=null&&N.url){try{localStorage.removeItem("cart"),localStorage.removeItem("cart_items"),localStorage.removeItem("cartData"),localStorage.removeItem("persistent_cart"),Object.keys(localStorage).forEach(j=>{j.toLowerCase().includes("cart")&&localStorage.removeItem(j)}),Object.keys(sessionStorage).forEach(j=>{j.toLowerCase().includes("cart")&&sessionStorage.removeItem(j)}),console.log("üõí Cart cleared before redirecting to Stripe checkout")}catch(j){console.error("Error clearing cart:",j)}window.location.href=N.url}else try{const j=await fetch(Me.ENDPOINTS.PLACE_ORDER,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:u});if(!j.ok){const f=await j.text();let g;try{g=JSON.parse(f)}catch{g={error:f||`HTTP ${j.status}: ${j.statusText}`}}throw new Error(g.error||g.message||`API returned status ${j.status}`)}const o=await j.json();if(o!=null&&o.next_url){try{localStorage.removeItem("cart"),localStorage.removeItem("cart_items"),localStorage.removeItem("cartData"),localStorage.removeItem("persistent_cart"),Object.keys(localStorage).forEach(f=>{f.toLowerCase().includes("cart")&&localStorage.removeItem(f)}),Object.keys(sessionStorage).forEach(f=>{f.toLowerCase().includes("cart")&&sessionStorage.removeItem(f)}),console.log("üõí Cart cleared before redirecting to Stripe checkout (fallback)")}catch(f){console.error("Error clearing cart:",f)}window.location.href=o.next_url}else L.innerHTML=Y,L.disabled=!1,alert((N==null?void 0:N.error)||(o==null?void 0:o.error)||"Failed to start checkout")}catch{L.innerHTML=Y,L.disabled=!1,alert("Network error starting checkout")}}catch(Z){console.error("‚ùå Checkout error:",Z),L.innerHTML=Y,L.disabled=!1,alert(`‚ö†Ô∏è Checkout error: ${Z.message||"Network error starting checkout"}`)}},children:[e.jsx("span",{children:"Place Order"}),e.jsx("span",{className:"btn-icon",children:"‚Üí"})]})]})]})]})]})};const _c=()=>{const t=Oe(),s=zt(),[r,a]=c.useState(null),[i,n]=c.useState(!0);c.useEffect(()=>{(async()=>{try{const{data:{user:S},error:b}=await R.auth.getUser(),_=new URLSearchParams(window.location.search).get("flow")==="new_user";if(!S&&!_){t("/signup",{state:{from:s.pathname,message:"Please sign up to set up your payment information and start earning."}});return}a(S)}catch(S){console.error("Error checking authentication:",S),new URLSearchParams(window.location.search).get("flow")==="new_user"||t("/signup")}finally{n(!1)}})()},[t,s]);const l=()=>{new URLSearchParams(window.location.search).get("flow")==="new_user"?t("/signup",{state:{message:"Great! Your PayPal is set up. Now create your account to start earning!"}}):t("/dashboard",{state:{message:"Payment information set up successfully! You can now start earning with ScreenMerch - completely free!"}})},h=()=>{new URLSearchParams(window.location.search).get("flow")==="new_user"?t("/signup",{state:{message:"No problem! You can set up PayPal later. Let's create your account!"}}):t("/dashboard",{state:{message:"Welcome to ScreenMerch! You can set up payment information later in your dashboard to start earning."}})};return i?e.jsx("div",{className:"payment-setup-page",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading..."})]})}):e.jsxs("div",{className:"payment-setup-page",children:[e.jsxs("div",{className:"payment-setup-header",children:[e.jsx("h1",{children:"üí∞ Welcome to ScreenMerch!"}),e.jsx("p",{children:"Set up your payment information to start earning from your merchandise sales - It's completely free!"})]}),e.jsx(fa,{onComplete:l,onSkip:h})]})};const Nc=typeof import.meta<"u"&&{VITE_API_BASE_URL:"https://screenmerch.fly.dev",VITE_SUPABASE_URL:"https://sojxbydpcdcdzfdtbypd.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanhieWRwY2RjZHpmZHRieXBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTIwNTUsImV4cCI6MjA2NTQyODA1NX0.BUm9LKbNs-EdJKxwwtoY3IRyokmDtRbS0XP-WBw-5no",VITE_API_URL:"https://screenmerch.fly.dev",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&{}.VITE_BACKEND_URL||typeof process<"u"&&process.env&&{}.REACT_APP_BACKEND_URL||"https://screenmerch.fly.dev",Cc=()=>{const t=Oe(),[s]=yt(),[r,a]=c.useState(""),[i,n]=c.useState(""),[l,h]=c.useState(!1),[v,S]=c.useState(null),[b,_]=c.useState(null),[m,x]=c.useState(null);c.useEffect(()=>{const M=s.get("token"),y=s.get("email");!M||!y?S({type:"error",text:"Invalid verification link. Please check your email and try again."}):(_(M),x(y))},[s]);const C=async M=>{if(M.preventDefault(),S(null),!r){S({type:"error",text:"Please enter a password."});return}if(r.length<6){S({type:"error",text:"Password must be at least 6 characters long."});return}if(r!==i){S({type:"error",text:"Passwords do not match."});return}if(!b||!m){S({type:"error",text:"Invalid verification link."});return}try{h(!0);const y=await fetch(`${Nc}/api/auth/verify-email`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({token:b,email:m,password:r})}),Y=(y.headers.get("content-type")||"").includes("application/json");if(!y.ok){const F=await y.text();if(Y){let H;try{H=JSON.parse(F)}catch{throw new Error(`Server error ${y.status}`)}throw new Error((H==null?void 0:H.error)||`Server error: ${y.status}`)}else throw new Error(`Could not reach verification API (HTTP ${y.status}).`)}if(!Y)throw new Error("Unexpected response from server (not JSON).");const J=await y.json();J!=null&&J.token&&localStorage.setItem("auth_token",J.token),J!=null&&J.user&&localStorage.setItem("user",JSON.stringify(J.user)),localStorage.setItem("isAuthenticated","true"),S({type:"success",text:"Email verified and password set successfully! Redirecting..."}),setTimeout(()=>{t("/product/browse")},2e3)}catch(y){S({type:"error",text:(y==null?void 0:y.message)||"Verification failed. Please try again."})}finally{h(!1)}};return e.jsx("div",{className:"verify-email-page",children:e.jsxs("div",{className:"verify-email-card",children:[e.jsx("h2",{className:"verify-email-title",children:"Set Your Password"}),e.jsx("p",{className:"verify-email-subtitle",children:"Please create a password to complete your account setup"}),v&&e.jsx("div",{className:`verify-email-alert ${v.type==="error"?"verify-email-alert-error":"verify-email-alert-success"}`,role:"alert",children:v.text}),b&&m?e.jsxs("form",{className:"verify-email-form",onSubmit:C,noValidate:!0,children:[e.jsxs("div",{className:"verify-email-field",children:[e.jsx("label",{htmlFor:"email",className:"verify-email-label",children:"Email"}),e.jsx("input",{id:"email",type:"email",className:"verify-email-input",value:m,disabled:!0})]}),e.jsxs("div",{className:"verify-email-field",children:[e.jsx("label",{htmlFor:"password",className:"verify-email-label",children:"Password"}),e.jsx("input",{id:"password",type:"password",className:"verify-email-input",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",autoComplete:"new-password",value:r,onChange:M=>a(M.target.value),disabled:l,required:!0,minLength:6}),e.jsx("p",{className:"verify-email-hint",children:"Must be at least 6 characters"})]}),e.jsxs("div",{className:"verify-email-field",children:[e.jsx("label",{htmlFor:"confirmPassword",className:"verify-email-label",children:"Confirm Password"}),e.jsx("input",{id:"confirmPassword",type:"password",className:"verify-email-input",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",autoComplete:"new-password",value:i,onChange:M=>n(M.target.value),disabled:l,required:!0,minLength:6})]}),e.jsx("button",{type:"submit",className:"verify-email-submit-btn",disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),"Verifying..."]}):"Verify & Set Password"})]}):e.jsx("div",{className:"verify-email-error",children:e.jsx("p",{children:"Invalid verification link. Please check your email and try again."})})]})})},kc=()=>{const[t,s]=c.useState(!1),[r,a]=c.useState(0),[i,n]=c.useState(null),[l,h]=c.useState("All"),[v,S]=c.useState(!1),b=()=>h("All"),_=zt(),m=Oe();c.useEffect(()=>{const C=()=>{S(window.innerWidth<=900)};return C(),window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[]),c.useEffect(()=>{const C=new URLSearchParams(_.search),M=C.get("login"),y=C.get("user"),L=C.get("message");if(M==="success"&&y)try{const Y=JSON.parse(decodeURIComponent(y));console.log("üéâ Google OAuth successful! User:",Y),localStorage.setItem("oauth_confirmation_pending","true"),console.log("üîî Auto-signing in user:",Y.display_name),localStorage.setItem("user",JSON.stringify(Y)),localStorage.setItem("isAuthenticated","true"),console.log("‚úÖ User auto-signed in via OAuth"),localStorage.removeItem("oauth_confirmation_pending"),window.dispatchEvent(new CustomEvent("oauthSuccess",{detail:Y})),console.log("üì° Dispatched oauthSuccess event to Navbar");const J=_.pathname;m(J,{replace:!0})}catch(Y){console.error("Error parsing user data:",Y),localStorage.removeItem("oauth_confirmation_pending"),alert("Login successful but there was an error processing your data. Please try again."),m("/",{replace:!0})}else M==="error"&&(console.error("‚ùå Google OAuth error:",L),localStorage.removeItem("oauth_confirmation_pending"),alert(`Login failed: ${L||"An unknown error occurred. Please try again."}`),m("/",{replace:!0}));C.get("clear")==="true"&&(localStorage.removeItem("user"),localStorage.removeItem("isAuthenticated"),localStorage.removeItem("oauth_confirmation_pending"),localStorage.removeItem("customer_authenticated"),localStorage.removeItem("customer_user"),localStorage.removeItem("user_authenticated"),localStorage.removeItem("user_email"),window.supabase&&window.supabase.auth.signOut(),console.log("üßπ Cleared all login data for testing"),m("/",{replace:!0}))},[_.search,m]),c.useEffect(()=>{(async()=>{const M=_.pathname.match(/^\/profile\/(.+)$/);if(M){const y=M[1];try{const L=await fetch(`${Me.ENDPOINTS.USER_SUBSCRIPTION}/${y}/subscription`);if(L.ok){const Y=await L.json();n(Y)}else n({isThirdTier:!1})}catch(L){console.error("Error fetching subscription data:",L),n({isThirdTier:!1})}}else n(null)})()},[_.pathname]);const x=t&&!(i!=null&&i.isThirdTier);return console.log("üöÄ App.jsx rendering - current path:",_.pathname),e.jsxs("div",{style:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsx(Fa,{setSidebar:s,resetCategory:b}),e.jsxs("div",{style:{display:"flex",flex:1},children:[x&&e.jsx(ac,{sidebar:t,category:r,setCategory:a}),t&&v&&e.jsx("div",{className:"mobile-sidebar-backdrop",onClick:()=>s(!1),style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999,display:"block"}}),e.jsxs("div",{className:"main-content-area",style:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{flex:1},children:e.jsxs(ja,{children:[e.jsx(Ie,{path:"/",element:e.jsx(Hl,{sidebar:t,category:r,selectedCategory:l,setSelectedCategory:h})}),e.jsx(Ie,{path:"/video/:categoryId/:videoId",element:e.jsx(Jl,{sidebar:t})}),e.jsx(Ie,{path:"/upload",element:e.jsx(Xl,{sidebar:t})}),e.jsx(Ie,{path:"/profile/:username",element:e.jsx(Zl,{sidebar:t})}),e.jsx(Ie,{path:"/approve-subscription",element:e.jsx(Kl,{})}),e.jsx(Ie,{path:"/dashboard",element:e.jsx(Ql,{sidebar:t})}),e.jsx(Ie,{path:"/subscription-tiers",element:e.jsx(ec,{})}),e.jsx(Ie,{path:"/subscription-success",element:e.jsx(tc,{})}),e.jsx(Ie,{path:"/success",element:e.jsx(sc,{})}),e.jsx(Ie,{path:"/coming-soon",element:e.jsx(ic,{})}),e.jsx(Ie,{path:"/admin",element:e.jsx(nc,{})}),e.jsx(Ie,{path:"/auth",element:e.jsx(oc,{})}),e.jsx(Ie,{path:"/login",element:e.jsx(xr,{})}),e.jsx(Ie,{path:"/signup",element:e.jsx(xr,{})}),e.jsx(Ie,{path:"/privacy-policy",element:e.jsx(lc,{})}),e.jsx(Ie,{path:"/terms-of-service",element:e.jsx(cc,{})}),e.jsx(Ie,{path:"/search",element:e.jsx(dc,{})}),e.jsx(Ie,{path:"/channel/:channelName",element:e.jsx(hc,{})}),e.jsx(Ie,{path:"/merchandise",element:e.jsx(uc,{sidebar:t})}),e.jsx(Ie,{path:"/product/browse",element:e.jsx(vr,{sidebar:t})}),e.jsx(Ie,{path:"/product/:productId",element:e.jsx(vr,{sidebar:t})}),e.jsx(Ie,{path:"/test-crop-tool",element:e.jsx(wc,{})}),e.jsx(Ie,{path:"/payment-portal",element:e.jsx(Sc,{})}),e.jsx(Ie,{path:"/checkout",element:e.jsx(bc,{})}),e.jsx(Ie,{path:"/payment-setup",element:e.jsx(_c,{})}),e.jsx(Ie,{path:"/tools",element:e.jsx(ga,{})}),e.jsx(Ie,{path:"/verify-email",element:e.jsx(Cc,{})})]})}),e.jsx($a,{})]})]})]})};console.log("Cache busted - FORCING API CONFIG OVERRIDE");console.log("Timestamp:",new Date().toISOString());console.log("Build ID:",Math.random().toString(36).substring(7));console.log("üîß FORCING BACKEND URL TO: https://screenmerch.fly.dev");ks.createRoot(document.getElementById("root")).render(e.jsx(Sa.StrictMode,{children:e.jsx(ba,{children:e.jsx(kc,{})})}));
